/**
 * Sturvive - v0.0.1 - 2014-01-13
 * 
 *
 * Copyright (c) 2014 Manland
 * Licensed  <>
 */
!function(window){var requirejs,require,define;!function(W){function D(a){return"[object Function]"===M.call(a)}function E(a){return"[object Array]"===M.call(a)}function t(a,b){if(a){var c;for(c=0;c<a.length&&(!a[c]||!b(a[c],c,a));c+=1);}}function N(a,b){if(a){var c;for(c=a.length-1;c>-1&&(!a[c]||!b(a[c],c,a));c-=1);}}function A(a,b){for(var c in a)if(a.hasOwnProperty(c)&&b(a[c],c))break}function O(a,b,c,d){return b&&A(b,function(b,e){(c||!F.call(a,e))&&(d&&"string"!=typeof b?(a[e]||(a[e]={}),O(a[e],b,c,d)):a[e]=b)}),a}function r(a,b){return function(){return b.apply(a,arguments)}}function X(a){if(!a)return a;var b=W;return t(a.split("."),function(a){b=b[a]}),b}function G(a,b,c,d){return b=Error(b+"\nhttp://requirejs.org/docs/errors.html#"+a),b.requireType=a,b.requireModules=d,c&&(b.originalError=c),b}function ba(){return H&&"interactive"===H.readyState?H:(N(document.getElementsByTagName("script"),function(a){return"interactive"===a.readyState?H=a:void 0}),H)}var g,s,u,y,q,B,H,I,Y,Z,ca=/(\/\*([\s\S]*?)\*\/|([^:]|^)\/\/(.*)$)/gm,da=/[^.]\s*require\s*\(\s*["']([^'"\s]+)["']\s*\)/g,$=/\.js$/,ea=/^\.\//;s=Object.prototype;var M=s.toString,F=s.hasOwnProperty,fa=Array.prototype.splice,v=!("undefined"==typeof window||!navigator||!document),aa=!v&&"undefined"!=typeof importScripts,ga=v&&"PLAYSTATION 3"===navigator.platform?/^complete$/:/^(complete|loaded)$/,R="undefined"!=typeof opera&&"[object Opera]"===opera.toString(),w={},n={},P=[],J=!1;if("undefined"==typeof define){if("undefined"!=typeof requirejs){if(D(requirejs))return;n=requirejs,requirejs=void 0}"undefined"!=typeof require&&!D(require)&&(n=require,require=void 0),g=requirejs=function(a,b,c,d){var e,f="_";return!E(a)&&"string"!=typeof a&&(e=a,E(b)?(a=b,b=c,c=d):a=[]),e&&e.context&&(f=e.context),(d=w[f])||(d=w[f]=g.s.newContext(f)),e&&d.configure(e),d.require(a,b,c)},g.config=function(a){return g(a)},g.nextTick="undefined"!=typeof setTimeout?function(a){setTimeout(a,4)}:function(a){a()},require||(require=g),g.version="2.1.1",g.jsExtRegExp=/^\/|:|\?|\.js$/,g.isBrowser=v,s=g.s={contexts:w,newContext:function(a){function b(a,b,c){var d,e,f,g,h,i,j,k=b&&b.split("/");d=k;var l=y.map,m=l&&l["*"];if(a&&"."===a.charAt(0))if(b){for(d=y.pkgs[b]?k=[b]:k.slice(0,k.length-1),b=a=d.concat(a.split("/")),d=0;b[d];d+=1)if(e=b[d],"."===e)b.splice(d,1),d-=1;else if(".."===e){if(1===d&&(".."===b[2]||".."===b[0]))break;d>0&&(b.splice(d-1,2),d-=2)}d=y.pkgs[b=a[0]],a=a.join("/"),d&&a===b+"/"+d.main&&(a=b)}else 0===a.indexOf("./")&&(a=a.substring(2));if(c&&(k||m)&&l){for(b=a.split("/"),d=b.length;d>0;d-=1){if(f=b.slice(0,d).join("/"),k)for(e=k.length;e>0;e-=1)if((c=l[k.slice(0,e).join("/")])&&(c=c[f])){g=c,h=d;break}if(g)break;!i&&m&&m[f]&&(i=m[f],j=d)}!g&&i&&(g=i,h=j),g&&(b.splice(0,h,g),a=b.join("/"))}return a}function c(a){v&&t(document.getElementsByTagName("script"),function(b){return b.getAttribute("data-requiremodule")===a&&b.getAttribute("data-requirecontext")===u.contextName?(b.parentNode.removeChild(b),!0):void 0})}function d(a){var b=y.paths[a];return b&&E(b)&&b.length>1?(c(a),b.shift(),u.require.undef(a),u.require([a]),!0):void 0}function e(a){var b,c=a?a.indexOf("!"):-1;return c>-1&&(b=a.substring(0,c),a=a.substring(c+1,a.length)),[b,a]}function f(a,c,d,f){var g,h,i=null,j=c?c.name:null,k=a,l=!0,m="";return a||(l=!1,a="_@r"+(L+=1)),a=e(a),i=a[0],a=a[1],i&&(i=b(i,j,f),h=I[i]),a&&(i?m=h&&h.normalize?h.normalize(a,function(a){return b(a,j,f)}):b(a,j,f):(m=b(a,j,f),a=e(m),i=a[0],m=a[1],d=!0,g=u.nameToUrl(m))),d=!i||h||d?"":"_unnormalized"+(M+=1),{prefix:i,name:m,parentMap:c,unnormalized:!!d,url:g,originalName:k,isDefine:l,id:(i?i+"!"+m:m)+d}}function h(a){var b=a.id,c=z[b];return c||(c=z[b]=new u.Module(a)),c}function i(a,b,c){var d=a.id,e=z[d];!F.call(I,d)||e&&!e.defineEmitComplete?h(a).on(b,c):"defined"===b&&c(I[d])}function j(a,b){var c=a.requireModules,d=!1;b?b(a):(t(c,function(b){(b=z[b])&&(b.error=a,b.events.error&&(d=!0,b.emit("error",a)))}),d||g.onError(a))}function k(){P.length&&(fa.apply(C,[C.length-1,0].concat(P)),P=[])}function l(a,b,c){var d=a.map.id;a.error?a.emit("error",a.error):(b[d]=!0,t(a.depMaps,function(d,e){var f=d.id,g=z[f];g&&!a.depMatched[e]&&!c[f]&&(b[f]?(a.defineDep(e,I[f]),a.check()):l(g,b,c))}),c[d]=!0)}function m(){var a,b,e,f,g=(e=1e3*y.waitSeconds)&&u.startTime+e<(new Date).getTime(),h=[],i=[],k=!1,n=!0;if(!q){if(q=!0,A(z,function(e){if(a=e.map,b=a.id,e.enabled&&(a.isDefine||i.push(e),!e.error))if(!e.inited&&g)d(b)?k=f=!0:(h.push(b),c(b));else if(!e.inited&&e.fetched&&a.isDefine&&(k=!0,!a.prefix))return n=!1}),g&&h.length)return e=G("timeout","Load timeout for modules: "+h,null,h),e.contextName=u.contextName,j(e);n&&t(i,function(a){l(a,{},{})}),g&&!f||!k||!v&&!aa||x||(x=setTimeout(function(){x=0,m()},50)),q=!1}}function n(a){h(f(a[0],null,!0)).init(a[1],a[2])}function o(a){var a=a.currentTarget||a.srcElement,b=u.onScriptLoad;return a.detachEvent&&!R?a.detachEvent("onreadystatechange",b):a.removeEventListener("load",b,!1),b=u.onScriptError,a.detachEvent&&!R||a.removeEventListener("error",b,!1),{node:a,id:a&&a.getAttribute("data-requiremodule")}}function p(){var a;for(k();C.length;){if(a=C.shift(),null===a[0])return j(G("mismatch","Mismatched anonymous define() module: "+a[a.length-1]));n(a)}}var q,s,u,w,x,y={waitSeconds:7,baseUrl:"./",paths:{},pkgs:{},shim:{},map:{},config:{}},z={},B={},C=[],I={},K={},L=1,M=1;return w={require:function(a){return a.require?a.require:a.require=u.makeRequire(a.map)},exports:function(a){return a.usingExports=!0,a.map.isDefine?a.exports?a.exports:a.exports=I[a.map.id]={}:void 0},module:function(a){return a.module?a.module:a.module={id:a.map.id,uri:a.map.url,config:function(){return y.config&&y.config[a.map.id]||{}},exports:I[a.map.id]}}},s=function(a){this.events=B[a.id]||{},this.map=a,this.shim=y.shim[a.id],this.depExports=[],this.depMaps=[],this.depMatched=[],this.pluginMaps={},this.depCount=0},s.prototype={init:function(a,b,c,d){d=d||{},this.inited||(this.factory=b,c?this.on("error",c):this.events.error&&(c=r(this,function(a){this.emit("error",a)})),this.depMaps=a&&a.slice(0),this.errback=c,this.inited=!0,this.ignore=d.ignore,d.enabled||this.enabled?this.enable():this.check())},defineDep:function(a,b){this.depMatched[a]||(this.depMatched[a]=!0,this.depCount-=1,this.depExports[a]=b)},fetch:function(){if(!this.fetched){this.fetched=!0,u.startTime=(new Date).getTime();var a=this.map;if(!this.shim)return a.prefix?this.callPlugin():this.load();u.makeRequire(this.map,{enableBuildCallback:!0})(this.shim.deps||[],r(this,function(){return a.prefix?this.callPlugin():this.load()}))}},load:function(){var a=this.map.url;K[a]||(K[a]=!0,u.load(this.map.id,a))},check:function(){if(this.enabled&&!this.enabling){var a,b,c=this.map.id;b=this.depExports;var d=this.exports,e=this.factory;if(this.inited){if(this.error)this.emit("error",this.error);else if(!this.defining){if(this.defining=!0,this.depCount<1&&!this.defined){if(D(e)){if(this.events.error)try{d=u.execCb(c,e,b,d)}catch(f){a=f}else d=u.execCb(c,e,b,d);if(this.map.isDefine&&((b=this.module)&&void 0!==b.exports&&b.exports!==this.exports?d=b.exports:void 0===d&&this.usingExports&&(d=this.exports)),a)return a.requireMap=this.map,a.requireModules=[this.map.id],a.requireType="define",j(this.error=a)}else d=e;this.exports=d,this.map.isDefine&&!this.ignore&&(I[c]=d,g.onResourceLoad)&&g.onResourceLoad(u,this.map,this.depMaps),delete z[c],this.defined=!0}this.defining=!1,this.defined&&!this.defineEmitted&&(this.defineEmitted=!0,this.emit("defined",this.exports),this.defineEmitComplete=!0)}}else this.fetch()}},callPlugin:function(){var a=this.map,c=a.id,d=f(a.prefix);this.depMaps.push(d),i(d,"defined",r(this,function(d){var e,k;k=this.map.name;var l=this.map.parentMap?this.map.parentMap.name:null,m=u.makeRequire(a.parentMap,{enableBuildCallback:!0,skipMap:!0});this.map.unnormalized?(d.normalize&&(k=d.normalize(k,function(a){return b(a,l,!0)})||""),d=f(a.prefix+"!"+k,this.map.parentMap),i(d,"defined",r(this,function(a){this.init([],function(){return a},null,{enabled:!0,ignore:!0})})),(k=z[d.id])&&(this.depMaps.push(d),this.events.error&&k.on("error",r(this,function(a){this.emit("error",a)})),k.enable())):(e=r(this,function(a){this.init([],function(){return a},null,{enabled:!0})}),e.error=r(this,function(a){this.inited=!0,this.error=a,a.requireModules=[c],A(z,function(a){0===a.map.id.indexOf(c+"_unnormalized")&&delete z[a.map.id]}),j(a)}),e.fromText=r(this,function(b,c){var d=a.name,i=f(d),j=J;c&&(b=c),j&&(J=!1),h(i);try{g.exec(b)}catch(k){throw Error("fromText eval for "+d+" failed: "+k)}j&&(J=!0),this.depMaps.push(i),u.completeLoad(d),m([d],e)}),d.load(a.name,m,e,y))})),u.enable(d,this),this.pluginMaps[d.id]=d},enable:function(){this.enabling=this.enabled=!0,t(this.depMaps,r(this,function(a,b){var c,d;if("string"==typeof a){if(a=f(a,this.map.isDefine?this.map:this.map.parentMap,!1,!this.skipMap),this.depMaps[b]=a,c=w[a.id])return this.depExports[b]=c(this),void 0;this.depCount+=1,i(a,"defined",r(this,function(a){this.defineDep(b,a),this.check()})),this.errback&&i(a,"error",this.errback)}c=a.id,d=z[c],!w[c]&&d&&!d.enabled&&u.enable(a,this)})),A(this.pluginMaps,r(this,function(a){var b=z[a.id];b&&!b.enabled&&u.enable(a,this)})),this.enabling=!1,this.check()},on:function(a,b){var c=this.events[a];c||(c=this.events[a]=[]),c.push(b)},emit:function(a,b){t(this.events[a],function(a){a(b)}),"error"===a&&delete this.events[a]}},u={config:y,contextName:a,registry:z,defined:I,urlFetched:K,defQueue:C,Module:s,makeModuleMap:f,nextTick:g.nextTick,configure:function(a){a.baseUrl&&"/"!==a.baseUrl.charAt(a.baseUrl.length-1)&&(a.baseUrl+="/");var b=y.pkgs,c=y.shim,d={paths:!0,config:!0,map:!0};A(a,function(a,b){d[b]?"map"===b?O(y[b],a,!0,!0):O(y[b],a,!0):y[b]=a}),a.shim&&(A(a.shim,function(a,b){E(a)&&(a={deps:a}),a.exports&&!a.exportsFn&&(a.exportsFn=u.makeShimExports(a)),c[b]=a}),y.shim=c),a.packages&&(t(a.packages,function(a){a="string"==typeof a?{name:a}:a,b[a.name]={name:a.name,location:a.location||a.name,main:(a.main||"main").replace(ea,"").replace($,"")}}),y.pkgs=b),A(z,function(a,b){a.inited||a.map.unnormalized||(a.map=f(b))}),(a.deps||a.callback)&&u.require(a.deps||[],a.callback)},makeShimExports:function(a){return function(){var b;return a.init&&(b=a.init.apply(W,arguments)),b||X(a.exports)}},makeRequire:function(c,d){function e(b,i,k){var l,n;return d.enableBuildCallback&&i&&D(i)&&(i.__requireJsBuild=!0),"string"==typeof b?D(i)?j(G("requireargs","Invalid require call"),k):c&&w[b]?w[b](z[c.id]):g.get?g.get(u,b,c):(l=f(b,c,!1,!0),l=l.id,F.call(I,l)?I[l]:j(G("notloaded",'Module name "'+l+'" has not been loaded yet for context: '+a+(c?"":". Use require([])")))):(p(),u.nextTick(function(){p(),n=h(f(null,c)),n.skipMap=d.skipMap,n.init(b,i,k,{enabled:!0}),m()}),e)}return d=d||{},O(e,{isBrowser:v,toUrl:function(a){var d=a.lastIndexOf("."),e=null;return-1!==d&&(e=a.substring(d,a.length),a=a.substring(0,d)),u.nameToUrl(b(a,c&&c.id,!0),e)},defined:function(a){return a=f(a,c,!1,!0).id,F.call(I,a)},specified:function(a){return a=f(a,c,!1,!0).id,F.call(I,a)||F.call(z,a)}}),c||(e.undef=function(a){k();var b=f(a,c,!0),d=z[a];delete I[a],delete K[b.url],delete B[a],d&&(d.events.defined&&(B[a]=d.events),delete z[a])}),e},enable:function(a){z[a.id]&&h(a).enable()},completeLoad:function(a){var b,c,e=y.shim[a]||{},f=e.exports;for(k();C.length;){if(c=C.shift(),null===c[0]){if(c[0]=a,b)break;b=!0}else c[0]===a&&(b=!0);n(c)}if(c=z[a],!b&&!I[a]&&c&&!c.inited){if(!(!y.enforceDefine||f&&X(f)))return d(a)?void 0:j(G("nodefine","No define call for "+a,null,[a]));n([a,e.deps||[],e.exportsFn])}m()},nameToUrl:function(a,b){var c,d,e,f,h,i;if(g.jsExtRegExp.test(a))f=a+(b||"");else{for(c=y.paths,d=y.pkgs,f=a.split("/"),h=f.length;h>0;h-=1){if(i=f.slice(0,h).join("/"),e=d[i],i=c[i]){E(i)&&(i=i[0]),f.splice(0,h,i);break}if(e){c=a===e.name?e.location+"/"+e.main:e.location,f.splice(0,h,c);break}}f=f.join("/"),f+=b||(/\?/.test(f)?"":".js"),f=("/"===f.charAt(0)||f.match(/^[\w\+\.\-]+:/)?"":y.baseUrl)+f}return y.urlArgs?f+((-1===f.indexOf("?")?"?":"&")+y.urlArgs):f},load:function(a,b){g.load(u,a,b)},execCb:function(a,b,c,d){return b.apply(d,c)},onScriptLoad:function(a){("load"===a.type||ga.test((a.currentTarget||a.srcElement).readyState))&&(H=null,a=o(a),u.completeLoad(a.id))},onScriptError:function(a){var b=o(a);return d(b.id)?void 0:j(G("scripterror","Script error",a,[b.id]))}},u.require=u.makeRequire(),u}},g({}),t(["toUrl","undef","defined","specified"],function(a){g[a]=function(){var b=w._;return b.require[a].apply(b,arguments)}}),v&&(u=s.head=document.getElementsByTagName("head")[0],y=document.getElementsByTagName("base")[0])&&(u=s.head=y.parentNode),g.onError=function(a){throw a},g.load=function(a,b,c){var d,e=a&&a.config||{};return v?(d=e.xhtml?document.createElementNS("http://www.w3.org/1999/xhtml","html:script"):document.createElement("script"),d.type=e.scriptType||"text/javascript",d.charset="utf-8",d.async=!0,d.setAttribute("data-requirecontext",a.contextName),d.setAttribute("data-requiremodule",b),!d.attachEvent||d.attachEvent.toString&&d.attachEvent.toString().indexOf("[native code")<0||R?(d.addEventListener("load",a.onScriptLoad,!1),d.addEventListener("error",a.onScriptError,!1)):(J=!0,d.attachEvent("onreadystatechange",a.onScriptLoad)),d.src=c,I=d,y?u.insertBefore(d,y):u.appendChild(d),I=null,d):(aa&&(importScripts(c),a.completeLoad(b)),void 0)},v&&N(document.getElementsByTagName("script"),function(a){return u||(u=a.parentNode),(q=a.getAttribute("data-main"))?(n.baseUrl||(B=q.split("/"),Y=B.pop(),Z=B.length?B.join("/")+"/":"./",n.baseUrl=Z,q=Y),q=q.replace($,""),n.deps=n.deps?n.deps.concat(q):[q],!0):void 0}),define=function(a,b,c){var d,e;"string"!=typeof a&&(c=b,b=a,a=null),E(b)||(c=b,b=[]),!b.length&&D(c)&&c.length&&(c.toString().replace(ca,"").replace(da,function(a,c){b.push(c)}),b=(1===c.length?["require"]:["require","exports","module"]).concat(b)),J&&(d=I||ba())&&(a||(a=d.getAttribute("data-requiremodule")),e=w[d.getAttribute("data-requirecontext")]),(e?e.defQueue:P).push([a,b,c])},define.amd={jQuery:!0},g.exec=function(b){return eval(b)},g(n)}}(this),define("requireLib",function(){}),define("goo/entities/components/Component",[],function(){"use strict";function a(){this.enabled=!0}return a}),define("goo/addons/box2d/components/Box2DComponent",["goo/entities/components/Component"],function(a){"use strict";function b(a){this.type="Box2DComponent",this.body=null,this.world=null,this.mass=1,this.settings=a||{},this.shape=a.shape?a.shape:"box",this.width=a.width?a.width:1,this.height=a.height?a.height:1,this.radius=a.radius?a.radius:1,this.vertices=a.vertices?a.vertices:[0,1,2,2,0,2],this.movable=a.movable===!0?!0:!1,this.friction=a.friction?a.friction:1,this.offsetX=a.offsetX?a.offsetX:0,this.offsetY=a.offsetY?a.offsetY:0}return b.prototype=Object.create(a.prototype),b}),define("goo/entities/systems/System",[],function(){"use strict";function a(a,b){this.type=a,this.interests=b,this._activeEntities=[],this.passive=!1}function b(a){return a.charAt(0).toLowerCase()+a.substr(1)}return a.prototype.added=function(a){this._check(a)},a.prototype.changed=function(a){this._check(a)},a.prototype.removed=function(a){var b=this._activeEntities.indexOf(a);-1!==b&&(this._activeEntities.splice(b,1),this.deleted&&this.deleted(a))},a.prototype._check=function(a){if(!this.interests||0!==this.interests.length){var c=null===this.interests;if(!c&&this.interests.length<=a._components.length){c=!0;for(var d=0;d<this.interests.length;d++){var e=b(this.interests[d]);if(!a[e]){c=!1;break}}}var f=this._activeEntities.indexOf(a);c&&-1===f?(this._activeEntities.push(a),this.inserted&&this.inserted(a)):c||-1===f||(this._activeEntities.splice(f,1),this.deleted&&this.deleted(a))}},a.prototype._process=function(a){this.process&&this.process(this._activeEntities,a)},a}),define("goo/addons/box2d/systems/Box2DSystem",["goo/entities/systems/System"],function(a){"use strict";function b(){a.call(this,"Box2DSystem",["Box2DComponent","MeshDataComponent"]),this.SCALE=.5,this.world=new Box2D.b2World(new Box2D.b2Vec2(0,-9)),this.sortVertexesClockWise=function(a,b){var c=Math.atan2(a.get_y(),a.get_x()),d=Math.atan2(b.get_y(),b.get_x());return c>d?1:-1},this.createPolygonShape=function(a){for(var b=new Box2D.b2PolygonShape,c=Box2D.allocate(8*a.length,"float",Box2D.ALLOC_STACK),d=0,e=0;e<a.length;e++)Box2D.setValue(c+d,a[e].get_x(),"float"),Box2D.setValue(c+(d+4),a[e].get_y(),"float"),d+=8;var f=Box2D.wrapPointer(c,Box2D.b2Vec2);return b.Set(f,a.length),b}}return b.prototype=Object.create(a.prototype),b.prototype.inserted=function(a){var b=a.physics2DComponent,c=0,d=0,e=new Box2D.b2PolygonShape;if("box"===b.shape)e.SetAsBox(b.width*this.SCALE,b.height*this.SCALE);else if("circle"===b.shape)e=new Box2D.b2CircleShape,e.set_m_radius(b.radius);else if("mesh"===b.shape){for(var f=a.meshDataComponent.meshData,g=f.getAttributeBuffer("POSITION"),h=0,i=[],j=1e4,k=-1e4,l=1e4,m=-1e4;h<=g.length-3;){var n=g[h],o=g[++h];j>o&&(j=o),o>k&&(k=o),l>n&&(l=n),n>m&&(m=n),++h,a.transformComponent.updateWorldTransform();var p=new Box2D.b2Vec2(n,o);i.push(p)}e=this.createPolygonShape(i),c=Math.abs(k-j),d=Math.abs(m-l)}else if("polygon"===b.shape){for(var i=[],h=0;h<=b.vertices.length-2;){var p=new Box2D.b2Vec2(b.vertices[h],b.vertices[++h]);i.push(p),++h}e=this.createPolygonShape(i),console.log(i)}var q=new Box2D.b2FixtureDef;q.set_shape(e),q.set_density(1),q.set_friction(b.friction);var r=new Box2D.b2BodyDef;b.movable===!0&&r.set_type(Box2D.b2_dynamicBody),r.set_position(new Box2D.b2Vec2(a.transformComponent.transform.translation.x+b.offsetX,a.transformComponent.transform.translation.y+b.offsetY));var s=this.world.CreateBody(r);s.CreateFixture(q),s.SetLinearDamping(.95),s.SetAngularDamping(.6),b.body=s,b.world=this.world,a.body=s,a.body.h=c,a.body.w=d},b.prototype.deleted=function(){},b.prototype.process=function(a,b){this.world.Step(b,2,2);for(var c=0;c<a.length;c++){var d=a[c].body.GetPosition();a[c].transformComponent.transform.translation.y=d.get_y()-a[c].physics2DComponent.offsetY,a[c].transformComponent.transform.translation.x=d.get_x()-a[c].physics2DComponent.offsetX,a[c].transformComponent.setUpdated(),a[c].transformComponent.transform.rotation.z=a[c].body.GetAngle(),d.get_y()>100&&a[c].body.ApplyForce(new Box2D.b2Vec2(0,-100),a[c].body.GetPosition())}},b}),define("goo/addons/cannon/components/CannonjsComponent",["goo/entities/components/Component"],function(a){"use strict";function b(a){this.type="CannonjsComponent",this.settings=a||{},this.mass=void 0!==a.mass?a.mass:0,this.useBounds=void 0!==a.useBounds?a.useBounds:!1,this.linearDamping=void 0!==a.linearDamping?a.linearDamping:0,this.angularDamping=void 0!==a.angularDamping?a.angularDamping:0}return b.prototype=Object.create(a.prototype),b}),define("goo/math/MathUtils",[],function(){"use strict";function a(){}return a.DEG_TO_RAD=Math.PI/180,a.RAD_TO_DEG=180/Math.PI,a.HALF_PI=.5*Math.PI,a.TWO_PI=2*Math.PI,a.EPSILON=1e-7,a.radFromDeg=function(b){return b*a.DEG_TO_RAD},a.degFromRad=function(b){return b*a.RAD_TO_DEG},a.lerp=function(a,b,c){return b===c?b:b+(c-b)*a},a.clamp=function(a,b,c){return c>b?b>a?b:a>c?c:a:c>a?c:a>b?b:a},a.moduloPositive=function(a,b){var c=a%b;return c+=0>c?b:0},a.scurve3=function(a){return(-2*a+3)*a*a},a.scurve5=function(a){return((6*a-15)*a+10)*a*a*a},a.sphericalToCartesian=function(a,b,c,d){var e=a*Math.cos(c);d.x=e*Math.cos(b),d.y=a*Math.sin(c),d.z=e*Math.sin(b)},a.cartesianToSpherical=function(a,b,c,d){var e=Math.sqrt(a*a+c*c);d.x=Math.sqrt(a*a+b*b+c*c),d.y=Math.atan2(c,a),d.z=Math.atan2(b,e)},a.getTriangleNormal=function(a,b,c,d,e,f,g,h,i){var j=d-a,k=e-b,l=f-c,m=g-a,n=h-b,o=i-c,p=k*o-l*n,q=l*m-j*o,r=j*n-k*m;return[p,q,r]},a.isPowerOfTwo=function(a){return 0===(a&a-1)},a.nearestHigherPowerOfTwo=function(a){return Math.floor(Math.pow(2,Math.ceil(Math.log(a)/Math.log(2))))},a.closeTo=function(a,b,c){return c="undefined"!=typeof c?c:.001,Math.abs(a-b)<=c},a.sign=function(a){return 0>a?-1:a>0?1:0},a}),define("goo/math/Vector",["goo/math/MathUtils"],function(a){"use strict";function b(a){this.data=new Float32Array(a||0)}return b.prototype.setupAliases=function(a){for(var b=this,c=0;c<a.length;c++)!function(d){for(var e=0;e<a[d].length;e++)Object.defineProperty(b,a[d][e],{get:function(){return this.data[d]},set:function(a){this.data[d]=a}});Object.defineProperty(b,c,{get:function(){return this.data[d]},set:function(a){this.data[d]=a}})}(c)},b.add=function(a,c,d){var e=a.data||a,f=c.data||c,g=e.length;if(d||(d=new b(g)),f.length!==g||d.data.length!==g)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};for(var h=0;g>h;h++)d.data[h]=e[h]+f[h];return d},b.prototype.add=function(a){return b.add(this,a,this)},b.sub=function(a,c,d){var e=a.data||a,f=c.data||c,g=e.length;if(d||(d=new b(g)),f.length!==g||d.data.length!==g)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};for(var h=0;g>h;h++)d.data[h]=e[h]-f[h];return d},b.prototype.sub=function(a){return b.sub(this,a,this)},b.mul=function(a,c,d){var e=a.data||a,f=c.data||c,g=e.length;if(d||(d=new b(g)),f.length!==g||d.data.length!==g)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};for(var h=0;g>h;h++)d.data[h]=e[h]*f[h];return d},b.prototype.mul=function(a){return b.mul(this,a,this)},b.div=function(a,c,d){var e=a.data||a,f=c.data||c,g=e.length;if(d||(d=new b(g)),f.length!==g||d.data.length!==g)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};for(var h=0;g>h;h++)d.data[h]=e[h]/f[h];return d},b.prototype.div=function(a){return b.div(this,a,this)},b.copy=function(a,c){var d=a.data.length;if(c||(c=new b(d)),c.data.length!==d)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};return c.data.set(a.data),c},b.prototype.copy=function(a){return b.copy(a,this)},b.dot=function(a,b){var c=a.data||a,d=b.data||b,e=c.length;if(d.length!==e)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};for(var f=0,g=0;e>g;g++)f+=c[g]*d[g];return f},b.prototype.dot=function(a){return b.dot(this,a)},b.apply=function(a,c,d){var e=a.rows,f=a.cols,g=c.data.length;if(d||(d=new b(e)),d.data.length!==e||f!==g)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};if(d===c)return b.copy(b.apply(a,c),d);for(var h=0;f>h;h++)for(var i=h*e,j=0;e>j;j++){for(var k=0,l=0;g>l;l++)k+=a.data[l*a.rows+j]*c.data[l];d.data[i+j]=k}return d},b.prototype.apply=function(a){return b.apply(a,this,this)},b.equals=function(b,c){var d=b.data.length;if(d!==c.data.length)return!1;for(var e=0;d>e;e++)if(Math.abs(b.data[e]-c.data[e])>a.EPSILON)return!1;return!0},b.prototype.equals=function(a){return b.equals(this,a)},b.distanceSquared=function(a,c){return b.sub(a,c).lengthSquared()},b.prototype.distanceSquared=function(a){return b.sub(this,a).lengthSquared()},b.distance=function(a,c){return b.sub(a,c).length()},b.prototype.distance=function(a){return b.sub(this,a).length()},b.prototype.lengthSquared=function(){return b.dot(this,this)},b.prototype.length=function(){return Math.sqrt(b.dot(this,this))},b.prototype.scale=function(a){for(var b=this.data.length-1;b>=0;b--)this.data[b]*=a;return this},b.prototype.invert=function(){for(var a=0;a<this.data.length;a++)this.data[a]=0-this.data[a];return this},b.prototype.normalize=function(){var b=this.length(),c=this.data.length;if(b<a.EPSILON)for(var d=0;c>d;d++)this.data[d]=0;else{b=1/b;for(var d=0;c>d;d++)this.data[d]*=b}return this},b.prototype.clone=function(){return b.copy(this)},b.prototype.set=function(){if(1===arguments.length&&"object"==typeof arguments[0])if(arguments[0]instanceof b)this.copy(arguments[0]);else if(arguments[0].length>1)for(var a=0;a<arguments[0].length;a++)this.data[a]=arguments[0][a];else this.set(arguments[0][0]);else for(var a=0;a<arguments.length;a++)this.data[a]=arguments[a];return this},b.prototype.toString=function(){var a="";a+="[";for(var b=0;b<this.data.length;b++)a+=this.data[b],a+=b!==this.data.length-1?", ":"";return a+="]"},b}),define("goo/math/Vector3",["goo/math/Vector"],function(a){"use strict";function b(){a.call(this,3),0!==arguments.length?this.set(arguments):this.setd(0,0,0)}return b.prototype=Object.create(a.prototype),b.prototype.setupAliases([["x","u","r"],["y","v","g"],["z","w","b"]]),b.ZERO=new b(0,0,0),b.ONE=new b(1,1,1),b.UNIT_X=new b(1,0,0),b.UNIT_Y=new b(0,1,0),b.UNIT_Z=new b(0,0,1),b.add=function(a,c,d){"number"==typeof a&&(a=[a,a,a]),"number"==typeof c&&(c=[c,c,c]),d||(d=new b);var e=a.data||a,f=c.data||c;if(3!==e.length||3!==f.length)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};return d.data[0]=e[0]+f[0],d.data[1]=e[1]+f[1],d.data[2]=e[2]+f[2],d},b.addv=function(a,c,d){return d||(d=new b),d.data[0]=a.data[0]+c.data[0],d.data[1]=a.data[1]+c.data[1],d.data[2]=a.data[2]+c.data[2],d},b.prototype.add=function(a){return b.add(this,a,this)},b.sub=function(a,c,d){"number"==typeof a&&(a=[a,a,a]),"number"==typeof c&&(c=[c,c,c]),d||(d=new b);var e=a.data||a,f=c.data||c;if(3!==e.length||3!==f.length)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};return d.data[0]=e[0]-f[0],d.data[1]=e[1]-f[1],d.data[2]=e[2]-f[2],d},b.subv=function(a,c,d){return d||(d=new b),d.data[0]=a.data[0]-c.data[0],d.data[1]=a.data[1]-c.data[1],d.data[2]=a.data[2]-c.data[2],d},b.prototype.sub=function(a){return b.sub(this,a,this)},b.mul=function(a,c,d){"number"==typeof a&&(a=[a,a,a]),"number"==typeof c&&(c=[c,c,c]),d||(d=new b);var e=a.data||a,f=c.data||c;if(3!==e.length||3!==f.length)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};return d.data[0]=e[0]*f[0],d.data[1]=e[1]*f[1],d.data[2]=e[2]*f[2],d},b.prototype.mul=function(a){return b.mul(this,a,this)},b.div=function(a,c,d){"number"==typeof a&&(a=[a,a,a]),"number"==typeof c&&(c=[c,c,c]),d||(d=new b);var e=a.data||a,f=c.data||c;if(3!==e.length||3!==f.length)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};return d.data[0]=e[0]/f[0],d.data[1]=e[1]/f[1],d.data[2]=e[2]/f[2],d},b.prototype.div=function(a){return b.div(this,a,this)},b.dot=function(a,b){"number"==typeof a&&(a=[a,a,a]),"number"==typeof b&&(b=[b,b,b]);var c=a.data||a,d=b.data||b;if(3!==c.length||3!==d.length)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};var e=0;return e+=c[0]*d[0],e+=c[1]*d[1],e+=c[2]*d[2]},b.prototype.dot=function(a){return b.dot(this,a)},b.cross=function(a,c,d){d||(d=new b);var e=a.data||a,f=c.data||c;if(3!==e.length||3!==f.length)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};var g=c.data[2]*a.data[1]-c.data[1]*a.data[2],h=c.data[0]*a.data[2]-c.data[2]*a.data[0],i=c.data[1]*a.data[0]-c.data[0]*a.data[1];return d.data[0]=g,d.data[1]=h,d.data[2]=i,d},b.prototype.cross=function(a){return b.cross(this,a,this)},b.prototype.lerp=function(a,b){return this.data[0]=(1-b)*this.data[0]+b*a.data[0],this.data[1]=(1-b)*this.data[1]+b*a.data[1],this.data[2]=(1-b)*this.data[2]+b*a.data[2],this},b.prototype.setd=function(a,b,c){return this.data[0]=a,this.data[1]=b,this.data[2]=c,this},b.prototype.seta=function(a){return this.data[0]=a[0],this.data[1]=a[1],this.data[2]=a[2],this},b.prototype.setv=function(a){return this.data[0]=a.data[0],this.data[1]=a.data[1],this.data[2]=a.data[2],this},b.prototype.add_d=function(a,b,c){return this.data[0]+=a,this.data[1]+=b,this.data[2]+=c,this},b.prototype.addv=function(a){return this.data[0]+=a.data[0],this.data[1]+=a.data[1],this.data[2]+=a.data[2],this},b.prototype.mulv=function(a){return this.data[0]*=a.data[0],this.data[1]*=a.data[1],this.data[2]*=a.data[2],this},b.prototype.muld=function(a,b,c){return this.data[0]*=a,this.data[1]*=b,this.data[2]*=c,this},b.prototype.subv=function(a){return this.data[0]-=a.data[0],this.data[1]-=a.data[1],this.data[2]-=a.data[2],this},b.prototype.sub_d=function(a,b,c){return this.data[0]-=a,this.data[1]-=b,this.data[2]-=c,this},b.prototype.lengthSquared=function(){return this.data[0]*this.data[0]+this.data[1]*this.data[1]+this.data[2]*this.data[2]},b.distanceSquared=function(a,b){var c=a.data[0]-b.data[0],d=a.data[1]-b.data[1],e=a.data[2]-b.data[2];return c*c+d*d+e*e},b.distance=function(a,c){return Math.sqrt(b.distanceSquared(a,c))},b.prototype.distanceSquared=function(a){return b.distanceSquared(this,a)},b.prototype.distance=function(a){return b.distance(this,a)},b}),define("goo/renderer/bounds/BoundingVolume",["goo/math/Vector3"],function(a){"use strict";function b(b){this.center=new a,void 0!==b&&this.center.setv(b),this.min=new a(1/0,1/0,1/0),this.max=new a(-1/0,-1/0,-1/0)}return b.Outside=0,b.Inside=1,b.Intersects=2,b}),define("goo/renderer/BufferData",[],function(){"use strict";function a(a,b){this.data=a,this.target=b,this.glBuffer=null,this._dataUsage="StaticDraw",this._dataNeedsRefresh=!1}return a.prototype.setDataUsage=function(a){this._dataUsage=a},a.prototype.setDataNeedsRefresh=function(){this._dataNeedsRefresh=!0},a}),define("goo/renderer/Util",[],function(){"use strict";function a(){}return a.getByteSize=function(a){switch(a){case"Byte":return 1;case"UnsignedByte":return 1;case"Short":return 2;case"UnsignedShort":return 2;case"Int":return 4;case"HalfFloat":return 2;case"Float":return 4;case"Double":return 8;default:throw"Unknown type: "+a}},a.checkGLError=function(a){for(var b=a.getError(),c=!1;b!==a.NO_ERROR;){if(c=!0,b===a.INVALID_ENUM)console.error("An unacceptable value is specified for an enumerated argument. The offending command is ignored and has no other side effect than to set the error flag.");else if(b===a.INVALID_VALUE)console.error("A numeric argument is out of range. The offending command is ignored and has no other side effect than to set the error flag.");else if(b===a.INVALID_OPERATION)console.error("The specified operation is not allowed in the current state. The offending command is ignored and has no other side effect than to set the error flag.");else if(b===a.FRAMEBUFFER_COMPLETE)console.error("The command is trying to render to or read from the framebuffer while the currently bound framebuffer is not framebuffer complete (i.e. the return value from glCheckFramebufferStatus is not GL_FRAMEBUFFER_COMPLETE). The offending command is ignored and has no other side effect than to set the error flag.");else if(b===a.OUT_OF_MEMORY)throw"There is not enough memory left to execute the command. The state of the GL is undefined, except for the state of the error flags, after this error is recorded.";b=a.getError()}if(c)throw"Stopping due to error"},a.isPowerOfTwo=function(a){return 0===(a&a-1)},a.nearestPowerOfTwo=function(a){return Math.pow(2,Math.ceil(Math.log(a)/Math.log(2)))},a.clone=function(b){if(null===b||"object"!=typeof b)return b;if(b instanceof Uint8Array)return b;if(b instanceof Date){var c=new Date;return c.setTime(b.getTime()),c}if(b instanceof Array){for(var c=[],d=0,e=b.length;e>d;++d)c[d]=a.clone(b[d]);return c}if(b instanceof Object){var c={};for(var f in b)b.hasOwnProperty(f)&&(c[f]=a.clone(b[f]));return c}throw new Error("Unable to copy obj! Its type isn't supported.")},a}),define("goo/renderer/BufferUtils",[],function(){"use strict";function a(){}return a.createIndexBuffer=function(a,b){var c;if(256>b)c=new Uint8Array(a);else{if(!(65536>b))throw new Error("Maximum number of vertices is 65535. Got: "+b);c=new Uint16Array(a)}return c},a}),define("goo/math/Vector2",["goo/math/Vector"],function(a){"use strict";function b(){a.call(this,2),0!==arguments.length?this.set(arguments):this.setd(0,0)}return b.prototype=Object.create(a.prototype),b.prototype.setupAliases([["x","u","s"],["y","v","t"]]),b.ZERO=new b(0,0),b.ONE=new b(1,1),b.UNIT_X=new b(1,0),b.UNIT_Y=new b(0,1),b.add=function(a,c,d){"number"==typeof a&&(a=[a,a]),"number"==typeof c&&(c=[c,c]),d||(d=new b);var e=a.data||a,f=c.data||c;if(2!==e.length||2!==f.length)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};
return d.data[0]=e[0]+f[0],d.data[1]=e[1]+f[1],d},b.prototype.add=function(a){return b.add(this,a,this)},b.sub=function(a,c,d){"number"==typeof a&&(a=[a,a]),"number"==typeof c&&(c=[c,c]),d||(d=new b);var e=a.data||a,f=c.data||c;if(2!==e.length||2!==f.length)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};return d.data[0]=e[0]-f[0],d.data[1]=e[1]-f[1],d},b.prototype.sub=function(a){return b.sub(this,a,this)},b.mul=function(a,c,d){"number"==typeof a&&(a=[a,a]),"number"==typeof c&&(c=[c,c]),d||(d=new b);var e=a.data||a,f=c.data||c;if(2!==e.length||2!==f.length)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};return d.data[0]=e[0]*f[0],d.data[1]=e[1]*f[1],d},b.prototype.mul=function(a){return b.mul(this,a,this)},b.div=function(a,c,d){"number"==typeof a&&(a=[a,a]),"number"==typeof c&&(c=[c,c]),d||(d=new b);var e=a.data||a,f=c.data||c;if(2!==e.length||2!==f.length)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};return d.data[0]=e[0]/f[0],d.data[1]=e[1]/f[1],d},b.prototype.div=function(a){return b.div(this,a,this)},b.dot=function(a,b){"number"==typeof a&&(a=[a,a]),"number"==typeof b&&(b=[b,b]);var c=a.data||a,d=b.data||b;if(2!==c.length||2!==d.length)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};var e=0;return e+=c[0]*d[0],e+=c[1]*d[1]},b.prototype.dot=function(a){return b.dot(this,a)},b.prototype.setd=function(a,b){return this.data[0]=a,this.data[1]=b,this},b.prototype.seta=function(a){return this.data[0]=a[0],this.data[1]=a[1],this},b.prototype.setv=function(a){return this.data[0]=a.data[0],this.data[1]=a.data[1],this},b}),define("goo/math/Vector4",["goo/math/Vector"],function(a){"use strict";function b(){a.call(this,4),0!==arguments.length?this.set(arguments):this.setd(0,0,0,0)}return b.prototype=Object.create(a.prototype),b.prototype.setupAliases([["x","r"],["y","g"],["z","b"],["w","a"]]),b.ZERO=new b(0,0,0,0),b.ONE=new b(1,1,1,1),b.UNIT_X=new b(1,0,0,0),b.UNIT_Y=new b(0,1,0,0),b.UNIT_Z=new b(0,0,1,0),b.UNIT_W=new b(0,0,0,1),b.add=function(a,c,d){"number"==typeof a&&(a=[a,a,a,a]),"number"==typeof c&&(c=[c,c,c,c]),d||(d=new b);var e=a.data||a,f=c.data||c;if(4!==e.length||4!==f.length)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};return d.data[0]=e[0]+f[0],d.data[1]=e[1]+f[1],d.data[2]=e[2]+f[2],d.data[3]=e[3]+f[3],d},b.prototype.add=function(a){return b.add(this,a,this)},b.sub=function(a,c,d){"number"==typeof a&&(a=[a,a,a,a]),"number"==typeof c&&(c=[c,c,c,c]),d||(d=new b);var e=a.data||a,f=c.data||c;if(4!==e.length||4!==f.length)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};return d.data[0]=e[0]-f[0],d.data[1]=e[1]-f[1],d.data[2]=e[2]-f[2],d.data[3]=e[3]-f[3],d},b.prototype.sub=function(a){return b.sub(this,a,this)},b.mul=function(a,c,d){"number"==typeof a&&(a=[a,a,a,a]),"number"==typeof c&&(c=[c,c,c,c]),d||(d=new b);var e=a.data||a,f=c.data||c;if(4!==e.length||4!==f.length)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};return d.data[0]=e[0]*f[0],d.data[1]=e[1]*f[1],d.data[2]=e[2]*f[2],d.data[3]=e[3]*f[3],d},b.prototype.mul=function(a){return b.mul(this,a,this)},b.div=function(a,c,d){"number"==typeof a&&(a=[a,a,a,a]),"number"==typeof c&&(c=[c,c,c,c]),d||(d=new b);var e=a.data||a,f=c.data||c;if(4!==e.length||4!==f.length)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};return d.data[0]=e[0]/f[0],d.data[1]=e[1]/f[1],d.data[2]=e[2]/f[2],d.data[3]=e[3]/f[3],d},b.prototype.div=function(a){return b.div(this,a,this)},b.dot=function(a,b){"number"==typeof a&&(a=[a,a,a,a]),"number"==typeof b&&(b=[b,b,b,b]);var c=a.data||a,d=b.data||b;if(4!==c.length||4!==d.length)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};var e=0;return e+=c[0]*d[0],e+=c[1]*d[1],e+=c[2]*d[2],e+=c[3]*d[3]},b.prototype.dot=function(a){return b.dot(this,a)},b.prototype.lerp=function(a,b){return this.x=(1-b)*this.x+b*a.x,this.y=(1-b)*this.y+b*a.y,this.z=(1-b)*this.z+b*a.z,this.w=(1-b)*this.w+b*a.w,this},b.prototype.setd=function(a,b,c,d){return this.data[0]=a,this.data[1]=b,this.data[2]=c,this.data[3]=d,this},b.prototype.seta=function(a){return this.data[0]=a[0],this.data[1]=a[1],this.data[2]=a[2],this.data[3]=a[3],this},b.prototype.setv=function(a){return this.data[0]=a.data[0],this.data[1]=a.data[1],this.data[2]=a.data[2],this.data[3]=a.data[3],this},b}),define("goo/renderer/MeshData",["goo/renderer/BufferData","goo/renderer/Util","goo/renderer/BufferUtils","goo/math/Vector2","goo/math/Vector3","goo/math/Vector4"],function(a,b,c,d,e,f){"use strict";function g(a,b,c){this.attributeMap=a,this.vertexCount=void 0!==b?b:0,this.indexCount=void 0!==c?c:0,this.primitiveCounts=[0],this.vertexData=null,this.indexData=null,this.dataViews={},this.indexLengths=null,this.indexModes=["Triangles"],this.type=g.MESH,this.rebuildData(this.vertexCount,this.indexCount)}function h(a){for(var c={},d=0;d<a.length;d++){var e=a[d];if(void 0===n[e])throw"No default attribute named: "+e;c[e]=b.clone(n[e])}return c}var i=window.Uint8ClampedArray;g.MESH=0,g.SKINMESH=1,g.prototype.rebuildData=function(a,b,c){var d={},e=null;if(c){for(var f in this.attributeMap){var g=this.dataViews[f];g&&(d[f]=g)}this.indexData&&(e=this.indexData.data)}if(this.rebuildVertexData(a),this.rebuildIndexData(b),c){for(var f in this.attributeMap){var h=d[f];if(h){var g=this.dataViews[f];g.set(h)}}d={},e&&this.indexData.data.set(e)}},g.prototype.rebuildVertexData=function(c){if(isNaN(c)||(this.vertexCount=c,this._vertexCountStore=this.vertexCount),this.vertexCount>0){var d=0;for(var e in this.attributeMap){var f=this.attributeMap[e];d+=b.getByteSize(f.type)*f.count}this.vertexData=new a(new ArrayBuffer(d*this.vertexCount),"ArrayBuffer"),this.generateAttributeData()}},g.prototype.rebuildIndexData=function(b){if(void 0!==b&&(this.indexCount=b),this.indexCount>0){var d=c.createIndexBuffer(this.indexCount,this.vertexCount);this.indexData=new a(d,"ElementArrayBuffer")}},g.prototype.setVertexDataUpdated=function(){this.vertexData._dataNeedsRefresh=!0},g.prototype.getSectionCount=function(){return this.indexLengths?this.indexLengths.length:1},g.prototype.getPrimitiveCount=function(a){return a>=0&&a<this.primitiveCounts.length?this.primitiveCounts[a]:0},g.prototype.getPrimitiveVertices=function(a,b,c){var d=this.getPrimitiveCount(b);if(a>=d||0>a)throw new Error("Invalid primitiveIndex '"+a+"'.  Count is "+d);var f=this.indexModes[b],h=g.getVertexCount(f),i=c;(!i||i.length<h)&&(i=[]);for(var j=this.getAttributeBuffer(g.POSITION),k=0;h>k;k++)if(i[k]||(i[k]=new e),this.getIndexBuffer()){var l=this.getIndexBuffer()[this.getVertexIndex(a,k,b)];i[k].x=j[3*l+0],i[k].y=j[3*l+1],i[k].z=j[3*l+2]}else{var l=this.getVertexIndex(a,k,b);i[k].x=j[3*l+0],i[k].y=j[3*l+1],i[k].z=j[3*l+2]}return i},g.prototype.getVertexIndex=function(a,b,c){for(var d=0,e=0;c>e;e++)d+=this.indexLengths[e];switch(this.indexModes[c]){case"Triangles":d+=3*a+b;break;case"TriangleStrip":d+=a+b;break;case"TriangleFan":d+=0===b?0:a+b;break;case"Points":d+=a;break;case"Lines":d+=2*a+b;break;case"LineStrip":case"LineLoop":d+=a+b;break;default:return g.logger.warning("unimplemented index mode: "+this.indexModes[c]),-1}return d},g.prototype.getTotalPrimitiveCount=function(){for(var a=0,b=0,c=this.primitiveCounts.length;c>b;b++)a+=this.primitiveCounts[b];return a},g.prototype.updatePrimitiveCounts=function(){var a=this.indexData?this.indexData.data.length:this.vertexCount,b=this.getSectionCount();this.primitiveCounts.length!==b&&(this.primitiveCounts=[]);for(var c=0;b>c;c++){var d=this.indexLengths?this.indexLengths[c]:a,e=g.getPrimitiveCount(this.indexModes[c],d);this.primitiveCounts[c]=e}},g.getPrimitiveCount=function(a,b){switch(a){case"Triangles":return b/3;case"TriangleFan":case"TriangleStrip":return b-2;case"Lines":return b/2;case"LineStrip":return b-1;case"LineLoop":return b;case"Points":return b}throw new Error("unimplemented index mode: "+a)},g.getVertexCount=function(a){switch(a){case"Triangles":case"TriangleFan":case"TriangleStrip":return 3;case"Lines":case"LineStrip":case"LineLoop":return 2;case"Points":return 1}throw new Error("unimplemented index mode: "+a)};var j={Byte:Int8Array,UnsignedByte:Uint8Array,UnsignedByteClamped:i,Short:Int16Array,UnsignedShort:Uint16Array,Int:Int32Array,UnsignedInt:Uint32Array,Float:Float32Array};g.prototype.generateAttributeData=function(){var a,c=this.vertexData.data,d=0;for(var e in this.attributeMap){var f=this.attributeMap[e];f.offset=d;var g=this.vertexCount*f.count;d+=g*b.getByteSize(f.type);var h=j[f.type];if(!h)throw"Unsupported DataType: "+f.type;a=new h(c,f.offset,g),this.dataViews[e]=a}},g.prototype.makeInterleavedData=function(){var c=0,d=0;for(var e in this.attributeMap){var f=this.attributeMap[e];f.offset=c,c+=f.count*b.getByteSize(f.type)}var g=new a(new ArrayBuffer(c*this.vertexCount),this.vertexData.target);g._dataUsage=this.vertexData._dataUsage,g._dataNeedsRefresh=!0;var h=new DataView(g.data);for(var e in this.attributeMap){var i=this.dataViews[e],f=this.attributeMap[e];f.stride=c;for(var d=f.offset,j=f.count,k=b.getByteSize(f.type),l=this.getDataMethod(f.type),m=h[l],n=0;n<this.vertexCount;n++)for(var o=0;j>o;o++)m.apply(h,[d+c*n+o*k,i[n*j+o],!0])}this.vertexData=g},g.prototype.getDataMethod=function(a){switch(a){case"Byte":return"setInt8";case"UnsignedByte":return"setUInt8";case"Short":return"setInt16";case"UnsignedShort":return"setUInt16";case"Int":return"setInt32";case"HalfFloat":return"setInt16";case"Float":return"setFloat32"}},g.prototype.getAttributeBuffer=function(a){return this.dataViews[a]},g.prototype.getIndexData=function(){return this.indexData},g.prototype.getIndexBuffer=function(){return null!==this.indexData?this.indexData.data:null},g.prototype.getIndexLengths=function(){return this.indexLengths},g.prototype.getIndexModes=function(){return this.indexModes},g.prototype.resetVertexCount=function(){this.vertexCount=this.vertexCountStore},g.prototype.applyTransform=function(a,b){var c=new e,d=this.getAttributeBuffer(a),f=d.length;if(a===g.POSITION)for(var h=0;f>h;h+=3)c.setd(d[h+0],d[h+1],d[h+2]),b.matrix.applyPostPoint(c),d[h+0]=c[0],d[h+1]=c[1],d[h+2]=c[2];else if(a===g.NORMAL)for(var h=0;f>h;h+=3)c.setd(d[h+0],d[h+1],d[h+2]),b.rotation.applyPost(c),d[h+0]=c[0],d[h+1]=c[1],d[h+2]=c[2];else if(a===g.TANGENT)for(var h=0;f>h;h+=3)c.setd(d[h+0],d[h+1],d[h+2]),b.rotation.applyPost(c),d[h+0]=c[0],d[h+1]=c[1],d[h+2]=c[2];return this},g.prototype.applyFunction=function(a,b){var c,g,h=this.getAttributeBuffer(a),i=h.length,j=this.attributeMap[a].count;switch(j){case 1:for(var k=0;i>k;k++)h[k]=b(h[k]);break;case 2:c=new d;for(var k=0;i>k;k+=2)c.setd(h[k+0],h[k+1]),g=b(c),h[k+0]=g[0],h[k+1]=g[1];break;case 3:c=new e;for(var k=0;i>k;k+=3)c.setd(h[k+0],h[k+1],h[k+2]),g=b(c),h[k+0]=g[0],h[k+1]=g[1],h[k+2]=g[2];break;case 4:c=new f;for(var k=0;i>k;k+=4)c.setd(h[k+0],h[k+1],h[k+2],h[k+3]),g=b(c),h[k+0]=g[0],h[k+1]=g[1],h[k+2]=g[2],h[k+3]=g[3]}return this},g.prototype.getNormalsMeshData=function(a){if(void 0!==this.getAttributeBuffer("POSITION")&&void 0!==this.getAttributeBuffer("NORMAL")){a=void 0!==a?a:1;for(var b=[],c=[],d=this.dataViews.POSITION.length/3,e=0;d>e;e++)b.push(this.dataViews.POSITION[3*e+0],this.dataViews.POSITION[3*e+1],this.dataViews.POSITION[3*e+2],this.dataViews.POSITION[3*e+0]+this.dataViews.NORMAL[3*e+0]*a,this.dataViews.POSITION[3*e+1]+this.dataViews.NORMAL[3*e+1]*a,this.dataViews.POSITION[3*e+2]+this.dataViews.NORMAL[3*e+2]*a);for(var e=0;2*d>e;e+=2)c.push(e,e+1);var f=new g(g.defaultMap([g.POSITION]),b.length,c.length);return f.getAttributeBuffer(g.POSITION).set(b),f.getIndexBuffer().set(c),f.indexModes[0]="Lines",f}},g.prototype.buildWireframeData=function(){var a=b.clone(this.attributeMap),c=new g(a,this.vertexCount,0);c.indexModes[0]="Lines";var d=this.getIndexBuffer(),e=[],f=0;this.updatePrimitiveCounts();for(var h=0;h<this.getSectionCount();h++)for(var i=this.indexModes[h],j=this.getPrimitiveCount(h),k=0;j>k;k++)switch(i){case"Triangles":case"TriangleFan":case"TriangleStrip":var l=d[this.getVertexIndex(k,0,h)],m=d[this.getVertexIndex(k,1,h)],n=d[this.getVertexIndex(k,2,h)];e[f+0]=l,e[f+1]=m,e[f+2]=m,e[f+3]=n,e[f+4]=n,e[f+5]=l,f+=6;break;case"Lines":case"LineStrip":var l=d[this.getVertexIndex(k,0,h)],m=d[this.getVertexIndex(k,1,h)];e[f+0]=l,e[f+1]=m,f+=2;break;case"LineLoop":var l=d[this.getVertexIndex(k,0,h)],m=d[this.getVertexIndex(k,1,h)];k===j-1&&(m=d[this.getVertexIndex(0,0,h)]),e[f+0]=l,e[f+1]=m,f+=2;break;case"Points":}if(f>0){c.rebuildIndexData(f);for(var o in a)c.getAttributeBuffer(o).set(this.getAttributeBuffer(o));c.getIndexBuffer().set(e)}return c.paletteMap=this.paletteMap,c.weightsPerVertex=this.weightsPerVertex,c};var k=new e,l=new e,m=new e;g.prototype.buildFlatMeshData=function(){var a=[],c=this.getIndexBuffer();if(null===c)return console.debug("No indices, probably a point mesh"),this;if(c.length>65535)return console.warn("Mesh too big, cannot build flat mesh data"),this;var d=b.clone(this.attributeMap),e={};for(var f in d)e[f]={oldBuffer:this.getAttributeBuffer(f),values:[]};var h=0;this.updatePrimitiveCounts();for(var i=0;i<this.getSectionCount();i++)for(var j=this.indexModes[i],n=this.getPrimitiveCount(i),o=!1,p=0;n>p;p++)switch(j){case"TriangleStrip":o=1===p%2?!0:!1;case"Triangles":case"TriangleFan":var q=c[this.getVertexIndex(p,0,i)],r=c[this.getVertexIndex(p,1,i)],s=c[this.getVertexIndex(p,2,i)];if(o){var t=s;s=r,r=t}for(var f in e)if(f!==g.NORMAL){for(var u=d[f].count,v=0;u>v;v++)e[f].values[h*u+v]=e[f].oldBuffer[q*u+v],e[f].values[(h+1)*u+v]=e[f].oldBuffer[r*u+v],e[f].values[(h+2)*u+v]=e[f].oldBuffer[s*u+v];f===g.POSITION&&(k.setd(e[f].values[3*h],e[f].values[3*h+1],e[f].values[3*h+2]),l.setd(e[f].values[3*(h+1)],e[f].values[3*(h+1)+1],e[f].values[3*(h+1)+2]),m.setd(e[f].values[3*(h+2)],e[f].values[3*(h+2)+1],e[f].values[3*(h+2)+2]),l.subv(k),m.subv(k),l.cross(m).normalize(),e[g.NORMAL]&&(e[g.NORMAL].values[3*h]=l.data[0],e[g.NORMAL].values[3*h+1]=l.data[1],e[g.NORMAL].values[3*h+2]=l.data[2],e[g.NORMAL].values[3*(h+1)]=l.data[0],e[g.NORMAL].values[3*(h+1)+1]=l.data[1],e[g.NORMAL].values[3*(h+1)+2]=l.data[2],e[g.NORMAL].values[3*(h+2)]=l.data[0],e[g.NORMAL].values[3*(h+2)+1]=l.data[1],e[g.NORMAL].values[3*(h+2)+2]=l.data[2]))}a.push(a.length),a.push(a.length),a.push(a.length),h+=3}if(0===a.length)return console.warn("Could not build flat data"),this;var w=new g(d,a.length,a.length);for(var f in e)w.getAttributeBuffer(f).set(e[f].values);return w.getIndexBuffer().set(a),w.paletteMap=this.paletteMap,w.weightPerVertex=this.weightsPerVertex,w},g.POSITION="POSITION",g.NORMAL="NORMAL",g.COLOR="COLOR",g.TANGENT="TANGENT",g.TEXCOORD0="TEXCOORD0",g.TEXCOORD1="TEXCOORD1",g.TEXCOORD2="TEXCOORD2",g.TEXCOORD3="TEXCOORD3",g.WEIGHTS="WEIGHTS",g.JOINTIDS="JOINTIDS",g.createAttribute=function(a,b,c){return{count:a,type:b,stride:0,offset:0,normalized:void 0!==c?c:!1}};var n={POSITION:g.createAttribute(3,"Float"),NORMAL:g.createAttribute(3,"Float"),COLOR:g.createAttribute(4,"Float"),TANGENT:g.createAttribute(4,"Float"),TEXCOORD0:g.createAttribute(2,"Float"),TEXCOORD1:g.createAttribute(2,"Float"),TEXCOORD2:g.createAttribute(2,"Float"),TEXCOORD3:g.createAttribute(2,"Float"),WEIGHTS:g.createAttribute(4,"Float"),JOINTIDS:g.createAttribute(4,"Short")};return g.defaultMap=function(a){return void 0===a?h(Object.keys(n)):h(a)},g}),define("goo/renderer/bounds/BoundingSphere",["goo/math/Vector3","goo/math/MathUtils","goo/renderer/bounds/BoundingVolume","goo/renderer/MeshData"],function(a,b,c,d){"use strict";function e(b,d){c.call(this,b),this.radius=void 0!==d?d:1,this.vec=new a}return e.prototype=Object.create(c.prototype),e.prototype.constructor=e,e.prototype.computeFromPoints=function(a){var b=this.min,c=this.max,d=this.vec;b.setd(1/0,1/0,1/0),c.setd(-1/0,-1/0,-1/0);for(var e,f,g,h=0;h<a.length;h+=3)e=a[h+0],f=a[h+1],g=a[h+2],b.x=e<b.x?e:b.x,b.y=f<b.y?f:b.y,b.z=g<b.z?g:b.z,c.x=e>c.x?e:c.x,c.y=f>c.y?f:c.y,c.z=g>c.z?g:c.z;for(var i,j=c.addv(b).div(2),k=0,h=0;h<a.length;h+=3)d.setd(a[h],a[h+1],a[h+2]),i=d.subv(j).lengthSquared(),i>k&&(k=i);this.radius=Math.sqrt(k),this.center.setv(j)},e.prototype.computeFromPrimitives=function(b,c,e,f,g){if(!(0>=g-f)){for(var h=[],i=[],j=d.getVertexCount(b.indexModes[c]),k=0,l=f;g>l;l++){i=b.getPrimitiveVertices(e[l],c,i);for(var m=0;j>m;m++)h[k++]=(new a).set(i[m])}this.averagePoints(h)}},e.prototype.averagePoints=function(b){this.center.set(b[0]);for(var c=1;c<b.length;c++)this.center.add(b[c]);var d=1/b.length;this.center.mul(d);for(var e=0,c=0;c<b.length;c++){var f=a.sub(b[c],this.center,this.vec),g=f.lengthSquared();g>e&&(e=g)}this.radius=Math.sqrt(e)+1e-5},e.prototype.transform=function(a,b){null===b&&(b=new e),a.applyForward(this.center,b.center);var c=a.scale;return b.radius=Math.abs(this._maxAxis(c)*this.radius),b},e.prototype.whichSide=function(a){var b=a.normal.data,d=this.center.data,e=b[0]*d[0]+b[1]*d[1]+b[2]*d[2]-a.constant;return e<-this.radius?c.Inside:e>this.radius?c.Outside:c.Intersects},e.prototype._pseudoDistance=function(a,b){return a.normal.x*b.x+a.normal.y*b.y+a.normal.z*b.z-a.constant},e.prototype._maxAxis=function(a){return Math.max(Math.abs(a.x),Math.max(Math.abs(a.y),Math.abs(a.z)))},e.prototype.toString=function(){var a=Math.round(10*this.center.x)/10,b=Math.round(10*this.center.y)/10,c=Math.round(10*this.center.z)/10,d=Math.round(10*this.radius)/10;return"["+a+","+b+","+c+"] - "+d},e.prototype.intersects=function(a){return a.intersectsSphere(this)},e.prototype.intersectsBoundingBox=function(a){return Math.abs(a.center.x-this.center.x)<this.radius+a.xExtent&&Math.abs(a.center.y-this.center.y)<this.radius+a.yExtent&&Math.abs(a.center.z-this.center.z)<this.radius+a.zExtent?!0:!1},e.prototype.intersectsSphere=function(a){var b=this.vec.setv(this.center).subv(a.center),c=this.radius+a.radius;return b.dot(b)<=c*c},e.prototype.intersectsRay=function(b){if(!this.center)return!1;var c=(new a).copy(b.origin).sub(this.center),d=c.dot(c)-this.radius*this.radius;if(0>=d)return!0;var e=b.direction.dot(c);return e>=0?!1:e*e>=d},e.prototype.intersectsRayWhere=function(b){var c,d,e,f=(new a).copy(b.origin).sub(this.center),g=f.dot(f)-this.radius*this.radius;if(0>=g){c=b.direction.dot(f),d=c*c-g,e=Math.sqrt(d);var h=[e-c],i=[(new a).copy(b.direction).mul(h[0]).add(b.origin)];return{distances:h,points:i}}if(c=b.direction.dot(f),c>=0)return null;if(d=c*c-g,0>d)return null;if(d>=1e-5){e=Math.sqrt(d);var h=[-c-e,-c+e],i=[(new a).copy(b.direction).mul(h[0]).add(b.origin),(new a).copy(b.direction).mul(h[1]).add(b.origin)];return{distances:h,points:i}}var h=[-c],i=[(new a).copy(b.direction).mul(h[0]).add(b.origin)];return{distances:h,points:i}},e.prototype.merge=function(a){if(a instanceof e)return this.mergeSphere(a.center,a.radius,this);var b=this.vec.setd(a.xExtent,a.yExtent,a.zExtent).length();return this.mergeSphere(a.center,b,this)},e.prototype.mergeSphere=function(a,c,d){d||(d=new e);var f=this.vec.setv(a).subv(this.center),g=f.lengthSquared(),h=c-this.radius,i=h*h;if(i>=g)return 0>=h?(d.center.setv(this.center),d.radius=this.radius,d):(d.center.setv(a),d.radius=c,d);var j=Math.sqrt(g),k=d.center;if(j>b.EPSILON){var l=(j+h)/(2*j);k.addv(f.mul(l))}return d.radius=.5*(j+this.radius+c),d},e.prototype.clone=function(a){return a&&a instanceof e?(a.center.setv(this.center),a.radius=this.radius,a):new e(this.center,this.radius)},e}),define("goo/renderer/bounds/BoundingBox",["goo/math/Vector3","goo/renderer/bounds/BoundingVolume","goo/renderer/bounds/BoundingSphere","goo/math/MathUtils"],function(a,b,c,d){"use strict";function e(c,d,e,f){b.call(this,c),this.xExtent=void 0!==d?d:1,this.yExtent=void 0!==e?e:1,this.zExtent=void 0!==f?f:1,this._compVect1=new a,this._compVect2=new a,this.vec=new a,this.corners=[];for(var g=0;8>g;g++)this.corners.push(new a)}return e.prototype=Object.create(b.prototype),e.prototype.constructor=e,e.prototype.computeFromPoints=function(a){var b=this.min,c=this.max,d=this.vec;b.setd(1/0,1/0,1/0),c.setd(-1/0,-1/0,-1/0);for(var e,f,g,h=0;h<a.length;h+=3)e=a[h+0],f=a[h+1],g=a[h+2],b.x=e<b.x?e:b.x,b.y=f<b.y?f:b.y,b.z=g<b.z?g:b.z,c.x=e>c.x?e:c.x,c.y=f>c.y?f:c.y,c.z=g>c.z?g:c.z;d.setv(c).subv(b).div(2),this.xExtent=d.x,this.yExtent=d.y,this.zExtent=d.z,this.center.setv(c).addv(b).div(2)},e.prototype.computeFromPrimitives=function(a,b,c,d,f){if(!(0>=f-d)){for(var g=this._compVect1.set(1/0,1/0,1/0),h=this._compVect2.set(-1/0,-1/0,-1/0),i=[],j=d;f>j;j++){i=a.getPrimitiveVertices(c[j],b,i);for(var k=0;k<i.length;k++)e.checkMinMax(g,h,i[k])}this.center.copy(g.add(h)),this.center.mul(.5),this.xExtent=h.x-this.center.x,this.yExtent=h.y-this.center.y,this.zExtent=h.z-this.center.z}},e.checkMinMax=function(a,b,c){c.x<a.x&&(a.x=c.x),c.x>b.x&&(b.x=c.x),c.y<a.y&&(a.y=c.y),c.y>b.y&&(b.y=c.y),c.z<a.z&&(a.z=c.z),c.z>b.z&&(b.z=c.z)},e.prototype.transform=function(a,b){null===b&&(b=new e);var c=this.corners;this.getCorners(c);for(var d=0;d<c.length;d++)a.matrix.applyPostPoint(c[d]);for(var f=c[0].data[0],g=c[0].data[1],h=c[0].data[2],i=f,j=g,k=h,d=1;d<c.length;d++){var l=c[d].data[0],m=c[d].data[1],n=c[d].data[2];f=Math.min(f,l),g=Math.min(g,m),h=Math.min(h,n),i=Math.max(i,l),j=Math.max(j,m),k=Math.max(k,n)}var o=.5*(i+f),p=.5*(j+g),q=.5*(k+h);return b.center.setd(o,p,q),b.xExtent=i-o,b.yExtent=j-p,b.zExtent=k-q,b},e.prototype.getCorners=function(b){if(!b||8!==b.length){b=[];for(var c=0;c<b.length;c++)b.push(new a)}return b[0].setd(this.center.data[0]+this.xExtent,this.center.data[1]+this.yExtent,this.center.data[2]+this.zExtent),b[1].setd(this.center.data[0]+this.xExtent,this.center.data[1]+this.yExtent,this.center.data[2]-this.zExtent),b[2].setd(this.center.data[0]+this.xExtent,this.center.data[1]-this.yExtent,this.center.data[2]+this.zExtent),b[3].setd(this.center.data[0]+this.xExtent,this.center.data[1]-this.yExtent,this.center.data[2]-this.zExtent),b[4].setd(this.center.data[0]-this.xExtent,this.center.data[1]+this.yExtent,this.center.data[2]+this.zExtent),b[5].setd(this.center.data[0]-this.xExtent,this.center.data[1]+this.yExtent,this.center.data[2]-this.zExtent),b[6].setd(this.center.data[0]-this.xExtent,this.center.data[1]-this.yExtent,this.center.data[2]+this.zExtent),b[7].setd(this.center.data[0]-this.xExtent,this.center.data[1]-this.yExtent,this.center.data[2]-this.zExtent),b},e.prototype.whichSide=function(a){var c=a.normal.data,d=this.center.data,e=Math.abs(this.xExtent*c[0])+Math.abs(this.yExtent*c[1])+Math.abs(this.zExtent*c[2]),f=c[0]*d[0]+c[1]*d[1]+c[2]*d[2]-a.constant;return-e>f?b.Inside:f>e?b.Outside:b.Intersects},e.prototype._pseudoDistance=function(a,b){var c=a.normal.data,d=b.data;return c[0]*d[0]+c[1]*d[1]+c[2]*d[2]-a.constant},e.prototype._maxAxis=function(a){return Math.max(Math.abs(a.x),Math.max(Math.abs(a.y),Math.abs(a.z)))},e.prototype.toString=function(){var a=Math.round(10*this.center.x)/10,b=Math.round(10*this.center.y)/10,c=Math.round(10*this.center.z)/10;return"["+a+","+b+","+c+"] - ["+this.xExtent+","+this.yExtent+","+this.zExtent+"]"},e.prototype.intersects=function(a){return a.intersectsBoundingBox(this)},e.prototype.intersectsBoundingBox=function(a){return this.center.x+this.xExtent<a.center.x-a.xExtent||this.center.x-this.xExtent>a.center.x+a.xExtent?!1:this.center.y+this.yExtent<a.center.y-a.yExtent||this.center.y-this.yExtent>a.center.y+a.yExtent?!1:this.center.z+this.zExtent<a.center.z-a.zExtent||this.center.z-this.zExtent>a.center.z+a.zExtent?!1:!0},e.prototype.intersectsSphere=function(a){return Math.abs(this.center.x-a.center.x)<a.radius+this.xExtent&&Math.abs(this.center.y-a.center.y)<a.radius+this.yExtent&&Math.abs(this.center.z-a.center.z)<a.radius+this.zExtent?!0:!1},e.prototype.testStaticAABBAABB=function(b,c){var d=this,e=b,f={mtvDistance:1e10,mtvAxis:new a};return this.testAxisStatic(a.UNIT_X,d.center.x-d.xExtent,d.center.x+d.xExtent,e.center.x-e.xExtent,e.center.x+e.xExtent,f)?this.testAxisStatic(a.UNIT_Y,d.center.y-d.yExtent,d.center.y+d.yExtent,e.center.y-e.yExtent,e.center.y+e.yExtent,f)?this.testAxisStatic(a.UNIT_Z,d.center.z-d.zExtent,d.center.z+d.zExtent,e.center.z-e.zExtent,e.center.z+e.zExtent,f)?(c&&(c.isIntersecting=!0,c.normal=f.mtvAxis,c.penetration=1.001*Math.sqrt(f.mtvDistance)),!0):!1:!1:!1},e.prototype.testAxisStatic=function(b,c,d,e,f,g){var h=a.dot(b,b);if(1e-6>h)return!0;var i=f-c,j=d-e;if(0>=i||0>=j)return!1;var k=j>i?i:-j,l=(new a).copy(b).mul(k/h),m=a.dot(l,l);return m<g.mtvDistance&&(g.mtvDistance=m,g.mtvAxis=b),!0},e.prototype.intersectsRay=function(a){if(isNaN(this.center.x)||isNaN(this.center.y)||isNaN(this.center.z))return!1;var b=this._compVect1.setv(a.origin).subv(this.center),c=a.direction,f=[0,1/0],g=this.xExtent;g<d.ZERO_TOLERANCE&&g>=0&&(g=d.ZERO_TOLERANCE);var h=this.yExtent;h<d.ZERO_TOLERANCE&&h>=0&&(h=d.ZERO_TOLERANCE);var i=this.zExtent;i<d.ZERO_TOLERANCE&&i>=0&&(i=d.ZERO_TOLERANCE);var j=e.clip(c.data[0],-b.data[0]-g,f)&&e.clip(-c.data[0],b.data[0]-g,f)&&e.clip(c.data[1],-b.data[1]-h,f)&&e.clip(-c.data[1],b.data[1]-h,f)&&e.clip(c.data[2],-b.data[2]-i,f)&&e.clip(-c.data[2],b.data[2]-i,f);return!j||0===f[0]&&1/0===f[1]?!1:!0},e.prototype.intersectsRayWhere=function(b){if(isNaN(this.center.x)||isNaN(this.center.y)||isNaN(this.center.z))return null;var c=a.sub(b.origin,this.center,this._compVect1),f=b.direction,g=[0,1/0],h=this.xExtent;h<d.ZERO_TOLERANCE&&h>=0&&(h=d.ZERO_TOLERANCE);var i=this.yExtent;i<d.ZERO_TOLERANCE&&i>=0&&(i=d.ZERO_TOLERANCE);var j=this.zExtent;j<d.ZERO_TOLERANCE&&j>=0&&(j=d.ZERO_TOLERANCE);var k=e.clip(f.x,-c.x-h,g)&&e.clip(-f.x,c.x-h,g)&&e.clip(f.y,-c.y-i,g)&&e.clip(-f.y,c.y-i,g)&&e.clip(f.z,-c.z-j,g)&&e.clip(-f.z,c.z-j,g);if(k&&(0!==g[0]||1/0!==g[1])){if(g[1]>g[0]){var l=g,m=[new a(b.direction).mul(l[0]).add(b.origin),new a(b.direction).mul(l[1]).add(b.origin)];return{distances:l,points:m}}var l=[g[0]],m=[new a(b.direction).mul(l[0]).add(b.origin)];return{distances:l,points:m}}return null},e.clip=function(a,b,c){return a>0?b>a*c[1]?!1:(b>a*c[0]&&(c[0]=b/a),!0):0>a?b>a*c[0]?!1:(b>a*c[1]&&(c[1]=b/a),!0):0>=b},e.prototype.merge=function(a){return a instanceof e?this.mergeBox(a.center,a.xExtent,a.yExtent,a.zExtent,this):a instanceof c?this.mergeBox(a.center,a.radius,a.radius,a.radius,this):this},e.prototype.mergeBox=function(a,b,c,d,f){f||(f=new e);var g=this._compVect1,h=this._compVect2;return g.x=this.center.x-this.xExtent,g.x>a.x-b&&(g.x=a.x-b),g.y=this.center.y-this.yExtent,g.y>a.y-c&&(g.y=a.y-c),g.z=this.center.z-this.zExtent,g.z>a.z-d&&(g.z=a.z-d),h.x=this.center.x+this.xExtent,h.x<a.x+b&&(h.x=a.x+b),h.y=this.center.y+this.yExtent,h.y<a.y+c&&(h.y=a.y+c),h.z=this.center.z+this.zExtent,h.z<a.z+d&&(h.z=a.z+d),f.center.set(h).addv(g).muld(.5,.5,.5),f.xExtent=h.x-f.center.x,f.yExtent=h.y-f.center.y,f.zExtent=h.z-f.center.z,f},e.prototype.clone=function(a){return a&&a instanceof e?(a.center.setv(this.center),a.xExtent=this.xExtent,a.yExtent=this.yExtent,a.zExtent=this.zExtent,a):new e(this.center,this.xExtent,this.yExtent,this.zExtent)},e}),define("goo/math/Matrix",["goo/math/MathUtils"],function(a){"use strict";function b(a,b){this.rows=a||0,this.cols=b||0,this.data=new Float32Array(this.rows*this.cols)}return b.prototype.setupAliases=function(a){for(var b=this,c=0;c<a.length;c++)!function(d){for(var e=0;e<a[d].length;e++)Object.defineProperty(b,a[d][e],{get:function(){return this.data[d]},set:function(a){this.data[d]=a}});Object.defineProperty(b,c,{get:function(){return this.data[d]},set:function(a){this.data[d]=a}})}(c)},b.add=function(a,c,d){var e=a.rows,f=a.cols;if(d||(d=new b(e,f)),c instanceof b){if(c.rows!==e||c.cols!==f||d.rows!==e||d.cols!==f)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};for(var g=0;g<a.data.length;g++)d.data[g]=a.data[g]+c.data[g]}else{if(d.rows!==e||d.cols!==f)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};for(var g=0;g<a.data.length;g++)d.data[g]=a.data[g]+c}return d},b.prototype.add=function(a){return b.add(this,a,this)},b.sub=function(a,c,d){var e=a.rows,f=a.cols;if(d||(d=new b(e,f)),c instanceof b){if(c.rows!==e||c.cols!==f||d.rows!==e||d.cols!==f)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};for(var g=0;g<a.data.length;g++)d.data[g]=a.data[g]-c.data[g]}else{if(d.rows!==e||d.cols!==f)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};for(var g=0;g<a.data.length;g++)d.data[g]=a.data[g]-c}return d},b.prototype.sub=function(a){return b.sub(this,a,this)},b.mul=function(a,c,d){var e=a.rows,f=a.cols;if(d||(d=new b(e,f)),c instanceof b){if(c.rows!==e||c.cols!==f||d.rows!==e||d.cols!==f)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};for(var g=0;g<a.data.length;g++)d.data[g]=a.data[g]*c.data[g]}else{if(d.rows!==e||d.cols!==f)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};for(var g=0;g<a.data.length;g++)d.data[g]=a.data[g]*c}return d},b.prototype.mul=function(a){return b.mul(this,a,this)},b.div=function(a,c,d){var e=a.rows,f=a.cols;if(d||(d=new b(e,f)),c instanceof b){if(c.rows!==e||c.cols!==f||d.rows!==e||d.cols!==f)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};for(var g=0;g<a.data.length;g++)d.data[g]=a.data[g]/c.data[g]}else{if(d.rows!==e||d.cols!==f)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};c=1/c;for(var g=0;g<a.data.length;g++)d.data[g]=a.data[g]*c}return d},b.prototype.div=function(a){return b.div(this,a,this)},b.combine=function(a,c,d){var e=a.rows,f=c.cols,g=a.cols=c.rows;if(d||(d=new b(e,f)),a.cols!==g||c.rows!==g||d.rows!==e||d.cols!==f)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};if(d===a||d===c)return b.copy(b.combine(a,c),d);for(var h=0;f>h;h++)for(var i=h*e,j=0;e>j;j++){for(var k=0,l=0;g>l;l++)k+=a.data[l*a.rows+j]*c.data[h*c.rows+l];d.data[i+j]=k}return d},b.prototype.combine=function(a){return b.combine(this,a,this)},b.transpose=function(a,c){var d=a.cols,e=a.rows;if(c||(c=new b(d,e)),c.rows!==d||c.cols!==e)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};if(c===a)return b.copy(b.transpose(a),c);for(var f=0;e>f;f++)for(var g=f*d,h=0;d>h;h++)c.data[g+h]=a.data[h*e+f];return c},b.prototype.transpose=function(){return b.transpose(this,this)},b.copy=function(a,c){var d=a.rows,e=a.cols;if(c||(c=new b(d,e)),c.rows!==d||c.cols!==e)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};return c.data.set(a.data),c},b.prototype.copy=function(a){return b.copy(a,this)},b.equals=function(b,c){if(b.rows!==c.rows||b.cols!==c.cols)return!1;for(var d=0;d<b.data.length;d++)if(Math.abs(b.data[d]-c.data[d])>a.EPSILON)return!1;return!0},b.prototype.equals=function(a){return b.equals(this,a)},b.prototype.isOrthogonal=function(){for(var b=0;b<this.cols;b++)for(var c=b+1;c<this.cols;c++){for(var d=b*this.rows,e=c*this.rows,f=0,g=0;g<this.rows;g++)f+=this.data[d+g]*this.data[e+g];if(Math.abs(f)>a.EPSILON)return!1}return!0},b.prototype.isNormal=function(){for(var b=0;b<this.cols;b++){for(var c=b*this.rows,d=0,e=0;e<this.rows;e++)d+=this.data[c+e]*this.data[c+e];if(Math.abs(d-1)>a.EPSILON)return!1}return!0},b.prototype.isOrthonormal=function(){return this.isOrthogonal()&&this.isNormal()},b.prototype.clone=function(){return b.copy(this)},b.prototype.set=function(){if(1===arguments.length&&"object"==typeof arguments[0])if(arguments[0]instanceof b)this.copy(arguments[0]);else for(var a=0;a<arguments[0].length;a++)this.data[a]=arguments[0][a];else for(var a=0;a<arguments.length;a++)this.data[a]=arguments[a];return this},b.prototype.toString=function(){for(var a="",b=0;b<this.cols;b++){var c=b*this.rows;a+="[";for(var d=0;d<this.rows;d++)a+=this.data[c+d],a+=d!==this.rows-1?", ":"";a+=b!==this.cols-1?"], ":"]"}return a},b}),define("goo/math/Matrix3x3",["goo/math/MathUtils","goo/math/Matrix","goo/math/Vector3"],function(a,b,c){"use strict";
function d(){b.call(this,3,3),0===arguments.length?this.setIdentity():this.set(arguments),this._tempX=new c,this._tempY=new c,this._tempZ=new c}return d.prototype=Object.create(b.prototype),d.prototype.setupAliases([["e00"],["e10"],["e20"],["e01"],["e11"],["e21"],["e02"],["e12"],["e22"]]),d.IDENTITY=new d(1,0,0,0,1,0,0,0,1),d.add=function(a,b,c){c||(c=new d);var e=c.data,f=a.data;if(b instanceof d){var g=b.data;e[0]=f[0]+g[0],e[1]=f[1]+g[1],e[2]=f[2]+g[2],e[3]=f[3]+g[3],e[4]=f[4]+g[4],e[5]=f[5]+g[5],e[6]=f[6]+g[6],e[7]=f[7]+g[7],e[8]=f[8]+g[8]}else e[0]=f[0]+b,e[1]=f[1]+b,e[2]=f[2]+b,e[3]=f[3]+b,e[4]=f[4]+b,e[5]=f[5]+b,e[6]=f[6]+b,e[7]=f[7]+b,e[8]=f[8]+b;return c},d.prototype.add=function(a){return d.add(this,a,this)},d.sub=function(a,b,c){c||(c=new d);var e=c.data,f=a.data;if(b instanceof d){var g=b.data;e[0]=f[0]-g[0],e[1]=f[1]-g[1],e[2]=f[2]-g[2],e[3]=f[3]-g[3],e[4]=f[4]-g[4],e[5]=f[5]-g[5],e[6]=f[6]-g[6],e[7]=f[7]-g[7],e[8]=f[8]-g[8]}else e[0]=f[0]-b,e[1]=f[1]-b,e[2]=f[2]-b,e[3]=f[3]-b,e[4]=f[4]-b,e[5]=f[5]-b,e[6]=f[6]-b,e[7]=f[7]-b,e[8]=f[8]-b;return c},d.prototype.sub=function(a){return d.sub(this,a,this)},d.mul=function(a,b,c){c||(c=new d);var e=c.data,f=a.data;if(b instanceof d){var g=b.data;e[0]=f[0]*g[0],e[1]=f[1]*g[1],e[2]=f[2]*g[2],e[3]=f[3]*g[3],e[4]=f[4]*g[4],e[5]=f[5]*g[5],e[6]=f[6]*g[6],e[7]=f[7]*g[7],e[8]=f[8]*g[8]}else e[0]=f[0]*b,e[1]=f[1]*b,e[2]=f[2]*b,e[3]=f[3]*b,e[4]=f[4]*b,e[5]=f[5]*b,e[6]=f[6]*b,e[7]=f[7]*b,e[8]=f[8]*b;return c},d.prototype.mul=function(a){return d.mul(this,a,this)},d.div=function(a,b,c){c||(c=new d);var e=c.data,f=a.data;if(b instanceof d){var g=b.data;e[0]=f[0]/g[0],e[1]=f[1]/g[1],e[2]=f[2]/g[2],e[3]=f[3]/g[3],e[4]=f[4]/g[4],e[5]=f[5]/g[5],e[6]=f[6]/g[6],e[7]=f[7]/g[7],e[8]=f[8]/g[8]}else e[0]=f[0]/b,e[1]=f[1]/b,e[2]=f[2]/b,e[3]=f[3]/b,e[4]=f[4]/b,e[5]=f[5]/b,e[6]=f[6]/b,e[7]=f[7]/b,e[8]=f[8]/b;return c},d.prototype.div=function(a){return d.div(this,a,this)},d.combine=function(a,b,c){c||(c=new d);var e=a.data,f=e[0],g=e[3],h=e[6],i=e[1],j=e[4],k=e[7],l=e[2],m=e[5],n=e[8],o=b.data,p=o[0],q=o[3],r=o[6],s=o[1],t=o[4],u=o[7],v=o[2],w=o[5],x=o[8],y=c.data;return y[0]=f*p+g*s+h*v,y[3]=f*q+g*t+h*w,y[6]=f*r+g*u+h*x,y[1]=i*p+j*s+k*v,y[4]=i*q+j*t+k*w,y[7]=i*r+j*u+k*x,y[2]=l*p+m*s+n*v,y[5]=l*q+m*t+n*w,y[8]=l*r+m*u+n*x,c},d.prototype.combine=function(a){return d.combine(this,a,this)},d.transpose=function(a,b){b||(b=new d);var c=a.data,e=b.data;if(b===a){var f=c[3],g=c[6],h=c[7];return e[3]=c[1],e[6]=c[2],e[7]=c[5],e[1]=f,e[2]=g,e[5]=h,b}return e[0]=c[0],e[1]=c[3],e[2]=c[6],e[3]=c[1],e[4]=c[4],e[5]=c[7],e[6]=c[2],e[7]=c[5],e[8]=c[8],b},d.prototype.transpose=function(){return d.transpose(this,this)},d.invert=function(c,e){if(e||(e=new d),e===c)return b.copy(d.invert(c),e);var f=c.determinant();if(Math.abs(f)<a.EPSILON)throw{name:"Singular Matrix",message:"The matrix is singular and cannot be inverted."};f=1/f;var g=e.data,h=c.data;return g[0]=(h[4]*h[8]-h[7]*h[5])*f,g[1]=(h[7]*h[2]-h[1]*h[8])*f,g[2]=(h[1]*h[5]-h[4]*h[2])*f,g[3]=(h[6]*h[5]-h[3]*h[8])*f,g[4]=(h[0]*h[8]-h[6]*h[2])*f,g[5]=(h[3]*h[2]-h[0]*h[5])*f,g[6]=(h[3]*h[7]-h[6]*h[4])*f,g[7]=(h[6]*h[1]-h[0]*h[7])*f,g[8]=(h[0]*h[4]-h[3]*h[1])*f,e},d.prototype.invert=function(){return d.invert(this,this)},d.prototype.isOrthogonal=function(){var b=this.data,c=b[0]*b[3]+b[1]*b[4]+b[2]*b[5];return Math.abs(c)>a.EPSILON?!1:(c=b[0]*b[6]+b[1]*b[7]+b[2]*b[8],Math.abs(c)>a.EPSILON?!1:(c=b[3]*b[6]+b[4]*b[7]+b[5]*b[8],Math.abs(c)>a.EPSILON?!1:!0))},d.prototype.isNormal=function(){var b=this.data,c=b[0]*b[0]+b[1]*b[1]+b[2]*b[2];return Math.abs(c-1)>a.EPSILON?!1:(c=b[3]*b[3]+b[4]*b[4]+b[5]*b[5],Math.abs(c-1)>a.EPSILON?!1:(c=b[6]*b[6]+b[7]*b[7]+b[8]*b[8],Math.abs(c-1)>a.EPSILON?!1:!0))},d.prototype.isOrthonormal=function(){return this.isOrthogonal()&&this.isNormal()},d.prototype.determinant=function(){var a=this.data;return a[0]*(a[4]*a[8]-a[7]*a[5])-a[3]*(a[1]*a[8]-a[7]*a[2])+a[6]*(a[1]*a[5]-a[4]*a[2])},d.prototype.setIdentity=function(){var a=this.data;return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=1,a[5]=0,a[6]=0,a[7]=0,a[8]=1,this},d.prototype.applyPost=function(a){var b=a.data,c=this.data,d=b[0],e=b[1],f=b[2];return b[0]=c[0]*d+c[3]*e+c[6]*f,b[1]=c[1]*d+c[4]*e+c[7]*f,b[2]=c[2]*d+c[5]*e+c[8]*f,a},d.prototype.applyPre=function(a){var b=a.data,c=this.data,d=b[0],e=b[1],f=b[2];return b[0]=c[0]*d+c[1]*e+c[2]*f,b[1]=c[3]*d+c[4]*e+c[5]*f,b[2]=c[6]*d+c[7]*e+c[8]*f,a},d.prototype.multiplyDiagonalPost=function(a,b){var c=a.data[0],d=a.data[1],e=a.data[2],f=this.data,g=b.data;return g[0]=c*f[0],g[1]=c*f[1],g[2]=c*f[2],g[3]=d*f[3],g[4]=d*f[4],g[5]=d*f[5],g[6]=e*f[6],g[7]=e*f[7],g[8]=e*f[8],b},d.prototype.fromAngles=function(a,b,c){var d=Math.cos(a),e=Math.sin(a),f=Math.cos(b),g=Math.sin(b),h=Math.cos(c),i=Math.sin(c),j=this.data;return j[0]=f*h,j[3]=g*e-f*i*d,j[6]=f*i*e+g*d,j[1]=i,j[4]=h*d,j[7]=-h*e,j[2]=-g*h,j[5]=g*i*d+f*e,j[8]=-g*i*e+f*d,this},d.prototype.rotateX=function(a,b){b=b||this;var c=this.data,d=b.data,e=Math.sin(a),f=Math.cos(a),g=c[3],h=c[4],i=c[5],j=c[6],k=c[7],l=c[8];return c!==d&&(d[0]=c[0],d[1]=c[1],d[2]=c[2]),d[3]=g*f+j*e,d[4]=h*f+k*e,d[5]=i*f+l*e,d[6]=j*f-g*e,d[7]=k*f-h*e,d[8]=l*f-i*e,d},d.prototype.rotateY=function(a,b){b=b||this;var c=this.data,d=b.data,e=Math.sin(a),f=Math.cos(a),g=c[0],h=c[1],i=c[2],j=c[6],k=c[7],l=c[8];return c!==d&&(d[3]=c[3],d[4]=c[4],d[5]=c[5]),d[0]=g*f-j*e,d[1]=h*f-k*e,d[2]=i*f-l*e,d[6]=g*e+j*f,d[7]=h*e+k*f,d[8]=i*e+l*f,d},d.prototype.rotateZ=function(a,b){b=b||this;var c=this.data,d=b.data,e=Math.sin(a),f=Math.cos(a),g=c[0],h=c[1],i=c[2],j=c[3],k=c[4],l=c[5];return c!==d&&(d[6]=c[6],d[7]=c[7],d[8]=c[8]),d[0]=g*f+j*e,d[1]=h*f+k*e,d[2]=i*f+l*e,d[3]=j*f-g*e,d[4]=k*f-h*e,d[5]=l*f-i*e,d},d.prototype.toAngles=function(b){var d=b;d||(d=new c);var e=this.data,f=d.data;return e[3]>1-a.EPSILON?(f[1]=Math.atan2(e[2],e[8]),f[2]=Math.PI/2,f[0]=0):e[3]<-1+a.EPSILON?(f[1]=Math.atan2(e[2],e[8]),f[2]=-Math.PI/2,f[0]=0):(f[1]=Math.atan2(-e[2],e[0]),f[0]=Math.atan2(-e[7],e[4]),f[2]=Math.asin(e[1])),d},d.prototype.fromAngleNormalAxis=function(a,b,c,d){var e=Math.cos(a),f=Math.sin(a),g=1-e,h=b*b,i=c*c,j=d*d,k=b*c*g,l=b*d*g,m=c*d*g,n=b*f,o=c*f,p=d*f,q=this.data;return q[0]=h*g+e,q[3]=k-p,q[6]=l+o,q[1]=k+p,q[4]=i*g+e,q[7]=m-n,q[2]=l-o,q[5]=m+n,q[8]=j*g+e,this},d.prototype.lookAt=function(a,b){var d=this._tempX,e=this._tempY,f=this._tempZ;f.setv(a).normalize(),d.setv(b).cross(f).normalize(),d.equals(c.ZERO)&&(0!==f.data[0]?d.setd(f.data[1],-f.data[0],0):d.setd(0,f.data[2],-f.data[1])),e.setv(f).cross(d);var g=this.data;return g[0]=d.data[0],g[1]=d.data[1],g[2]=d.data[2],g[3]=e.data[0],g[4]=e.data[1],g[5]=e.data[2],g[6]=f.data[0],g[7]=f.data[1],g[8]=f.data[2],this},d.prototype.copyQuaternion=function(a){return a.toRotationMatrix(this)},d.prototype.copy=function(a){var b=this.data,c=a.data;return b[0]=c[0],b[1]=c[1],b[2]=c[2],b[3]=c[3],b[4]=c[4],b[5]=c[5],b[6]=c[6],b[7]=c[7],b[8]=c[8],this},d.prototype.clone=function(){var a=this.data;return new d(a[0],a[1],a[2],a[3],a[4],a[5],a[4],a[5],a[6])},d}),define("goo/math/Quaternion",["goo/math/Vector","goo/math/Vector3","goo/math/Matrix3x3","goo/math/MathUtils"],function(a,b,c,d){"use strict";function e(){a.call(this,4),0!==arguments.length?this.set(arguments):this.setd(0,0,0,1)}return e.prototype=Object.create(a.prototype),e.prototype.setupAliases([["x"],["y"],["z"],["w"]]),e.IDENTITY=new e(0,0,0,1),e.ALLOWED_DEVIANCE=1e-8,e.add=function(a,b,c){return c||(c=new e),c.data[0]=a.data[0]+b.data[0],c.data[1]=a.data[1]+b.data[1],c.data[2]=a.data[2]+b.data[2],c.data[3]=a.data[3]+b.data[3],c},e.sub=function(a,b,c){return c||(c=new e),c.data[0]=a.data[0]-b.data[0],c.data[1]=a.data[1]-b.data[1],c.data[2]=a.data[2]-b.data[2],c.data[3]=a.data[3]-b.data[3],c},e.mul=function(a,b,c){return c||(c=new e),c.data[0]=a.data[0]*b.data[0],c.data[1]=a.data[1]*b.data[1],c.data[2]=a.data[2]*b.data[2],c.data[3]=a.data[3]*b.data[3],c},e.mul2=function(a,b,c){var d=a.data[0],e=a.data[1],f=a.data[2],g=a.data[3],h=b.data[0],i=b.data[1],j=b.data[2],k=b.data[3];return c.data[0]=d*k+g*h+e*j-f*i,c.data[1]=e*k+g*i+f*h-d*j,c.data[2]=f*k+g*j+d*i-e*h,c.data[3]=g*k-d*h-e*i-f*j,c},e.div=function(a,b,c){c||(c=new e);var d=!0;return c.data[0]=(d&=b.data[0]<0||b.data[0]>0)?a.data[0]/b.data[0]:0,c.data[1]=(d&=b.data[1]<0||b.data[1]>0)?a.data[1]/b.data[1]:0,c.data[2]=(d&=b.data[2]<0||b.data[2]>0)?a.data[2]/b.data[2]:0,c.data[3]=(d&=b.data[3]<0||b.data[3]>0)?a.data[3]/b.data[3]:0,d===!1&&console.warn("[Quaternion.div] Attempted to divide by zero!"),c},e.scalarAdd=function(a,b,c){return c||(c=new e),c.data[0]=a.data[0]+b,c.data[1]=a.data[1]+b,c.data[2]=a.data[2]+b,c.data[3]=a.data[3]+b,c},e.scalarSub=function(a,b,c){return c||(c=new e),c.data[0]=a.data[0]-b,c.data[1]=a.data[1]-b,c.data[2]=a.data[2]-b,c.data[3]=a.data[3]-b,c},e.scalarMul=function(a,b,c){return c||(c=new e),c.data[0]=a.data[0]*b,c.data[1]=a.data[1]*b,c.data[2]=a.data[2]*b,c.data[3]=a.data[3]*b,c},e.scalarDiv=function(a,b,c){c||(c=new e);var d=!0;return b=(d&=0>b||b>0)?1/b:0,c.data[0]=a.data[0]*b,c.data[1]=a.data[1]*b,c.data[2]=a.data[2]*b,c.data[3]=a.data[3]*b,d===!1&&console.warn("[Quaternion.scalarDiv] Attempted to divide by zero!"),c},e.slerp=function(a,b,c,d){if(0===c)return d.setv(a);if(1===c)return d.setv(b);if(a.equals(b))return d.setv(a);var e=a.dot(b);d.setv(b),0>e&&(d.negate(),e=-e);var f=1-c,g=c;if(1-e>.1){var h=Math.acos(e),i=1/Math.sin(h);f=Math.sin((1-c)*h)*i,g=Math.sin(c*h)*i}var j=f*a.data[0]+g*d.data[0],k=f*a.data[1]+g*d.data[1],l=f*a.data[2]+g*d.data[2],m=f*a.data[3]+g*d.data[3];return d.setd(j,k,l,m),d},e.prototype.negate=function(){return this.data[0]*=-1,this.data[1]*=-1,this.data[2]*=-1,this.data[3]*=-1,this},e.prototype.dot=function(a){var b=this.data,c=a.data||a,d=0;return d+=b[0]*c[0],d+=b[1]*c[1],d+=b[2]*c[2],d+=b[3]*c[3]},e.prototype.add=function(a){return e.add(this,a,this)},e.prototype.sub=function(a){return e.sub(this,a,this)},e.prototype.mul=function(a){return e.mul(this,a,this)},e.prototype.div=function(a){return e.div(this,a,this)},e.prototype.scalarAdd=function(a){return e.scalarAdd(this,a,this)},e.prototype.scalarSub=function(a){return e.scalarSub(this,a,this)},e.prototype.scalarMul=function(a){return e.scalarMul(this,a,this)},e.prototype.scalarDiv=function(a){return e.scalarDiv(this,a,this)},e.prototype.slerp=function(a,b){var c=(new e).copy(a);return e.slerp(this,a,b,c),this.copy(c),this},e.prototype.fromRotationMatrix=function(a){var b,c,d,e,f=a.e00+a.e11+a.e22;if(f>=0){var g=Math.sqrt(f+1);e=.5*g,g=.5/g,b=(a.e21-a.e12)*g,c=(a.e02-a.e20)*g,d=(a.e10-a.e01)*g}else if(a.e00>a.e11&&a.e00>a.e22){var g=Math.sqrt(1+a.e00-a.e11-a.e22);b=.5*g,g=.5/g,c=(a.e10+a.e01)*g,d=(a.e02+a.e20)*g,e=(a.e21-a.e12)*g}else if(a.e11>a.e22){var g=Math.sqrt(1+a.e11-a.e00-a.e22);c=.5*g,g=.5/g,b=(a.e10+a.e01)*g,d=(a.e21+a.e12)*g,e=(a.e02-a.e20)*g}else{var g=Math.sqrt(1+a.e22-a.e00-a.e11);d=.5*g,g=.5/g,b=(a.e02+a.e20)*g,c=(a.e21+a.e12)*g,e=(a.e10-a.e01)*g}return this.set(b,c,d,e)},e.prototype.toRotationMatrix=function(a){var b=a;b||(b=new c);var d=this.magnitudeSquared(),e=d>0?2/d:0,f=this.data,g=f[0]*e,h=f[1]*e,i=f[2]*e,j=f[0]*g,k=f[0]*h,l=f[0]*i,m=f[3]*g,n=f[1]*h,o=f[1]*i,p=f[3]*h,q=f[2]*i,r=f[3]*i,s=b.data;return s[0]=1-(n+q),s[1]=k+r,s[2]=l-p,s[3]=k-r,s[4]=1-(j+q),s[5]=o+m,s[6]=l+p,s[7]=o-m,s[8]=1-(j+n),b},e.prototype.fromVectorToVector=function(a,c){var f=a,g=c,h=f.length()*g.length();if(Math.abs(h)>d.EPSILON){var i=new b,j=f.dot(g)/h,k=Math.acos(Math.max(-1,Math.min(j,1)));if(f.cross(g,i),0>j&&i.length()<d.EPSILON){var l;l=Math.abs(f.x)>Math.abs(f.y)?Math.abs(f.x)>Math.abs(f.z)?0:2:Math.abs(f.y)>Math.abs(f.z)?1:2,i.setValue(l,-f[(l+1)%3]),i.setValue((l+1)%3,f[l]),i.setValue((l+2)%3,0)}return this.fromAngleAxis(k,i)}return this.set(e.IDENTITY)},e.prototype.normalize=function(){var a=1/this.magnitude(),b=this.x*a,c=this.y*a,d=this.z*a,e=this.w*a;return this.set(b,c,d,e)},e.prototype.magnitude=function(){var a=this.data[0]*this.data[0]+this.data[1]*this.data[1]+this.data[2]*this.data[2]+this.data[3]*this.data[3];return 1===a?1:Math.sqrt(a)},e.prototype.magnitudeSquared=function(){return this.data[0]*this.data[0]+this.data[1]*this.data[1]+this.data[2]*this.data[2]+this.data[3]*this.data[3]},e.prototype.fromAngleAxis=function(a,c){var d=new b(c).normalize();return this.fromAngleNormalAxis(a,d)},e.prototype.fromAngleNormalAxis=function(a,c){if(c.equals(b.ZERO))return this.set(e.IDENTITY);var f=.5*a,g=d.sin(f),h=d.cos(f),i=g*c.getX(),j=g*c.getY(),k=g*c.getZ();return this.set(i,j,k,h)},e.prototype.toAngleAxis=function(a){var b,c=this.x*this.x+this.y*this.y+this.z*this.z;if(Math.abs(c)<=e.ALLOWED_DEVIANCE)b=0,null!==a&&(a.x=1,a.y=0,a.z=0);else if(b=2*Math.acos(this.w),null!==a){var d=1/Math.sqrt(c);a.x=this.x*d,a.y=this.y*d,a.z=this.z*d}return b},e.prototype.equals=function(a){return this===a?!0:!a instanceof e?!1:Math.abs(this.data[0]-a.data[0])<e.ALLOWED_DEVIANCE&&Math.abs(this.data[1]-a.data[1])<e.ALLOWED_DEVIANCE&&Math.abs(this.data[2]-a.data[2])<e.ALLOWED_DEVIANCE&&Math.abs(this.data[3]-a.data[3])<e.ALLOWED_DEVIANCE},e.prototype.setd=function(a,b,c,d){return this.data[0]=a,this.data[1]=b,this.data[2]=c,this.data[3]=d,this},e.prototype.seta=function(a){return this.data[0]=a[0],this.data[1]=a[1],this.data[2]=a[2],this.data[3]=a[3],this},e.prototype.setv=function(a){return this.data[0]=a.data[0],this.data[1]=a.data[1],this.data[2]=a.data[2],this.data[3]=a.data[3],this},e}),define("goo/shapes/Box",["goo/renderer/MeshData"],function(a){"use strict";function b(b,c,d,e,f){if(1===arguments.length&&arguments[0]instanceof Object){var g=arguments[0];b=g.width,c=g.height,d=g.length,e=g.tileX,f=g.tileY}this.xExtent=void 0!==b?.5*b:.5,this.yExtent=void 0!==c?.5*c:.5,this.zExtent=void 0!==d?.5*d:.5,this.tileX=e||1,this.tileY=f||1;var h=a.defaultMap([a.POSITION,a.NORMAL,a.TEXCOORD0]);a.call(this,h,24,36),this.rebuild()}return b.prototype=Object.create(a.prototype),b.prototype.rebuild=function(){function b(a){for(var b=0;b<a.length;b++){var c=3*a[b];j.push(i[c]),j.push(i[c+1]),j.push(i[c+2])}}function c(){for(var a=0;a<k.length/3;a++)for(var b=0;4>b;b++){var c=3*a;l.push(k[c]),l.push(k[c+1]),l.push(k[c+2])}}var d=this.xExtent,e=this.yExtent,f=this.zExtent,g=this.tileX,h=this.tileY,i=[-d,-e,-f,d,-e,-f,d,e,-f,-d,e,-f,d,-e,f,-d,-e,f,d,e,f,-d,e,f],j=[];b([0,1,2,3,1,4,6,2,4,5,7,6,5,0,3,7,2,6,7,3,0,5,4,1]),this.getAttributeBuffer(a.POSITION).set(j);var k=[0,0,-1,1,0,0,0,0,1,-1,0,0,0,1,0,0,-1,0],l=[];c(),this.getAttributeBuffer(a.NORMAL).set(l);for(var m=[],n=0;6>n;n++)m.push(g),m.push(0),m.push(0),m.push(0),m.push(0),m.push(h),m.push(g),m.push(h);return this.getAttributeBuffer(a.TEXCOORD0).set(m),this.getIndexBuffer().set([2,1,0,3,2,0,6,5,4,7,6,4,10,9,8,11,10,8,14,13,12,15,14,12,18,17,16,19,18,16,22,21,20,23,22,20]),this},b}),define("goo/shapes/Quad",["goo/renderer/MeshData"],function(a){"use strict";function b(b,c,d,e){if(1===arguments.length&&arguments[0]instanceof Object){var f=arguments[0];b=f.width,c=f.height,d=f.tileX,e=f.tileY}this.xExtent=void 0!==b?.5*b:.5,this.yExtent=void 0!==c?.5*c:.5,this.tileX=d||1,this.tileY=e||1;var g=a.defaultMap([a.POSITION,a.NORMAL,a.TEXCOORD0]);a.call(this,g,4,6),this.rebuild()}return b.prototype=Object.create(a.prototype),b.prototype.rebuild=function(){var b=this.xExtent,c=this.yExtent,d=this.tileX,e=this.tileY;return this.getAttributeBuffer(a.POSITION).set([-b,-c,0,-b,c,0,b,c,0,b,-c,0]),this.getAttributeBuffer(a.NORMAL).set([0,0,1,0,0,1,0,0,1,0,0,1]),this.getAttributeBuffer(a.TEXCOORD0).set([0,0,0,e,d,e,d,0]),this.getIndexBuffer().set([0,3,1,1,3,2]),this},b}),define("goo/util/Enum",[],function(){"use strict";function a(a,b){return Object.getOwnPropertyNames(b).forEach(function(c){Object.defineProperty(a,c,Object.getOwnPropertyDescriptor(b,c))}),a}function b(b,c){this.name=b,c&&a(this,c),Object.freeze(this)}function c(a){1===arguments.length&&null!==a&&"object"==typeof a?Object.keys(a).forEach(function(c){this[c]=new b(c,a[c])},this):Array.prototype.forEach.call(arguments,function(a){this[a]=new b(a)},this),Object.freeze(this)}return b.prototype=Object.create(null),b.prototype.constructor=b,b.prototype.toString=function(){return"|"+this.name+"|"},Object.freeze(b.prototype),c.prototype.symbols=function(){return Object.keys(this).map(function(a){return this[a]},this)},c.prototype.contains=function(a){return!a instanceof b?!1:this[a.name]===a},c}),define("goo/shapes/Sphere",["goo/renderer/MeshData","goo/util/Enum","goo/math/Vector3","goo/math/MathUtils"],function(a,b,c,d){"use strict";function e(b,c,d,f){if(1===arguments.length&&arguments[0]instanceof Object){var g=arguments[0];b=g.zSamples,c=g.radialSamples,d=g.radius,f=g.textureMode}this.zSamples=(void 0!==b?b:8)+1,this.radialSamples=void 0!==c?c:8,this.radius=void 0!==d?d:.5,"string"==typeof f&&(f=e.TextureModes[f]),this.textureMode=void 0!==f?f:e.TextureModes.Polar,this.viewInside=!1;var h=a.defaultMap([a.POSITION,a.NORMAL,a.TEXCOORD0]),i=this.textureMode===e.TextureModes.Chromeball?this.zSamples+1:this.zSamples,j=(i-2)*(this.radialSamples+1)+2,k=6*(i-2)*this.radialSamples;a.call(this,h,j,k),this.rebuild()}function f(a,b,c){a[3*c+0]=a[3*b+0],a[3*c+1]=a[3*b+1],a[3*c+2]=a[3*b+2]}return e.prototype=Object.create(a.prototype),e.prototype.rebuild=function(){for(var b=this.getAttributeBuffer(a.POSITION),g=this.getAttributeBuffer(a.NORMAL),h=this.getAttributeBuffer(a.TEXCOORD0),i=this.getIndexBuffer(),j=1/this.radialSamples,k=2/(this.zSamples-1),l=[],m=[],n=0;n<this.radialSamples;n++){var o=d.TWO_PI*j*n;m[n]=Math.cos(o),l[n]=Math.sin(o)}l[this.radialSamples]=l[0],m[this.radialSamples]=m[0];for(var p=0,q=new c,r=new c,s=new c,t=1;t<this.zSamples-1;t++){var u=d.HALF_PI*(-1+k*t),v=Math.sin(u),w=this.radius*v,x=r.set(0,0,0);x.z+=w;for(var y,z=Math.sqrt(Math.abs(this.radius*this.radius-w*w)),A=p,n=0;n<this.radialSamples;n++){var B=n*j,C=s.set(m[n],l[n],0);if(c.mul(C,z,q),b[3*p+0]=x.x+q.x,b[3*p+1]=x.y+q.y,b[3*p+2]=x.z+q.z,y=q.set(b[3*p+0],b[3*p+1],b[3*p+2]),y.normalize(),this.viewInside?(g[3*p+0]=-y.x,g[3*p+1]=-y.y,g[3*p+2]=-y.z):(g[3*p+0]=y.x,g[3*p+1]=y.y,g[3*p+2]=y.z),this.textureMode===e.TextureModes.Linear)h[2*p+0]=B,h[2*p+1]=.5*(v+1);else if(this.textureMode===e.TextureModes.Projected)h[2*p+0]=B,h[2*p+1]=(d.HALF_PI+Math.asin(v))/Math.PI;else if(this.textureMode===e.TextureModes.Polar){var D=(d.HALF_PI-Math.abs(u))/Math.PI,E=D*m[n]+.5,F=D*l[n]+.5;h[2*p+0]=E,h[2*p+1]=F}else if(this.textureMode===e.TextureModes.Chromeball){var D=Math.sin((d.HALF_PI+u)/2);D/=2;var E=D*m[n]+.5,F=D*l[n]+.5;h[2*p+0]=E,h[2*p+1]=F}p++}if(f(b,A,p),f(g,A,p),this.textureMode===e.TextureModes.Linear)h[2*p+0]=1,h[2*p+1]=.5*(v+1);else if(this.textureMode===e.TextureModes.Projected)h[2*p+0]=1,h[2*p+1]=(d.HALF_PI+Math.asin(v))/Math.PI;else if(this.textureMode===e.TextureModes.Polar){var D=(d.HALF_PI-Math.abs(u))/Math.PI;h[2*p+0]=D+.5,h[2*p+1]=.5}else if(this.textureMode===e.TextureModes.Chromeball){var D=Math.sin((d.HALF_PI+u)/2);D/=2,h[2*p+0]=D+.5,h[2*p+1]=.5}p++}if(this.textureMode===e.TextureModes.Chromeball){for(var G=d.HALF_PI-.001,H=this.radius*Math.sin(G),I=Math.sqrt(Math.abs(this.radius*this.radius-H*H)),A=p,n=0;n<this.radialSamples;n++){b[3*p+0]=I*m[n],b[3*p+1]=I*l[n],b[3*p+2]=H;var y=q.set(b[3*p+0],b[3*p+1],b[3*p+2]);y.normalize(),this.viewInside?(g[3*p+0]=-y.x,g[3*p+1]=-y.y,g[3*p+2]=-y.z):(g[3*p+0]=y.x,g[3*p+1]=y.y,g[3*p+2]=y.z);var D=Math.sin((d.HALF_PI+G)/2);D/=2;var E=D*m[n]+.5,F=D*l[n]+.5;h[2*p+0]=E,h[2*p+1]=F,p++}f(b,A,p),f(g,A,p);var D=Math.sin((d.HALF_PI+G)/2);D/=2,h[2*p+0]=D+.5,h[2*p+1]=.5,p++}b[3*p+0]=0,b[3*p+1]=0,b[3*p+2]=-this.radius,this.viewInside?(g[3*p+0]=0,g[3*p+1]=0,g[3*p+2]=1):(g[3*p+0]=0,g[3*p+1]=0,g[3*p+2]=-1),this.textureMode===e.TextureModes.Polar||this.textureMode===e.TextureModes.Chromeball?(h[2*p+0]=.5,h[2*p+1]=.5):(h[2*p+0]=.5,h[2*p+1]=0),p++,b[3*p+0]=0,b[3*p+1]=0,b[3*p+2]=this.radius,this.viewInside?(g[3*p+0]=0,g[3*p+1]=0,g[3*p+2]=-1):(g[3*p+0]=0,g[3*p+1]=0,g[3*p+2]=1),this.textureMode===e.TextureModes.Polar?(h[2*p+0]=.5,h[2*p+1]=.5):this.textureMode===e.TextureModes.Chromeball?(h[2*p+0]=1,h[2*p+1]=-.5):(h[2*p+0]=.5,h[2*p+1]=1);for(var J=0,K=this.textureMode===e.TextureModes.Chromeball?this.zSamples+1:this.zSamples,t=0,L=0;K-3>t;t++){var M=L,N=M+1;L+=this.radialSamples+1;for(var O=L,P=O+1,p=0;p<this.radialSamples;p++)this.viewInside?(i[J++]=M++,i[J++]=O,i[J++]=N,i[J++]=N++,i[J++]=O++,i[J++]=P++):(i[J++]=M++,i[J++]=N,i[J++]=O,i[J++]=N++,i[J++]=P++,i[J++]=O++)}for(var p=0;p<this.radialSamples;p++)this.viewInside?(i[J++]=p,i[J++]=p+1,i[J++]=this.vertexCount-2):(i[J++]=p,i[J++]=this.vertexCount-2,i[J++]=p+1);for(var Q=(K-3)*(this.radialSamples+1),p=0;p<this.radialSamples;p++)this.viewInside?(i[J++]=p+Q,i[J++]=this.vertexCount-1,i[J++]=p+1+Q):(i[J++]=p+Q,i[J++]=p+1+Q,i[J++]=this.vertexCount-1);return this},e.TextureModes=new b("Linear","Projected","Polar","Chromeball"),e}),define("goo/addons/cannon/systems/CannonjsSystem",["goo/entities/systems/System","goo/renderer/bounds/BoundingBox","goo/renderer/bounds/BoundingSphere","goo/math/Quaternion","goo/shapes/Box","goo/shapes/Quad","goo/shapes/Sphere","goo/renderer/MeshData"],function(a,b,c,d,e,f,g,h){"use strict";function i(b){a.call(this,"CannonjsSystem",["CannonjsComponent","TransformComponent"]),b=b||{};var c=this.world=new j.World;c.gravity.y=-9.82,c.broadphase=new j.NaiveBroadphase,this.stepFrequency=b.stepFrequency||60,this.quat=new d}var j=window.CANNON;return i.prototype=Object.create(a.prototype),i.prototype.createShape=function(a){var d,i=a.cannonjsComponent,k=a.transformComponent;if(a.meshDataComponent){var l=a.meshDataComponent;if(i.useBounds){l.computeBoundFromPoints();var m=l.modelBound;m instanceof b?d=new j.Box(new j.Vec3(m.xExtent,m.yExtent,m.zExtent)):m instanceof c&&(d=new j.Sphere(m.radius))}else{var n=l.meshData;if(n instanceof e)d=new j.Box(new j.Vec3(n.xExtent,n.yExtent,n.zExtent));else if(n instanceof g)d=new j.Sphere(n.radius);else if(n instanceof f)d=new j.Plane;else{for(var o=[],p=[],q=n.getAttributeBuffer(h.POSITION),r=n.getIndexBuffer(),s=0;s<3*n.vertexCount;s+=3)o.push(new j.Vec3(q[s],q[s+1],q[s+2]));for(var s=0;s<n.indexCount;s+=3){var t=[r[s],r[s+1],r[s+2]];p.push(t)}d=new j.ConvexPolyhedron(o,p)}}}else for(var u=k.children,s=0;s<u.length;s++){var v=u[s].entity,w=this.createShape(v);if(w){d||(d=new j.Compound);var x=v.transformComponent.transform.translation,y=v.transformComponent.transform.rotation,z=new j.Vec3(x.x,x.y,x.z);this.quat.fromRotationMatrix(y);var A=new j.Quaternion(this.quat.x,this.quat.y,this.quat.z,this.quat.w);d.addChild(w,z,A)}}return d},i.prototype.inserted=function(a){var b=a.cannonjsComponent,c=a.transformComponent,d=this.createShape(a);if(!d)return a.clearComponent("CannonjsComponent"),void 0;var e=new j.RigidBody(b.mass,d);e.position.set(c.transform.translation.x,c.transform.translation.y,c.transform.translation.z),this.quat.fromRotationMatrix(c.transform.rotation),e.quaternion.set(this.quat.x,this.quat.y,this.quat.z,this.quat.w),b.body=e,this.world.add(e)},i.prototype.deleted=function(a){var b=a.cannonjsComponent;b&&this.world.remove(b.body)},i.prototype.process=function(a){this.world.step(1/this.stepFrequency);for(var b=0;b<a.length;b++){var c=a[b],d=c.cannonjsComponent,e=d.body.position;c.transformComponent.transform.translation.x=e.x,c.transformComponent.transform.translation.y=e.y,c.transformComponent.transform.translation.z=e.z;var f=d.body.quaternion;this.quat.set(f.x,f.y,f.z,f.w),c.transformComponent.transform.rotation.copyQuaternion(this.quat),c.transformComponent.setUpdated()}},i}),define("goo/addons/howler/components/HowlerComponent",["goo/entities/components/Component"],function(a){"use strict";function b(){this.type="HowlerComponent",this.sounds=[]}return b.prototype=Object.create(a.prototype),b.prototype.addSound=function(a){-1===this.sounds.indexOf(a)&&this.sounds.push(a)},b.prototype.playSound=function(a,b,c){console.log(this.sounds[a].play),this.sounds[a].play(b,c)},b.prototype.getSound=function(a){return this.sounds[a]},b}),define("goo/renderer/RendererRecord",[],function(){"use strict";function a(){this.currentBuffer={ArrayBuffer:{buffer:null,valid:!1},ElementArrayBuffer:{buffer:null,valid:!1}},this.currentFrameBuffer=null,this.clippingTestValid=!1,this.clippingTestEnabled=!1,this.clips=[],this.enabledTextures=0,this.texturesValid=!1,this.currentTextureArraysUnit=0,this.textureRecord=[],this.usedProgram=null,this.boundAttributes=[],this.depthRecord={},this.cullRecord={},this.blendRecord={},this.offsetRecord={},this.lineRecord={},this.pointRecord={}}return a.prototype.invalidateBuffer=function(a){this.currentBuffer[a].buffer=null,this.currentBuffer[a].valid=!1},a}),define("goo/util/rsvp",["exports"],function(a){"use strict";function b(a,b){f.async(function(){a.trigger("promise:resolved",{detail:b}),a.isResolved=!0,a.resolvedValue=b})}function c(a,b){f.async(function(){a.trigger("promise:failed",{detail:b}),a.isRejected=!0,a.rejectedValue=b})}function d(a){var b,c=[],d=new q,e=a.length;0===e&&d.resolve([]);var f=function(a,b){c[a]=b,0===--e&&d.resolve(c)},g=function(a){return function(b){f(a,b)}},h=function(a){d.reject(a)};for(b=0;e>b;b++)a[b].then(g(b),h);return d}function e(a,b){f[a]=b}var f={},g="undefined"!=typeof window?window:{},h=g.MutationObserver||g.WebKitMutationObserver,i=window.process;if("undefined"!=typeof i&&"[object process]"==={}.toString.call(i))f.async=function(a,b){i.nextTick(function(){a.call(b)})};else if(h){var j=[],k=new h(function(){var a=j.slice();j=[],a.forEach(function(a){var b=a[0],c=a[1];b.call(c)})}),l=document.createElement("div");k.observe(l,{attributes:!0}),window.addEventListener("unload",function(){k.disconnect(),k=null}),f.async=function(a,b){j.push([a,b]),l.setAttribute("drainQueue","drainQueue")}}else f.async=function(a,b){setTimeout(function(){a.call(b)},1)};var m=function(a,b){this.type=a;for(var c in b)b.hasOwnProperty(c)&&(this[c]=b[c])},n=function(a,b){for(var c=0,d=a.length;d>c;c++)if(a[c][0]===b)return c;return-1},o=function(a){var b=a._promiseCallbacks;return b||(b=a._promiseCallbacks={}),b},p={mixin:function(a){return a.on=this.on,a.off=this.off,a.trigger=this.trigger,a},on:function(a,b,c){var d,e,f=o(this);for(a=a.split(/\s+/),c=c||this;e=a.shift();)d=f[e],d||(d=f[e]=[]),-1===n(d,b)&&d.push([b,c])},off:function(a,b){var c,d,e,f=o(this);for(a=a.split(/\s+/);d=a.shift();)b?(c=f[d],e=n(c,b),-1!==e&&c.splice(e,1)):f[d]=[]},trigger:function(a,b){var c,d,e,f,g,h=o(this);if(c=h[a])for(var i=0,j=c.length;j>i;i++)d=c[i],e=d[0],f=d[1],"object"!=typeof b&&(b={detail:b}),g=new m(a,b),e.call(f,g)}},q=function(){this.on("promise:resolved",function(a){this.trigger("success",{detail:a.detail})},this),this.on("promise:failed",function(a){this.trigger("error",{detail:a.detail})},this)},r=function(){},s=function(a,b,c,d){var e,f,g,h,i="function"==typeof c;if(i)try{e=c(d.detail),g=!0}catch(j){h=!0,f=j}else e=d.detail,g=!0;e&&"function"==typeof e.then?e.then(function(a){b.resolve(a)},function(a){b.reject(a)}):i&&g?b.resolve(e):h?b.reject(f):b[a](e)};q.prototype={then:function(a,b){var c=new q;return this.isResolved&&f.async(function(){s("resolve",c,a,{detail:this.resolvedValue})},this),this.isRejected&&f.async(function(){s("reject",c,b,{detail:this.rejectedValue})},this),this.on("promise:resolved",function(b){s("resolve",c,a,b)}),this.on("promise:failed",function(a){s("reject",c,b,a)}),c},resolve:function(a){b(this,a),this.resolve=r,this.reject=r},reject:function(a){c(this,a),this.resolve=r,this.reject=r}},p.mixin(q.prototype),a.Promise=q,a.Event=m,a.EventTarget=p,a.all=d,a.configure=e}),define("goo/util/Ajax",["goo/util/rsvp"],function(a){"use strict";function b(a){this._loadStack=[],this._callback=a}return b.prototype.get=function(b){var c=new a.Promise,d=this._progress.bind(this),e={loaded:0,total:0,lengthComputable:!1};this._loadStack.push(e),b=b||{};var f=b.url||"",g="GET",h=!0,i=new XMLHttpRequest;return i.open(g,f,h),b.responseType&&(i.responseType=b.responseType),i.onreadystatechange=function(){4===i.readyState&&(i.status>=200&&i.status<=299?(e.loaded=e.total,d(),c.resolve(i)):c.reject(i.statusText))},i.addEventListener("progress",function(a){e.loaded=a.loaded||a.position,e.total=a.total||a.totalSize,e.lengthComputable=a.lengthComputable,d()},!1),i.send(),c},b.prototype._progress=function(){if(this._callback){for(var a={total:0,loaded:0,count:this._loadStack.length},b=0;b<this._loadStack.length;b++)a.total+=this._loadStack[b].total,a.loaded+=this._loadStack[b].loaded;this._callback(a)}},b.ARRAY_BUFFER="arraybuffer",b.prototype.load=function(a,c){if("undefined"==typeof a||null===a)throw new Error("Ajax(): `path` was undefined/null");var d={url:a};c===b.ARRAY_BUFFER&&(d.responseType=b.ARRAY_BUFFER);var e=this.get(d).then(function(a){return a.response});return e.then(null,function(a){throw console.error("Ajax.load(): Could not retrieve data from `"+d.url+"`.\n Reason: "+a),new Error("Ajax.load(): Could not retrieve data from `"+d.url+"`.\n Reason: "+a)}),e},b.prototype.loadImage=function(c,d){window.URL=window.URL||window.webkitURL;var e=new a.Promise,f=new Image;return f.addEventListener("load",function(){f.dataReady=!0,window.URL.revokeObjectURL(f.src),e.resolve(f)},!1),f.addEventListener("error",function(a){console.log(a),e.reject("Ajax.loadImage(): Couldn't load from ["+c+"]")},!1),d?this.load(c,function(a){var b=new Uint8Array(a,0,a.byteLength),d="image/jpeg";/\.png$/.test(c)&&(d="image/png");var e=new Blob([b],{type:d});return f.src=window.URL.createObjectURL(e),f},b.ARRAY_BUFFER):f.src=c,e},b}),define("goo/loaders/Loader",["goo/util/rsvp","goo/util/Ajax"],function(a,b){"use strict";function c(a){if("undefined"!=typeof a&&null!==a&&"object"!=typeof a)throw new Error("Loader(): Argument `parameters` must be of type `object`");("undefined"==typeof a||null===a)&&(a={}),this.rootPath=a.rootPath||"",this.xhr=a.xhr||new b(this._progressCallback.bind(this)),this._progressCallbacks=[],this.total=0}return c.prototype.load=function(a,b,d){if("undefined"==typeof a||null===a)throw new Error("Loader(): `path` was undefined/null");var e={url:this._buildURL(a)};d===c.ARRAY_BUFFER&&(e.responseType=c.ARRAY_BUFFER);var f=this.xhr.get(e).then(function(a){return a.response});return b&&(f=f.then(function(a){return"function"==typeof b?b(a):a})),f.then(function(){console.log("Loaded: "+e.url)}),f.then(null,function(a){throw console.error("Loader.load(): Could not retrieve data from `"+e.url+"`.\n Reason: "+a),new Error("Loader.load(): Could not retrieve data from `"+e.url+"`.\n Reason: "+a)}),f},c.prototype.addProgressCallback=function(a){this._progressCallbacks.push(a)},c.prototype.removeProgressCallback=function(a){for(var b=0;b<this._progressCallbacks.length;b++)if(this._progressCallbacks[b]===a){this._progressCallbacks.splice(b,1);break}},c.prototype._progressCallback=function(a){this.total&&(a.total=this.total);for(var b=0;b<this._progressCallbacks.length;b++)this._progressCallbacks[b](a)},c.prototype.loadImage=function(b,d){window.URL=window.URL||window.webkitURL;var e=new a.Promise,f=new Image;return f.addEventListener("load",function(){f.dataReady=!0,window.URL.revokeObjectURL(f.src),e.resolve(f)},!1),f.addEventListener("error",function(){e.reject("Loader.loadImage(): Couldn't load from ["+b+"]")},!1),d?this.load(b,function(a){var c=new Uint8Array(a,0,a.byteLength),d="image/jpeg";/\.png$/.test(b)&&(d="image/png");var e=new Blob([c],{type:d});f.src=window.URL.createObjectURL(e)},c.ARRAY_BUFFER):f.src=this._buildURL(b),e},c.prototype._buildURL=function(a){return this.rootPath+window.escape(a)},c.ARRAY_BUFFER="arraybuffer",c}),define("goo/renderer/Texture",["goo/math/Vector2"],function(a){"use strict";function b(b,c,d,e){this.glTexture=null,c=c||{},this.wrapS=c.wrapS||"Repeat",this.wrapT=c.wrapT||"Repeat",this.magFilter=c.magFilter||"Bilinear",this.minFilter=c.minFilter||"Trilinear",this.anisotropy=void 0!==c.anisotropy?c.anisotropy:1,this.format=c.format||"RGBA",this.type=c.type||"UnsignedByte",this.variant="2D",this.offset=new a(c.offset||[0,0]),this.repeat=new a(c.repeat||[1,1]),this.generateMipmaps=void 0!==c.generateMipmaps?c.generateMipmaps:!0,this.premultiplyAlpha=void 0!==c.premultiplyAlpha?c.premultiplyAlpha:!1,this.unpackAlignment=void 0!==c.unpackAlignment?c.unpackAlignment:1,this.flipY=void 0!==c.flipY?c.flipY:!0,this.hasBorder=!1,this.needsUpdate=!1,this.updateCallback=null,this.readyCallback=null,b&&this.setImage(b,c,d,e)
}return b.prototype.checkDataReady=function(){return this.image&&(this.image.dataReady||this.image instanceof HTMLImageElement)||null!==this.readyCallback&&this.readyCallback()},b.prototype.checkNeedsUpdate=function(){return this.needsUpdate||null!==this.updateCallback&&this.updateCallback()},b.prototype.setNeedsUpdate=function(){this.needsUpdate=!0},b.prototype.setImage=function(a,b,c,d){this.image=a;var e=a instanceof Array?a[0]:a;if(e instanceof Uint8Array||e instanceof Uint8ClampedArray||e instanceof Uint16Array||e instanceof Float32Array){if(c=c||a.width,d=d||a.height,void 0===c||void 0===d)throw"Data textures need width and height";this.image={data:a},this.image.width=c,this.image.height=d,this.image.isData=!0,this.image.dataReady=!0,e instanceof Uint8Array||e instanceof Uint8ClampedArray?b.type="UnsignedByte":e instanceof Uint16Array&&(b.type="UnsignedShort4444")}else a instanceof Array&&(this.image={data:a});this.setNeedsUpdate()},b.CUBE_FACES=["PositiveX","NegativeX","PositiveY","NegativeY","PositiveZ","NegativeZ"],b}),define("goo/loaders/dds/DdsUtils",[],function(){"use strict";function a(){}return a.getDdsExtension=function(a){for(var b=["","WEBKIT_","MOZ_"],c=0;c<b.length;c++){var d=a.getExtension(b[c]+"WEBGL_compressed_texture_s3tc");if("undefined"!=typeof d&&null!==d)return d}return null},a.isSupported=function(b){return null!==a.getDdsExtension(b)},a.shiftCount=function(a){if(0===a)return 0;for(var b=0;0===(1&a);)if(a>>=1,b++,b>32)throw"invalid mask!";return b},a.isSet=function(a,b){return(a&b)===b},a.getIntFromString=function(b){for(var c=[],d=0;d<b.length;d++)c[d]=b.charCodeAt(d);return a.getIntFromBytes(c)},a.getIntFromBytes=function(a){var b=0;return b|=(255&a[0])<<0,a.length>1&&(b|=(255&a[1])<<8),a.length>2&&(b|=(255&a[2])<<16),a.length>3&&(b|=(255&a[3])<<24),b},a.getComponents=function(a){switch(a){case"Alpha":return 1;case"RGB":return 3;case"RGBA":return 4;case"Luminance":return 1;case"LuminanceAlpha":return 2;case"PrecompressedDXT1":return 1;case"PrecompressedDXT1A":return 1;case"PrecompressedDXT3":return 2;case"PrecompressedDXT5":return 2}return 0},a.flipDXT=function(b,c,d,e){for(var f=new Uint8Array(b.length),g=c+3>>2,h=d+3>>2,i=8*a.getComponents(e),j=0;h>j;j++)for(var k=h-j-1,l=0;g>l;l++){var m=(k*g+l)*i,n=(j*g+l)*i;switch(e){case"PrecompressedDXT1":case"PrecompressedDXT1A":f[m+0]=b[n+0],f[m+1]=b[n+1],f[m+2]=b[n+2],f[m+3]=b[n+3],f[m+4]=b[n+7],f[m+5]=b[n+6],f[m+6]=b[n+5],f[m+7]=b[n+4];break;case"PrecompressedDXT3":f[m+0]=b[n+6],f[m+1]=b[n+7],f[m+2]=b[n+4],f[m+3]=b[n+5],f[m+4]=b[n+2],f[m+5]=b[n+3],f[m+6]=b[n+0],f[m+7]=b[n+1],f[m+8]=b[n+8],f[m+9]=b[n+9],f[m+10]=b[n+10],f[m+11]=b[n+11],f[m+12]=b[n+15],f[m+13]=b[n+14],f[m+14]=b[n+13],f[m+15]=b[n+12];break;case"PrecompressedDXT5":f[m+0]=b[n+0],f[m+1]=b[n+1],a.getBytesFromUInt24(f,m+5,a.flipUInt24(a.getUInt24(b,n+2))),a.getBytesFromUInt24(f,m+2,a.flipUInt24(a.getUInt24(b,n+5))),f[m+8]=b[n+8],f[m+9]=b[n+9],f[m+10]=b[n+10],f[m+11]=b[n+11],f[m+12]=b[n+15],f[m+13]=b[n+14],f[m+14]=b[n+13],f[m+15]=b[n+12]}}return f},a.getUInt24=function(a,b){var c=0;return c|=(255&a[b+0])<<0,c|=(255&a[b+1])<<8,c|=(255&a[b+2])<<16},a.getBytesFromUInt24=function(a,b,c){a[b+0]=255&c,a[b+1]=(65280&c)>>8,a[b+2]=(16711680&c)>>16},a.ThreeBitMask=7,a.flipUInt24=function(b){for(var c=[],d=0;2>d;d++)c.push([0,0,0,0]);c[0][0]=b&a.ThreeBitMask,b>>=3,c[0][1]=b&a.ThreeBitMask,b>>=3,c[0][2]=b&a.ThreeBitMask,b>>=3,c[0][3]=b&a.ThreeBitMask,b>>=3,c[1][0]=b&a.ThreeBitMask,b>>=3,c[1][1]=b&a.ThreeBitMask,b>>=3,c[1][2]=b&a.ThreeBitMask,b>>=3,c[1][3]=b&a.ThreeBitMask;var e=0;return e|=c[1][0]<<0,e|=c[1][1]<<3,e|=c[1][2]<<6,e|=c[1][3]<<9,e|=c[0][0]<<12,e|=c[0][1]<<15,e|=c[0][2]<<18,e|=c[0][3]<<21},a}),define("goo/loaders/dds/DdsLoader",["goo/loaders/dds/DdsUtils"],function(a){"use strict";function b(){this.dwSize=0,this.dwFlags=0,this.dwFourCC=0,this.dwRGBBitCount=0,this.dwRBitMask=0,this.dwGBitMask=0,this.dwBBitMask=0,this.dwABitMask=0}function c(){this.dwSize=0,this.dwFlags=0,this.dwHeight=0,this.dwWidth=0,this.dwLinearSize=0,this.dwDepth=0,this.dwMipMapCount=0,this.dwAlphaBitDepth=0,this.dwReserved1=[],this.ddpf=null,this.dwCaps=0,this.dwCaps2=0,this.dwCaps3=0,this.dwCaps4=0,this.dwTextureStage=0}function d(){this.flipVertically=!1,this.bpp=0,this.header=null,this.headerDX10=null,this.mipmapByteSizes=[]}function e(){}return b.HEADER_OFFSET=19,b.DDPF_ALPHAPIXELS=1,b.DDPF_ALPHA=2,b.DDPF_FOURCC=4,b.DDPF_RGB=64,b.DDPF_YUV=512,b.DDPF_LUMINANCE=131072,b.read=function(a){var c=new b;if(c.dwSize=a[b.HEADER_OFFSET+0],32!==c.dwSize)throw"invalid pixel format size: "+c.dwSize;return c.dwFlags=a[b.HEADER_OFFSET+1],c.dwFourCC=a[b.HEADER_OFFSET+2],c.dwRGBBitCount=a[b.HEADER_OFFSET+3],c.dwRBitMask=a[b.HEADER_OFFSET+4],c.dwGBitMask=a[b.HEADER_OFFSET+5],c.dwBBitMask=a[b.HEADER_OFFSET+6],c.dwABitMask=a[b.HEADER_OFFSET+7],c},c.DDSD_CAPS=1,c.DDSD_HEIGHT=2,c.DDSD_WIDTH=4,c.DDSD_PITCH=8,c.DDSD_PIXELFORMAT=4096,c.DDSD_MIPMAPCOUNT=131072,c.DDSD_LINEARSIZE=524288,c.DDSD_DEPTH=8388608,c.DDSCAPS_COMPLEX=8,c.DDSCAPS_MIPMAP=4194304,c.DDSCAPS_TEXTURE=4096,c.DDSCAPS2_CUBEMAP=512,c.DDSCAPS2_CUBEMAP_POSITIVEX=1024,c.DDSCAPS2_CUBEMAP_NEGATIVEX=2048,c.DDSCAPS2_CUBEMAP_POSITIVEY=4096,c.DDSCAPS2_CUBEMAP_NEGATIVEY=8192,c.DDSCAPS2_CUBEMAP_POSITIVEZ=16384,c.DDSCAPS2_CUBEMAP_NEGATIVEZ=32768,c.DDSCAPS2_VOLUME=2097152,c.read=function(d){var e=new c;if(e.dwSize=d[1],124!==e.dwSize)throw"invalid dds header size: "+e.dwSize;e.dwFlags=d[2],e.dwHeight=d[3],e.dwWidth=d[4],e.dwLinearSize=d[5],e.dwDepth=d[6],e.dwMipMapCount=d[7],e.dwAlphaBitDepth=d[8];for(var f=0;f<e.dwReserved1.length;f++)e.dwReserved1[f]=d[9+f];e.ddpf=b.read(d),e.dwCaps=d[27],e.dwCaps2=d[28],e.dwCaps3=d[29],e.dwCaps4=d[30],e.dwTextureStage=d[31];var g=1+Math.ceil(Math.log(Math.max(e.dwHeight,e.dwWidth))/Math.log(2));return a.isSet(e.dwCaps,c.DDSCAPS_MIPMAP)?a.isSet(e.dwFlags,c.DDSD_MIPMAPCOUNT)?e.dwMipMapCount!==g&&console.warn("Got "+e.dwMipMapCount+" mipmaps, expected "+g):e.dwMipMapCount=g:e.dwMipMapCount=1,e},d.prototype.calcMipmapSizes=function(a){for(var b=this.header.dwWidth,c=this.header.dwHeight,d=0,e=0;e<this.header.dwMipMapCount;e++)d=a?2*~~((b+3)/4)*~~((c+3)/4)*this.bpp:~~(b*c*this.bpp/8),this.mipmapByteSizes.push(4*~~((d+3)/4)),b=~~(b/2)>1?~~(b/2):1,c=~~(c/2)>1?~~(c/2):1},e.updateDepth=function(b,d){if(a.isSet(d.header.dwCaps2,c.DDSCAPS2_CUBEMAP)){var e=0;if(a.isSet(d.header.dwCaps2,c.DDSCAPS2_CUBEMAP_POSITIVEX)&&e++,a.isSet(d.header.dwCaps2,c.DDSCAPS2_CUBEMAP_NEGATIVEX)&&e++,a.isSet(d.header.dwCaps2,c.DDSCAPS2_CUBEMAP_POSITIVEY)&&e++,a.isSet(d.header.dwCaps2,c.DDSCAPS2_CUBEMAP_NEGATIVEY)&&e++,a.isSet(d.header.dwCaps2,c.DDSCAPS2_CUBEMAP_POSITIVEZ)&&e++,a.isSet(d.header.dwCaps2,c.DDSCAPS2_CUBEMAP_NEGATIVEZ)&&e++,6!==e)throw new Error("Cubemaps without all faces defined are not currently supported.");b.depth=e}else b.depth=d.header.dwDepth>0?d.header.dwDepth:1},e.readDXT=function(b,c,d,e){if(e.image.isCompressed=!0,!d.flipVertically)return new Uint8Array(b.buffer,b.byteOffset+0,c);for(var f=d.header.dwWidth,g=d.header.dwHeight,h=new Uint8Array(c),i=0,j=0;j<d.header.dwMipMapCount;j++){var k=b.subarray(i,i+d.mipmapByteSizes[j]),l=a.flipDXT(k,f,g,e.format);h.set(l,i),i+=l.length,f=~~(f/2)>1?~~(f/2):1,g=~~(g/2)>1?~~(g/2):1}return h},e.readUncompressed=function(b,c,d,e,f,g,h,i){var j=a.shiftCount(h.header.ddpf.dwRBitMask),k=a.shiftCount(h.header.ddpf.dwGBitMask),l=a.shiftCount(h.header.ddpf.dwBBitMask),m=a.shiftCount(h.header.ddpf.dwABitMask),n=~~(h.header.ddpf.dwRGBBitCount/8),o=1*a.getComponents(i.format),p=new Uint8Array(c),q=h.header.dwWidth,r=h.header.dwHeight,s=0,t=0,u=0,v=[];for(u=0;n>u;u++)v.push(0);for(var w=0;w<h.header.dwMipMapCount;w++){for(var x=0;r>x;x++)for(var y=0;q>y;y++){for(u=0;n>u;u++)v[u]=b[t++];u=a.getIntFromBytes(v);var z=(u&h.header.ddpf.dwRBitMask)>>j,A=(u&h.header.ddpf.dwGBitMask)>>k,B=(u&h.header.ddpf.dwBBitMask)>>l,C=(u&h.header.ddpf.dwABitMask)>>m;f?p[s++]=C:e?(p[s++]=z,g&&(p[s++]=C)):d&&(p[s++]=z,p[s++]=A,p[s++]=B,g&&(p[s++]=C))}s+=q*r*o,q=~~(q/2)>1?~~(q/2):1,r=~~(r/2)>1?~~(r/2):1}return p},e.populate=function(c,d,f){var g=d.header.ddpf.dwFlags,h=a.isSet(g,b.DDPF_FOURCC),i=a.isSet(g,b.DDPF_RGB),j=a.isSet(g,b.DDPF_ALPHAPIXELS),k=a.isSet(g,b.DDPF_LUMINANCE),l=a.isSet(g,b.DDPF_ALPHA);if(c.type="UnsignedByte",h){var m=d.header.ddpf.dwFourCC;if(m===a.getIntFromString("DXT1"))d.bpp=4,c.format="PrecompressedDXT1A";else if(m===a.getIntFromString("DXT3"))d.bpp=8,c.format="PrecompressedDXT3";else{if(m!==a.getIntFromString("DXT5"))throw m===a.getIntFromString("DX10")?new Error("dxt10 LATC formats not supported currently: "+d.headerDX10.dxgiFormat):m===a.getIntFromString("DXT2")?"DXT2 is not supported.":m===a.getIntFromString("DXT4")?"DXT4 is not supported.":"unsupported compressed dds format found ("+m+")";d.bpp=8,c.format="PrecompressedDXT5"}}else if(d.bpp=d.header.ddpf.dwRGBBitCount,i)c.format=j?"RGBA":"RGB";else{if(!k&&!j)throw new Error("unsupported uncompressed dds format found.");k&&j?c.format="LuminanceAlpha":k?c.format="Luminance":l&&(c.format="Alpha")}d.calcMipmapSizes(h),c.image.mipmapSizes=d.mipmapByteSizes;for(var n=0,o=0;o<d.mipmapByteSizes.length;o++)n+=d.mipmapByteSizes[o];for(var p=[],o=0;o<c.image.depth;o++)h?p.push(e.readDXT(f,n,d,c)):(i||k||l)&&p.push(e.readUncompressed(f,n,i,k,l,j,d,c));c.image.data=1===c.image.depth?p[0]:p,c.image.useArrays=!0},e.prototype.load=function(b,f,g,h,i){var j=new Int32Array(b,h+0,32),k=j[0];if(k!==a.getIntFromString("DDS "))throw"Not a dds file.";var l=new d;l.flipVertically=g,l.header=c.read(j),l.headerDX10=l.header.ddpf.dwFourCC===a.getIntFromString("DX10")?c.read(Int32Array.create(b,h+128,5)):null;var m=f.image;("undefined"==typeof m||null===m)&&(m={},f.image=m),m.width=l.header.dwWidth,m.height=l.header.dwHeight,e.updateDepth(m,l);var n=128+(l.headerDX10?20:0);e.populate(f,l,new Uint8Array(b,h+n,i-n)),(!l.mipmapByteSizes||l.mipmapByteSizes.length<2)&&(f.minFilter="BilinearNoMipMaps"),m.bpp=l.bpp,m.dataReady=!0,f.needsUpdate=!0},e.SUPPORTS_DDS=!1,e.prototype.isSupported=function(){return e.SUPPORTS_DDS},e.prototype.toString=function(){return"DdsLoader"},e}),define("goo/loaders/crunch/CrunchLoader",["goo/loaders/dds/DdsLoader","goo/loaders/dds/DdsUtils"],function(a,b){"use strict";function c(){}return c.cCRNFmtDXT1=0,c.cCRNFmtDXT3=1,c.cCRNFmtDXT5=2,c.prototype.arrayBufferCopy=function(a,b,c,d){var e,f=c/4,g=d%4,h=new Uint32Array(a.buffer,0,(d-g)/4),i=new Uint32Array(b.buffer);for(e=0;e<h.length;e++)i[f+e]=h[e];for(e=d-g;d>e;e++)b[c+e]=a[e]},c.prototype.load=function(a,d,e){if("undefined"==typeof window.CrunchModule)return console.warn("Crunch library not loaded! Include a script tag pointing to lib/crunch/crunch.js in your html-file."),void 0;var f,g,h,i,j,k,l,m,n=window.CrunchModule,o=new Uint8Array(a),p=a.byteLength,q=n._malloc(p);this.arrayBufferCopy(o,n.HEAPU8,q,p),f=n._crn_get_dxt_format(q,p);var r;switch(f){case c.cCRNFmtDXT1:d.format="PrecompressedDXT1A",r=4;break;case c.cCRNFmtDXT3:d.format="PrecompressedDXT3",r=8;break;case c.cCRNFmtDXT5:d.format="PrecompressedDXT5",r=8;break;default:return console.error("Unsupported image format"),0}i=n._crn_get_width(q,p),j=n._crn_get_height(q,p),k=n._crn_get_levels(q,p),h=n._crn_get_uncompressed_size(q,p,0),g=n._malloc(h);var s=d.image;("undefined"==typeof s||null===s)&&(s={},d.image=s),s.width=i,s.height=j,s.depth=1;var t=[];for(d.image.mipmapSizes=[],m=0;k>m;++m)m&&(h=n._crn_get_uncompressed_size(q,p,m)),n._crn_decompress(q,p,g,h,m),l=new Uint8Array(n.HEAPU8.buffer,g,h),e&&(l=b.flipDXT(l,i,j,d.format)),t.push(l),d.image.mipmapSizes.push(h),i*=.5,j*=.5;d.image.data=t,d.image.useArrays=!0,d.type="UnsignedByte",d.image.isCompressed=!0,1>=k&&(d.minFilter="BilinearNoMipMaps"),s.bpp=r,s.dataReady=!0,d.needsUpdate=!0,n._free(q),n._free(g)},c.prototype.dxtToRgb565=function(a,b,c,d){for(var e=new Uint16Array(4),f=new Uint16Array(c*d),g=0,h=0,i=0,j=0,k=0,l=0,m=0,n=0,o=0,p=c/4,q=d/4,r=0;q>r;r++)for(var s=0;p>s;s++)i=b+4*(r*p+s),e[0]=a[i],e[1]=a[i+1],j=31&e[0],k=2016&e[0],l=63488&e[0],m=31&e[1],n=2016&e[1],o=63488&e[1],e[2]=5*j+3*m>>3|2016&5*k+3*n>>3|63488&5*l+3*o>>3,e[3]=5*m+3*j>>3|2016&5*n+3*k>>3|63488&5*o+3*l>>3,g=a[i+2],h=4*r*c+4*s,f[h]=e[3&g],f[h+1]=e[3&g>>2],f[h+2]=e[3&g>>4],f[h+3]=e[3&g>>6],h+=c,f[h]=e[3&g>>8],f[h+1]=e[3&g>>10],f[h+2]=e[3&g>>12],f[h+3]=e[g>>14],g=a[i+3],h+=c,f[h]=e[3&g],f[h+1]=e[3&g>>2],f[h+2]=e[3&g>>4],f[h+3]=e[3&g>>6],h+=c,f[h]=e[3&g>>8],f[h+1]=e[3&g>>10],f[h+2]=e[3&g>>12],f[h+3]=e[g>>14];return f},c.prototype.isSupported=function(){return a.SUPPORTS_DDS},c.prototype.toString=function(){return"CrunchLoader"},c}),define("goo/loaders/tga/TgaLoader",[],function(){"use strict";function a(){this.header=null,this.offset=0,this.use_rle=!1,this.use_pal=!1,this.use_rgb=!1,this.use_grey=!1}return a.TYPE_NO_DATA=0,a.TYPE_INDEXED=1,a.TYPE_RGB=2,a.TYPE_GREY=3,a.TYPE_RLE_INDEXED=9,a.TYPE_RLE_RGB=10,a.TYPE_RLE_GREY=11,a.ORIGIN_MASK=48,a.ORIGIN_SHIFT=4,a.ORIGIN_BL=0,a.ORIGIN_BR=1,a.ORIGIN_UL=2,a.ORIGIN_UR=3,a.prototype.load=function(a,b){this.loadData(new Uint8Array(a));var c=this.getImageData();b.setImage(c,null,c.width,c.height),c.dataReady=!0,b.needsUpdate=!0},a.prototype.loadData=function(b){if(b.length<19)throw new Error("Targa::load() - Not enough data to contain header.");if(this.offset=0,this.header={id_length:b[this.offset++],colormap_type:b[this.offset++],image_type:b[this.offset++],colormap_index:b[this.offset++]|b[this.offset++]<<8,colormap_length:b[this.offset++]|b[this.offset++]<<8,colormap_size:b[this.offset++],origin:[b[this.offset++]|b[this.offset++]<<8,b[this.offset++]|b[this.offset++]<<8],width:b[this.offset++]|b[this.offset++]<<8,height:b[this.offset++]|b[this.offset++]<<8,pixel_size:b[this.offset++],flags:b[this.offset++]},this.checkHeader(),this.header.id_length+this.offset>b.length)throw new Error("Targa::load() - No data ?");switch(this.offset+=this.header.id_length,this.header.image_type){case a.TYPE_RLE_INDEXED:this.use_rle=!0;break;case a.TYPE_INDEXED:this.use_pal=!0;break;case a.TYPE_RLE_RGB:this.use_rle=!0;break;case a.TYPE_RGB:this.use_rgb=!0;break;case a.TYPE_RLE_GREY:this.use_rle=!0;break;case a.TYPE_GREY:this.use_grey=!0}this.parse(b)},a.prototype.checkHeader=function(){switch(this.header.image_type){case a.TYPE_INDEXED:case a.TYPE_RLE_INDEXED:if(this.header.colormap_length>256||24!==this.header.colormap_size||1!==this.header.colormap_type)throw new Error("Targa::checkHeader() - Invalid type colormap data for indexed type");break;case a.TYPE_RGB:case a.TYPE_GREY:case a.TYPE_RLE_RGB:case a.TYPE_RLE_GREY:if(this.header.colormap_type)throw new Error("Targa::checkHeader() - Invalid type colormap data for colormap type");break;case a.TYPE_NO_DATA:throw new Error("Targa::checkHeader() - No data on this TGA file");default:throw new Error("Targa::checkHeader() - Invalid type '"+this.header.image_type+"'")}if(this.header.width<=0||this.header.height<=0)throw new Error("Targa::checkHeader() - Invalid image size");if(8!==this.header.pixel_size&&16!==this.header.pixel_size&&24!==this.header.pixel_size&&32!==this.header.pixel_size)throw new Error("Targa::checkHeader() - Invalid pixel size '"+this.header.pixel_size+"'")},a.prototype.parse=function(a){var b,c,d,e,f;if(b=this.header,c=15&b.flags,e=b.pixel_size>>3,f=b.width*b.height*e,this.use_pal&&(this.palettes=a.subarray(this.offset,this.offset+=b.colormap_length*e)),this.use_rle){d=new Uint8Array(f);for(var g,h,i,j=0,k=new Uint8Array(e);f>j;)if(g=a[this.offset++],h=(127&g)+1,128&g){for(i=0;e>i;++i)k[i]=a[this.offset++];for(i=0;h>i;++i)d.set(k,j+i*e);j+=e*h}else{for(h*=e,i=0;h>i;++i)d[j+i]=a[this.offset++];j+=h}}else d=a.subarray(this.offset,this.offset+=this.use_pal?b.width*b.height:f);this.image=d},a.prototype.getImageData=function(b){var c,d,e,f,g,h,i,j,k=this.header.width,l=this.header.height;switch(j=b||document&&document.createElement("canvas").getContext("2d").createImageData(k,l)||{width:k,height:l,data:new Uint8Array(4*k*l)},(this.header.flags&a.ORIGIN_MASK)>>a.ORIGIN_SHIFT){default:case a.ORIGIN_UL:c=0,e=1,h=k,d=0,f=1,g=l;break;case a.ORIGIN_BL:c=0,e=1,h=k,d=l-1,f=-1,g=-1;break;case a.ORIGIN_UR:c=k-1,e=-1,h=-1,d=0,f=1,g=l;break;case a.ORIGIN_BR:c=k-1,e=-1,h=-1,d=l-1,f=-1,g=-1}return i="getImageData"+(this.use_grey?"Grey":"")+this.header.pixel_size+"bits",this[i](j.data,d,f,g,c,e,h),j},a.prototype.getCanvas=function(){var a=document.createElement("canvas"),b=a.getContext("2d"),c=b.createImageData(this.header.width,this.header.height);return a.width=this.header.width,a.height=this.header.height,b.putImageData(this.getImageData(c),0,0),a},a.prototype.getDataURL=function(a){return this.getCanvas().toDataURL(a||"image/png")},a.prototype.getImageData8bits=function(a,b,c,d,e,f,g){var h,i,j,k=this.image,l=this.palettes,m=this.header.width,n=0;for(j=b;j!==d;j+=c)for(i=e;i!==g;i+=f,n++)h=k[n],a[4*(i+m*j)+3]=255,a[4*(i+m*j)+2]=l[3*h+0],a[4*(i+m*j)+1]=l[3*h+1],a[4*(i+m*j)+0]=l[3*h+2];return a},a.prototype.getImageData16bits=function(a,b,c,d,e,f,g){var h,i,j,k=this.image,l=this.header.width,m=0;for(j=b;j!==d;j+=c)for(i=e;i!==g;i+=f,m+=2)h=k[m+0]+(k[m+1]<<8),a[4*(i+l*j)+0]=(31744&h)>>7,a[4*(i+l*j)+1]=(992&h)>>2,a[4*(i+l*j)+2]=(31&h)>>3,a[4*(i+l*j)+3]=32768&h?0:255;return a},a.prototype.getImageData24bits=function(a,b,c,d,e,f,g){var h,i,j=this.image,k=this.header.width,l=0;for(i=b;i!==d;i+=c)for(h=e;h!==g;h+=f,l+=3)a[4*(h+k*i)+3]=255,a[4*(h+k*i)+2]=j[l+0],a[4*(h+k*i)+1]=j[l+1],a[4*(h+k*i)+0]=j[l+2];return a},a.prototype.getImageData32bits=function(a,b,c,d,e,f,g){var h,i,j=this.image,k=this.header.width,l=0;for(i=b;i!==d;i+=c)for(h=e;h!==g;h+=f,l+=4)a[4*(h+k*i)+2]=j[l+0],a[4*(h+k*i)+1]=j[l+1],a[4*(h+k*i)+0]=j[l+2],a[4*(h+k*i)+3]=j[l+3];return a},a.prototype.getImageDataGrey8bits=function(a,b,c,d,e,f,g){var h,i,j,k=this.image,l=this.header.width,m=0;for(j=b;j!==d;j+=c)for(i=e;i!==g;i+=f,m++)h=k[m],a[4*(i+l*j)+0]=h,a[4*(i+l*j)+1]=h,a[4*(i+l*j)+2]=h,a[4*(i+l*j)+3]=255;return a},a.prototype.getImageDataGrey16bits=function(a,b,c,d,e,f,g){var h,i,j=this.image,k=this.header.width,l=0;for(i=b;i!==d;i+=c)for(h=e;h!==g;h+=f,l+=2)a[4*(h+k*i)+0]=j[l+0],a[4*(h+k*i)+1]=j[l+0],a[4*(h+k*i)+2]=j[l+0],a[4*(h+k*i)+3]=j[l+1];return a},a.prototype.isSupported=function(){return!0},a.prototype.toString=function(){return"TgaLoader"},a}),define("goo/util/Latch",[],function(){"use strict";function a(a,b){this.count=a,this.callback=b}return a.prototype.countDown=function(){this.count--,this.isDone()&&this.callback&&this.callback.done?this.callback.done():this.callback&&this.callback.progress&&this.callback.progress(this.count)},a.prototype.isDone=function(){return 0===this.count},a}),define("goo/renderer/TextureCreator",["goo/loaders/Loader","goo/renderer/Texture","goo/loaders/dds/DdsLoader","goo/loaders/crunch/CrunchLoader","goo/loaders/tga/TgaLoader","goo/renderer/Util","goo/util/Latch"],function(a,b,c,d,e,f,g){"use strict";function h(b){b=b||{},this.verticalFlip=void 0!==b.verticalFlip?b.verticalFlip:!0,this._loader=void 0!==b.loader?b.loader:new a,this.textureLoaders={".dds":new c,".crn":new d,".tga":new e}}function i(a,b){return-1!==a.indexOf(b,a.length-b.length)}h.cache={},h.UNSUPPORTED_FALLBACK=".png",h.clearCache=function(){h.cache={}},h.prototype.loadTexture2D=function(c,d,e){if(void 0!==h.cache[c])return e&&e(),h.cache[c];var g={onSuccess:function(a){l.load(a,m,j.verticalFlip,0,a.byteLength),h._finishedLoading(),e&&e()}.bind(this),onError:function(a){console.warn("Error loading texture: "+c+" | "+a)}.bind(this)},j=this;for(var k in this.textureLoaders)if(i(c.toLowerCase(),k)){var l=this.textureLoaders[k];if(!l||!l.isSupported()){c=c.substring(0,c.length-k.length),c+=h.UNSUPPORTED_FALLBACK,d=d||{},d.flipY=!1;break}var m=new b(f.clone(h.DEFAULT_TEXTURE_2D.image),d);return m.image.dataReady=!1,m.a=c,h.cache[c]=m,this._loader.load(c,null,a.ARRAY_BUFFER).then(g.onSuccess,g.onError),m}if(void 0!==h.cache[c])return e&&e(),h.cache[c];var n=new b(null,d);return h.cache[c]=n,this._loader.loadImage(c).then(function(a){n.setImage(a),h._finishedLoading(a),e&&e()}).then(null,function(a){console.error(a)}),n},h.prototype.loadTextureVideo=function(a,c,d,e){if(void 0!==h.cache[a])return h.cache[a];var g=document.createElement("video");for(var i in d)g[i]=d[i];g.loop="boolean"==typeof c?c:!0,g.addEventListener("error",function(b){console.warn("Couldn't load video URL ["+a+"]",b),e&&e(b)},!1);var j=new b(g,{wrapS:"EdgeClamp",wrapT:"EdgeClamp"});return j.readyCallback=function(){return g.readyState>=3?(console.log("Video ready: "+g.videoWidth+", "+g.videoHeight),g.width=g.videoWidth,g.height=g.videoHeight,(f.isPowerOfTwo(g.width)===!1||f.isPowerOfTwo(g.height)===!1)&&(j.generateMipmaps=!1,j.minFilter="BilinearNoMipMaps"),g.play(),g.dataReady=!0,!0):!1},j.updateCallback=function(){return!g.paused},g.crossOrigin="anonymous",g.src=a,h.cache[a]=j,j},h.prototype.loadTextureWebCam=function(){var a=document.createElement("video");a.autoplay=!0,a.loop=!0;var c=new b(a,{wrapS:"EdgeClamp",wrapT:"EdgeClamp"});return c.readyCallback=function(){return a.readyState>=3?(console.log("WebCam video ready: "+a.videoWidth+", "+a.videoHeight),a.width=a.videoWidth,a.height=a.videoHeight,(f.isPowerOfTwo(a.width)===!1||f.isPowerOfTwo(a.height)===!1)&&(c.generateMipmaps=!1,c.minFilter="BilinearNoMipMaps"),a.dataReady=!0,!0):!1},c.updateCallback=function(){return!a.paused},window.URL=window.URL||window.webkitURL,navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,navigator.getUserMedia?navigator.getUserMedia({video:!0},function(b){a.src=window.URL.createObjectURL(b)},function(a){console.warn("Unable to capture WebCam. Please reload the page.",a)}):console.warn("No support for WebCam getUserMedia found!"),c},h.prototype.loadTextureCube=function(a,c){var d=new b(null,c);d.variant="CUBE";for(var e=[],f=new g(6,{done:function(){for(var a=e[0].width,b=e[0].height,c=0;6>c;c++){var f=e[c];(a!==f.width||b!==f.height)&&(d.generateMipmaps=!1,d.minFilter="BilinearNoMipMaps",console.error("Images not all the same size!"))}d.setImage(e),d.image.dataReady=!0,d.image.width=a,d.image.height=b}}),h=this,i=0;i<a.length;i++)!function(b){var c=a[b];"string"==typeof c?h._loader.loadImage(c).then(function(a){e[b]=a,f.countDown()}):(e[b]=c,f.countDown())}(i);return d},h._globalCallback=null,h._finishedLoading=function(a){if(h._globalCallback)try{h._globalCallback(a)}catch(b){console.error("Error in texture callback:",b)}};var j=new Uint8Array([255,255,255,255]);return h.DEFAULT_TEXTURE_2D=new b(j,null,1,1),h.DEFAULT_TEXTURE_CUBE=new b([j,j,j,j,j,j],null,1,1),h.DEFAULT_TEXTURE_CUBE.variant="CUBE",h}),define("goo/renderer/pass/RenderTarget",["goo/math/Vector2"],function(a){"use strict";function b(b,c,d){this.glTexture=null,this._glRenderBuffer=null,this._glFrameBuffer=null,this.width=Math.floor(b),this.height=Math.floor(c),d=d||{},this.wrapS=void 0!==d.wrapS?d.wrapS:"EdgeClamp",this.wrapT=void 0!==d.wrapT?d.wrapT:"EdgeClamp",this.magFilter=void 0!==d.magFilter?d.magFilter:"Bilinear",this.minFilter=void 0!==d.minFilter?d.minFilter:"BilinearNoMipMaps",this.anisotropy=void 0!==d.anisotropy?d.anisotropy:1,this.format=void 0!==d.format?d.format:"RGBA",this.type=void 0!==d.type?d.type:"UnsignedByte",this.variant="2D",this.offset=new a(0,0),this.repeat=new a(1,1),this.generateMipmaps=void 0!==d.generateMipmaps?d.generateMipmaps:!1,this.premultiplyAlpha=void 0!==d.premultiplyAlpha?d.premultiplyAlpha:!1,this.unpackAlignment=void 0!==d.unpackAlignment?d.unpackAlignment:1,this.flipY=void 0!==d.flipY?d.flipY:!0,this.depthBuffer=void 0!==d.depthBuffer?d.depthBuffer:!0,this.stencilBuffer=void 0!==d.stencilBuffer?d.stencilBuffer:!0}return b.prototype.clone=function(){var a=new b(this.width,this.height);return a.wrapS=this.wrapS,a.wrapT=this.wrapT,a.magFilter=this.magFilter,a.minFilter=this.minFilter,a.anisotropy=this.anisotropy,a.format=this.format,a.type=this.type,a.variant=this.variant,a.offset.copy(this.offset),a.repeat.copy(this.repeat),a.generateMipmaps=this.generateMipmaps,a.premultiplyAlpha=this.premultiplyAlpha,a.unpackAlignment=this.unpackAlignment,a.flipY=this.flipY,a.depthBuffer=this.depthBuffer,a.stencilBuffer=this.stencilBuffer,a},b}),define("goo/entities/Entity",[],function(){"use strict";function a(b,c){this._world=b,this._components=[],Object.defineProperty(this,"id",{value:a.entityCount++,writable:!1}),this.name=void 0!==c?c:"Entity_"+this.id,this.skip=!1,this.hidden=!1}function b(a){return a.charAt(0).toLowerCase()+a.substr(1)}return a.prototype.addToWorld=function(a){this._world.addEntity(this,a)},a.prototype.removeFromWorld=function(a){this._world.removeEntity(this,a)},a.prototype.setComponent=function(a){this.hasComponent(a.type)||(this._components.push(a),this[b(a.type)]=a,"TransformComponent"===a.type&&(a.entity=this),this._world.entityManager.containsEntity(this)&&this._world.changedEntity(this,a,"addedComponent"))},a.prototype.hasComponent=function(a){return void 0!==this[b(a)]},a.prototype.getComponent=function(a){return this[b(a)]},a.prototype.clearComponent=function(a){var c=this[b(a)],d=this._components.indexOf(c);if(-1!==d){var c=this._components[d];"TransformComponent"===c.type&&(c.entity=void 0),this._components.splice(d,1)}delete this[b(a)],this._world.entityManager.containsEntity(this)&&this._world.changedEntity(this,c,"removedComponent")},a.prototype.toString=function(){return this.name},a.entityCount=0,a}),define("goo/renderer/ShaderCall",[],function(){"use strict";function a(a,b,c){if(this.context=a,this.location=b,this.location.value=void 0,c)switch(c){case"float":this.call=this.uniform1f;break;case"bool":case"int":case"integer":case"sampler2D":case"sampler3D":case"samplerCube":this.call=this.uniform1i;break;case"floatarray":this.call=this.uniform1fv;break;case"intarray":case"samplerArray":this.call=this.uniform1iv;break;case"vec2":this.call=this.uniform2fv;break;case"vec3":this.call=this.uniform3fv;break;case"vec4":this.call=this.uniform4fv;break;case"mat2":this.call=this.uniformMatrix2fv;break;case"mat3":this.call=this.uniformMatrix3fv;break;case"mat4":this.call=this.uniformMatrix4fv;break;default:throw"Uniform type not handled: "+c}}function b(a,b,c){if(0>c)return!1;for(;c--;)if(a[c]!==b[c])return!1;return!0}function c(a,b){for(var c=a.length;c--;)if(a[c]!==b[c])return!1;return!0}return a.prototype.uniform1f=function(a){var b=this.location.value;b!==a&&(this.context.uniform1f(this.location,a),this.location.value=a)},a.prototype.uniform1fv=function(a){var b=this.location.value;void 0!==b&&c(a,b)||(this.context.uniform1fv(this.location,a),this.location.value=a.slice())},a.prototype.uniform1i=function(a){var b=this.location.value;b!==a&&(this.context.uniform1i(this.location,a),this.location.value=a)},a.prototype.uniform1iv=function(a){var b=this.location.value;void 0!==b&&c(a,b)||(this.context.uniform1iv(this.location,a),this.location.value=a.slice())},a.prototype.uniform2f=function(a,b){var c=this.location.value;(void 0===c||2!==c.length||c[0]!==a||c[1]!==b)&&(this.context.uniform2f(this.location,a,b),this.location.value=[a,b])},a.prototype.uniform2fv=function(a){var b=this.location.value;if(void 0!==b){if(c(a,b))return}else b=this.location.value=new Float64Array(a.length);this.context.uniform2fv(this.location,a);for(var d=a.length;d--;)b[d]=a[d]},a.prototype.uniform2i=function(a,b){var c=this.location.value;(void 0===c||2!==c.length||c[0]!==a||c[1]!==b)&&(this.context.uniform2i(this.location,a,b),this.location.value=[a,b])},a.prototype.uniform2iv=function(a){var b=this.location.value;void 0!==b&&c(a,b)||(this.context.uniform2iv(this.location,a),this.location.value=a.slice())},a.prototype.uniform3f=function(a,b,c){var d=this.location.value;(void 0===d||3!==d.length||d[0]!==a||d[1]!==b||d[2]!==c)&&(this.context.uniform3f(this.location,a,b,c),this.location.value=[a,b,c])},a.prototype.uniform3fv=function(a){var b=this.location.value;if(void 0!==b){if(c(a,b))return}else b=this.location.value=new Float64Array(a.length);this.context.uniform3fv(this.location,a);for(var d=a.length;d--;)b[d]=a[d]},a.prototype.uniform3i=function(a,b,c){var d=this.location.value;(void 0===d||3!==d.length||d[0]!==a||d[1]!==b||d[2]!==c)&&(this.context.uniform3i(this.location,a,b,c),this.location.value=[a,b,c])},a.prototype.uniform3iv=function(a){var b=this.location.value;void 0!==b&&c(a,b)||(this.context.uniform3iv(this.location,a),this.location.value=a.slice())},a.prototype.uniform4f=function(a,b,c,d){var e=this.location.value;(void 0===e||4!==e.length||e[0]!==a||e[1]!==b||e[2]!==c||e[3]!==d)&&(this.context.uniform4f(this.location,a,b,c,d),this.location.value=[a,b,c,d])},a.prototype.uniform4fv=function(a){var b=this.location.value;if(void 0!==b){if(c(a,b))return}else b=this.location.value=new Float64Array(a.length);this.context.uniform4fv(this.location,a);for(var d=a.length;d--;)b[d]=a[d]},a.prototype.uniform4i=function(a,b,c,d){var e=this.location.value;(void 0===e||4!==e.length||e[0]!==a||e[1]!==b||e[2]!==c||e[3]!==d)&&(this.context.uniform4i(this.location,a,b,c,d),this.location.value=[a,b,c,d])},a.prototype.uniform4iv=function(a){var b=this.location.value;void 0!==b&&c(a,b)||(this.context.uniform4iv(this.location,a),this.location.value=a.slice())},a.prototype.uniformMatrix2fv=function(a,c){if(c=c===!0,!a.data)return this.context.uniformMatrix2fv(this.location,c,a),void 0;var d=this.location.value;if(void 0!==d){var e=b(d.data,a.data,4);if(e)return;d.copy(a)}else this.location.value=a.clone();this.context.uniformMatrix2fv(this.location,c,a.data)},a.prototype.uniformMatrix3fv=function(a,c){if(c=c===!0,!a.data)return this.context.uniformMatrix3fv(this.location,c,a),void 0;var d=this.location.value;if(void 0!==d){var e=b(d.data,a.data,9);if(e)return;d.copy(a)}else this.location.value=a.clone();this.context.uniformMatrix3fv(this.location,c,a.data)},a.prototype.uniformMatrix4fv=function(a,d){if(d=d===!0,a.data){var e=this.location.value;if(void 0!==e){var f=b(e.data,a.data,16);if(f)return;e.copy(a)}else this.location.value=a.clone();this.context.uniformMatrix4fv(this.location,d,a.data)}else{var g=a,e=this.location.value;if(void 0!==e){if(c(g,e))return}else e=this.location.value=new Float64Array(g.length);this.context.uniformMatrix4fv(this.location,d,g);for(var h=g.length;h--;)e[h]=g[h]}},a}),define("goo/math/Matrix4x4",["goo/math/MathUtils","goo/math/Matrix"],function(a,b){"use strict";function c(){b.call(this,4,4),0===arguments.length?this.setIdentity():this.set(arguments)}return c.prototype=Object.create(b.prototype),c.prototype.setupAliases([["e00"],["e10"],["e20"],["e30"],["e01"],["e11"],["e21"],["e31"],["e02"],["e12"],["e22"],["e32"],["e03"],["e13"],["e23"],["e33"]]),c.IDENTITY=new c(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),c.add=function(a,b,d){return d||(d=new c),b instanceof c?(d.e00=a.e00+b.e00,d.e10=a.e10+b.e10,d.e20=a.e20+b.e20,d.e30=a.e30+b.e30,d.e01=a.e01+b.e01,d.e11=a.e11+b.e11,d.e21=a.e21+b.e21,d.e31=a.e31+b.e31,d.e02=a.e02+b.e02,d.e12=a.e12+b.e12,d.e22=a.e22+b.e22,d.e32=a.e32+b.e32,d.e03=a.e03+b.e03,d.e13=a.e13+b.e13,d.e23=a.e23+b.e23,d.e33=a.e33+b.e33):(d.e00=a.e00+b,d.e10=a.e10+b,d.e20=a.e20+b,d.e30=a.e30+b,d.e01=a.e01+b,d.e11=a.e11+b,d.e21=a.e21+b,d.e31=a.e31+b,d.e02=a.e02+b,d.e12=a.e12+b,d.e22=a.e22+b,d.e32=a.e32+b,d.e03=a.e03+b,d.e13=a.e13+b,d.e23=a.e23+b,d.e33=a.e33+b),d},c.prototype.add=function(a){return c.add(this,a,this)},c.sub=function(a,b,d){return d||(d=new c),b instanceof c?(d.e00=a.e00-b.e00,d.e10=a.e10-b.e10,d.e20=a.e20-b.e20,d.e30=a.e30-b.e30,d.e01=a.e01-b.e01,d.e11=a.e11-b.e11,d.e21=a.e21-b.e21,d.e31=a.e31-b.e31,d.e02=a.e02-b.e02,d.e12=a.e12-b.e12,d.e22=a.e22-b.e22,d.e32=a.e32-b.e32,d.e03=a.e03-b.e03,d.e13=a.e13-b.e13,d.e23=a.e23-b.e23,d.e33=a.e33-b.e33):(d.e00=a.e00-b,d.e10=a.e10-b,d.e20=a.e20-b,d.e30=a.e30-b,d.e01=a.e01-b,d.e11=a.e11-b,d.e21=a.e21-b,d.e31=a.e31-b,d.e02=a.e02-b,d.e12=a.e12-b,d.e22=a.e22-b,d.e32=a.e32-b,d.e03=a.e03-b,d.e13=a.e13-b,d.e23=a.e23-b,d.e33=a.e33-b),d},c.prototype.sub=function(a){return c.sub(this,a,this)},c.mul=function(a,b,d){return d||(d=new c),b instanceof c?(d.e00=a.e00*b.e00,d.e10=a.e10*b.e10,d.e20=a.e20*b.e20,d.e30=a.e30*b.e30,d.e01=a.e01*b.e01,d.e11=a.e11*b.e11,d.e21=a.e21*b.e21,d.e31=a.e31*b.e31,d.e02=a.e02*b.e02,d.e12=a.e12*b.e12,d.e22=a.e22*b.e22,d.e32=a.e32*b.e32,d.e03=a.e03*b.e03,d.e13=a.e13*b.e13,d.e23=a.e23*b.e23,d.e33=a.e33*b.e33):(d.e00=a.e00*b,d.e10=a.e10*b,d.e20=a.e20*b,d.e30=a.e30*b,d.e01=a.e01*b,d.e11=a.e11*b,d.e21=a.e21*b,d.e31=a.e31*b,d.e02=a.e02*b,d.e12=a.e12*b,d.e22=a.e22*b,d.e32=a.e32*b,d.e03=a.e03*b,d.e13=a.e13*b,d.e23=a.e23*b,d.e33=a.e33*b),d
},c.prototype.mul=function(a){return c.mul(this,a,this)},c.div=function(a,b,d){return d||(d=new c),b instanceof c?(d.e00=a.e00/b.e00,d.e10=a.e10/b.e10,d.e20=a.e20/b.e20,d.e30=a.e30/b.e30,d.e01=a.e01/b.e01,d.e11=a.e11/b.e11,d.e21=a.e21/b.e21,d.e31=a.e31/b.e31,d.e02=a.e02/b.e02,d.e12=a.e12/b.e12,d.e22=a.e22/b.e22,d.e32=a.e32/b.e32,d.e03=a.e03/b.e03,d.e13=a.e13/b.e13,d.e23=a.e23/b.e23,d.e33=a.e33/b.e33):(b=1/b,d.e00=a.e00*b,d.e10=a.e10*b,d.e20=a.e20*b,d.e30=a.e30*b,d.e01=a.e01*b,d.e11=a.e11*b,d.e21=a.e21*b,d.e31=a.e31*b,d.e02=a.e02*b,d.e12=a.e12*b,d.e22=a.e22*b,d.e32=a.e32*b,d.e03=a.e03*b,d.e13=a.e13*b,d.e23=a.e23*b,d.e33=a.e33*b),d},c.prototype.div=function(a){return c.div(this,a,this)},c.combine=function(a,b,d){d||(d=new c);var e=a.data,f=e[0],g=e[4],h=e[8],i=e[12],j=e[1],k=e[5],l=e[9],m=e[13],n=e[2],o=e[6],p=e[10],q=e[14],r=e[3],s=e[7],t=e[11],u=e[15],v=b.data,w=v[0],x=v[4],y=v[8],z=v[12],A=v[1],B=v[5],C=v[9],D=v[13],E=v[2],F=v[6],G=v[10],H=v[14],I=v[3],J=v[7],K=v[11],L=v[15],M=d.data;return M[0]=f*w+g*A+h*E+i*I,M[4]=f*x+g*B+h*F+i*J,M[8]=f*y+g*C+h*G+i*K,M[12]=f*z+g*D+h*H+i*L,M[1]=j*w+k*A+l*E+m*I,M[5]=j*x+k*B+l*F+m*J,M[9]=j*y+k*C+l*G+m*K,M[13]=j*z+k*D+l*H+m*L,M[2]=n*w+o*A+p*E+q*I,M[6]=n*x+o*B+p*F+q*J,M[10]=n*y+o*C+p*G+q*K,M[14]=n*z+o*D+p*H+q*L,M[3]=r*w+s*A+t*E+u*I,M[7]=r*x+s*B+t*F+u*J,M[11]=r*y+s*C+t*G+u*K,M[15]=r*z+s*D+t*H+u*L,d},c.prototype.combine=function(a){return c.combine(this,a,this)},c.transpose=function(a,b){b||(b=new c);var d=a.data,e=b.data;if(b===a){var f=d[4],g=d[8],h=d[12],i=d[9],j=d[13],k=d[14];return e[4]=d[1],e[8]=d[2],e[12]=d[3],e[9]=d[6],e[13]=d[7],e[14]=d[11],e[1]=f,e[2]=g,e[3]=h,e[6]=i,e[7]=j,e[11]=k,b}return e[0]=d[0],e[1]=d[4],e[2]=d[8],e[3]=d[12],e[4]=d[1],e[5]=d[5],e[6]=d[9],e[7]=d[13],e[8]=d[2],e[9]=d[6],e[10]=d[10],e[11]=d[14],e[12]=d[3],e[13]=d[7],e[14]=d[11],e[15]=d[15],b},c.prototype.transpose=function(){return c.transpose(this,this)},c.invert=function(d,e){if(e||(e=new c),e===d)return b.copy(c.invert(d),e);var f=d.determinant();if(Math.abs(f)<a.EPSILON)return e;var g=d.data,h=e.data;return f=1/f,h[0]=(g[5]*(g[10]*g[15]-g[14]*g[11])-g[9]*(g[6]*g[15]-g[14]*g[7])+g[13]*(g[6]*g[11]-g[10]*g[7]))*f,h[1]=(g[1]*(g[14]*g[11]-g[10]*g[15])-g[9]*(g[14]*g[3]-g[2]*g[15])+g[13]*(g[10]*g[3]-g[2]*g[11]))*f,h[2]=(g[1]*(g[6]*g[15]-g[14]*g[7])-g[5]*(g[2]*g[15]-g[14]*g[3])+g[13]*(g[2]*g[7]-g[6]*g[3]))*f,h[3]=(g[1]*(g[10]*g[7]-g[6]*g[11])-g[5]*(g[10]*g[3]-g[2]*g[11])+g[9]*(g[6]*g[3]-g[2]*g[7]))*f,h[4]=(g[4]*(g[14]*g[11]-g[10]*g[15])-g[8]*(g[14]*g[7]-g[6]*g[15])+g[12]*(g[10]*g[7]-g[6]*g[11]))*f,h[5]=(g[0]*(g[10]*g[15]-g[14]*g[11])-g[8]*(g[2]*g[15]-g[14]*g[3])+g[12]*(g[2]*g[11]-g[10]*g[3]))*f,h[6]=(g[0]*(g[14]*g[7]-g[6]*g[15])-g[4]*(g[14]*g[3]-g[2]*g[15])+g[12]*(g[6]*g[3]-g[2]*g[7]))*f,h[7]=(g[0]*(g[6]*g[11]-g[10]*g[7])-g[4]*(g[2]*g[11]-g[10]*g[3])+g[8]*(g[2]*g[7]-g[6]*g[3]))*f,h[8]=(g[4]*(g[9]*g[15]-g[13]*g[11])-g[8]*(g[5]*g[15]-g[13]*g[7])+g[12]*(g[5]*g[11]-g[9]*g[7]))*f,h[9]=(g[0]*(g[13]*g[11]-g[9]*g[15])-g[8]*(g[13]*g[3]-g[1]*g[15])+g[12]*(g[9]*g[3]-g[1]*g[11]))*f,h[10]=(g[0]*(g[5]*g[15]-g[13]*g[7])-g[4]*(g[1]*g[15]-g[13]*g[3])+g[12]*(g[1]*g[7]-g[5]*g[3]))*f,h[11]=(g[0]*(g[9]*g[7]-g[5]*g[11])-g[4]*(g[9]*g[3]-g[1]*g[11])+g[8]*(g[5]*g[3]-g[1]*g[7]))*f,h[12]=(g[4]*(g[13]*g[10]-g[9]*g[14])-g[8]*(g[13]*g[6]-g[5]*g[14])+g[12]*(g[9]*g[6]-g[5]*g[10]))*f,h[13]=(g[0]*(g[9]*g[14]-g[13]*g[10])-g[8]*(g[1]*g[14]-g[13]*g[2])+g[12]*(g[1]*g[10]-g[9]*g[2]))*f,h[14]=(g[0]*(g[13]*g[6]-g[5]*g[14])-g[4]*(g[13]*g[2]-g[1]*g[14])+g[12]*(g[5]*g[2]-g[1]*g[6]))*f,h[15]=(g[0]*(g[5]*g[10]-g[9]*g[6])-g[4]*(g[1]*g[10]-g[9]*g[2])+g[8]*(g[1]*g[6]-g[5]*g[2]))*f,e},c.prototype.invert=function(){return c.invert(this,this)},c.prototype.isOrthogonal=function(){var b;return b=this.e00*this.e01+this.e10*this.e11+this.e20*this.e21+this.e30*this.e31,Math.abs(b)>a.EPSILON?!1:(b=this.e00*this.e02+this.e10*this.e12+this.e20*this.e22+this.e30*this.e32,Math.abs(b)>a.EPSILON?!1:(b=this.e00*this.e03+this.e10*this.e13+this.e20*this.e23+this.e30*this.e33,Math.abs(b)>a.EPSILON?!1:(b=this.e01*this.e02+this.e11*this.e12+this.e21*this.e22+this.e31*this.e32,Math.abs(b)>a.EPSILON?!1:(b=this.e01*this.e03+this.e11*this.e13+this.e21*this.e23+this.e31*this.e33,Math.abs(b)>a.EPSILON?!1:(b=this.e02*this.e03+this.e12*this.e13+this.e22*this.e23+this.e32*this.e33,Math.abs(b)>a.EPSILON?!1:!0)))))},c.prototype.isNormal=function(){var b;return b=this.e00*this.e00+this.e10*this.e10+this.e20*this.e20+this.e30*this.e30,Math.abs(b-1)>a.EPSILON?!1:(b=this.e01*this.e01+this.e11*this.e11+this.e21*this.e21+this.e31*this.e31,Math.abs(b-1)>a.EPSILON?!1:(b=this.e02*this.e02+this.e12*this.e12+this.e22*this.e22+this.e32*this.e32,Math.abs(b-1)>a.EPSILON?!1:(b=this.e03*this.e03+this.e13*this.e13+this.e23*this.e23+this.e33*this.e33,Math.abs(b-1)>a.EPSILON?!1:!0)))},c.prototype.isOrthonormal=function(){return this.isOrthogonal()&&this.isNormal()},c.prototype.determinant=function(){var a=this.data,b=a[5]*a[10]*a[15]+a[9]*a[14]*a[7]+a[13]*a[6]*a[11]-a[13]*a[10]*a[7]-a[9]*a[6]*a[15]-a[5]*a[14]*a[11],c=a[1]*a[10]*a[15]+a[9]*a[14]*a[3]+a[13]*a[2]*a[11]-a[13]*a[10]*a[3]-a[9]*a[2]*a[15]-a[1]*a[14]*a[11],d=a[1]*a[6]*a[15]+a[5]*a[14]*a[3]+a[13]*a[2]*a[7]-a[13]*a[6]*a[3]-a[5]*a[2]*a[15]-a[1]*a[14]*a[7],e=a[1]*a[6]*a[11]+a[5]*a[10]*a[3]+a[9]*a[2]*a[7]-a[9]*a[6]*a[3]-a[5]*a[2]*a[11]-a[1]*a[10]*a[7];return a[0]*b-a[4]*c+a[8]*d-a[12]*e},c.prototype.setIdentity=function(){var a=this.data;return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,this},c.prototype.setRotationFromVector=function(a){var b=Math.sin(a.x),c=Math.cos(a.x),d=Math.sin(a.y),e=Math.cos(a.y),f=Math.sin(a.z),g=Math.cos(a.z);return this.e00=g*e,this.e10=f*e,this.e20=0-d,this.e01=g*d*b-f*c,this.e11=f*d*b+g*c,this.e21=e*b,this.e02=g*d*c+f*b,this.e12=f*d*c-g*b,this.e22=e*c,this},c.prototype.setRotationFromQuaternion=function(a){var b=a.lengthSquared();b=b>0?2/b:0;var c=a.x*b,d=a.y*b,e=a.z*b,f=a.w*c,g=a.w*d,h=a.w*e,i=a.x*c,j=a.x*d,k=a.x*e,l=a.y*d,m=a.y*e,n=a.z*e;return this.e00=1-l-n,this.e10=j+h,this.e20=k-g,this.e01=j-h,this.e11=1-i-n,this.e21=m+f,this.e02=k+g,this.e12=m-f,this.e22=1-i-l,this},c.prototype.setTranslation=function(a){return this.e03=a.x,this.e13=a.y,this.e23=a.z,this},c.prototype.getTranslation=function(a){return a.x=this.data[12],a.y=this.data[13],a.z=this.data[14],this},c.prototype.getScale=function(a){var b=Math.sqrt(a.setd(this.data[0],this.data[4],this.data[8]).lengthSquared()),c=Math.sqrt(a.setd(this.data[1],this.data[5],this.data[9]).lengthSquared()),d=Math.sqrt(a.setd(this.data[2],this.data[6],this.data[10]).lengthSquared());return a.x=b,a.y=c,a.z=d,this},c.prototype.setScale=function(a){return this.e00*=a.x,this.e10*=a.y,this.e20*=a.z,this.e01*=a.x,this.e11*=a.y,this.e21*=a.z,this.e02*=a.x,this.e12*=a.y,this.e22*=a.z,this},c.prototype.applyPre=function(a){var b=a.data[0],c=a.data[1],d=a.data[2],e=a.data[3],f=this.data;return a.data[0]=f[0]*b+f[1]*c+f[2]*d+f[3]*e,a.data[1]=f[4]*b+f[5]*c+f[6]*d+f[7]*e,a.data[2]=f[8]*b+f[9]*c+f[10]*d+f[11]*e,a.data[3]=f[12]*b+f[13]*c+f[14]*d+f[15]*e,a},c.prototype.applyPost=function(a){var b=a.data[0],c=a.data[1],d=a.data[2],e=a.data[3],f=this.data;return a.data[0]=f[0]*b+f[4]*c+f[8]*d+f[12]*e,a.data[1]=f[1]*b+f[5]*c+f[9]*d+f[13]*e,a.data[2]=f[2]*b+f[6]*c+f[10]*d+f[14]*e,a.data[3]=f[3]*b+f[7]*c+f[11]*d+f[15]*e,a},c.prototype.applyPostPoint=function(a){var b=a.data[0],c=a.data[1],d=a.data[2],e=this.data;return a.data[0]=e[0]*b+e[4]*c+e[8]*d+e[12],a.data[1]=e[1]*b+e[5]*c+e[9]*d+e[13],a.data[2]=e[2]*b+e[6]*c+e[10]*d+e[14],a},c.prototype.applyPostVector=function(a){var b=a.x,c=a.y,d=a.z,e=this.data;return a.x=e[0]*b+e[4]*c+e[8]*d,a.y=e[1]*b+e[5]*c+e[9]*d,a.z=e[2]*b+e[6]*c+e[10]*d,a},c.prototype.copy=function(a){var b=this.data,c=a.data;return b[0]=c[0],b[1]=c[1],b[2]=c[2],b[3]=c[3],b[4]=c[4],b[5]=c[5],b[6]=c[6],b[7]=c[7],b[8]=c[8],b[9]=c[9],b[10]=c[10],b[11]=c[11],b[12]=c[12],b[13]=c[13],b[14]=c[14],b[15]=c[15],this},c.prototype.clone=function(){var a=this.data;return new c(a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8],a[9],a[10],a[11],a[12],a[13],a[14],a[15])},c}),define("goo/entities/managers/EntityManager",[],function(){"use strict";function a(){this.type="EntityManager",this._entitiesById=[],this._entityCount=0}return a.prototype.added=function(a){this.containsEntity(a)||(this._entitiesById[a.id]=a,this._entityCount++)},a.prototype.removed=function(a){this.containsEntity(a)&&(delete this._entitiesById[a.id],this._entityCount--)},a.prototype.containsEntity=function(a){return void 0!==this._entitiesById[a.id]},a.prototype.getEntityById=function(a){return this._entitiesById[a]},a.prototype.getEntityByName=function(a){for(var b in this._entitiesById){var c=this._entitiesById[b];if(c.name===a)return c}},a.prototype.size=function(){return this._entityCount},a.prototype.getEntities=function(){var a=[];for(var b in this._entitiesById)a.push(this._entitiesById[b]);return a},a.prototype.getTopEntities=function(){var a=[];for(var b in this._entitiesById){var c=this._entitiesById[b];c.transformComponent?c.transformComponent.parent||a.push(c):a.push(c)}return a},a}),define("goo/math/Transform",["goo/math/Vector3","goo/math/Matrix3x3","goo/math/Matrix4x4"],function(a,b,c){"use strict";function d(){this.matrix=new c,this.translation=new a,this.rotation=new b,this.scale=new a(1,1,1),this.tmpVec=new a,this.tmpVec2=new a,this.tmpMat1=new b}return d.combine=function(a,c,e){if(a.scale.data[0]!==a.scale.data[1]||a.scale.data[0]!==a.scale.data[2])throw{name:"NonUniformScaleException",message:"Non-uniform scaling in left hand transform, cannot resolve combined transform"};e=e||new d;var f=e.tmpVec;f.setv(c.translation),a.rotation.applyPost(f),f.mulv(a.scale),f.addv(a.translation);var g=e.tmpVec2;g.setv(c.scale),g.mulv(a.scale);var h=e.tmpMat1;return b.combine(a.rotation,c.rotation,h),e.rotation.copy(h),e.scale.setv(g),e.translation.setv(f),e},d.prototype.combine=function(a){return d.combine(this,a,this)},d.prototype.multiply=function(a,d){c.combine(a.matrix,d.matrix,this.matrix),this.tmpMat1.data.set(a.rotation.data),this.rotation.data.set(d.rotation.data),b.combine(this.tmpMat1,this.rotation,this.rotation),this.translation.setv(d.translation),this.translation.mulv(a.scale),this.tmpMat1.applyPost(this.translation).addv(a.translation),this.scale.setv(a.scale).mulv(d.scale)},d.prototype.setIdentity=function(){this.matrix.setIdentity(),this.translation.setv(a.ZERO),this.rotation.setIdentity(),this.scale.setv(a.ONE)},d.prototype.applyForward=function(a,b){return b.setv(a),this.matrix.applyPostPoint(b),b},d.prototype.applyForwardVector=function(a,b){return b.copy(a),b.set(b.x*this.scale.x,b.y*this.scale.y,b.z*this.scale.z),this.rotation.applyPost(b),b},d.prototype.update=function(){var a=this.matrix.data,b=this.rotation.data,c=this.scale.data,d=this.translation.data;a[0]=c[0]*b[0],a[1]=c[0]*b[1],a[2]=c[0]*b[2],a[3]=0,a[4]=c[1]*b[3],a[5]=c[1]*b[4],a[6]=c[1]*b[5],a[7]=0,a[8]=c[2]*b[6],a[9]=c[2]*b[7],a[10]=c[2]*b[8],a[11]=0,a[12]=d[0],a[13]=d[1],a[14]=d[2],a[15]=1},d.prototype.copy=function(a){this.matrix.copy(a.matrix),this.translation.setv(a.translation),this.rotation.copy(a.rotation),this.scale.setv(a.scale)},d.prototype.setRotationXYZ=function(a,b,c){this.rotation.fromAngles(a,b,c)},d.prototype.lookAt=function(a,b){this.tmpVec.setv(this.translation).subv(a).normalize(),this.rotation.lookAt(this.tmpVec,b)},d.prototype.invert=function(a){var b=a;b||(b=new d),b.matrix.copy(this.matrix),b.matrix.invert();var c=b.rotation.copy(this.rotation);return c.multiplyDiagonalPost(this.scale,c).invert(),b.translation.copy(this.translation),b.rotation.applyPost(b.translation).invert(),b},d.prototype.toString=function(){return""+this.matrix},d}),define("goo/entities/components/TransformComponent",["goo/math/Transform","goo/math/Vector3","goo/entities/components/Component"],function(a,b,c){"use strict";function d(){this.type="TransformComponent",this.parent=null,this.children=[],this.transform=new a,this.worldTransform=new a,this._dirty=!0,this._updated=!1}return d.prototype=Object.create(c.prototype),d.prototype.setTranslation=function(){return this.transform.translation.set(arguments),this._dirty=!0,this},d.prototype.setScale=function(){return this.transform.scale.set(arguments),this._dirty=!0,this},d.prototype.addTranslation=function(){return 3===arguments.length?this.transform.translation.add(arguments):this.transform.translation.add(arguments[0]),this._dirty=!0,this},d.prototype.setRotation=function(a,b,c){return this.transform.rotation.fromAngles(a,b,c),this._dirty=!0,this},d.prototype.lookAt=function(a,b){return this.transform.lookAt(a,b),this._dirty=!0,this},d.prototype.setUpdated=function(){this._dirty=!0},d.prototype.attachChild=function(a){for(var b=this;b;){if(b===a)return console.warn("attachChild: An object can't be added as a descendant of itself."),void 0;b=b.parent}a.parent&&a.parent.detachChild(a),a.parent=this,this.children.push(a)},d.prototype.detachChild=function(a){if(a===this)return console.warn("attachChild: An object can't be removed from itself."),void 0;var b=this.children.indexOf(a);-1!==b&&(a.parent=null,this.children.splice(b,1))},d.prototype.updateTransform=function(){this.transform.update()},d.prototype.updateWorldTransform=function(){this.parent?this.worldTransform.multiply(this.parent.worldTransform,this.transform):this.worldTransform.copy(this.transform),this._dirty=!1,this._updated=!0},d}),define("goo/entities/World",["goo/entities/Entity","goo/entities/managers/EntityManager","goo/entities/components/TransformComponent"],function(a,b,c){"use strict";function d(a){this.gooRunner=a,this._managers=[],this._systems=[],this._addedEntities=[],this._changedEntities=[],this._removedEntities=[],this.entityManager=new b,this.setManager(this.entityManager),this.time=0,this.tpf=1}return d.time=0,d.tpf=1,d.prototype.setManager=function(a){this._managers.push(a)},d.prototype.getManager=function(a){for(var b=0;b<this._managers.length;b++){var c=this._managers[b];if(c.type===a)return c}},d.prototype.setSystem=function(a){this._systems.push(a)},d.prototype.getSystem=function(a){for(var b=0;b<this._systems.length;b++){var c=this._systems[b];if(c.type===a)return c}},d.prototype.createEntity=function(b){var d=new a(this,b);return d.setComponent(new c),d},d.prototype.getEntities=function(){return this.entityManager.getEntities()},d.prototype.addEntity=function(a,b){if(-1===this._addedEntities.indexOf(a)&&this._addedEntities.push(a),a.transformComponent&&(void 0===b||b===!0))for(var c=a.transformComponent.children,d=0;d<c.length;d++)this.addEntity(c[d].entity,b)},d.prototype.removeEntity=function(a,b){-1===this._removedEntities.indexOf(a)&&this._removedEntities.push(a);var c=a.transformComponent;if(c.parent&&(c.parent.detachChild(c),c.parent=null),b===!1){for(var d=c.children,e=0;e<d.length;e++)d[e].parent=null;c.children=[]}else for(var d=c.children,e=0;e<d.length;e++)this._recursiveRemoval(d[e].entity,b)},d.prototype._recursiveRemoval=function(a,b){if(-1===this._removedEntities.indexOf(a)&&this._removedEntities.push(a),a.transformComponent&&(void 0===b||b===!0))for(var c=a.transformComponent.children,d=0;d<c.length;d++)this._recursiveRemoval(c[d].entity,b)},d.prototype.changedEntity=function(a,b,c){var d={entity:a};void 0!==b&&(d.component=b),void 0!==c&&(d.eventType=c),this._changedEntities.push(d)},d.prototype.process=function(){this._check(this._addedEntities,function(a,b){if(a.added&&a.added(b),a.addedComponent)for(var c=0;c<b._components.length;c++)a.addedComponent(b,b._components[c])}),this._check(this._changedEntities,function(a,b){a.changed&&a.changed(b.entity),void 0!==b.eventType&&a[b.eventType]&&a[b.eventType](b.entity,b.component)}),this._check(this._removedEntities,function(a,b){if(a.removed&&a.removed(b),a.removedComponent)for(var c=0;c<b._components.length;c++)a.removedComponent(b,b._components[c])});for(var a=0;a<this._systems.length;a++){var b=this._systems[a];b.passive||b._process(this.tpf)}},d.prototype._check=function(a,b){for(var c=0;c<a.length;c++){for(var d=a[c],e=0;e<this._managers.length;e++){var f=this._managers[e];b(f,d)}for(var g=0;g<this._systems.length;g++){var h=this._systems[g];b(h,d)}}a.length=0},d}),define("goo/renderer/RenderQueue",["goo/math/Vector3"],function(a){"use strict";function b(){var b=this,c=new a;this.opaqueSorter=function(a,d){var e=a.meshRendererComponent.materials[0],f=d.meshRendererComponent.materials[0];if(null===e||null===f)return 0;if(e===f){var g=a.meshRendererComponent.worldBound,h=d.meshRendererComponent.worldBound;if(null===g||null===h)return 0;var i=c.setv(b.camera.translation).subv(g.center).lengthSquared(),j=c.setv(b.camera.translation).subv(h.center).lengthSquared();return i-j}var k=e.shader,l=f.shader;if(null===k||null===l)return 0;if(k._id===l._id){var g=a.meshRendererComponent.worldBound,h=d.meshRendererComponent.worldBound;if(null===g||null===h)return 0;var i=c.setv(b.camera.translation).subv(g.center).lengthSquared(),j=c.setv(b.camera.translation).subv(h.center).lengthSquared();return i-j}return k._id-l._id},this.transparentSorter=function(a,d){var e=a.meshRendererComponent.worldBound,f=d.meshRendererComponent.worldBound,g=c.setv(b.camera.translation).subv(e.center).lengthSquared(),h=c.setv(b.camera.translation).subv(f.center).lengthSquared();return h-g},this.bucketSorter=function(a,b){return a-b}}return b.prototype.sort=function(a,c){var d=0;this.camera=c;for(var e={},f=[],g=0;g<a.length;g++){var h=a[g],i=h.meshRendererComponent;if(i&&0!==i.materials.length){var j=i.materials[0].getRenderQueue(),k=e[j];k||(k=[],e[j]=k,f.push(j)),k.push(h)}else a[d]=h,d++}f.length>1&&f.sort(this.bucketSorter);for(var l=0;l<f.length;l++){var m=f[l],k=e[m];m<b.TRANSPARENT?k.sort(this.opaqueSorter):k.sort(this.transparentSorter);for(var g=0;g<k.length;g++)a[d]=k[g],d++}},b.BACKGROUND=0,b.OPAQUE=1e3,b.TRANSPARENT=2e3,b.OVERLAY=3e3,b}),define("goo/renderer/Shader",["goo/renderer/ShaderCall","goo/math/Matrix4x4","goo/entities/World","goo/renderer/RenderQueue","goo/renderer/Util"],function(a,b,c,d,e){"use strict";function f(a,b){if(!b.vshader||!b.fshader)throw new Error("Missing shader sources for shader: "+a);this.originalShaderDefinition=b,this.shaderDefinition=b,this.name=a,this.origVertexSource=b.vshader,this.origFragmentSource=b.fshader,this.vertexSource="function"==typeof this.origVertexSource?this.origVertexSource():this.origVertexSource,this.fragmentSource="function"==typeof this.origFragmentSource?this.origFragmentSource():this.origFragmentSource,this.shaderProgram=null,this.attributeMapping={},this.attributeIndexMapping={},this.uniformMapping={},this.uniformCallMapping={},this.textureSlots=[],this.textureSlotsNaming={},this.currentCallbacks={},this.overridePrecision=b.precision||null,this.processors=b.processors,this.builder=b.builder,this.defines=b.defines,this.attributes=b.attributes||{},this.uniforms=b.uniforms||{},this.renderQueue=d.OPAQUE,this._id=f.id++,this.errorOnce=!1}function g(a){var d=new b,e=new b;a[f.PROJECTION_MATRIX]=function(a,b){var c=b.camera.getProjectionMatrix();a.uniformMatrix4fv(c)},a[f.VIEW_MATRIX]=function(a,b){var c=b.camera.getViewMatrix();a.uniformMatrix4fv(c)},a[f.WORLD_MATRIX]=function(a,b){var c=void 0!==b.transform?b.transform.matrix:d;a.uniformMatrix4fv(c)},a[f.NORMAL_MATRIX]=function(a,b){var c=void 0!==b.transform?b.transform.matrix:d;e.copy(c).invert().transpose(),a.uniformMatrix4fv(e)},a[f.VIEW_INVERSE_MATRIX]=function(a,b){var c=b.camera.getViewInverseMatrix();a.uniformMatrix4fv(c)},a[f.VIEW_PROJECTION_MATRIX]=function(a,b){var c=b.camera.getViewProjectionMatrix();a.uniformMatrix4fv(c)},a[f.VIEW_PROJECTION_INVERSE_MATRIX]=function(a,b){var c=b.camera.getViewProjectionInverseMatrix();a.uniformMatrix4fv(c)};for(var g=0;16>g;g++)a[f["TEXTURE"+g]]=function(a){return function(b){b.uniform1i(a)}}(g);for(var g=0;8>g;g++)a[f["LIGHT"+g]]=function(a){return function(b,c){var d=c.lights[a];void 0!==d?b.uniform3f(d.translation.data[0],d.translation.data[1],d.translation.data[2]):b.uniform3f(-20,20,20)}}(g);a[f.LIGHTCOUNT]=function(a,b){a.uniform1i(b.lights.length)},a[f.CAMERA]=function(a,b){var c=b.camera.translation;a.uniform3f(c.data[0],c.data[1],c.data[2])},a[f.NEAR_PLANE]=function(a,b){a.uniform1f(b.camera.near)},a[f.FAR_PLANE]=function(a,b){a.uniform1f(b.camera.far)},a[f.MAIN_NEAR_PLANE]=function(a,b){a.uniform1f(b.mainCamera.near)},a[f.MAIN_FAR_PLANE]=function(a,b){a.uniform1f(b.mainCamera.far)},a[f.MAIN_DEPTH_SCALE]=function(a,b){a.uniform1f(1/(b.mainCamera.far-b.mainCamera.near))},a[f.AMBIENT]=function(a,b){var c=void 0!==b.material.materialState?b.material.materialState.ambient:f.DEFAULT_AMBIENT;a.uniform4fv(c)},a[f.EMISSIVE]=function(a,b){var c=void 0!==b.material.materialState?b.material.materialState.emissive:f.DEFAULT_EMISSIVE;a.uniform4fv(c)},a[f.DIFFUSE]=function(a,b){var c=void 0!==b.material.materialState?b.material.materialState.diffuse:f.DEFAULT_DIFFUSE;a.uniform4fv(c)},a[f.SPECULAR]=function(a,b){var c=void 0!==b.material.materialState?b.material.materialState.specular:f.DEFAULT_SPECULAR;a.uniform4fv(c)},a[f.SPECULAR_POWER]=function(a,b){var c=void 0!==b.material.materialState?b.material.materialState.shininess:f.DEFAULT_SHININESS;c=Math.max(c,1),a.uniform1f(c)},a[f.TIME]=function(a){a.uniform1f(c.time)},a[f.TPF]=function(a){a.uniform1f(c.tpf)},a[f.RESOLUTION]=function(a,b){a.uniform2f(b.renderer.viewportWidth,b.renderer.viewportHeight)}}var h=window.WebGLRenderingContext;f.id=0,f.prototype.clone=function(){return new f(this.name,e.clone({precision:this.precision,processors:this.processors,builder:this.builder,defines:this.defines,attributes:this.attributes,uniforms:this.uniforms,vshader:this.origVertexSource,fshader:this.origFragmentSource}))},f.prototype.cloneOriginal=function(){return new f(this.name,this.originalShaderDefinition)};var i=/\b(attribute|uniform)\s+(float|int|bool|vec2|vec3|vec4|mat3|mat4|sampler2D|sampler3D|samplerCube)\s+(\w+)(\s*\[\s*\w+\s*\])*;/g;f.prototype.apply=function(a,b){var c=b.context,d=b.rendererRecord;null===this.shaderProgram&&(this._investigateShaders(),this.addDefines(this.defines),this.addPrecision(this.overridePrecision||b.shaderPrecision),this.compile(b));var e=!1;if(d.usedProgram!==this.shaderProgram&&(c.useProgram(this.shaderProgram),d.usedProgram=this.shaderProgram,e=!0),this.attributes){var f=a.meshData.attributeMap;for(var g in this.attributes){var h=f[this.attributes[g]];if(h){var i=this.attributeIndexMapping[g];void 0!==i&&(e&&b.context.enableVertexAttribArray(i),b.bindVertexAttribute(i,h))}}}this._bindUniforms(a)},f.prototype._bindUniforms=function(a){if(this.uniforms)try{this.textureIndex=0;for(var b in this.uniforms)this._bindUniform(b,a);this.errorOnce=!1}catch(c){this.errorOnce===!1&&(console.error(c.stack),this.errorOnce=!0)}},f.prototype._bindUniform=function(a,b){var c=this.uniformCallMapping[a];if(void 0!==c){var d=void 0!==b.material.uniforms[a]?b.material.uniforms[a]:this.uniforms[a];if("string"==typeof d){var e=this.currentCallbacks[a];if(e)e(c,b);else{var f=this.textureSlotsNaming[a];if(void 0!==f){var g=b.material.getTexture(f.mapping);if(g instanceof Array){var h=[];f.index=[];for(var i=0;i<g.length;i++)f.index.push(this.textureIndex),h.push(this.textureIndex++);c.call(h)}else f.index=this.textureIndex,c.call(this.textureIndex++)}}}else{var j="function"==typeof d?d(b):d;c.call(j)}}},f.prototype.rebuild=function(){this.shaderProgram=null,this.attributeMapping={},this.attributeIndexMapping={},this.uniformMapping={},this.uniformCallMapping={},this.currentCallbacks={},this.vertexSource="function"==typeof this.origVertexSource?this.origVertexSource():this.origVertexSource,this.fragmentSource="function"==typeof this.origFragmentSource?this.origFragmentSource():this.origFragmentSource},f.prototype._investigateShaders=function(){this.textureSlots=[],this.textureSlotsNaming={},f.investigateShader(this.vertexSource,this),f.investigateShader(this.fragmentSource,this)},f.investigateShader=function(a,b){i.lastIndex=0;for(var c=i.exec(a);null!==c;){var d={format:c[2]},e=c[1],f=c[3],g=c[4];if(g&&("float"===d.format?d.format="floatarray":"int"===d.format?d.format="intarray":0===d.format.indexOf("sampler")&&(d.format="samplerArray")),"attribute"===e)b.attributeMapping[f]=d;else{if(0===d.format.indexOf("sampler")){var h={format:d.format,name:f,mapping:b.uniforms[f],index:b.textureSlots.length};b.textureSlots.push(h),b.textureSlotsNaming[h.name]=h}b.uniformMapping[f]=d}c=i.exec(a)}},f.prototype.compile=function(b){var c=b.context,d=this._getShader(c,h.VERTEX_SHADER,this.vertexSource),e=this._getShader(c,h.FRAGMENT_SHADER,this.fragmentSource);(null===d||null===e)&&console.error("Shader error - no shaders"),this.shaderProgram=c.createProgram();var f=c.getError();(null===this.shaderProgram||f!==h.NO_ERROR)&&console.error("Shader error: "+f+" [shader: "+this.name+"]"),c.attachShader(this.shaderProgram,d),c.attachShader(this.shaderProgram,e),c.linkProgram(this.shaderProgram),c.getProgramParameter(this.shaderProgram,h.LINK_STATUS)||console.error("Could not initialise shaders: "+c.getProgramInfoLog(this.shaderProgram));for(var g in this.attributeMapping){var i=c.getAttribLocation(this.shaderProgram,g);-1!==i&&(this.attributeIndexMapping[g]=i)}for(var g in this.uniformMapping){var j=c.getUniformLocation(this.shaderProgram,g);if(null!==j)this.uniformCallMapping[g]=new a(c,j,this.uniformMapping[g].format);else for(var k=this.textureSlots.length,l=0;k>l;l++){var m=this.textureSlots[l];if(m.name===g){for(this.textureSlots.splice(l,1),delete this.textureSlotsNaming[m.name];k-1>l;l++)this.textureSlots[l].index--;break}}}if(this.uniforms){if(this.uniforms.$link){for(var n=this.uniforms.$link instanceof Array?this.uniforms.$link:[this.uniforms.$link],l=0;l<n.length;l++){var o=n[l];for(var g in o)this.uniforms[g]=o[g]}delete this.uniforms.$link}for(var p in this.uniforms){var q=this.uniforms[p];this.defaultCallbacks[q]&&(this.currentCallbacks[p]=this.defaultCallbacks[q])}}};var j=/\bERROR: \d+:(\d+):\s(.+)\b/g;f.prototype._getShader=function(a,b,c){var d=a.createShader(b);if(a.shaderSource(d,c),a.compileShader(d),!a.getShaderParameter(d,h.COMPILE_STATUS)){var e=a.getShaderInfoLog(d),f=b===h.VERTEX_SHADER?"VertexShader":"FragmentShader";j.lastIndex=0;var g=j.exec(e);if(null!==g)for(;null!==g;){var i=c.split("\n"),k=g[1],l=g[2];console.error("Error in "+f+" - ["+this.name+"]["+this._id+"] at line "+k+":"),console.error("	Error: "+l),console.error("	Source: "+i[k-1]),g=j.exec(e)}else console.error("Error in "+f+" - ["+this.name+"]["+this._id+"] "+e);return null}return d};var k=/\bprecision\s+(lowp|mediump|highp)\s+(float|int);/g;f.prototype.addPrecision=function(a){k.lastIndex=0;var b=k.exec(this.vertexSource);null===b&&(this.vertexSource="precision "+a+" float;\n"+this.vertexSource),k.lastIndex=0;var c=k.exec(this.fragmentSource);null===c&&(this.fragmentSource="precision "+a+" float;\n"+this.fragmentSource)},f.prototype.addDefines=function(a){if(a){var b=this.generateDefines(a);this.vertexSource=b+"\n"+this.vertexSource,this.fragmentSource=b+"\n"+this.fragmentSource}},f.prototype.generateDefines=function(a){var b=[];for(var c in a){var d=a[c];if(d!==!1){var e="#define "+c+" "+d;b.push(e)}}return b.join("\n")},f.prototype.getShaderDefinition=function(){return{vshader:this.vertexSource,fshader:this.fragmentSource,defines:this.defines,attributes:this.attributes,uniforms:this.uniforms}},f.prototype.toString=function(){return this.name},f.PROJECTION_MATRIX="PROJECTION_MATRIX",f.VIEW_MATRIX="VIEW_MATRIX",f.VIEW_INVERSE_MATRIX="VIEW_INVERSE_MATRIX",f.VIEW_PROJECTION_MATRIX="VIEW_PROJECTION_MATRIX",f.VIEW_PROJECTION_INVERSE_MATRIX="VIEW_PROJECTION_INVERSE_MATRIX",f.WORLD_MATRIX="WORLD_MATRIX",f.NORMAL_MATRIX="NORMAL_MATRIX";for(var l=0;8>l;l++)f["LIGHT"+l]="LIGHT"+l;return f.CAMERA="CAMERA",f.AMBIENT="AMBIENT",f.EMISSIVE="EMISSIVE",f.DIFFUSE="DIFFUSE",f.SPECULAR="SPECULAR",f.SPECULAR_POWER="SPECULAR_POWER",f.NEAR_PLANE="NEAR_PLANE",f.FAR_PLANE="FAR_PLANE",f.MAIN_NEAR_PLANE="NEAR_PLANE",f.MAIN_FAR_PLANE="FAR_PLANE",f.MAIN_DEPTH_SCALE="DEPTH_SCALE",f.TIME="TIME",f.TPF="TPF",f.RESOLUTION="RESOLUTION",f.DIFFUSE_MAP="DIFFUSE_MAP",f.NORMAL_MAP="NORMAL_MAP",f.SPECULAR_MAP="SPECULAR_MAP",f.LIGHT_MAP="LIGHT_MAP",f.SHADOW_MAP="SHADOW_MAP",f.AO_MAP="AO_MAP",f.EMISSIVE_MAP="EMISSIVE_MAP",f.DEPTH_MAP="DEPTH_MAP",f.DEFAULT_AMBIENT=[.1,.1,.1,1],f.DEFAULT_EMISSIVE=[0,0,0,0],f.DEFAULT_DIFFUSE=[.8,.8,.8,1],f.DEFAULT_SPECULAR=[.6,.6,.6,1],f.DEFAULT_SHININESS=64,f.prototype.defaultCallbacks={},g(f.prototype.defaultCallbacks),f}),define("goo/renderer/Material",["goo/renderer/Shader"],function(a){"use strict";function b(b){this.name=b,this.shader=null,this.uniforms={},this._textureMaps={},this.materialState={ambient:a.DEFAULT_AMBIENT,diffuse:a.DEFAULT_DIFFUSE,emissive:a.DEFAULT_EMISSIVE,specular:a.DEFAULT_SPECULAR,shininess:a.DEFAULT_SHININESS},this.cullState={enabled:!0,cullFace:"Back",frontFace:"CCW"},this.blendState={blending:"NoBlending",blendEquation:"AddEquation",blendSrc:"SrcAlphaFactor",blendDst:"OneMinusSrcAlphaFactor"},this.depthState={enabled:!0,write:!0},this.offsetState={enabled:!1,factor:1,units:1},this.dualTransparency=!1,this.wireframe=!1,this.flat=!1,this.renderQueue=null}return b.prototype.setTexture=function(a,b){this._textureMaps[a]=b},b.prototype.getTexture=function(a){return this._textureMaps[a]},b.prototype.removeTexture=function(a){delete this._textureMaps[a]},b.prototype.getTextures=function(){var a=[];for(var b in this._textureMaps)a.push(this._textureMaps[b]);return a},b.prototype.getTextureEntries=function(){return this._textureMaps},b.prototype.getRenderQueue=function(){return null!==this.renderQueue?this.renderQueue:null!==this.shader?this.shader.renderQueue:1e3},b.prototype.setRenderQueue=function(a){this.renderQueue=a},b.store=[],b.hash=[],b.createShader=function(c,d){var e=b.store.indexOf(c);if(-1!==e)return b.hash[e];var f=new a(d||null,c);return null===f.name&&(f.name="DefaultShader"+f._id),b.store.push(c),b.hash.push(f),f},b.clearShaderCache=function(){b.store.length=0,b.hash.length=0},b.createMaterial=function(a,c){var d=new b(c||"DefaultMaterial");return d.shader=b.createShader(a),d},b.createEmptyMaterial=function(a,c){var d=new b(c||"Empty Material");return d.empty(),d.shader=a?b.createShader(a):void 0,d},b.prototype.empty=function(){this.cullState={},this.blendState={},this.depthState={},this.offsetState={},this.wireframe=void 0,this.renderQueue=void 0,this.flat=void 0,this._textureMaps={},this.shader=void 0,this.uniforms={}},b}),define("goo/renderer/shaders/ShaderFragment",[],function(){"use strict";function a(){}return a.noisecommon=["vec4 mod289(vec4 x) {","  return x - floor(x * (1.0 / 289.0)) * 289.0;","}","vec3 mod289(vec3 x) {","  return x - floor(x * (1.0 / 289.0)) * 289.0;","}","vec2 mod289(vec2 x) {","  return x - floor(x * (1.0 / 289.0)) * 289.0;","}","vec3 permute(vec3 x) {","  return mod289(((x*34.0)+1.0)*x);","}","vec4 permute(vec4 x) {","  return mod289(((x*34.0)+1.0)*x);","}"].join("\n"),a.noise2d=[a.noisecommon,"float snoise(vec2 v)","  {","  const vec4 C = vec4(0.211324865405187,  // (3.0-sqrt(3.0))/6.0","                      0.366025403784439,  // 0.5*(sqrt(3.0)-1.0)","                     -0.577350269189626,  // -1.0 + 2.0 * C.x","                      0.024390243902439); // 1.0 / 41.0","  vec2 i  = floor(v + dot(v, C.yy) );","  vec2 x0 = v -   i + dot(i, C.xx);","  vec2 i1;","  //i1.x = step( x0.y, x0.x ); // x0.x > x0.y ? 1.0 : 0.0","  //i1.y = 1.0 - i1.x;","  i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);","  // x0 = x0 - 0.0 + 0.0 * C.xx ;","  // x1 = x0 - i1 + 1.0 * C.xx ;","  // x2 = x0 - 1.0 + 2.0 * C.xx ;","  vec4 x12 = x0.xyxy + C.xxzz;","  x12.xy -= i1;","  i = mod289(i); // Avoid truncation effects in permutation","  vec3 p = permute( permute( i.y + vec3(0.0, i1.y, 1.0 ))","		+ i.x + vec3(0.0, i1.x, 1.0 ));","  vec3 m = max(0.5 - vec3(dot(x0,x0), dot(x12.xy,x12.xy), dot(x12.zw,x12.zw)), 0.0);","  m = m*m ;","  m = m*m ;","  vec3 x = 2.0 * fract(p * C.www) - 1.0;","  vec3 h = abs(x) - 0.5;","  vec3 ox = floor(x + 0.5);","  vec3 a0 = x - ox;","  m *= 1.79284291400159 - 0.85373472095314 * ( a0*a0 + h*h );","  vec3 g;","  g.x  = a0.x  * x0.x  + h.x  * x0.y;","  g.yz = a0.yz * x12.xz + h.yz * x12.yw;","  return 130.0 * dot(m, g);","}"].join("\n"),a.noise3d=[a.noisecommon,"vec4 taylorInvSqrt(vec4 r) {","	return 1.79284291400159 - 0.85373472095314 * r;","}","float snoise(vec3 v) {","	const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;","	const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);","	vec3 i  = floor(v + dot(v, C.yyy) );","	vec3 x0 =   v - i + dot(i, C.xxx) ;","	vec3 g = step(x0.yzx, x0.xyz);","	vec3 l = 1.0 - g;","	vec3 i1 = min( g.xyz, l.zxy );","	vec3 i2 = max( g.xyz, l.zxy );","	vec3 x1 = x0 - i1 + C.xxx;","	vec3 x2 = x0 - i2 + C.yyy; // 2.0*C.x = 1/3 = C.y","	vec3 x3 = x0 - D.yyy;      // -1.0+3.0*C.x = -0.5 = -D.y","	i = mod289(i); ","	vec4 p = permute( permute( permute( ","         i.z + vec4(0.0, i1.z, i2.z, 1.0 ))","       + i.y + vec4(0.0, i1.y, i2.y, 1.0 )) ","       + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));","	float n_ = 0.142857142857; // 1.0/7.0","	vec3  ns = n_ * D.wyz - D.xzx;","	vec4 j = p - 49.0 * floor(p * ns.z * ns.z);  //  mod(p,7*7)","	vec4 x_ = floor(j * ns.z);","	vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)","	vec4 x = x_ *ns.x + ns.yyyy;","	vec4 y = y_ *ns.x + ns.yyyy;","	vec4 h = 1.0 - abs(x) - abs(y);","	vec4 b0 = vec4( x.xy, y.xy );","	vec4 b1 = vec4( x.zw, y.zw );","	vec4 s0 = floor(b0)*2.0 + 1.0;","	vec4 s1 = floor(b1)*2.0 + 1.0;","	vec4 sh = -step(h, vec4(0.0));","	vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;","	vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;","	vec3 p0 = vec3(a0.xy,h.x);","	vec3 p1 = vec3(a0.zw,h.y);","	vec3 p2 = vec3(a1.xy,h.z);","	vec3 p3 = vec3(a1.zw,h.w);","	vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));","	p0 *= norm.x;","	p1 *= norm.y;","	p2 *= norm.z;","	p3 *= norm.w;","	vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);","	m = m * m;","	return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1), dot(p2,x2), dot(p3,x3) ) );","}"].join("\n"),a.methods={packDepth:["vec4 packDepth( const in float depth ) {","	const vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );","	const vec4 bit_mask  = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );","	vec4 res = fract( depth * bit_shift );","	res -= res.xxyz * bit_mask;","	return res;","}"].join("\n"),unpackDepth:["float unpackDepth( const in vec4 rgba_depth ) {","	const vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );","	float depth = dot( rgba_depth, bit_shift );","	return depth;","}"].join("\n"),packDepth16:["vec2 packDepth16( const in float depth ) {","	const vec2 bias = vec2(1.0 / 255.0, 0.0);","	vec2 res = vec2(depth, fract(depth * 255.0));","	return res - (res.yy * bias);","}"].join("\n"),unpackDepth16:["float unpackDepth16( const in vec2 rg_depth ) {","	return rg_depth.x + (rg_depth.y / 255.0);","}"].join("\n")},a
}),define("goo/renderer/light/Light",["goo/math/Vector3"],function(a){"use strict";function b(){this.translation=new a,this.color=new a(1,1,1),this.intensity=1,this.specularIntensity=1,this.shadowCaster=!1,this.lightCookie=null,this.shadowSettings={size:100,near:1,far:1e3,resolution:[512,512],upVector:a.UNIT_Y,darkness:0,shadowType:"VSM"},this.changedProperties=!1,this.changedColor=!1}return b}),define("goo/renderer/light/PointLight",["goo/renderer/light/Light"],function(a){"use strict";function b(){a.call(this),this.range=1e3}return b.prototype=Object.create(a.prototype),b.prototype.update=function(a){a.matrix.getTranslation(this.translation)},b}),define("goo/renderer/light/DirectionalLight",["goo/math/Vector3","goo/renderer/light/Light"],function(a,b){"use strict";function c(){b.call(this),this.direction=new a}return c.prototype=Object.create(b.prototype),c.prototype.update=function(a){a.matrix.getTranslation(this.translation),this.direction.setd(0,0,-1),a.matrix.applyPostVector(this.direction)},c}),define("goo/renderer/light/SpotLight",["goo/math/Vector3","goo/renderer/light/Light"],function(a,b){"use strict";function c(){b.call(this),this.direction=new a,this.range=1e3,this.angle=45,this.penumbra=null,this.exponent=16}return c.prototype=Object.create(b.prototype),c.prototype.update=function(a){a.matrix.getTranslation(this.translation),this.direction.setd(0,0,-1),a.matrix.applyPostVector(this.direction)},c}),define("goo/util/TangentGenerator",["goo/math/Vector2","goo/math/Vector3","goo/renderer/MeshData"],function(a,b,c){"use strict";function d(){}return d.addTangentBuffer=function(d,e){function f(b){for(var c=[],d=0;d<b.length;d+=2)c.push(new a(b[d+0],b[d+1]));return c}function g(a){for(var c=[],d=0;d<a.length;d+=3)c.push(new b(a[d+0],a[d+1],a[d+2]));return c}e=e||0;var h=d.getAttributeBuffer(c.POSITION);if(h){var i=d.getAttributeBuffer(c.NORMAL);if(i){var j=d.getAttributeBuffer("TEXCOORD"+e);if(j||0===e||(j=d.getAttributeBuffer(c.TEXCOORD0)),j){var k=d.getIndexBuffer();if(k){for(var l=d.vertexCount,m=d.indexCount/3,n=[],o=[],p=0;l>p;p++)n[p]=new b,o[p]=new b;for(var q=g(h),r=g(i),s=f(j),t=0;m>t;t++){var u=k[3*t],v=k[3*t+1],w=k[3*t+2],x=q[u],y=q[v],z=q[w],A=s[u],B=s[v],C=s[w],D=y.x-x.x,E=z.x-x.x,F=y.y-x.y,G=z.y-x.y,H=y.z-x.z,I=z.z-x.z,J=B.x-A.x,K=C.x-A.x,L=B.y-A.y,M=C.y-A.y,N=1/(J*M-K*L);if(isFinite(N)!==!1){var O=new b((M*D-L*E)*N,(M*F-L*G)*N,(M*H-L*I)*N),P=new b((J*E-K*D)*N,(J*G-K*F)*N,(J*I-K*H)*N);n[u].add(O),n[v].add(O),n[w].add(O),o[u].add(P),o[v].add(P),o[w].add(P)}}d.attributeMap[c.TANGENT]=c.createAttribute(4,"Float"),d.rebuildData(d.vertexCount,d.indexCount,!0);for(var Q=d.getAttributeBuffer(c.TANGENT),R=new b,S=new b,t=0;l>t;t++){var T=r[t],U=n[t],V=T.dot(U);R.copy(U).sub(S.copy(T).mul(V)).normalize(),Q[4*t+0]=R.x,Q[4*t+1]=R.y,Q[4*t+2]=R.z,V=R.copy(T).cross(U).dot(o[t]);var W=0>V?-1:1;Q[4*t+3]=W}return Q}}}}},d}),define("goo/renderer/shaders/ShaderBuilder",["goo/renderer/MeshData","goo/renderer/light/PointLight","goo/renderer/light/DirectionalLight","goo/renderer/light/SpotLight","goo/math/MathUtils","goo/util/TangentGenerator"],function(a,b,c,d,e,f){"use strict";function g(){}var h=new c;return h.translation.setd(10,10,10),h.direction.setd(1,1,1).normalize(),g.defaultLight=h,g.SKYBOX=null,g.SKYSPHERE=null,g.ENVIRONMENT_TYPE=0,g.GLOBAL_AMBIENT=[0,0,0],g.USE_FOG=!1,g.FOG_SETTINGS=[0,1e4],g.FOG_COLOR=[1,1,1],g.uber={processor:function(b,c){var d=c.meshData.attributeMap,e=c.material,h=e._textureMaps;b.defines=b.defines||{},g.SKYBOX&&e.uniforms.reflectivity>0?e.setTexture("ENVIRONMENT_CUBE",g.SKYBOX):e.removeTexture("ENVIRONMENT_CUBE"),g.SKYSPHERE&&e.uniforms.reflectivity>0?(e.setTexture("ENVIRONMENT_SPHERE",g.SKYSPHERE),b.defines.ENVIRONMENT_TYPE=g.ENVIRONMENT_TYPE):e.removeTexture("ENVIRONMENT_SPHERE");for(var i in d)b.defines[i]||(b.defines[i]=!0);for(var j in h)if(void 0!==h[j]&&"SHADOW_MAP"!==j&&(b.defines[j]||(b.defines[j]=!0),"DIFFUSE_MAP"===j)){var k=h[j].offset,l=h[j].repeat;b.uniforms.offsetRepeat=b.uniforms.offsetRepeat||[0,0,1,1],b.uniforms.offsetRepeat[0]=k.x,b.uniforms.offsetRepeat[1]=k.y,b.uniforms.offsetRepeat[2]=l.x,b.uniforms.offsetRepeat[3]=l.y}for(var i in b.defines)"MAX_POINT_LIGHTS"!==i&&"MAX_DIRECTIONAL_LIGHTS"!==i&&"MAX_SPOT_LIGHTS"!==i&&"SHADOW_TYPE"!==i&&"JOINT_COUNT"!==i&&"WEIGHTS"!==i&&"PHYSICALLY_BASED_SHADING"!==i&&"ENVIRONMENT_TYPE"!==i&&(d[i]||h[i]||delete b.defines[i]);c.material.uniforms.discardThreshold>=0?b.defines.DISCARD=!0:delete b.defines.DISCARD,g.USE_FOG?(b.defines.FOG=!0,b.uniforms.fogSettings=g.FOG_SETTINGS,b.uniforms.fogColor=g.FOG_COLOR):delete b.defines.FOG,b.defines.SKIP_SPECULAR=!0,b.defines.NORMAL&&b.defines.NORMAL_MAP&&!c.meshData.getAttributeBuffer(a.TANGENT)&&f.addTangentBuffer(c.meshData)}},g.light={processor:function(a,f){a.uniforms.materialAmbient=a.uniforms.materialAmbient||"AMBIENT",a.uniforms.materialEmissive=a.uniforms.materialEmissive||"EMISSIVE",a.uniforms.materialDiffuse=a.uniforms.materialDiffuse||"DIFFUSE",a.uniforms.materialSpecular=a.uniforms.materialSpecular||"SPECULAR",a.uniforms.materialSpecularPower=a.uniforms.materialSpecularPower||"SPECULAR_POWER",a.uniforms.globalAmbient=g.GLOBAL_AMBIENT;for(var h=f.lights,i=[],j=0;j<h.length;j++){var k=h[j];if(k instanceof b?(a.uniforms["pointLight"+j]=[k.translation.data[0],k.translation.data[1],k.translation.data[2],k.range],a.uniforms["pointLightColor"+j]=[k.color.data[0]*k.intensity,k.color.data[1]*k.intensity,k.color.data[2]*k.intensity,k.specularIntensity],i.push("P")):k instanceof c?(a.uniforms["directionalLightDirection"+j]=[k.direction.data[0],k.direction.data[1],k.direction.data[2]],a.uniforms["directionalLightColor"+j]=[k.color.data[0]*k.intensity,k.color.data[1]*k.intensity,k.color.data[2]*k.intensity,k.specularIntensity],i.push("D")):k instanceof d&&(a.uniforms["spotLight"+j]=[k.translation.data[0],k.translation.data[1],k.translation.data[2],k.range],a.uniforms["spotLightColor"+j]=[k.color.data[0]*k.intensity,k.color.data[1]*k.intensity,k.color.data[2]*k.intensity,k.specularIntensity],a.uniforms["spotLightDirection"+j]=[k.direction.data[0],k.direction.data[1],k.direction.data[2]],a.uniforms["spotLightAngle"+j]=Math.cos(k.angle*e.DEG_TO_RAD/2),a.uniforms["spotLightPenumbra"+j]=void 0!==k.penumbra?Math.sin(k.penumbra*e.DEG_TO_RAD/4):0,i.push("S")),k.shadowCaster&&f.renderable.meshRendererComponent&&f.renderable.meshRendererComponent.receiveShadows&&k.shadowSettings.shadowData){var l=k.shadowSettings.shadowData;a.uniforms["shadowMaps"+j]="SHADOW_MAP"+j,f.material.setTexture("SHADOW_MAP"+j,l.shadowResult);for(var m=l.lightCamera.getViewProjectionMatrix().data,n=a.uniforms["shadowLightMatrices"+j]=a.uniforms["shadowLightMatrices"+j]||[],o=0;16>o;o++)n[o]=m[o];var p=l.lightCamera.translation.data,q=a.uniforms["shadowLightPositions"+j]=a.uniforms["shadowLightPositions"+j]||[];if(q[0]=p[0],q[1]=p[1],q[2]=p[2],a.uniforms["cameraScales"+j]=1/(l.lightCamera.far-l.lightCamera.near),a.uniforms["shadowDarkness"+j]=k.shadowSettings.darkness,"PCF"===k.shadowSettings.shadowType){var r=a.uniforms["shadowMapSizes"+j]=a.uniforms["shadowMapSizes"+j]||[];r[0]=k.shadowSettings.resolution[0],r[1]=k.shadowSettings.resolution[1]}i.push("H","PCF"===k.shadowSettings.shadowType?1:"VSM"===k.shadowSettings.shadowType?2:0)}}a.defines=a.defines||{},a.defines.LIGHT=i.join("")},builder:function(a,e){var f=[],h=[],i=[],j=[];f.push("const mat4 ScaleMatrix = mat4(0.5, 0.0, 0.0, 0.0, 0.0, 0.5, 0.0, 0.0, 0.0, 0.0, 0.5, 0.0, 0.5, 0.5, 0.5, 1.0);"),i.push("uniform vec4 materialAmbient;","uniform vec4 materialEmissive;","uniform vec4 materialDiffuse;","uniform vec4 materialSpecular;","uniform float materialSpecularPower;","uniform vec3 globalAmbient;","float ChebychevInequality(in vec2 moments, in float t) {","if ( t <= moments.x ) return 1.0;","float variance = moments.y - (moments.x * moments.x);","variance = max(variance, 0.02);","float d = t - moments.x;","return variance / (variance + d * d);","}"),j.push("#if defined(SPECULAR_MAP) && defined(TEXCOORD0)","float specularStrength = texture2D(specularMap, texCoord0).x;","#else","float specularStrength = 1.0;","#endif","vec3 totalDiffuse = vec3(0.0);","vec3 totalSpecular = vec3(0.0);");for(var k=e.lights,l=0;l<k.length;l++){var m=k[l];j.push("{","float shadow = 1.0;"),(m.shadowCaster||m.lightCookie)&&(f.push("uniform mat4 shadowLightMatrices"+l+";","varying vec4 shadowLightDepths"+l+";"),h.push("shadowLightDepths"+l+" = ScaleMatrix * shadowLightMatrices"+l+" * worldPos;"),m.shadowCaster&&i.push("uniform sampler2D shadowMaps"+l+";","uniform vec3 shadowLightPositions"+l+";","uniform float cameraScales"+l+";","uniform float shadowDarkness"+l+";"),m.lightCookie&&i.push("uniform sampler2D lightCookie"+l+";"),i.push("varying vec4 shadowLightDepths"+l+";"),"PCF"===m.shadowSettings.shadowType&&i.push("uniform vec2 shadowMapSizes"+l+";"),j.push("vec3 depth = shadowLightDepths"+l+".xyz / shadowLightDepths"+l+".w;","depth.z = length(vWorldPos.xyz - shadowLightPositions"+l+") * cameraScales"+l+";","if (depth.x >= 0.0 && depth.x <= 1.0 && depth.y >= 0.0 && depth.y <= 1.0 && shadowLightDepths"+l+".z >= 0.0 && depth.z <= 1.0) {"),"PCF"===m.shadowSettings.shadowType?j.push("depth.z *= 0.96;","float shadowPcf = 0.0;","const float shadowDelta = 1.0 / 9.0;","float xPixelOffset = 1.0 / shadowMapSizes"+l+".x;","float yPixelOffset = 1.0 / shadowMapSizes"+l+".y;","float dx0 = -1.25 * xPixelOffset;","float dy0 = -1.25 * yPixelOffset;","float dx1 = 1.25 * xPixelOffset;","float dy1 = 1.25 * yPixelOffset;","float fDepth = 0.0;","fDepth = texture2D(shadowMaps"+l+", depth.xy + vec2(dx0, dy0)).r;","if (fDepth < depth.z) shadowPcf += shadowDelta;","fDepth = texture2D(shadowMaps"+l+", depth.xy + vec2(0.0, dy0)).r;","if (fDepth < depth.z) shadowPcf += shadowDelta;","fDepth = texture2D(shadowMaps"+l+", depth.xy + vec2(dx1, dy0)).r;","if (fDepth < depth.z) shadowPcf += shadowDelta;","fDepth = texture2D(shadowMaps"+l+", depth.xy + vec2(dx0, 0.0)).r;","if (fDepth < depth.z) shadowPcf += shadowDelta;","fDepth =  texture2D(shadowMaps"+l+", depth.xy).r;","if (fDepth < depth.z) shadowPcf += shadowDelta;","fDepth = texture2D(shadowMaps"+l+", depth.xy + vec2(dx1, 0.0)).r;","if (fDepth < depth.z) shadowPcf += shadowDelta;","fDepth = texture2D(shadowMaps"+l+", depth.xy + vec2(dx0, dy1)).r;","if (fDepth < depth.z) shadowPcf += shadowDelta;","fDepth = texture2D(shadowMaps"+l+", depth.xy + vec2(0.0, dy1)).r;","if (fDepth < depth.z) shadowPcf += shadowDelta;","fDepth = texture2D(shadowMaps"+l+", depth.xy + vec2(dx1, dy1)).r;","if (fDepth < depth.z) shadowPcf += shadowDelta;","shadow = (1.0 - shadowPcf) * (1.0 - shadowDarkness"+l+") + shadowDarkness"+l+";"):"VSM"===m.shadowSettings.shadowType?j.push("vec4 texel = texture2D(shadowMaps"+l+", depth.xy);","vec2 moments = vec2(texel.x, texel.y);","shadow = ChebychevInequality(moments, depth.z);","shadow = pow(shadow, 8.0 - shadowDarkness"+l+" * 8.0);"):j.push("depth.z *= 0.96;","float shadowDepth = texture2D(shadowMaps"+l+", depth.xy).x;","if ( depth.z > shadowDepth ) shadow = shadowDarkness"+l+";"),j.push("}","shadow = clamp(shadow, 0.0, 1.0);")),m instanceof b?(i.push("uniform vec4 pointLight"+l+";","uniform vec4 pointLightColor"+l+";"),j.push("vec3 lVector = normalize(pointLight"+l+".xyz - vWorldPos.xyz);","float lDistance = 1.0 - min((length(pointLight"+l+".xyz - vWorldPos.xyz) / pointLight"+l+".w), 1.0);","float dotProduct = dot(N, lVector);","#ifdef WRAP_AROUND","float pointDiffuseWeightFull = max(dotProduct, 0.0);","float pointDiffuseWeightHalf = max(0.5 * dotProduct + 0.5, 0.0);","vec3 pointDiffuseWeight = mix(vec3(pointDiffuseWeightFull), vec3(pointDiffuseWeightHalf), wrapRGB);","#else","float pointDiffuseWeight = max(dotProduct, 0.0);","#endif","totalDiffuse += materialDiffuse.rgb * pointLightColor"+l+".rgb * pointDiffuseWeight * lDistance * shadow;","vec3 pointHalfVector = normalize(lVector + normalize(viewPosition));","float pointDotNormalHalf = max(dot(N, pointHalfVector), 0.0);","float pointSpecularWeight = pointLightColor"+l+".a * specularStrength * max(pow(pointDotNormalHalf, materialSpecularPower), 0.0);","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = (materialSpecularPower + 2.0001 ) / 8.0;","vec3 schlick = materialSpecular.rgb + vec3(1.0 - materialSpecular.rgb) * pow(1.0 - dot(lVector, pointHalfVector), 5.0);","totalSpecular += schlick * pointLightColor"+l+".rgb * pointSpecularWeight * pointDiffuseWeight * lDistance * specularNormalization * shadow;","#else","totalSpecular += materialSpecular.rgb * pointLightColor"+l+".rgb * pointSpecularWeight * pointDiffuseWeight * lDistance * shadow;","#endif")):m instanceof c?(i.push("uniform vec4 directionalLightColor"+l+";","uniform vec3 directionalLightDirection"+l+";"),j.push("vec4 lDirection = vec4(-directionalLightDirection"+l+", 0.0);","vec3 dirVector = normalize(lDirection.xyz);","float dotProduct = dot(N, dirVector);","#ifdef WRAP_AROUND","float dirDiffuseWeightFull = max(dotProduct, 0.0);","float dirDiffuseWeightHalf = max(0.5 * dotProduct + 0.5, 0.0);","vec3 dirDiffuseWeight = mix(vec3(dirDiffuseWeightFull), vec3(dirDiffuseWeightHalf), wrapRGB);","#else","float dirDiffuseWeight = max(dotProduct, 0.0);","#endif","totalDiffuse += materialDiffuse.rgb * directionalLightColor"+l+".rgb * dirDiffuseWeight * shadow;","vec3 dirHalfVector = normalize(dirVector + normalize(viewPosition));","float dirDotNormalHalf = max(dot(N, dirHalfVector), 0.0);","float dirSpecularWeight = directionalLightColor"+l+".a * specularStrength * max(pow(dirDotNormalHalf, materialSpecularPower), 0.0);","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = (materialSpecularPower + 2.0001) / 8.0;","vec3 schlick = materialSpecular.rgb + vec3(1.0 - materialSpecular.rgb) * pow(1.0 - dot(dirVector, dirHalfVector), 5.0);","totalSpecular += schlick * directionalLightColor"+l+".rgb * dirSpecularWeight * dirDiffuseWeight * specularNormalization * shadow;","#else","totalSpecular += materialSpecular.rgb * directionalLightColor"+l+".rgb * dirSpecularWeight * dirDiffuseWeight * shadow;","#endif")):m instanceof d&&(i.push("uniform vec4 spotLightColor"+l+";","uniform vec4 spotLight"+l+";","uniform vec3 spotLightDirection"+l+";","uniform float spotLightAngle"+l+";","uniform float spotLightPenumbra"+l+";"),j.push("vec3 lVector = normalize(spotLight"+l+".xyz - vWorldPos.xyz);","float lDistance = 1.0 - min((length(spotLight"+l+".xyz - vWorldPos.xyz) / spotLight"+l+".w), 1.0);","float spotEffect = dot(normalize(-spotLightDirection"+l+"), lVector);","if (spotEffect > spotLightAngle"+l+") {","if (spotLightPenumbra"+l+" > 0.0) {","spotEffect = (spotEffect - spotLightAngle"+l+") / spotLightPenumbra"+l+";","spotEffect = clamp(spotEffect, 0.0, 1.0);","} else {","spotEffect = 1.0;","}","float dotProduct = dot(N, lVector);","#ifdef WRAP_AROUND","float spotDiffuseWeightFull = max(dotProduct, 0.0);","float spotDiffuseWeightHalf = max(0.5 * dotProduct + 0.5, 0.0);","vec3 spotDiffuseWeight = mix(vec3(spotDiffuseWeightFull), vec3(spotDiffuseWeightHalf), wrapRGB);","#else","float spotDiffuseWeight = max(dotProduct, 0.0);","#endif","totalDiffuse += materialDiffuse.rgb * spotLightColor"+l+".rgb * spotDiffuseWeight * lDistance * spotEffect * shadow;","vec3 spotHalfVector = normalize(lVector + normalize(viewPosition));","float spotDotNormalHalf = max(dot(N, spotHalfVector), 0.0);","float spotSpecularWeight = spotLightColor"+l+".a * specularStrength * max(pow(spotDotNormalHalf, materialSpecularPower), 0.0);","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = (materialSpecularPower + 2.0001) / 8.0;","vec3 schlick = materialSpecular.rgb + vec3(1.0 - materialSpecular.rgb) * pow(1.0 - dot(lVector, spotHalfVector), 5.0);","totalSpecular += schlick * spotLightColor"+l+".rgb * spotSpecularWeight * spotDiffuseWeight * lDistance * specularNormalization * spotEffect * shadow;","#else","totalSpecular += materialSpecular.rgb * spotLightColor"+l+".rgb * spotSpecularWeight * spotDiffuseWeight * lDistance * spotEffect * shadow;","#endif","}")),j.push("}")}j.push("#if defined(EMISSIVE_MAP) && defined(TEXCOORD0)","vec3 emissive = vec3(0.0);","#else","vec3 emissive = materialEmissive.rgb;","#endif","#ifdef SKIP_SPECULAR","final_color.xyz = final_color.xyz * (emissive + totalDiffuse + globalAmbient + materialAmbient.rgb);","#else","final_color.xyz = final_color.xyz * (emissive + totalDiffuse + globalAmbient + materialAmbient.rgb) + totalSpecular;","#endif","#if defined(EMISSIVE_MAP) && defined(TEXCOORD0)","final_color.rgb += texture2D(emissiveMap, texCoord0).rgb * materialEmissive.rgb;","#endif"),g.light.prevertex=f.join("\n"),g.light.vertex=h.join("\n"),g.light.prefragment=i.join("\n"),g.light.fragment=j.join("\n")}},g.animation={processor:function(a,b){var c=b.currentPose;a.defines=a.defines||{},c?(a.uniforms.jointPalette||(a.uniforms.jointPalette=g.animation.jointPalette),a.defines.JOINT_COUNT=Math.max(3*b.meshData.paletteMap.length,80)):delete a.defines.JOINT_COUNT},jointPalette:function(a){var b=a.meshData,c=a.currentPose;if(c){var d=c._matrixPalette,e=b.store;e||(e=new Float32Array(12*b.paletteMap.length),b.store=e);for(var f,h=0;h<b.paletteMap.length;h++){f=d[b.paletteMap[h]];for(var i=0;12>i;i++)e[12*h+i]=f.data[g.animation.order[i]]}return e}},order:[0,4,8,12,1,5,9,13,2,6,10,14],prevertex:["#ifdef JOINTIDS","attribute vec4 vertexJointIDs;","#endif","#ifdef WEIGHTS","attribute vec4 vertexWeights;","#endif","#ifdef JOINT_COUNT","uniform vec4 jointPalette[JOINT_COUNT];","#endif"].join("\n"),vertex:["#if defined(JOINT_COUNT) && defined(WEIGHTS) && defined(JOINTIDS)","int x = 3*int(vertexJointIDs.x);","int y = 3*int(vertexJointIDs.y);","int z = 3*int(vertexJointIDs.z);","int w = 3*int(vertexJointIDs.w);","mat4 mat = mat4(0.0);","mat += mat4(","	jointPalette[x+0].x, jointPalette[x+1].x, jointPalette[x+2].x, 0,","	jointPalette[x+0].y, jointPalette[x+1].y, jointPalette[x+2].y, 0,","	jointPalette[x+0].z, jointPalette[x+1].z, jointPalette[x+2].z, 0,","	jointPalette[x+0].w, jointPalette[x+1].w, jointPalette[x+2].w, 1",") * vertexWeights.x;","mat += mat4(","	jointPalette[y+0].x, jointPalette[y+1].x, jointPalette[y+2].x, 0,","	jointPalette[y+0].y, jointPalette[y+1].y, jointPalette[y+2].y, 0,","	jointPalette[y+0].z, jointPalette[y+1].z, jointPalette[y+2].z, 0,","	jointPalette[y+0].w, jointPalette[y+1].w, jointPalette[y+2].w, 1",") * vertexWeights.y;","mat += mat4(","	jointPalette[z+0].x, jointPalette[z+1].x, jointPalette[z+2].x, 0,","	jointPalette[z+0].y, jointPalette[z+1].y, jointPalette[z+2].y, 0,","	jointPalette[z+0].z, jointPalette[z+1].z, jointPalette[z+2].z, 0,","	jointPalette[z+0].w, jointPalette[z+1].w, jointPalette[z+2].w, 1",") * vertexWeights.z;","mat += mat4(","	jointPalette[w+0].x, jointPalette[w+1].x, jointPalette[w+2].x, 0,","	jointPalette[w+0].y, jointPalette[w+1].y, jointPalette[w+2].y, 0,","	jointPalette[w+0].z, jointPalette[w+1].z, jointPalette[w+2].z, 0,","	jointPalette[w+0].w, jointPalette[w+1].w, jointPalette[w+2].w, 1",") * vertexWeights.w;","wMatrix = wMatrix * mat / mat[3][3];","#ifdef NORMAL","nMatrix = nMatrix * mat / mat[3][3];","#endif","#endif"].join("\n")},g}),define("goo/renderer/shaders/ShaderLib",["goo/renderer/MeshData","goo/renderer/Shader","goo/renderer/shaders/ShaderFragment","goo/renderer/shaders/ShaderBuilder","goo/renderer/Util","goo/entities/World"],function(a,b,c,d,e,f){"use strict";function g(){}return g.uber={processors:[d.uber.processor,d.light.processor,d.animation.processor],attributes:{vertexPosition:a.POSITION,vertexNormal:a.NORMAL,vertexTangent:a.TANGENT,vertexColor:a.COLOR,vertexUV0:a.TEXCOORD0,vertexUV1:a.TEXCOORD1,vertexJointIDs:a.JOINTIDS,vertexWeights:a.WEIGHTS},uniforms:{viewProjectionMatrix:b.VIEW_PROJECTION_MATRIX,worldMatrix:b.WORLD_MATRIX,normalMatrix:b.NORMAL_MATRIX,cameraPosition:b.CAMERA,diffuseMap:b.DIFFUSE_MAP,offsetRepeat:[0,0,1,1],normalMap:b.NORMAL_MAP,normalMultiplier:1,specularMap:b.SPECULAR_MAP,emissiveMap:b.EMISSIVE_MAP,aoMap:b.AO_MAP,lightMap:b.LIGHT_MAP,environmentCube:"ENVIRONMENT_CUBE",environmentSphere:"ENVIRONMENT_SPHERE",reflectionMap:"REFLECTION_MAP",transparencyMap:"TRANSPARENCY_MAP",opacity:1,reflectivity:0,fresnel:0,discardThreshold:-.01,fogSettings:[0,1e4],fogColor:[1,1,1],shadowDarkness:.5},builder:function(a,b){d.light.builder(a,b)},vshader:function(){return["attribute vec3 vertexPosition;","#ifdef NORMAL","attribute vec3 vertexNormal;","#endif","#ifdef TANGENT","attribute vec4 vertexTangent;","#endif","#ifdef COLOR","attribute vec4 vertexColor;","#endif","#ifdef TEXCOORD0","attribute vec2 vertexUV0;","uniform vec4 offsetRepeat;","varying vec2 texCoord0;","#endif","#ifdef TEXCOORD1","attribute vec2 vertexUV1;","varying vec2 texCoord1;","#endif","uniform mat4 viewProjectionMatrix;","uniform mat4 worldMatrix;","uniform mat4 normalMatrix;","uniform vec3 cameraPosition;","varying vec3 vWorldPos;","varying vec3 viewPosition;","#ifdef NORMAL","varying vec3 normal;","#endif","#ifdef TANGENT","varying vec3 binormal;","varying vec3 tangent;","#endif","#ifdef COLOR","varying vec4 color;","#endif",d.light.prevertex,d.animation.prevertex,"void main(void) {","mat4 wMatrix = worldMatrix;","#ifdef NORMAL","mat4 nMatrix = normalMatrix;","#endif",d.animation.vertex,"vec4 worldPos = wMatrix * vec4(vertexPosition, 1.0);","vWorldPos = worldPos.xyz;","gl_Position = viewProjectionMatrix * worldPos;","viewPosition = cameraPosition - worldPos.xyz;","#ifdef NORMAL","	normal = normalize((nMatrix * vec4(vertexNormal, 0.0)).xyz);","#endif","#ifdef TANGENT","	tangent = normalize((nMatrix * vec4(vertexTangent.xyz, 0.0)).xyz);","	binormal = cross(normal, tangent) * vec3(vertexTangent.w);","#endif","#ifdef COLOR","	color = vertexColor;","#endif","#ifdef TEXCOORD0","	texCoord0 = vertexUV0 * offsetRepeat.zw + offsetRepeat.xy;","#endif","#ifdef TEXCOORD1","	texCoord1 = vertexUV1;","#endif",d.light.vertex,"}"].join("\n")},fshader:function(){return["#ifdef DIFFUSE_MAP","uniform sampler2D diffuseMap;","#endif","#ifdef NORMAL_MAP","uniform sampler2D normalMap;","uniform float normalMultiplier;","#endif","#ifdef SPECULAR_MAP","uniform sampler2D specularMap;","#endif","#ifdef EMISSIVE_MAP","uniform sampler2D emissiveMap;","#endif","#ifdef AO_MAP","uniform sampler2D aoMap;","#endif","#ifdef LIGHT_MAP","uniform sampler2D lightMap;","#endif","#ifdef TRANSPARENCY_MAP","uniform sampler2D transparencyMap;","#endif","#if defined(ENVIRONMENT_CUBE) || defined(ENVIRONMENT_SPHERE)","#ifndef ENVIRONMENT_TYPE","#define ENVIRONMENT_TYPE 0","#endif","#ifdef ENVIRONMENT_CUBE","uniform samplerCube environmentCube;","#else","uniform sampler2D environmentSphere;","#endif","uniform float reflectivity;","uniform float fresnel;","#ifdef REFLECTION_MAP","uniform sampler2D reflectionMap;","#endif","#endif","uniform float opacity;","#ifdef DISCARD","uniform float discardThreshold;","#endif","#ifdef FOG","uniform vec2 fogSettings;","uniform vec3 fogColor;","#endif","varying vec3 vWorldPos;","varying vec3 viewPosition;","#ifdef NORMAL","varying vec3 normal;","#endif","#ifdef TANGENT","varying vec3 binormal;","varying vec3 tangent;","#endif","#ifdef COLOR","varying vec4 color;","#endif","#ifdef TEXCOORD0","varying vec2 texCoord0;","#endif","#ifdef TEXCOORD1","varying vec2 texCoord1; //Use for lightmap","#endif",d.light.prefragment,"void main(void)","{","vec4 final_color = vec4(1.0);","#if defined(DIFFUSE_MAP) && defined(TEXCOORD0)","final_color *= texture2D(diffuseMap, texCoord0);","#endif","#ifdef COLOR","final_color *= color;","#endif","#if defined(TRANSPARENCY_MAP) && defined(TEXCOORD0)","final_color.a *= texture2D(transparencyMap, texCoord0).r;","#endif","final_color.a *= opacity;","#ifdef DISCARD","if (final_color.a < discardThreshold) discard;","#endif","#ifdef AO_MAP","#ifdef TEXCOORD1","final_color.rgb *= texture2D(aoMap, texCoord1).rgb;","#elif TEXCOORD0","final_color.rgb *= texture2D(aoMap, texCoord0).rgb;","#endif","#endif","#ifdef LIGHT_MAP","#ifdef TEXCOORD1","final_color.rgb *= texture2D(lightMap, texCoord1).rgb * 2.0 - 0.5;","#elif TEXCOORD0","final_color.rgb *= texture2D(lightMap, texCoord0).rgb * 2.0 - 0.5;","#endif","#else","#if defined(TANGENT) && defined(NORMAL_MAP) && defined(TEXCOORD0)","mat3 tangentToWorld = mat3(tangent, binormal, normal);","vec3 tangentNormal = texture2D(normalMap, texCoord0).xyz * vec3(2.0) - vec3(1.0);","tangentNormal.xy *= normalMultiplier;","vec3 worldNormal = (tangentToWorld * tangentNormal);","vec3 N = normalize(worldNormal);","#elif defined(NORMAL)","vec3 N = normalize(normal);","#else","vec3 N = vec3(0.0, 1.0, 0.0);","#endif",d.light.fragment,"#endif","#if defined(ENVIRONMENT_CUBE) || defined(ENVIRONMENT_SPHERE)","vec3 reflectionVector = reflect(viewPosition, N);","reflectionVector.yz = -reflectionVector.yz;","#ifdef ENVIRONMENT_CUBE","vec4 environment = textureCube(environmentCube, reflectionVector);","#else","#if ENVIRONMENT_TYPE == 0","reflectionVector = -reflectionVector;","float m = 4.0 * sqrt(reflectionVector.x*reflectionVector.x + reflectionVector.y*reflectionVector.y + (reflectionVector.z+1.0)*(reflectionVector.z+1.0));","vec4 environment = texture2D(environmentSphere, (reflectionVector.xy / m) + 0.5);","#else","reflectionVector.xyz = vec3(-reflectionVector.z, -reflectionVector.y, reflectionVector.x);","vec2 index;","index.y = dot(normalize(reflectionVector), vec3(0.0,1.0,0.0));","reflectionVector.y = 0.0;","index.x = dot(normalize(reflectionVector), vec3(1.0,0.0,0.0)) * 0.5;","if (reflectionVector.z >= 0.0) {","index = (index + 1.0) * 0.5;","} else {","index.t = (index.t + 1.0) * 0.5;","index.s = (-index.s) * 0.5 + 1.0;","}","vec4 environment = texture2D(environmentSphere, index);","#endif","#endif","float reflectionAmount = reflectivity;","#if defined(REFLECTION_MAP) && defined(TEXCOORD0)","reflectionAmount *= texture2D(reflectionMap, texCoord0).r;","#endif","float fresnelVal = pow(1.0 - abs(dot(normalize(viewPosition), N)), fresnel * 4.0);","reflectionAmount *= fresnelVal;","final_color = mix(final_color, environment, reflectionAmount);","#endif","#ifndef LIGHT_MAP","final_color.rgb += totalSpecular;","final_color.a += min(length(totalSpecular), 1.0);","#endif","#ifdef FOG","float d = pow(smoothstep(fogSettings.x, fogSettings.y, length(viewPosition)), 1.0);","final_color.rgb = mix(final_color.rgb, fogColor, d);","#endif","gl_FragColor = final_color;","}"].join("\n")}},g.screenCopy={attributes:{vertexPosition:a.POSITION,vertexUV0:a.TEXCOORD0},uniforms:{diffuseMap:b.DIFFUSE_MAP},vshader:["attribute vec3 vertexPosition;","attribute vec2 vertexUV0;","varying vec2 texCoord0;","void main(void) {","	texCoord0 = vertexUV0;","	gl_Position = vec4(vertexPosition, 1.0);","}"].join("\n"),fshader:["uniform sampler2D diffuseMap;","varying vec2 texCoord0;","void main(void)","{","	gl_FragColor = texture2D(diffuseMap, texCoord0);","}"].join("\n")},g.copy={attributes:{vertexPosition:a.POSITION,vertexUV0:a.TEXCOORD0},uniforms:{viewProjectionMatrix:b.VIEW_PROJECTION_MATRIX,worldMatrix:b.WORLD_MATRIX,opacity:1,diffuseMap:b.DIFFUSE_MAP},vshader:["attribute vec3 vertexPosition;","attribute vec2 vertexUV0;","uniform mat4 viewProjectionMatrix;","uniform mat4 worldMatrix;","varying vec2 texCoord0;","void main(void) {","	texCoord0 = vertexUV0;","	gl_Position = viewProjectionMatrix * worldMatrix * vec4(vertexPosition, 1.0);","}"].join("\n"),fshader:["uniform sampler2D diffuseMap;","uniform float opacity;","varying vec2 texCoord0;","void main(void)","{","	gl_FragColor = vec4(texture2D(diffuseMap, texCoord0).rgb, opacity);","}"].join("\n")},g.copyPure={attributes:{vertexPosition:a.POSITION,vertexUV0:a.TEXCOORD0},uniforms:{viewProjectionMatrix:b.VIEW_PROJECTION_MATRIX,worldMatrix:b.WORLD_MATRIX,opacity:1,diffuseMap:b.DIFFUSE_MAP},vshader:["attribute vec3 vertexPosition;","attribute vec2 vertexUV0;","uniform mat4 viewProjectionMatrix;","uniform mat4 worldMatrix;","varying vec2 texCoord0;","void main(void) {","	texCoord0 = vertexUV0;","	gl_Position = viewProjectionMatrix * worldMatrix * vec4(vertexPosition, 1.0);","}"].join("\n"),fshader:["uniform sampler2D diffuseMap;","uniform float opacity;","varying vec2 texCoord0;","void main(void)","{","	vec4 col = texture2D(diffuseMap, texCoord0);","	gl_FragColor = vec4(col.rgb, col.a * opacity);","}"].join("\n")},g.simple={attributes:{vertexPosition:a.POSITION},uniforms:{viewProjectionMatrix:b.VIEW_PROJECTION_MATRIX,worldMatrix:b.WORLD_MATRIX},vshader:["attribute vec3 vertexPosition;","uniform mat4 viewProjectionMatrix;","uniform mat4 worldMatrix;","void main(void) {","	gl_Position = viewProjectionMatrix * worldMatrix * vec4(vertexPosition, 1.0);","}"].join("\n"),fshader:["void main(void)","{","	gl_FragColor = vec4(1.0);","}"].join("\n")},g.simpleColored={attributes:{vertexPosition:a.POSITION},uniforms:{viewProjectionMatrix:b.VIEW_PROJECTION_MATRIX,worldMatrix:b.WORLD_MATRIX,color:[1,1,1],opacity:1},vshader:["attribute vec3 vertexPosition;","uniform mat4 viewProjectionMatrix;","uniform mat4 worldMatrix;","void main(void) {","	gl_Position = viewProjectionMatrix * worldMatrix * vec4(vertexPosition, 1.0);","}"].join("\n"),fshader:["uniform vec3 color;","uniform float opacity;","void main(void)","{","	if (opacity == 0.0) {","		discard;","	}","	gl_FragColor = vec4(color, opacity);","}"].join("\n")},g.simpleLit={processors:[d.light.processor],defines:{NORMAL:!0},attributes:{vertexPosition:a.POSITION,vertexNormal:a.NORMAL},uniforms:{viewProjectionMatrix:b.VIEW_PROJECTION_MATRIX,worldMatrix:b.WORLD_MATRIX,cameraPosition:b.CAMERA,opacity:1},builder:function(a,b){d.light.builder(a,b)},vshader:function(){return["attribute vec3 vertexPosition;","attribute vec3 vertexNormal;","uniform mat4 viewProjectionMatrix;","uniform mat4 worldMatrix;","uniform vec3 cameraPosition;",d.light.prevertex,"varying vec3 normal;","varying vec3 vWorldPos;","varying vec3 viewPosition;","void main(void) {","	vec4 worldPos = worldMatrix * vec4(vertexPosition, 1.0);"," vWorldPos = worldPos.xyz;","	gl_Position = viewProjectionMatrix * worldPos;",d.light.vertex,"	normal = (worldMatrix * vec4(vertexNormal, 0.0)).xyz;","	viewPosition = cameraPosition - worldPos.xyz;","}"].join("\n")},fshader:function(){return["#ifdef SPECULAR_MAP","uniform sampler2D specularMap;","#ifdef TEXCOORD0","varying vec2 texCoord0;","#endif","#endif","uniform float opacity;",d.light.prefragment,"#ifdef NORMAL","varying vec3 normal;","#endif","varying vec3 vWorldPos;","varying vec3 viewPosition;","void main(void)","{"," if (opacity == 0.0) {","	discard;","	return;"," }"," #ifdef NORMAL","	vec3 N = normalize(normal);"," #else"," vec3 N = vec3(0,0,1);"," #endif","	vec4 final_color = vec4(1.0);",d.light.fragment,"	final_color.a = opacity;","	gl_FragColor = final_color;","}"].join("\n")}},g.billboard={attributes:{vertexPosition:a.POSITION,vertexUV0:a.TEXCOORD0},uniforms:{viewProjectionMatrix:b.VIEW_PROJECTION_MATRIX,projectionMatrix:b.PROJECTION_MATRIX,viewMatrix:b.VIEW_MATRIX,worldMatrix:b.WORLD_MATRIX,diffuseMap:b.DIFFUSE_MAP},vshader:["attribute vec3 vertexPosition;","attribute vec2 vertexUV0;","uniform mat4 viewProjectionMatrix;","uniform mat4 worldMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","varying vec2 texCoord0;","void main(void) {","	texCoord0 = vertexUV0;","	gl_Position = viewProjectionMatrix * worldMatrix * vec4(0.0, 0.0, 0.0, 1.0) + projectionMatrix * vec4(vertexPosition.x, vertexPosition.y, 0.0, 0.0);","}"].join("\n"),fshader:["uniform sampler2D diffuseMap;","varying vec2 texCoord0;","void main(void)","{","	gl_FragColor = texture2D(diffuseMap, texCoord0);","}"].join("\n")},g.textured={defines:{TEXCOORD0:!0,DIFFUSE_MAP:!0},attributes:{vertexPosition:a.POSITION,vertexUV0:a.TEXCOORD0},uniforms:{viewProjectionMatrix:b.VIEW_PROJECTION_MATRIX,worldMatrix:b.WORLD_MATRIX,diffuseMap:b.DIFFUSE_MAP},vshader:["attribute vec3 vertexPosition;","attribute vec2 vertexUV0;","uniform mat4 viewProjectionMatrix;","uniform mat4 worldMatrix;","varying vec2 texCoord0;","void main(void) {","	texCoord0 = vertexUV0;","	gl_Position = viewProjectionMatrix * worldMatrix * vec4(vertexPosition, 1.0);","}"].join("\n"),fshader:["#if defined(TEXCOORD0) && defined(DIFFUSE_MAP)","uniform sampler2D diffuseMap;","varying vec2 texCoord0;","#endif","void main(void)","{"," #if defined(TEXCOORD0) && defined(DIFFUSE_MAP)","	gl_FragColor = texture2D(diffuseMap, texCoord0);"," #else"," gl_FragColor = vec4(1.0);"," #endif","}"].join("\n")},g.texturedLit={processors:[d.light.processor],attributes:{vertexPosition:a.POSITION,vertexNormal:a.NORMAL,vertexUV0:a.TEXCOORD0},uniforms:{viewProjectionMatrix:b.VIEW_PROJECTION_MATRIX,worldMatrix:b.WORLD_MATRIX,cameraPosition:b.CAMERA,diffuseMap:b.DIFFUSE_MAP},builder:function(a,b){d.light.builder(a,b)
},vshader:function(){return["attribute vec3 vertexPosition;","attribute vec3 vertexNormal;","attribute vec2 vertexUV0;","uniform mat4 viewProjectionMatrix;","uniform mat4 worldMatrix;","uniform vec3 cameraPosition;",d.light.prevertex,"varying vec3 normal;","varying vec3 vWorldPos;","varying vec3 viewPosition;","varying vec2 texCoord0;","void main(void) {","	vec4 worldPos = worldMatrix * vec4(vertexPosition, 1.0);"," vWorldPos = worldPos.xyz;","	gl_Position = viewProjectionMatrix * worldPos;",d.light.vertex,"	normal = (worldMatrix * vec4(vertexNormal, 0.0)).xyz;","	texCoord0 = vertexUV0;","	viewPosition = cameraPosition - worldPos.xyz;","}"].join("\n")},fshader:function(){return["uniform sampler2D diffuseMap;",d.light.prefragment,"varying vec3 normal;","varying vec3 vWorldPos;","varying vec3 viewPosition;","varying vec2 texCoord0;","void main(void)","{","	vec3 N = normalize(normal);","	vec4 final_color = texture2D(diffuseMap, texCoord0);",d.light.fragment,"	gl_FragColor = final_color;","}"].join("\n")}},g.convolution={defines:{KERNEL_SIZE_FLOAT:"25.0",KERNEL_SIZE_INT:"25"},attributes:{position:a.POSITION,uv:a.TEXCOORD0},uniforms:{viewMatrix:b.VIEW_MATRIX,projectionMatrix:b.PROJECTION_MATRIX,worldMatrix:b.WORLD_MATRIX,tDiffuse:b.DIFFUSE_MAP,uImageIncrement:[.001953125,0],cKernel:[],size:1},vshader:["attribute vec3 position;","attribute vec2 uv;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 worldMatrix;","uniform float size;","uniform vec2 uImageIncrement;","varying vec2 vUv;","void main() {","	vUv = uv - ( ( KERNEL_SIZE_FLOAT - 1.0 ) / 2.0 ) * size * uImageIncrement;","	gl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( position, 1.0 );","}"].join("\n"),fshader:["uniform float cKernel[ KERNEL_SIZE_INT ];","uniform sampler2D tDiffuse;","uniform vec2 uImageIncrement;","uniform float size;","varying vec2 vUv;","void main() {","	vec2 imageCoord = vUv;","	vec4 sum = vec4( 0.0 );","	for( int i = 0; i < KERNEL_SIZE_INT; i ++ ) {","		sum += texture2D( tDiffuse, imageCoord ) * cKernel[ i ];","		imageCoord += uImageIncrement * size;","	}","	gl_FragColor = sum;","}"].join("\n"),buildKernel:function(a){function b(a,b){return Math.exp(-(a*a)/(2*b*b))}var c,d,e,f,g=25,h=2*Math.ceil(3*a)+1;for(h>g&&(h=g),f=.5*(h-1),d=new Array(h),e=0,c=0;h>c;++c)d[c]=b(c-f,a),e+=d[c];for(c=0;h>c;++c)d[c]/=e;return d}},g.showDepth={attributes:{vertexPosition:a.POSITION},uniforms:{viewMatrix:b.VIEW_MATRIX,projectionMatrix:b.PROJECTION_MATRIX,worldMatrix:b.WORLD_MATRIX,near:b.NEAR_PLANE,far:b.FAR_PLANE},vshader:["attribute vec3 vertexPosition;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 worldMatrix;","void main(void) {","	gl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4(vertexPosition, 1.0);","}"].join("\n"),fshader:["uniform float near;","uniform float far;","void main(void)","{","	float depth = gl_FragCoord.z / gl_FragCoord.w;","	float d = 1.0 - smoothstep( near, far, depth );","	gl_FragColor = vec4(d);","}"].join("\n")},g.showNormals={defines:{NORMAL:!0},attributes:{vertexPosition:a.POSITION,vertexNormal:a.NORMAL},uniforms:{viewMatrix:b.VIEW_MATRIX,projectionMatrix:b.PROJECTION_MATRIX,viewProjectionMatrix:b.VIEW_PROJECTION_MATRIX,worldMatrix:b.WORLD_MATRIX,opacity:1},vshader:["attribute vec3 vertexPosition;","attribute vec3 vertexNormal;","uniform mat4 viewProjectionMatrix;","uniform mat4 worldMatrix;","varying vec3 normal;","void main() {","normal = vec3(worldMatrix * vec4(vertexNormal, 0.0));","gl_Position = viewProjectionMatrix * worldMatrix * vec4(vertexPosition, 1.0);","}"].join("\n"),fshader:["uniform float opacity;","#ifdef NORMAL","varying vec3 normal;","#else","vec3 normal = vec3(0,0,1);","#endif","void main() {","gl_FragColor = vec4( 0.5 * normalize( normal ) + 0.5, opacity );","}"].join("\n")},g.bokehShader={attributes:{position:a.POSITION,uv:a.TEXCOORD0},uniforms:{viewMatrix:b.VIEW_MATRIX,projectionMatrix:b.PROJECTION_MATRIX,worldMatrix:b.WORLD_MATRIX,tColor:b.DIFFUSE_MAP,tDepth:b.DEPTH_MAP,focus:1,aspect:1,aperture:.025,maxblur:1},vshader:["attribute vec3 position;","attribute vec2 uv;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 worldMatrix;","varying vec2 vUv;","void main() {","	vUv = uv;","	gl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( position, 1.0 );","}"].join("\n"),fshader:["varying vec2 vUv;","uniform sampler2D tColor;","uniform sampler2D tDepth;","uniform float maxblur;","uniform float aperture;","uniform float focus;","uniform float aspect;","void main() {","vec2 aspectcorrect = vec2( 1.0, aspect );","vec4 depth1 = texture2D( tDepth, vUv );","float factor = depth1.x - focus;","vec2 dofblur = vec2 ( clamp( factor * aperture, -maxblur, maxblur ) );","vec2 dofblur9 = dofblur * 0.9;","vec2 dofblur7 = dofblur * 0.7;","vec2 dofblur4 = dofblur * 0.4;","vec4 col = vec4( 0.0 );","col += texture2D( tColor, vUv.xy );","col += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.15,  0.37 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2( -0.37,  0.15 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.40,  0.0  ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.37, -0.15 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2( -0.15, -0.37 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2( -0.15,  0.37 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.37,  0.15 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2( -0.37, -0.15 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.15, -0.37 ) * aspectcorrect ) * dofblur );","col += texture2D( tColor, vUv.xy + ( vec2(  0.15,  0.37 ) * aspectcorrect ) * dofblur9 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.37,  0.15 ) * aspectcorrect ) * dofblur9 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.37, -0.15 ) * aspectcorrect ) * dofblur9 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.15, -0.37 ) * aspectcorrect ) * dofblur9 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.15,  0.37 ) * aspectcorrect ) * dofblur9 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.37,  0.15 ) * aspectcorrect ) * dofblur9 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.37, -0.15 ) * aspectcorrect ) * dofblur9 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.15, -0.37 ) * aspectcorrect ) * dofblur9 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur7 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.40,  0.0  ) * aspectcorrect ) * dofblur7 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur7 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur7 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur7 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur7 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur7 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur7 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur4 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.4,   0.0  ) * aspectcorrect ) * dofblur4 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur4 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur4 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur4 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur4 );","col += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur4 );","col += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur4 );","gl_FragColor = col / 41.0;","gl_FragColor.a = 1.0;","}"].join("\n")},g.particles={attributes:{vertexPosition:a.POSITION,vertexColor:a.COLOR,vertexUV0:a.TEXCOORD0},uniforms:{viewProjectionMatrix:b.VIEW_PROJECTION_MATRIX,worldMatrix:b.WORLD_MATRIX,diffuseMap:b.DIFFUSE_MAP},vshader:["attribute vec3 vertexPosition;","attribute vec4 vertexColor;","attribute vec2 vertexUV0;","uniform mat4 viewProjectionMatrix;","uniform mat4 worldMatrix;","varying vec2 texCoord0;","varying vec4 color;","void main(void) {","    texCoord0 = vertexUV0;","    color = vertexColor;","	 gl_Position = viewProjectionMatrix * worldMatrix * vec4(vertexPosition, 1.0);","}"].join("\n"),fshader:["uniform sampler2D diffuseMap;","varying vec2 texCoord0;","varying vec4 color;","void main(void)","{","	vec4 texCol = texture2D(diffuseMap, texCoord0);","   if (color.a == 0.0 || texCol.a == 0.0) discard;","	else gl_FragColor = texCol * color;","}"].join("\n")},g.sepia={attributes:{vertexPosition:a.POSITION,vertexUV0:a.TEXCOORD0},uniforms:{viewMatrix:b.VIEW_MATRIX,projectionMatrix:b.PROJECTION_MATRIX,worldMatrix:b.WORLD_MATRIX,tDiffuse:b.DIFFUSE_MAP,amount:1},vshader:["attribute vec3 vertexPosition;","attribute vec2 vertexUV0;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 worldMatrix;","varying vec2 vUv;","void main() {","vUv = vertexUV0;","gl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( vertexPosition, 1.0 );","}"].join("\n"),fshader:["uniform float amount;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 color = texture2D( tDiffuse, vUv );","vec3 c = color.rgb;","color.r = dot( c, vec3( 1.0 - 0.607 * amount, 0.769 * amount, 0.189 * amount ) );","color.g = dot( c, vec3( 0.349 * amount, 1.0 - 0.314 * amount, 0.168 * amount ) );","color.b = dot( c, vec3( 0.272 * amount, 0.534 * amount, 1.0 - 0.869 * amount ) );","gl_FragColor = vec4( min( vec3( 1.0 ), color.rgb ), color.a );","}"].join("\n")},g.dotscreen={attributes:{vertexPosition:a.POSITION,vertexUV0:a.TEXCOORD0},uniforms:{viewMatrix:b.VIEW_MATRIX,projectionMatrix:b.PROJECTION_MATRIX,worldMatrix:b.WORLD_MATRIX,tDiffuse:b.DIFFUSE_MAP,tSize:[256,256],center:[.5,.5],angle:1.57,scale:1},vshader:["attribute vec3 vertexPosition;","attribute vec2 vertexUV0;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 worldMatrix;","varying vec2 vUv;","void main() {","vUv = vertexUV0;","gl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( vertexPosition, 1.0 );","}"].join("\n"),fshader:["uniform vec2 center;","uniform float angle;","uniform float scale;","uniform vec2 tSize;","uniform sampler2D tDiffuse;","varying vec2 vUv;","float pattern() {","float s = sin( angle ), c = cos( angle );","vec2 tex = vUv * tSize - center;","vec2 point = vec2( c * tex.x - s * tex.y, s * tex.x + c * tex.y ) * scale;","return ( sin( point.x ) * sin( point.y ) ) * 4.0;","}","void main() {","vec4 color = texture2D( tDiffuse, vUv );","float average = ( color.r + color.g + color.b ) / 3.0;","gl_FragColor = vec4( vec3( average * 10.0 - 5.0 + pattern() ), color.a );","}"].join("\n")},g.vignette={attributes:{vertexPosition:a.POSITION,vertexUV0:a.TEXCOORD0},uniforms:{viewMatrix:b.VIEW_MATRIX,projectionMatrix:b.PROJECTION_MATRIX,worldMatrix:b.WORLD_MATRIX,tDiffuse:b.DIFFUSE_MAP,offset:1,darkness:1.5},vshader:["attribute vec3 vertexPosition;","attribute vec2 vertexUV0;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 worldMatrix;","varying vec2 vUv;","void main() {","vUv = vertexUV0;","gl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( vertexPosition, 1.0 );","}"].join("\n"),fshader:["uniform float offset;","uniform float darkness;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","vec2 uv = ( vUv - vec2( 0.5 ) ) * vec2( offset );","gl_FragColor = vec4( mix( texel.rgb, vec3( 1.0 - darkness ), dot( uv, uv ) ), texel.a );","}"].join("\n")},g.film={attributes:g.copy.attributes,uniforms:{tDiffuse:b.DIFFUSE_MAP,time:function(){return f.time},nIntensity:.5,sIntensity:.5,sCount:1024,grayscale:0,$link:g.copy.uniforms},vshader:g.copy.vshader,fshader:["uniform float time;","uniform bool grayscale;","uniform float nIntensity;","uniform float sIntensity;","uniform float sCount;","uniform sampler2D tDiffuse;","varying vec2 texCoord0;","void main() {","	vec4 cTextureScreen = texture2D( tDiffuse, texCoord0 );","	float x = texCoord0.x * texCoord0.y * time * 1000.0;","	x = mod( x, 13.0 ) * mod( x, 123.0 );","	float dx = mod( x, 0.01 );","	vec3 cResult = cTextureScreen.rgb + cTextureScreen.rgb * clamp( 0.1 + dx * 100.0, 0.0, 1.0 );","	vec2 sc = vec2( sin( texCoord0.y * sCount ), cos( texCoord0.y * sCount ) );","	cResult += cTextureScreen.rgb * vec3( sc.x, sc.y, sc.x ) * sIntensity;","	cResult = cTextureScreen.rgb + clamp( nIntensity, 0.0,1.0 ) * ( cResult - cTextureScreen.rgb );","	if( grayscale ) {","		cResult = vec3( cResult.r * 0.3 + cResult.g * 0.59 + cResult.b * 0.11 );","	}","	gl_FragColor = vec4( cResult, cTextureScreen.a );","}"].join("\n")},g.bleachbypass={attributes:{vertexPosition:a.POSITION,vertexUV0:a.TEXCOORD0},uniforms:{viewMatrix:b.VIEW_MATRIX,projectionMatrix:b.PROJECTION_MATRIX,worldMatrix:b.WORLD_MATRIX,tDiffuse:b.DIFFUSE_MAP,opacity:1},vshader:["attribute vec3 vertexPosition;","attribute vec2 vertexUV0;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 worldMatrix;","varying vec2 vUv;","void main() {","vUv = vertexUV0;","gl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( vertexPosition, 1.0 );","}"].join("\n"),fshader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 base = texture2D( tDiffuse, vUv );","vec3 lumCoeff = vec3( 0.25, 0.65, 0.1 );","float lum = dot( lumCoeff, base.rgb );","vec3 blend = vec3( lum );","float L = min( 1.0, max( 0.0, 10.0 * ( lum - 0.45 ) ) );","vec3 result1 = 2.0 * base.rgb * blend;","vec3 result2 = 1.0 - 2.0 * ( 1.0 - blend ) * ( 1.0 - base.rgb );","vec3 newColor = mix( result1, result2, L );","float A2 = opacity * base.a;","vec3 mixRGB = A2 * newColor.rgb;","mixRGB += ( ( 1.0 - A2 ) * base.rgb );","gl_FragColor = vec4( mixRGB, base.a );","}"].join("\n")},g.horizontalTiltShift={attributes:{vertexPosition:a.POSITION,vertexUV0:a.TEXCOORD0},uniforms:{viewMatrix:b.VIEW_MATRIX,projectionMatrix:b.PROJECTION_MATRIX,worldMatrix:b.WORLD_MATRIX,tDiffuse:b.DIFFUSE_MAP,h:1/128,r:.5},vshader:["attribute vec3 vertexPosition;","attribute vec2 vertexUV0;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 worldMatrix;","varying vec2 vUv;","void main() {","vUv = vertexUV0;","gl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( vertexPosition, 1.0 );","}"].join("\n"),fshader:["uniform sampler2D tDiffuse;","uniform float h;","uniform float r;","varying vec2 vUv;","void main() {","vec4 sum = vec4( 0.0 );","float hh = h * abs( r - vUv.y );","sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * hh, vUv.y ) ) * 0.051;","sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * hh, vUv.y ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * hh, vUv.y ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * hh, vUv.y ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x,            vUv.y ) ) * 0.1633;","sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * hh, vUv.y ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * hh, vUv.y ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * hh, vUv.y ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * hh, vUv.y ) ) * 0.051;","gl_FragColor = sum;","}"].join("\n")},g.colorify={attributes:{vertexPosition:a.POSITION,vertexUV0:a.TEXCOORD0},uniforms:{viewMatrix:b.VIEW_MATRIX,projectionMatrix:b.PROJECTION_MATRIX,worldMatrix:b.WORLD_MATRIX,tDiffuse:b.DIFFUSE_MAP,color:[1,1,1]},vshader:["attribute vec3 vertexPosition;","attribute vec2 vertexUV0;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 worldMatrix;","varying vec2 vUv;","void main() {","vUv = vertexUV0;","gl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( vertexPosition, 1.0 );","}"].join("\n"),fshader:["uniform vec3 color;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","vec3 luma = vec3( 0.299, 0.587, 0.114 );","float v = dot( texel.xyz, luma );","gl_FragColor = vec4( v * color, texel.w );","}"].join("\n")},g.normalmap={attributes:{vertexPosition:a.POSITION,vertexUV0:a.TEXCOORD0},uniforms:{viewMatrix:b.VIEW_MATRIX,projectionMatrix:b.PROJECTION_MATRIX,worldMatrix:b.WORLD_MATRIX,heightMap:b.DIFFUSE_MAP,resolution:[512,512],height:.05},vshader:["attribute vec3 vertexPosition;","attribute vec2 vertexUV0;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 worldMatrix;","varying vec2 vUv;","void main() {","vUv = vertexUV0;","gl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( vertexPosition, 1.0 );","}"].join("\n"),fshader:["uniform float height;","uniform vec2 resolution;","uniform sampler2D heightMap;","varying vec2 vUv;","void main() {","float val = texture2D( heightMap, vUv ).x;","float valU = texture2D( heightMap, vUv + vec2( 1.0 / resolution.x, 0.0 ) ).x;","float valV = texture2D( heightMap, vUv + vec2( 0.0, 1.0 / resolution.y ) ).x;","gl_FragColor = vec4( ( 0.5 * normalize( vec3( val - valU, val - valV, height  ) ) + 0.5 ), 1.0 );","}"].join("\n")},g.ssao={attributes:{vertexPosition:a.POSITION,vertexUV0:a.TEXCOORD0},uniforms:{viewMatrix:b.VIEW_MATRIX,projectionMatrix:b.PROJECTION_MATRIX,worldMatrix:b.WORLD_MATRIX,tDiffuse:b.DIFFUSE_MAP,tDepth:b.DEPTH_MAP,size:[512,512],cameraNear:b.MAIN_NEAR_PLANE,cameraFar:b.MAIN_FAR_PLANE,fogNear:b.MAIN_NEAR_PLANE,fogFar:b.MAIN_FAR_PLANE,fogEnabled:0,onlyAO:0,aoClamp:.3,lumInfluence:0},vshader:["attribute vec3 vertexPosition;","attribute vec2 vertexUV0;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 worldMatrix;","varying vec2 vUv;","void main() {","vUv = vertexUV0;","gl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( vertexPosition, 1.0 );","}"].join("\n"),fshader:["uniform float cameraNear;","uniform float cameraFar;","uniform float fogNear;","uniform float fogFar;","uniform bool fogEnabled;","uniform bool onlyAO;","uniform vec2 size;","uniform float aoClamp;","uniform float lumInfluence;","uniform sampler2D tDiffuse;","uniform sampler2D tDepth;","varying vec2 vUv;","#define DL 2.399963229728653","#define EULER 2.718281828459045","float width = size.x;","float height = size.y;","float cameraFarPlusNear = cameraFar + cameraNear;","float cameraFarMinusNear = cameraFar - cameraNear;","float cameraCoef = 2.0 * cameraNear;","const int samples = 16;","const float radius = 2.0;","const bool useNoise = false;","const float noiseAmount = 0.0003;","const float diffArea = 0.4;","const float gDisplace = 0.4;","const vec3 onlyAOColor = vec3( 1.0, 1.0, 1.0 );","float unpackDepth( const in vec4 rgba_depth ) {","const vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );","float depth = dot( rgba_depth, bit_shift );","return depth;","}","vec2 rand( const vec2 coord ) {","vec2 noise;","if ( useNoise ) {","float nx = dot ( coord, vec2( 12.9898, 78.233 ) );","float ny = dot ( coord, vec2( 12.9898, 78.233 ) * 2.0 );","noise = clamp( fract ( 43758.5453 * sin( vec2( nx, ny ) ) ), 0.0, 1.0 );","} else {","float ff = fract( 1.0 - coord.s * ( width / 2.0 ) );","float gg = fract( coord.t * ( height / 2.0 ) );","noise = vec2( 0.25, 0.75 ) * vec2( ff ) + vec2( 0.75, 0.25 ) * gg;","}","return ( noise * 2.0  - 1.0 ) * noiseAmount;","}","float doFog() {","float zdepth = unpackDepth( texture2D( tDepth, vUv ) );","float depth = -cameraFar * cameraNear / ( zdepth * cameraFarMinusNear - cameraFar );","return smoothstep( fogNear, fogFar, depth );","}","float readDepth( const in vec2 coord ) {","return cameraCoef / ( cameraFarPlusNear - unpackDepth( texture2D( tDepth, coord ) ) * cameraFarMinusNear );","}","float compareDepths( const in float depth1, const in float depth2, inout int far ) {","float garea = 2.0;","float diff = ( depth1 - depth2 ) * 100.0;","if ( diff < gDisplace ) {","garea = diffArea;","} else {","far = 1;","}","float dd = diff - gDisplace;","float gauss = pow( EULER, -2.0 * dd * dd / ( garea * garea ) );","return gauss;","}","float calcAO( float depth, float dw, float dh ) {","float dd = radius - depth * radius;","vec2 vv = vec2( dw, dh );","vec2 coord1 = vUv + dd * vv;","vec2 coord2 = vUv - dd * vv;","float temp1 = 0.0;","float temp2 = 0.0;","int far = 0;","temp1 = compareDepths( depth, readDepth( coord1 ), far );","if ( far > 0 ) {","temp2 = compareDepths( readDepth( coord2 ), depth, far );","temp1 += ( 1.0 - temp1 ) * temp2;","}","return temp1;","}","void main() {","vec2 noise = rand( vUv );","float depth = readDepth( vUv );","float tt = clamp( depth, aoClamp, 1.0 );","float w = ( 1.0 / width )  / tt + ( noise.x * ( 1.0 - noise.x ) );","float h = ( 1.0 / height ) / tt + ( noise.y * ( 1.0 - noise.y ) );","float pw;","float ph;","float ao;","float dz = 1.0 / float( samples );","float z = 1.0 - dz / 2.0;","float l = 0.0;","for ( int i = 0; i <= samples; i ++ ) {","float r = sqrt( 1.0 - z );","pw = cos( l ) * r;","ph = sin( l ) * r;","ao += calcAO( depth, pw * w, ph * h );","z = z - dz;","l = l + DL;","}","ao /= float( samples );","ao = 1.0 - ao;","if ( fogEnabled ) {","ao = mix( ao, 1.0, doFog() );","}","vec3 color = texture2D( tDiffuse, vUv ).rgb;","vec3 lumcoeff = vec3( 0.299, 0.587, 0.114 );","float lum = dot( color.rgb, lumcoeff );","vec3 luminance = vec3( lum );","vec3 final = vec3( color * mix( vec3( ao ), vec3( 1.0 ), luminance * lumInfluence ) );","if ( onlyAO ) {","final = onlyAOColor * vec3( mix( vec3( ao ), vec3( 1.0 ), luminance * lumInfluence ) );","}","gl_FragColor = vec4( final, 1.0 );","}"].join("\n")},g.skinning={defines:{JOINT_COUNT:56,WEIGHTS:4},attributes:{vertexPosition:a.POSITION,vertexUV0:a.TEXCOORD0,vertexWeights:a.WEIGHTS,vertexJointIDs:a.JOINTIDS},uniforms:{viewProjectionMatrix:b.VIEW_PROJECTION_MATRIX,worldMatrix:b.WORLD_MATRIX,diffuseMap:b.DIFFUSE_MAP,jointPalette:function(a){var b=a.meshData,c=b.currentPose;if(c){var d=c._matrixPalette,e=16*b.paletteMap.length,f=b.store;f||(f=new Float32Array(e),b.store=f);for(var g,h=0;h<b.paletteMap.length;h++){g=d[b.paletteMap[h]];for(var i=0;4>i;i++)for(var j=0;4>j;j++)f[16*h+4*i+j]=g.data[4*j+i]}return f}}},vshader:["attribute vec3 vertexPosition;","attribute vec2 vertexUV0;","attribute vec4 vertexWeights;","attribute vec4 vertexJointIDs;","uniform mat4 viewProjectionMatrix;","uniform mat4 worldMatrix;","uniform mat4 jointPalette[JOINT_COUNT];","varying vec2 texCoord0;","void main(void) {","	mat4 mat = mat4(0.0);","	mat += jointPalette[int(vertexJointIDs.x)] * vertexWeights.x;","	mat += jointPalette[int(vertexJointIDs.y)] * vertexWeights.y;","	mat += jointPalette[int(vertexJointIDs.z)] * vertexWeights.z;","	mat += jointPalette[int(vertexJointIDs.w)] * vertexWeights.w;","	texCoord0 = vertexUV0;","	gl_Position = viewProjectionMatrix * worldMatrix * mat * vec4(vertexPosition, 1.0);","}"].join("\n"),fshader:["uniform sampler2D diffuseMap;","varying vec2 texCoord0;","void main(void)","{","	gl_FragColor = texture2D(diffuseMap, texCoord0);","}"].join("\n")},g.rgbshift={attributes:{vertexPosition:a.POSITION,vertexUV0:a.TEXCOORD0},uniforms:{viewMatrix:b.VIEW_MATRIX,projectionMatrix:b.PROJECTION_MATRIX,worldMatrix:b.WORLD_MATRIX,tDiffuse:b.DIFFUSE_MAP,amount:.005,angle:0},vshader:["attribute vec3 vertexPosition;","attribute vec2 vertexUV0;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 worldMatrix;","varying vec2 vUv;","void main() {","vUv = vertexUV0;","gl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( vertexPosition, 1.0 );","}"].join("\n"),fshader:["uniform sampler2D tDiffuse;","uniform float amount;","uniform float angle;","varying vec2 vUv;","void main() {","vec2 offset = amount * vec2( cos(angle), sin(angle));","vec4 cr = texture2D(tDiffuse, vUv + offset);","vec4 cga = texture2D(tDiffuse, vUv);","vec4 cb = texture2D(tDiffuse, vUv - offset);","gl_FragColor = vec4(cr.r, cga.g, cb.b, cga.a);","}"].join("\n")},g.brightnesscontrast={attributes:{vertexPosition:a.POSITION,vertexUV0:a.TEXCOORD0},uniforms:{viewMatrix:b.VIEW_MATRIX,projectionMatrix:b.PROJECTION_MATRIX,worldMatrix:b.WORLD_MATRIX,tDiffuse:b.DIFFUSE_MAP,brightness:0,contrast:0},vshader:["attribute vec3 vertexPosition;","attribute vec2 vertexUV0;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 worldMatrix;","varying vec2 vUv;","void main() {","vUv = vertexUV0;","gl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( vertexPosition, 1.0 );","}"].join("\n"),fshader:["uniform sampler2D tDiffuse;","uniform float brightness;","uniform float contrast;","varying vec2 vUv;","void main() {","gl_FragColor = texture2D( tDiffuse, vUv );","gl_FragColor.rgb += brightness;","if (contrast > 0.0) {","gl_FragColor.rgb = (gl_FragColor.rgb - 0.5) / (1.0 - contrast) + 0.5;","} else {","gl_FragColor.rgb = (gl_FragColor.rgb - 0.5) * (1.0 + contrast) + 0.5;","}","}"].join("\n")},g.luminosity={attributes:{vertexPosition:a.POSITION,vertexUV0:a.TEXCOORD0},uniforms:{viewMatrix:b.VIEW_MATRIX,projectionMatrix:b.PROJECTION_MATRIX,worldMatrix:b.WORLD_MATRIX,tDiffuse:b.DIFFUSE_MAP},vshader:["attribute vec3 vertexPosition;","attribute vec2 vertexUV0;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 worldMatrix;","varying vec2 vUv;","void main() {","vUv = vertexUV0;","gl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( vertexPosition, 1.0 );","}"].join("\n"),fshader:["uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","vec3 luma = vec3( 0.299, 0.587, 0.114 );","float v = dot( texel.xyz, luma );","gl_FragColor = vec4( v, v, v, texel.w );","}"].join("\n")},g.point={attributes:{vertexPosition:a.POSITION,vertexColor:a.COLOR},uniforms:{viewProjectionMatrix:b.VIEW_PROJECTION_MATRIX,worldMatrix:b.WORLD_MATRIX,pointSize:2},vshader:["attribute vec3 vertexPosition;","attribute vec4 vertexColor;","uniform mat4 viewProjectionMatrix;","uniform mat4 worldMatrix;","uniform float pointSize;","varying vec4 color;","void main(void) {","	color = vertexColor;","	gl_Position = viewProjectionMatrix * worldMatrix * vec4(vertexPosition, 1.0);","	gl_PointSize = pointSize;","}"].join("\n"),fshader:["varying vec4 color;","void main(void)","{","	gl_FragColor = color;","}"].join("\n")},g.toon={attributes:{vertexPosition:a.POSITION,vertexNormal:a.NORMAL},uniforms:{viewMatrix:b.VIEW_MATRIX,projectionMatrix:b.PROJECTION_MATRIX,worldMatrix:b.WORLD_MATRIX,cameraPosition:b.CAMERA,lightPosition:b.LIGHT0,HighlightColour:[.9,.8,.7,1],MidColour:[.65,.55,.45,1],ShadowColour:[.4,.3,.2,1],HighlightSize:.2,ShadowSize:.01,OutlineWidth:.15},vshader:["attribute vec3 vertexPosition;","attribute vec3 vertexNormal;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 worldMatrix;","uniform vec3 cameraPosition;","uniform vec3 lightPosition;","varying vec3 N;","varying vec3 V;","varying vec3 L;","void main()","{","	vec4 worldPos = worldMatrix * vec4(vertexPosition, 1.0);","	N = (worldMatrix * vec4(vertexNormal, 0.0)).xyz;","	L = lightPosition - worldPos.xyz;","	V = cameraPosition - worldPos.xyz;","	gl_Position = projectionMatrix * viewMatrix * worldPos;","}"].join("\n"),fshader:["uniform vec4 HighlightColour;","uniform vec4 MidColour;","uniform vec4 ShadowColour;","uniform float HighlightSize;","uniform float ShadowSize;","uniform float OutlineWidth;","varying vec3 N;","varying vec3 L;","varying vec3 V;","void main()","{","	vec3 n = normalize(N);","	vec3 l = normalize(L);","	vec3 v = normalize(V);","    float lambert = dot(l,n);","    vec4 colour = MidColour;","    if (lambert > 1.0 - HighlightSize) colour = HighlightColour;","    if (lambert < ShadowSize) colour = ShadowColour;","    if (dot(n,v) < OutlineWidth) colour = vec4(0.0,0.0,0.0,1.0);","    gl_FragColor = colour;","}"].join("\n")},g.differenceOfGaussians={attributes:{vertexPosition:a.POSITION,vertexUV0:a.TEXCOORD0},uniforms:{viewMatrix:b.VIEW_MATRIX,projectionMatrix:b.PROJECTION_MATRIX,worldMatrix:b.WORLD_MATRIX,gaussBlurredImage1:"BLUR1",gaussBlurredImage2:"BLUR2",originalImage:"ORIGINAL",threshold:.01},vshader:["attribute vec3 vertexPosition;","attribute vec2 vertexUV0;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 worldMatrix;","varying vec2 texCoord0;","void main(void) {","	texCoord0 = vertexUV0;","	gl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4(vertexPosition, 1.0);","}"].join("\n"),fshader:["uniform sampler2D gaussBlurredImage1;","uniform sampler2D gaussBlurredImage2;","uniform sampler2D originalImage;","uniform float threshold;","varying vec2 texCoord0;","void main(void)","{","	vec4 blur1 = texture2D(gaussBlurredImage1, texCoord0);","	vec4 blur2 = texture2D(gaussBlurredImage2, texCoord0);","	vec4 originalColor = texture2D(originalImage, texCoord0);","	vec3 col = clamp(blur1.rgb - blur2.rgb, 0.0, 1.0);","	float value = (col.r + col.g + col.b) / 3.0;","	value = step(threshold, value);","	vec3 outputColor = mix(originalColor.rgb, vec3(value), value);","	gl_FragColor = vec4(outputColor, 1.0);","}"].join("\n")},g.downsample={attributes:{vertexPosition:a.POSITION,vertexUV0:a.TEXCOORD0},uniforms:{viewMatrix:b.VIEW_MATRIX,projectionMatrix:b.PROJECTION_MATRIX,worldMatrix:b.WORLD_MATRIX,tDiffuse:b.DIFFUSE_MAP},vshader:["attribute vec3 vertexPosition;","attribute vec2 vertexUV0;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 worldMatrix;","varying vec2 vUv;","void main() {","vUv = vertexUV0;","gl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( vertexPosition, 1.0 );","}"].join("\n"),fshader:["uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","gl_FragColor = texture2D( tDiffuse, vUv );","}"].join("\n")},g.boxfilter={attributes:{vertexPosition:a.POSITION,vertexUV0:a.TEXCOORD0},uniforms:{viewMatrix:b.VIEW_MATRIX,projectionMatrix:b.PROJECTION_MATRIX,worldMatrix:b.WORLD_MATRIX,tDiffuse:b.DIFFUSE_MAP,viewport:[128,128]},vshader:["attribute vec3 vertexPosition;","attribute vec2 vertexUV0;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 worldMatrix;","varying vec2 vUv;","void main() {","vUv = vertexUV0;","gl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( vertexPosition, 1.0 );","}"].join("\n"),fshader:["uniform sampler2D tDiffuse;","uniform vec2 viewport;","varying vec2 vUv;","void main() {","vec3 result = vec3(0.0);","for(int x=-1; x<=1; x++) {","	for(int y=-1; y<=1; y++) {","		result += texture2D(tDiffuse, vUv + vec2(x, y) / viewport).rgb;","	}","}","gl_FragColor = vec4(result / vec3(9.0), 1.0);","}"].join("\n")},g.lightDepth={processors:[d.animation.processor],defines:{SHADOW_TYPE:0,WEIGHTS:!0,JOINTIDS:!0},attributes:{vertexPosition:a.POSITION,vertexJointIDs:a.JOINTIDS,vertexWeights:a.WEIGHTS},uniforms:{viewMatrix:b.VIEW_MATRIX,projectionMatrix:b.PROJECTION_MATRIX,worldMatrix:b.WORLD_MATRIX,cameraScale:b.MAIN_DEPTH_SCALE},vshader:["attribute vec3 vertexPosition;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 worldMatrix;","varying vec4 worldPosition;",d.animation.prevertex,"void main(void) {","mat4 wMatrix = worldMatrix;",d.animation.vertex,"worldPosition = viewMatrix * wMatrix * vec4(vertexPosition, 1.0);","gl_Position = projectionMatrix * worldPosition;","}"].join("\n"),fshader:["#ifndef SHADOW_TYPE","#define SHADOW_TYPE 0","#endif","uniform float cameraScale;","varying vec4 worldPosition;","void main(void)","{","float linearDepth = length(worldPosition) * cameraScale;","#if SHADOW_TYPE == 0","gl_FragColor = vec4(linearDepth);","#elif SHADOW_TYPE == 1","gl_FragColor = vec4(linearDepth);","#elif SHADOW_TYPE == 2","gl_FragColor = vec4(linearDepth, linearDepth * linearDepth, 0.0, 0.0);","#endif","}"].join("\n")},g.packDepth={attributes:{vertexPosition:a.POSITION},uniforms:{viewMatrix:b.VIEW_MATRIX,projectionMatrix:b.PROJECTION_MATRIX,worldMatrix:b.WORLD_MATRIX,farPlane:b.FAR_PLANE},vshader:["attribute vec3 vertexPosition;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 worldMatrix;","varying vec4 vPosition;","void main(void) {","	vPosition = viewMatrix * worldMatrix * vec4(vertexPosition, 1.0);","	gl_Position = projectionMatrix * vPosition;","}"].join("\n"),fshader:["uniform float farPlane;",c.methods.packDepth,"varying vec4 vPosition;","void main(void)","{","	float linearDepth = min(length(vPosition), farPlane) / farPlane;","	gl_FragColor = packDepth(linearDepth);","}"].join("\n")},g.pickingShader={defines:{WEIGHTS:!0,JOINTIDS:!0},attributes:{vertexPosition:a.POSITION,vertexJointIDs:a.JOINTIDS,vertexWeights:a.WEIGHTS},uniforms:{viewMatrix:b.VIEW_MATRIX,projectionMatrix:b.PROJECTION_MATRIX,worldMatrix:b.WORLD_MATRIX,cameraFar:b.FAR_PLANE,id:function(a){return a.renderable.id+1
}},processors:[d.animation.processor],vshader:["attribute vec3 vertexPosition;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 worldMatrix;","uniform float cameraFar;",d.animation.prevertex,"varying float depth;","void main() {","mat4 wMatrix = worldMatrix;",d.animation.vertex,"vec4 mvPosition = viewMatrix * wMatrix * vec4( vertexPosition, 1.0 );","depth = length(mvPosition.xyz) / cameraFar;","gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fshader:["uniform float id;","varying float depth;",c.methods.packDepth16,"void main() {","vec2 packedId = vec2(floor(id/255.0), mod(id, 255.0)) * vec2(1.0/255.0);","vec2 packedDepth = packDepth16(depth);","gl_FragColor = vec4(packedId, packedDepth);","}"].join("\n")},g}),define("goo/shapes/Cylinder",["goo/renderer/MeshData"],function(a){"use strict";function b(b,c){if(1===arguments.length&&arguments[0]instanceof Object){var d=arguments[0];b=d.radialSamples,c=d.radius}this.radialSamples=b||8,this.radius=c||1;var e=a.defaultMap([a.POSITION,a.NORMAL,a.TEXCOORD0]);a.call(this,e,4*this.radialSamples+2+2,12*this.radialSamples),this.indexModes=["Triangles"],this.rebuild()}return b.prototype=Object.create(a.prototype),b.prototype.rebuild=function(){for(var b=[],c=[],d=[],e=[],f=2*Math.PI/this.radialSamples,g=1/this.radialSamples,h=4*this.radialSamples+2+2-1,i=0,j=0,k=0;i<this.radialSamples;i++,j+=f,k+=g){var l=Math.cos(j),m=Math.sin(j),n=l*this.radius,o=m*this.radius;b.push(n,o,.5,n,o,-.5,n,o,.5,n,o,-.5),c.push(0,0,1,0,0,-1,l,m,0,l,m,0),d.push(l/4+.25,m/4+.75,l/4+.25,m/4+.25,.5,k,1,k)}b.push(this.radius,0,.5,this.radius,0,-.5),c.push(1,0,0,1,0,0),d.push(.5,1,1,1);for(var i=0;i<this.radialSamples-1;i++)e.push(h,4*i+0,4*i+4,4*i+1,h-1,4*i+5,4*i+4+2,4*i+2,4*i+4+3,4*i+2,4*i+3,4*i+4+3);return e.push(h,4*i+0,0,4*i+1,h-1,1,4*i+4,4*i+2,4*i+5,4*i+2,4*i+3,4*i+5),b.push(0,0,-.5,0,0,.5),c.push(0,0,-.5,0,0,.5),d.push(.25,.25,.25,.75),this.getAttributeBuffer(a.POSITION).set(b),this.getAttributeBuffer(a.NORMAL).set(c),this.getAttributeBuffer(a.TEXCOORD0).set(d),this.getIndexBuffer().set(e),this},b}),define("goo/shapes/Torus",["goo/renderer/MeshData","goo/math/Vector3","goo/math/MathUtils"],function(a,b,c){"use strict";function d(b,c,d,e){if(1===arguments.length&&arguments[0]instanceof Object){var f=arguments[0];b=f.circleSamples,c=f.radialSamples,d=f.tubeRadius,e=f.centerRadius}this._circleSamples=void 0!==b?b:8,this._radialSamples=void 0!==c?c:8,this._tubeRadius=void 0!==d?d:1,this._centerRadius=void 0!==e?e:2,this.viewInside=!1;var g=a.defaultMap([a.POSITION,a.NORMAL,a.TEXCOORD0]),h=(this._circleSamples+1)*(this._radialSamples+1),i=6*this._circleSamples*this._radialSamples;a.call(this,g,h,i),this.rebuild()}function e(a,b,c){a[3*c+0]=a[3*b+0],a[3*c+1]=a[3*b+1],a[3*c+2]=a[3*b+2]}function f(a,b,c){a[2*c+0]=a[2*b+0],a[2*c+1]=a[2*b+1]}return d.prototype=Object.create(a.prototype),d.prototype.rebuild=function(){for(var d=this.getAttributeBuffer(a.POSITION),g=this.getAttributeBuffer(a.NORMAL),h=this.getAttributeBuffer(a.TEXCOORD0),i=this.getIndexBuffer(),j=1/this._circleSamples,k=1/this._radialSamples,l=0,m=new b,n=new b,o=new b,p=0;p<this._circleSamples;p++){var q=p*j,r=c.TWO_PI*q,s=Math.cos(r),t=Math.sin(r);m.set(s,t,0),b.mul(m,this._centerRadius,n);for(var u=l,v=0;v<this._radialSamples;v++){var w=v*k,x=c.TWO_PI*w,y=Math.cos(x),z=Math.sin(x);o.copy(m).mul(y),o.z=o.z+z,o.normalize(),this.viewInside?(g[3*l+0]=-o.x,g[3*l+1]=-o.y,g[3*l+2]=-o.z):(g[3*l+0]=o.x,g[3*l+1]=o.y,g[3*l+2]=o.z),o.mul(this._tubeRadius).add(n),d[3*l+0]=o.x,d[3*l+1]=o.y,d[3*l+2]=o.z,h[2*l+0]=w,h[2*l+1]=q,l++}e(d,u,l),e(g,u,l),h[2*l+0]=1,h[2*l+1]=q,l++}for(var A=0;A<=this._radialSamples;A++,l++)e(d,A,l),e(g,A,l),f(h,A,l),h[2*l+1]=1;for(var B=0,C=0,p=0;p<this._circleSamples;p++){var D=C,E=D+1;C+=this._radialSamples+1;var F=C,G=F+1;for(l=0;l<this._radialSamples;l++)this.viewInside?(i[B++]=D++,i[B++]=E,i[B++]=F,i[B++]=E++,i[B++]=G++,i[B++]=F++):(i[B++]=D++,i[B++]=F,i[B++]=E,i[B++]=E++,i[B++]=F++,i[B++]=G++)}return this},d}),define("goo/shapes/ShapeCreator",["goo/shapes/Box","goo/shapes/Quad","goo/shapes/Sphere","goo/shapes/Cylinder","goo/shapes/Torus"],function(a,b,c,d,e){"use strict";function f(){}return f.createQuad=function(a,c,d,e){return new b(a,c,d,e)},f.createBox=function(b,c,d,e,f){return new a(b,c,d,e,f)},f.createSphere=function(a,b,d,e){return new c(a,b,d,e)},f.createCylinder=function(a,b,c){return new d(a,b,c)},f.createTorus=function(a,b,c,d){return new e(a,b,c,d)},f}),define("goo/util/Handy",[],function(){"use strict";function a(){}return a.deepFreeze=function(b){var c,d;Object.freeze(b);for(d in b)c=b[d],b.hasOwnProperty(d)&&"object"==typeof c&&!Object.isFrozen(c)&&a.deepFreeze(c)},a.defineProperty=function(a,b,c,d){var e=c;Object.defineProperty(a,b,{get:function(){return e},set:function(a){e=a,d(e)},configurable:!0,enumerable:!0})},a.addListener=function(a,b,c,d){var e=a[b];Object.defineProperty(a,b,{get:function(){return c&&c(),e},set:function(a){e=a,d&&d(e)},configurable:!0,enumerable:!0})},a}),define("goo/math/Plane",["goo/math/Vector3"],function(a){"use strict";function b(b,c){this.normal=void 0!==b?new a(b):new a(a.UNIT_Y),this.constant=isNaN(c)?0:c}b.XZ=new b(a.UNIT_Y,0),b.XY=new b(a.UNIT_Z,0),b.YZ=new b(a.UNIT_X,0),b.prototype.pseudoDistance=function(a){return this.normal.dot(a)-this.constant},b.prototype.setPlanePoints=function(a,b,c){return this.normal.set(b).subtractLocal(a),this.normal.crossLocal(c.x-a.x,c.y-a.y,c.z-a.z).normalizeLocal(),this.constant=this.normal.dot(a),this},b.prototype.reflectVector=function(b,c){var d=c;null===d&&(d=new a);var e=2*this.normal.dot(b);return d.set(b).subtractLocal(this.normal.x*e,this.normal.y*e,this.normal.z*e),d};var c=new a;return b.prototype.rayIntersect=function(b,d){d=d||new a;var e=b.direction.dot(this.normal);if(Math.abs(e)<1e-8)return console.warn("Ray parallell with plane"),null;var f=this.constant,g=c.set(this.normal).muld(f,f,f).subv(b.origin).dot(this.normal),h=g/e;return d.setv(b.direction).muld(h,h,h).addv(b.origin)},b}),define("goo/math/Ray",["goo/math/Vector3","goo/math/MathUtils"],function(a,b){"use strict";function c(b,c){this.origin=b||new a,this.direction=c||(new a).copy(a.UNIT_Z),this.calcVec1=new a,this.calcVec2=new a,this.calcVec3=new a,this.calcVec4=new a}return c.prototype.intersects=function(a,b,c){return 3===a.length?this.intersectsTriangle(a[0],a[1],a[2],b,c):4===a.length?this.intersectsTriangle(a[0],a[1],a[2],b,c)||this.intersectsTriangle(a[0],a[2],a[3],b,c):!1},c.prototype.intersectsTriangle=function(c,d,e,f,g){var h,i=this.calcVec1.set(this.origin).sub(c),j=this.calcVec2.set(d).sub(c),k=this.calcVec3.set(e).sub(c),l=this.calcVec4.set(j).cross(k),m=this.direction.dot(l);if(m>b.EPSILON)h=1;else{if(!(m<-b.EPSILON))return!1;h=-1,m=-m}var n=h*this.direction.dot(a.cross(i,k,k)),o=!1;if(n>=0){var p=h*this.direction.dot(j.cross(i));if(p>=0&&m>=n+p){var q=-h*i.dot(l);if(q>=0){if(!g)return!0;var r=1/m,s=q*r;if(f){var t=n*r,u=p*r;g.setd(s,t,u)}else g.setv(this.origin).add_d(this.direction.x*s,this.direction.y*s,this.direction.z*s);o=!0}}}return o},c.prototype.getDistanceToPrimitive=function(a){var b=this.calcVec1;return this.intersects(a,!1,b)?this.origin.distance(b.x,b.y,b.z):1/0},c.prototype.intersectsPlane=function(a,b){var c=a.normal,d=c.dot(this.direction);if(Math.abs(d)<1e-5)return!1;var e=-c.dot(this.origin)+a.constant,f=e/d;return 1e-5>f?!1:(null!==b&&b.set(this.direction).multiplyLocal(f).addLocal(this.origin),!0)},c.prototype.distanceSquared=function(a,b){var c=this.calcVec1;c.set(a).subtractLocal(this.origin);var d=this.direction.dot(c);return d>0?(c.set(this.direction).multiplyLocal(d),c.addLocal(this.origin)):c.set(this.origin),null!==b&&b.set(c),a.subtract(c,c),c.lengthSquared()},c}),define("goo/renderer/Camera",["goo/util/Handy","goo/math/Vector3","goo/math/Vector4","goo/math/Matrix4x4","goo/math/Plane","goo/math/MathUtils","goo/math/Ray","goo/renderer/bounds/BoundingBox","goo/renderer/bounds/BoundingSphere","goo/renderer/bounds/BoundingVolume"],function(a,b,c,d,e,f,g,h,i,j){"use strict";function k(f,g,h,i){this.translation=new b(0,0,0),this._left=new b(-1,0,0),this._up=new b(0,1,0),this._direction=new b(0,0,-1),a.defineProperty(this,"this._depthRangeNear",0,function(){this._depthRangeDirty=!0}),a.defineProperty(this,"this._depthRangeFar",1,function(){this._depthRangeDirty=!0}),this._depthRangeDirty=!0,this._frustumNear=1,this._frustumFar=2,this._frustumLeft=-.5,this._frustumRight=.5,this._frustumTop=.5,this._frustumBottom=-.5,this._coeffLeft=[],this._coeffRight=[],this._coeffBottom=[],this._coeffTop=[],this._viewPortLeft=0,this._viewPortRight=1,this._viewPortTop=1,this._viewPortBottom=0,this._planeQuantity=6,this._worldPlane=[];for(var j=0;j<k.FRUSTUM_PLANES;j++)this._worldPlane[j]=new e;this._newDirection=new b,this.projectionMode=k.Perspective,this._updateMVMatrix=!0,this._updateInverseMVMatrix=!0,this._updatePMatrix=!0,this._updateMVPMatrix=!0,this._updateInverseMVPMatrix=!0,this.modelView=new d,this.modelViewInverse=new d,this.projection=new d,this.modelViewProjection=new d,this.modelViewProjectionInverse=new d,this._depthRangeDirty=!0,this._viewPortDirty=!0,this._planeState=0,this._clipPlane=new c,this._qCalc=new c,this._corners=[];for(var j=0;8>j;j++)this._corners.push(new b);this._extents=new b,this.vNearPlaneCenter=new b,this.vFarPlaneCenter=new b,this.direction=new b,this.left=new b,this.up=new b,this.planeNormal=new b,this.changedProperties=!0,this.setFrustumPerspective(f,g,h,i),this.onFrameChange()}k.LEFT_PLANE=0,k.RIGHT_PLANE=1,k.BOTTOM_PLANE=2,k.TOP_PLANE=3,k.FAR_PLANE=4,k.NEAR_PLANE=5,k.FRUSTUM_PLANES=6,k.Perspective=0,k.Parallel=1,k.Custom=2,k.Outside=0,k.Inside=1,k.Intersects=2,k.prototype.normalize=function(){this._left.normalize(),this._up.normalize(),this._direction.normalize(),this.onFrameChange()},k.prototype.setProjectionMode=function(a){this.projectionMode=a,this.update()},k.prototype.setFrustumPerspective=function(a,b,c,d){if(void 0!==a&&null!==a&&(this.fov=a),void 0!==b&&null!==b&&(this.aspect=b),void 0!==c&&null!==c&&(this.near=c),void 0!==d&&null!==d&&(this.far=d),void 0!==this.fov){var e=Math.tan(.5*this.fov*f.DEG_TO_RAD)*this.near,g=e*this.aspect;this._frustumLeft=-g,this._frustumRight=g,this._frustumBottom=-e,this._frustumTop=e,this._frustumNear=this.near,this._frustumFar=this.far,this.onFrustumChange()}},k.prototype.setFrustum=function(a,b,c,d,e,f){void 0!==a&&null!==a&&(this.near=a),void 0!==b&&null!==b&&(this.far=b),void 0!==c&&null!==c&&(this.left=c),void 0!==d&&null!==d&&(this.right=d),void 0!==e&&null!==e&&(this.top=e),void 0!==f&&null!==f&&(this.bottom=f),this._frustumNear=this.near,this._frustumFar=this.far,this._frustumLeft=this.left,this._frustumRight=this.right,this._frustumTop=this.top,this._frustumBottom=this.bottom,this.onFrustumChange()},k.prototype.copy=function(a){this.translation.setv(a.translation),this._left.setv(a._left),this._up.setv(a._up),this._direction.setv(a._direction),this.fov=a.fov,this.aspect=a.aspect,this.near=a.near,this.far=a.far,this._frustumLeft=a._frustumLeft,this._frustumRight=a._frustumRight,this._frustumBottom=a._frustumBottom,this._frustumTop=a._frustumTop,this._frustumNear=a._frustumNear,this._frustumFar=a._frustumFar,this.projectionMode=a.projectionMode,this._depthRangeDirty=!0,this.onFrustumChange(),this.onFrameChange()},k.prototype.setFrame=function(a,b,c,d){this._left.copy(b),this._up.copy(c),this._direction.copy(d),this.translation.copy(a),this.onFrameChange()},k.prototype.lookAt=function(a,c){this._newDirection.copy(a).sub(this.translation).normalize(),this._newDirection.equals(this._direction)||(this._direction.copy(this._newDirection),this._up.copy(c).normalize(),this._up.equals(b.ZERO)&&this._up.copy(b.UNIT_Y),this._left.copy(this._up).cross(this._direction).normalize(),this._left.equals(b.ZERO)&&(0!==this._direction.x?this._left.set(this._direction.y,-this._direction.x,0):this._left.set(0,this._direction.z,-this._direction.y)),this._up.copy(this._direction).cross(this._left).normalize(),this.onFrameChange())},k.prototype.makeDirty=function(){this._depthRangeDirty=!0,this._viewPortDirty=!0},k.prototype.update=function(){this._depthRangeDirty=!0,this.onFrustumChange(),this.onFrameChange()},k.prototype.setViewPort=function(){console.warn("Camera.setViewPort() not implemented.")},k.prototype.contains=function(a){if(!a)return k.Inside;for(var b=k.Inside,c=k.FRUSTUM_PLANES-1;c>=0;c--)switch(a.whichSide(this._worldPlane[c])){case j.Inside:return k.Outside;case j.Outside:break;case j.Intersects:b=k.Intersects}return b},k.prototype.onFrustumChange=function(){if(this.projectionMode===k.Perspective){var a=this._frustumNear*this._frustumNear,b=this._frustumLeft*this._frustumLeft,c=this._frustumRight*this._frustumRight,d=this._frustumBottom*this._frustumBottom,e=this._frustumTop*this._frustumTop,f=1/Math.sqrt(a+b);this._coeffLeft[0]=this._frustumNear*f,this._coeffLeft[1]=-this._frustumLeft*f,f=1/Math.sqrt(a+c),this._coeffRight[0]=-this._frustumNear*f,this._coeffRight[1]=this._frustumRight*f,f=1/Math.sqrt(a+d),this._coeffBottom[0]=this._frustumNear*f,this._coeffBottom[1]=-this._frustumBottom*f,f=1/Math.sqrt(a+e),this._coeffTop[0]=-this._frustumNear*f,this._coeffTop[1]=this._frustumTop*f}else this.projectionMode===k.Parallel&&(this._frustumRight>this._frustumLeft?(this._coeffLeft[0]=-1,this._coeffLeft[1]=0,this._coeffRight[0]=1,this._coeffRight[1]=0):(this._coeffLeft[0]=1,this._coeffLeft[1]=0,this._coeffRight[0]=-1,this._coeffRight[1]=0),this._frustumTop>this._frustumBottom?(this._coeffBottom[0]=-1,this._coeffBottom[1]=0,this._coeffTop[0]=1,this._coeffTop[1]=0):(this._coeffBottom[0]=1,this._coeffBottom[1]=0,this._coeffTop[0]=-1,this._coeffTop[1]=0));this._updatePMatrix=!0,this._updateMVPMatrix=!0,this._updateInverseMVMatrix=!0,this._updateInverseMVPMatrix=!0,this.changedProperties=!0},k.prototype.onFrameChange=function(){var a=this._direction.dot(this.translation),b=this.planeNormal;b.x=this._left.x*this._coeffLeft[0],b.y=this._left.y*this._coeffLeft[0],b.z=this._left.z*this._coeffLeft[0],b.add([this._direction.x*this._coeffLeft[1],this._direction.y*this._coeffLeft[1],this._direction.z*this._coeffLeft[1]]),this._worldPlane[k.LEFT_PLANE].normal.copy(b),this._worldPlane[k.LEFT_PLANE].constant=this.translation.dot(b),b.x=this._left.x*this._coeffRight[0],b.y=this._left.y*this._coeffRight[0],b.z=this._left.z*this._coeffRight[0],b.add([this._direction.x*this._coeffRight[1],this._direction.y*this._coeffRight[1],this._direction.z*this._coeffRight[1]]),this._worldPlane[k.RIGHT_PLANE].normal.copy(b),this._worldPlane[k.RIGHT_PLANE].constant=this.translation.dot(b),b.x=this._up.x*this._coeffBottom[0],b.y=this._up.y*this._coeffBottom[0],b.z=this._up.z*this._coeffBottom[0],b.add([this._direction.x*this._coeffBottom[1],this._direction.y*this._coeffBottom[1],this._direction.z*this._coeffBottom[1]]),this._worldPlane[k.BOTTOM_PLANE].normal.copy(b),this._worldPlane[k.BOTTOM_PLANE].constant=this.translation.dot(b),b.x=this._up.x*this._coeffTop[0],b.y=this._up.y*this._coeffTop[0],b.z=this._up.z*this._coeffTop[0],b.add([this._direction.x*this._coeffTop[1],this._direction.y*this._coeffTop[1],this._direction.z*this._coeffTop[1]]),this._worldPlane[k.TOP_PLANE].normal.copy(b),this._worldPlane[k.TOP_PLANE].constant=this.translation.dot(b),this.projectionMode===k.Parallel&&(this._frustumRight>this._frustumLeft?(this._worldPlane[k.LEFT_PLANE].constant=this._worldPlane[k.LEFT_PLANE].contant+this._frustumLeft,this._worldPlane[k.RIGHT_PLANE].constant=this._worldPlane[k.RIGHT_PLANE].contant-this._frustumRight):(this._worldPlane[k.LEFT_PLANE].constant=this._worldPlane[k.LEFT_PLANE].contant-this._frustumLeft,this._worldPlane[k.RIGHT_PLANE].constant=this._worldPlane[k.RIGHT_PLANE].contant+this._frustumRight),this._frustumBottom>this._frustumTop?(this._worldPlane[k.TOP_PLANE].constant=this._worldPlane[k.TOP_PLANE].contant+this._frustumTop,this._worldPlane[k.BOTTOM_PLANE].constant=this._worldPlane[k.BOTTOM_PLANE].contant-this._frustumBottom):(this._worldPlane[k.TOP_PLANE].constant=this._worldPlane[k.TOP_PLANE].contant-this._frustumTop,this._worldPlane[k.BOTTOM_PLANE].constant=this._worldPlane[k.BOTTOM_PLANE].contant+this._frustumBottom)),b.copy(this._direction).invert(),this._worldPlane[k.FAR_PLANE].normal.copy(b),this._worldPlane[k.FAR_PLANE].constant=-(a+this._frustumFar),this._worldPlane[k.NEAR_PLANE].normal.copy(this._direction),this._worldPlane[k.NEAR_PLANE].constant=a+this._frustumNear,this._updateMVMatrix=!0,this._updateMVPMatrix=!0,this._updateInverseMVMatrix=!0,this._updateInverseMVPMatrix=!0},k.prototype.updateProjectionMatrix=function(){if(this.projectionMode===k.Parallel){this.projection.setIdentity();var a=this.projection.data;a[0]=2/(this._frustumRight-this._frustumLeft),a[5]=2/(this._frustumTop-this._frustumBottom),a[10]=-2/(this._frustumFar-this._frustumNear),a[12]=-(this._frustumRight+this._frustumLeft)/(this._frustumRight-this._frustumLeft),a[13]=-(this._frustumTop+this._frustumBottom)/(this._frustumTop-this._frustumBottom),a[14]=-(this._frustumFar+this._frustumNear)/(this._frustumFar-this._frustumNear)}else if(this.projectionMode===k.Perspective){this.projection.setIdentity();var a=this.projection.data;a[0]=2*this._frustumNear/(this._frustumRight-this._frustumLeft),a[5]=2*this._frustumNear/(this._frustumTop-this._frustumBottom),a[8]=(this._frustumRight+this._frustumLeft)/(this._frustumRight-this._frustumLeft),a[9]=(this._frustumTop+this._frustumBottom)/(this._frustumTop-this._frustumBottom),a[10]=-(this._frustumFar+this._frustumNear)/(this._frustumFar-this._frustumNear),a[11]=-1,a[14]=-(2*this._frustumFar*this._frustumNear)/(this._frustumFar-this._frustumNear),a[15]=-0}},k.prototype.updateModelViewMatrix=function(){this.modelView.setIdentity();var a=this.modelView.data;a[0]=-this._left.x,a[4]=-this._left.y,a[8]=-this._left.z,a[1]=this._up.x,a[5]=this._up.y,a[9]=this._up.z,a[2]=-this._direction.x,a[6]=-this._direction.y,a[10]=-this._direction.z,a[12]=this._left.dot(this.translation),a[13]=-this._up.dot(this.translation),a[14]=this._direction.dot(this.translation)},k.prototype.getPickRay=function(a,c,d,e,f){f||(f=new g);var h=new b,i=new b;return this.getWorldCoordinates(a,e-c,d,e,0,h),this.getWorldCoordinates(a,e-c,d,e,.3,i).sub(h).normalize(),f.origin.copy(h),f.direction.copy(i),f},k.prototype.getWorldCoordinates=function(a,d,e,f,g,h){h||(h=new b),this.checkInverseModelViewProjection();var i=new c;return i.set(2*((a/e-this._viewPortLeft)/(this._viewPortRight-this._viewPortLeft))-1,2*((d/f-this._viewPortBottom)/(this._viewPortTop-this._viewPortBottom))-1,2*g-1,1),this.modelViewProjectionInverse.applyPost(i),i.mul(1/i.w),h.x=i.x,h.y=i.y,h.z=i.z,h},k.prototype.getScreenCoordinates=function(a,b,c,d){return d=this.getNormalizedDeviceCoordinates(a,d),d.x=(d.x+1)*(this._viewPortRight-this._viewPortLeft)/2*b,d.y=(d.y+1)*(this._viewPortTop-this._viewPortBottom)/2*c,d.z=(d.z+1)/2,d},k.prototype.getFrustumCoordinates=function(a,b){return b=this.getNormalizedDeviceCoordinates(a,b),b.x=(b.x+1)*(this._frustumRight-this._frustumLeft)/2+this._frustumLeft,b.y=(b.y+1)*(this._frustumTop-this._frustumBottom)/2+this._frustumBottom,b.z=(b.z+1)*(this._frustumFar-this._frustumNear)/2+this._frustumNear,b},k.prototype.getNormalizedDeviceCoordinates=function(a,d){d||(d=new b),this.checkModelViewProjection();var e=new c;return e.set(a.x,a.y,a.z,1),this.modelViewProjection.applyPost(e),e.mul(1/e.w),d.x=e.x,d.y=e.y,d.z=e.z,d},k.prototype.checkModelView=function(){this._updateMVMatrix&&(this.updateModelViewMatrix(),this._updateMVMatrix=!1)},k.prototype.checkProjection=function(){this._updatePMatrix&&(this.updateProjectionMatrix(),this._updatePMatrix=!1)},k.prototype.checkModelViewProjection=function(){this._updateMVPMatrix&&(this.checkModelView(),this.checkProjection(),this.modelViewProjection.copy(this.getProjectionMatrix()).combine(this.getViewMatrix()),this._updateMVPMatrix=!1)},k.prototype.checkInverseModelView=function(){this._updateInverseMVMatrix&&(this.checkModelView(),d.invert(this.modelView,this.modelViewInverse),this._updateInverseMVMatrix=!1)},k.prototype.checkInverseModelViewProjection=function(){this._updateInverseMVPMatrix&&(this.checkModelViewProjection(),d.invert(this.modelViewProjection,this.modelViewProjectionInverse),this._updateInverseMVPMatrix=!1)},k.prototype.getViewMatrix=function(){return this.checkModelView(),this.modelView},k.prototype.getProjectionMatrix=function(){return this.checkProjection(),this.projection},k.prototype.getViewProjectionMatrix=function(){return this.checkModelViewProjection(),this.modelViewProjection},k.prototype.getViewInverseMatrix=function(){return this.checkInverseModelView(),this.modelViewInverse},k.prototype.getViewProjectionInverseMatrix=function(){return this.checkInverseModelViewProjection(),this.modelViewProjectionInverse},k.prototype.pack=function(a){for(var b=a.center,d=this._corners,e=this._extents,f=0;f<d.length;f++)d[f].set(b);a instanceof h?e.setd(a.xExtent,a.yExtent,a.zExtent):a instanceof i&&e.setd(a.radius,a.radius,a.radius),d[0].add_d(e.x,e.y,e.z),d[1].add_d(e.x,-e.y,e.z),d[2].add_d(e.x,e.y,-e.z),d[3].add_d(e.x,-e.y,-e.z),d[4].add_d(-e.x,e.y,e.z),d[5].add_d(-e.x,-e.y,e.z),d[6].add_d(-e.x,e.y,-e.z),d[7].add_d(-e.x,-e.y,-e.z);for(var g=this.getViewMatrix(),j=Number.MAX_VALUE,k=-Number.MAX_VALUE,l=new c,f=0;f<d.length;f++)l.setd(d[f].x,d[f].y,d[f].z,1),g.applyPre(l),j=Math.min(-l.z,j),k=Math.max(-l.z,k);j=Math.min(Math.max(this._frustumNear,j),this._frustumFar),k=Math.max(j,Math.min(this._frustumFar,k));var m=j/this._frustumNear;this._frustumLeft=this._frustumLeft*m,this._frustumRight=this._frustumRight*m,this._frustumTop=this._frustumTop*m,this._frustumBottom=this._frustumBottom*m,this._frustumNear=j,this._frustumFar=k},k.prototype.calculateFrustumCorners=function(a,b){a=void 0!==a?a:this._frustumNear,b=void 0!==b?b:this._frustumFar;var c=.5*(this._frustumTop-this._frustumBottom)*a/this._frustumNear,d=.5*(this._frustumRight-this._frustumLeft)*a/this._frustumNear,e=.5*(this._frustumTop-this._frustumBottom)*b/this._frustumNear,f=.5*(this._frustumRight-this._frustumLeft)*b/this._frustumNear;this.projectionMode===k.Parallel&&(c=.5*(this._frustumTop-this._frustumBottom),d=.5*(this._frustumRight-this._frustumLeft),e=.5*(this._frustumTop-this._frustumBottom),f=.5*(this._frustumRight-this._frustumLeft));var g=this.vNearPlaneCenter,h=this.vFarPlaneCenter,i=this.direction,j=this.left,l=this.up;return i.setv(this._direction).mul(a),g.setv(this.translation).addv(i),i.setv(this._direction).mul(b),h.setv(this.translation).addv(i),j.setv(this._left).mul(d),l.setv(this._up).mul(c),this._corners[0].setv(g).subv(j).subv(l),this._corners[1].setv(g).addv(j).subv(l),this._corners[2].setv(g).addv(j).addv(l),this._corners[3].setv(g).subv(j).addv(l),j.setv(this._left).mul(f),l.setv(this._up).mul(e),this._corners[4].setv(h).subv(j).subv(l),this._corners[5].setv(h).addv(j).subv(l),this._corners[6].setv(h).addv(j).addv(l),this._corners[7].setv(h).subv(j).addv(l),this._corners};var l=function(a){return a>0?1:0>a?-1:0};return k.prototype.setToObliqueMatrix=function(a,b){b=b||0;var d=this._clipPlane.setv(a);this.getViewMatrix().applyPost(d),d.w=this.translation.y*a.y+b,this._updatePMatrix=!0;var e=this.getProjectionMatrix();this._qCalc.setd((l(d.x)+e[8])/e[0],(l(d.y)+e[9])/e[5],-1,(1+e[10])/e[14]),d.mul(2/c.dot(d,this._qCalc)),e[2]=d.x,e[6]=d.y,e[10]=d.z+1,e[14]=d.w,this._updateMVPMatrix=!0,this._updateInverseMVPMatrix=!0},k}),define("goo/renderer/pass/FullscreenUtil",["goo/shapes/ShapeCreator","goo/renderer/Camera","goo/math/Vector3"],function(a,b,c){"use strict";function d(){}var e=new b;return e.projectionMode=b.Parallel,e.setFrustum(0,1,-1,1,1,-1),e._left.copy(c.UNIT_X).invert(),e._up.copy(c.UNIT_Y),e._direction.copy(c.UNIT_Z),e.onFrameChange(),d.camera=e,d.quad=a.createQuad(2,2),d}),define("goo/renderer/pass/FullscreenPass",["goo/renderer/Material","goo/renderer/pass/FullscreenUtil","goo/renderer/shaders/ShaderLib"],function(a,b,c){"use strict";function d(d){this.material=a.createMaterial(d||c.simple),this.useReadBuffer=!0,this.renderToScreen=!1,this.renderable={meshData:b.quad,materials:[this.material]},this.enabled=!0,this.clear=!1,this.needsSwap=!0}return d.prototype.render=function(a,c,d){this.useReadBuffer&&this.material.setTexture("DIFFUSE_MAP",d),this.renderToScreen?a.render(this.renderable,b.camera,[],null,this.clear):a.render(this.renderable,b.camera,[],c,this.clear)},d}),define("goo/renderer/shadow/ShadowHandler",["goo/math/Vector3","goo/renderer/pass/FullscreenPass","goo/renderer/Camera","goo/renderer/Material","goo/renderer/shaders/ShaderLib","goo/renderer/pass/RenderTarget","goo/math/Vector4","goo/renderer/light/PointLight","goo/renderer/light/DirectionalLight","goo/renderer/light/SpotLight"],function(a,b,c,d,e,f,g,h,i,j){"use strict";function k(){this.depthMaterial=d.createMaterial(e.lightDepth,"depthMaterial"),this.depthMaterial.cullState.cullFace="Back",this.fullscreenPass=new b,this.downsample=d.createShader(e.downsample,"downsample");var c=2;this.blurfilter=d.createShader(e.convolution,"blurfilter");var f=2*Math.ceil(3*c)+1;this.blurfilter.defines={KERNEL_SIZE_FLOAT:f.toFixed(1),KERNEL_SIZE_INT:f.toFixed(0)},this.blurfilter.uniforms.cKernel=e.convolution.buildKernel(c),this.oldClearColor=new g(0,0,0,0),this.shadowClearColor=new g(1,1,1,1),this.renderList=[],this.shadowList=[],this.tmpVec=new a,this.first=!0}return k.prototype._createShadowData=function(a){var b=a.resolution[0],c=a.resolution[1];a.shadowData=a.shadowData||{},a.shadowData.shadowTarget=new f(b,c,{type:"Float",magFilter:"NearestNeighbor",minFilter:"NearestNeighborNoMipMaps"}),a.shadowData.shadowResult=null,"VSM"===a.shadowType&&(a.shadowData.shadowTargetDown=new f(b/2,c/2,{type:"Float"}),a.shadowData.shadowBlurred=new f(b/2,c/2,{type:"Float"})),a.shadowRecord=a.shadowRecord||{},a.shadowRecord.resolution=a.shadowRecord.resolution||[],a.shadowRecord.resolution[0]=b,a.shadowRecord.resolution[0]=b,a.shadowRecord.shadowType=a.shadowType},k.prototype._testStatesEqual=function(a,b){var c=Object.keys(a),d=Object.keys(b);if(c.length!==d.length)return!1;for(var e=0;e<c.length;e++){var f=c[e];if(a[f]!==b[f])return!1}return!0},k.prototype.checkShadowRendering=function(b,d,e,f){if(this.first===!0)return this.first=!1,void 0;this.shadowResults=[],this.shadowLights=[];for(var g=0;g<f.length;g++){var i=f[g];if(i.shadowCaster){var k=i.shadowSettings;k.shadowData||(this._createShadowData(k),k.shadowData.lightCamera=new c(55,1,1,1e3));var l=k.shadowRecord,m=k.shadowData.lightCamera;if(m.translation.copy(i.translation),i.direction?(this.tmpVec.setv(i.translation).addv(i.direction),m.lookAt(this.tmpVec,k.upVector)):m.lookAt(a.ZERO,k.upVector),l.angle!==i.angle||!l.resolution||l.resolution[0]!==k.resolution[0]||l.resolution[1]!==k.resolution[1]||l.near!==k.near||l.far!==k.far||l.size!==k.size){if(l.resolution&&l.resolution[0]===k.resolution[0]&&l.resolution[1]===k.resolution[1]||this._createShadowData(k),i instanceof j)m.setFrustumPerspective(i.angle,k.resolution[0]/k.resolution[1],k.near,k.far);else if(i instanceof h)m.setFrustumPerspective(90,k.resolution[0]/k.resolution[1],k.near,k.far);else{var n=k.size;m.setFrustum(k.near,k.far,-n,n,n,-n),m.projectionMode=c.Parallel}m.update(),l.resolution=l.resolution||[],l.resolution[0]=k.resolution[0],l.resolution[1]=k.resolution[1],l.angle=i.angle,l.near=k.near,l.far=k.far,l.size=k.size}"VSM"===k.shadowType&&l.shadowType!==k.shadowType&&(this._createShadowData(k),l.shadowType=k.shadowType),m.onFrameChange(),this.depthMaterial.shader.defines.SHADOW_TYPE="VSM"===k.shadowType?2:0,this.depthMaterial.uniforms.cameraScale=1/(m.far-m.near),this.oldClearColor.copy(b.clearColor),b.setClearColor(this.shadowClearColor.r,this.shadowClearColor.g,this.shadowClearColor.b,this.shadowClearColor.a),this.shadowList.length=0;for(var o=0;o<e.length;o++){var p=e[o];p.meshRendererComponent&&p.meshRendererComponent.castShadows&&!p.isSkybox&&this.shadowList.push(p)}switch(d.process(m,this.shadowList,this.renderList),b.render(this.renderList,m,[],k.shadowData.shadowTarget,!0,this.depthMaterial),k.shadowType){case"VSM":this.fullscreenPass.material.shader=this.downsample,this.fullscreenPass.render(b,k.shadowData.shadowTargetDown,k.shadowData.shadowTarget,0),this.fullscreenPass.material.shader=this.blurfilter,this.fullscreenPass.material.uniforms.uImageIncrement=[2/k.resolution[0],0],this.fullscreenPass.render(b,k.shadowData.shadowBlurred,k.shadowData.shadowTargetDown,0),this.fullscreenPass.material.uniforms.uImageIncrement=[0,2/k.resolution[1]],this.fullscreenPass.render(b,k.shadowData.shadowTargetDown,k.shadowData.shadowBlurred,0),k.shadowData.shadowResult=k.shadowData.shadowTargetDown;break;case"PCF":k.shadowData.shadowResult=k.shadowData.shadowTarget;break;case"Basic":k.shadowData.shadowResult=k.shadowData.shadowTarget;break;default:k.shadowData.shadowResult=k.shadowData.shadowTarget}b.setClearColor(this.oldClearColor.r,this.oldClearColor.g,this.oldClearColor.b,this.oldClearColor.a)}}},k}),define("goo/util/ArrayUtil",[],function(){"use strict";var a={};return a.getTypedArray=function(a,b){var c=b[0],d=b[1],e=b[2];if("float32"===e)return new Float32Array(a,c,d);if("uint8"===e)return new Uint8Array(a,c,d);if("uint16"===e)return new Uint16Array(a,c,d);if("uint32"===e)return new Uint32Array(a,c,d);throw new Error("Binary format "+e+" is not supported")},a.remove=function(a,b,c){var d=-1;if("function"==typeof c){for(var e=0;e<a.length;e++)if(c(a[e],b)){d=e;break}}else d=a.indexOf(b);d>-1&&a.splice(d,1)},a}),define("goo/entities/Bus",["goo/util/ArrayUtil"],function(a){"use strict";function b(){this.trie={name:"",listeners:[],children:{}}}return b.prototype.emit=function(a,b){"string"==typeof a&&(a=[a]);for(var c=0;c<a.length;c++)this._emitToSingle(a[c],b)},b.prototype._getNode=function(a){for(var b=this.trie,c=a.split("."),d=0;d<c.length;d++){var e=c[d];if(!b.children[e])return;b=b.children[e]}return b},b.prototype._emitToSingle=function(a,b){var c=this._getNode(a);c&&this._emitToAll(c,b)},b.prototype._emitToAll=function(a,b){for(var c=0;c<a.listeners.length;c++)a.listeners[c](b);for(var d=Object.keys(a.children),c=0;c<d.length;c++)this._emitToAll(a.children[d],b)},b.prototype.addListener=function(a,b){for(var c=this.trie,d=a.split("."),e=0;e<d.length;e++){var f=d[e];if(c.children[f])c=c.children[f];else{var g={listeners:[],children:[]};c.children[f]=g,c=g}}-1===c.listeners.indexOf(b)&&c.listeners.push(b)},b.prototype.removeListener=function(b,c){var d=this._getNode(b);d&&a.remove(d.listeners,c)},b.prototype.removeAllOnChannel=function(a){var b=this._getNode(a);b&&(b.listeners=[])},b.prototype.removeChannelAndChildren=function(a){var b=a.split("."),c=b.pop(),d=b.join("."),e=this._getNode(d);delete e.children[c]},b.prototype._removeListener=function(b,c){a.remove(b.listeners,c);for(var d=Object.keys(b.children),e=0;e<d.length;e++)this._removeListener(b.children[d[e]],c)},b.prototype.removeListenerFromAllChannels=function(a){this._removeListener(this.trie,a)},b}),define("goo/entities/SystemBus",["goo/entities/Bus"],function(a){"use strict";return new a}),define("goo/renderer/Renderer",["goo/renderer/RendererRecord","goo/renderer/Util","goo/renderer/TextureCreator","goo/renderer/pass/RenderTarget","goo/math/Vector4","goo/entities/Entity","goo/renderer/Texture","goo/loaders/dds/DdsLoader","goo/loaders/dds/DdsUtils","goo/renderer/Material","goo/math/Transform","goo/renderer/RenderQueue","goo/renderer/shaders/ShaderLib","goo/renderer/shadow/ShadowHandler","goo/entities/SystemBus"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){"use strict";function p(b){b=b||{};var c=b.canvas;void 0===c&&(c=document.createElement("canvas"),c.width=500,c.height=500),this.domElement=c,this._alpha=void 0!==b.alpha?b.alpha:!1,this._premultipliedAlpha=void 0!==b.premultipliedAlpha?b.premultipliedAlpha:!0,this._antialias=void 0!==b.antialias?b.antialias:!0,this._stencil=void 0!==b.stencil?b.stencil:!1,this._preserveDrawingBuffer=void 0!==b.preserveDrawingBuffer?b.preserveDrawingBuffer:!1,this._onError=b.onError;
var d={alpha:this._alpha,premultipliedAlpha:this._premultipliedAlpha,antialias:this._antialias,stencil:this._stencil,preserveDrawingBuffer:this._preserveDrawingBuffer};if(this.context=null,!window.WebGLRenderingContext)throw{name:"GooWebGLError",message:"WebGL is not supported",supported:!1,enabled:!1};for(var f=["experimental-webgl","webgl","moz-webgl","webkit-3d"],g=0;g<f.length;g++)try{if(this.context=c.getContext(f[g],d),this.context&&"function"==typeof this.context.getParameter)break}catch(k){}if(!this.context)throw{name:"GooWebGLError",message:"WebGL is supported but disabled",supported:!0,enabled:!1};if(b.debug){var m=new XMLHttpRequest;m.open("GET","/js/goo/lib/webgl-debug.js",!1),m.onreadystatechange=function(){4===m.readyState&&m.status>=200&&m.status<=299&&window.eval.call(window,m.responseText)},m.send(null),"undefined"==typeof window.WebGLDebugUtils?console.warn("You need to include webgl-debug.js in your script definition to run in debug mode."):(console.log("Running in webgl debug mode."),b.validate?(console.log('Running with "undefined arguments" validation.'),this.context=window.WebGLDebugUtils.makeDebugContext(this.context,this.onDebugError.bind(this),q)):this.context=window.WebGLDebugUtils.makeDebugContext(this.context,this.onDebugError.bind(this)))}this.rendererRecord=new a,this.glExtensionCompressedTextureS3TC=h.SUPPORTS_DDS=i.isSupported(this.context),this.glExtensionTextureFloat=this.context.getExtension("OES_texture_float"),this.glExtensionTextureFloatLinear=this.context.getExtension("OES_texture_float_linear"),this.glExtensionTextureHalfFloat=this.context.getExtension("OES_texture_half_float"),this.glExtensionStandardDerivatives=this.context.getExtension("OES_standard_derivatives"),this.glExtensionTextureFilterAnisotropic=this.context.getExtension("EXT_texture_filter_anisotropic")||this.context.getExtension("MOZ_EXT_texture_filter_anisotropic")||this.context.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.glExtensionDepthTexture=this.context.getExtension("WEBGL_depth_texture")||this.context.getExtension("WEBKIT_WEBGL_depth_texture")||this.context.getExtension("MOZ_WEBGL_depth_texture"),this.glExtensionElementIndexUInt=this.context.getExtension("OES_element_index_uint"),this.glExtensionTextureFloat||console.log("Float textures not supported."),this.glExtensionTextureFloatLinear||console.log("Float textures with linear filtering not supported."),this.glExtensionStandardDerivatives||console.log("Standard derivatives not supported."),this.glExtensionTextureFilterAnisotropic||console.log("Anisotropic texture filtering not supported."),this.glExtensionCompressedTextureS3TC||console.log("S3TC compressed textures not supported."),this.glExtensionDepthTexture||console.log("Depth textures not supported."),this.glExtensionElementIndexUInt||console.log("32 bit indices not supported."),void 0===this.context.getShaderPrecisionFormat&&(this.context.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}}),this.capabilities={maxTexureSize:this.context.getParameter(r.MAX_TEXTURE_SIZE),maxCubemapSize:this.context.getParameter(r.MAX_CUBE_MAP_TEXTURE_SIZE),maxRenderbufferSize:this.context.getParameter(r.MAX_RENDERBUFFER_SIZE),maxViewPortDims:this.context.getParameter(r.MAX_VIEWPORT_DIMS),maxAnisotropy:this.glExtensionTextureFilterAnisotropic?this.context.getParameter(this.glExtensionTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,maxVertexTextureUnits:this.context.getParameter(r.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxFragmentTextureUnits:this.context.getParameter(r.MAX_TEXTURE_IMAGE_UNITS),maxCombinedTextureUnits:this.context.getParameter(r.MAX_COMBINED_TEXTURE_IMAGE_UNITS),maxVertexAttributes:this.context.getParameter(r.MAX_VERTEX_ATTRIBS),maxVertexUniformVectors:this.context.getParameter(r.MAX_VERTEX_UNIFORM_VECTORS),maxFragmentUniformVectors:this.context.getParameter(r.MAX_FRAGMENT_UNIFORM_VECTORS),maxVaryingVectors:this.context.getParameter(r.MAX_VARYING_VECTORS),aliasedPointSizeRange:this.context.getParameter(r.ALIASED_POINT_SIZE_RANGE),aliasedLineWidthRange:this.context.getParameter(r.ALIASED_LINE_WIDTH_RANGE),samples:this.context.getParameter(r.SAMPLES),sampleBuffers:this.context.getParameter(r.SAMPLE_BUFFERS),depthBits:this.context.getParameter(r.DEPTH_BITS),stencilBits:this.context.getParameter(r.STENCIL_BITS),subpixelBits:this.context.getParameter(r.SUBPIXEL_BITS),supportedExtensionsList:this.context.getSupportedExtensions(),renderer:this.context.getParameter(r.RENDERER),vendor:this.context.getParameter(r.VENDOR),version:this.context.getParameter(r.VERSION),shadingLanguageVersion:this.context.getParameter(r.SHADING_LANGUAGE_VERSION),vertexShaderHighpFloat:this.context.getShaderPrecisionFormat(this.context.VERTEX_SHADER,this.context.HIGH_FLOAT),vertexShaderMediumpFloat:this.context.getShaderPrecisionFormat(this.context.VERTEX_SHADER,this.context.MEDIUM_FLOAT),vertexShaderLowpFloat:this.context.getShaderPrecisionFormat(this.context.VERTEX_SHADER,this.context.LOW_FLOAT),fragmentShaderHighpFloat:this.context.getShaderPrecisionFormat(this.context.FRAGMENT_SHADER,this.context.HIGH_FLOAT),fragmentShaderMediumpFloat:this.context.getShaderPrecisionFormat(this.context.FRAGMENT_SHADER,this.context.MEDIUM_FLOAT),fragmentShaderLowpFloat:this.context.getShaderPrecisionFormat(this.context.FRAGMENT_SHADER,this.context.LOW_FLOAT),vertexShaderHighpInt:this.context.getShaderPrecisionFormat(this.context.VERTEX_SHADER,this.context.HIGH_INT),vertexShaderMediumpInt:this.context.getShaderPrecisionFormat(this.context.VERTEX_SHADER,this.context.MEDIUM_INT),vertexShaderLowpInt:this.context.getShaderPrecisionFormat(this.context.VERTEX_SHADER,this.context.LOW_INT),fragmentShaderHighpInt:this.context.getShaderPrecisionFormat(this.context.FRAGMENT_SHADER,this.context.HIGH_INT),fragmentShaderMediumpInt:this.context.getShaderPrecisionFormat(this.context.FRAGMENT_SHADER,this.context.MEDIUM_INT),fragmentShaderLowpInt:this.context.getShaderPrecisionFormat(this.context.FRAGMENT_SHADER,this.context.LOW_INT)},this.shaderPrecision=b.shaderPrecision||"highp",this.shaderPrecision="highp"===this.shaderPrecision&&this.capabilities.vertexShaderHighpFloat.precision>0&&this.capabilities.fragmentShaderHighpFloat.precision>0?"highp":"lowp"!==this.shaderPrecision&&this.capabilities.vertexShaderMediumpFloat.precision>0&&this.capabilities.fragmentShaderMediumpFloat.precision>0?"mediump":"lowp",this.downScale=b.downScale||1,this.clearColor=new e,this._clearColor=new Float64Array(4),this.setClearColor(.3,.3,.3,1),this.context.clearDepth(1),this.context.clearStencil(0),this.context.stencilMask(0),this.context.enable(r.DEPTH_TEST),this.context.depthFunc(r.LEQUAL),this.viewportX=0,this.viewportY=0,this.viewportWidth=0,this.viewportHeight=0,this.currentWidth=0,this.currentHeight=0,this._overrideMaterials=[],this._mergedMaterial=new j("Merged Material"),this.renderQueue=new l,this.info={calls:0,vertices:0,indices:0,reset:function(){this.calls=0,this.vertices=0,this.indices=0},toString:function(){return"Calls: "+this.calls+" Vertices: "+this.vertices+" Indices: "+this.indices}},this.shadowHandler=new n,this.hardwarePicking=null}function q(a,b){for(var c=0;c<b.length;++c)void 0===b[c]&&console.error("undefined passed to gl."+a+"("+window.WebGLDebugUtils.glFunctionArgsToString(a,b)+")")}var r=window.WebGLRenderingContext;return p.prototype.onDebugError=function(a,b,c){for(var d="WebGL error "+window.WebGLDebugUtils.glEnumToString(a)+" in "+b+"(",e=0;e<c.length;++e)d+=(0===e?"":", ")+window.WebGLDebugUtils.glFunctionArgToString(b,e,c[e]);d+=")",console.error(d),this._onError&&this._onError(d)},p.mainCamera=null,o.addListener("goo.setCurrentCamera",function(a){p.mainCamera=a}),p.prototype.checkResize=function(a){var b=this.domElement.offsetWidth/this.downScale,c=this.domElement.offsetHeight/this.downScale;(b!==this.domElement.width||c!==this.domElement.height)&&this.setSize(b,c);var d=this.domElement.width/this.domElement.height;a&&a.aspect!==d&&0===a.projectionMode&&(a.aspect=d,a.setFrustumPerspective(),a.onFrameChange())},p.prototype.setSize=function(a,b){this.domElement.width=a,this.domElement.height=b,this.setViewport(0,0,a,b),null!==this.hardwarePicking&&(this.hardwarePicking.pickingTarget=null)},p.prototype.setViewport=function(a,b,c,d){this.viewportX=void 0!==a?a:0,this.viewportY=void 0!==b?b:0,this.viewportWidth=void 0!==c?c:this.domElement.width,this.viewportHeight=void 0!==d?d:this.domElement.height,this.context.viewport(this.viewportX,this.viewportY,this.viewportWidth,this.viewportHeight)},p.prototype.setClearColor=function(a,b,c,d){(this._clearColor[0]!==a||this._clearColor[1]!==b||this._clearColor[2]!==c||this._clearColor[3]!==d)&&(this._clearColor[0]=a,this._clearColor[1]=b,this._clearColor[2]=c,this._clearColor[3]=d,this.clearColor.seta(this._clearColor),this.context.clearColor(a,b,c,d))},p.prototype.bindData=function(a){var b=a.glBuffer;null!==b?(this.setBoundBuffer(b,a.target),a._dataNeedsRefresh&&(this.context.bufferSubData(this.getGLBufferTarget(a.target),0,a.data),a._dataNeedsRefresh=!1)):(b=this.context.createBuffer(),a.glBuffer=b,this.rendererRecord.invalidateBuffer(a.target),this.setBoundBuffer(b,a.target),this.context.bufferData(this.getGLBufferTarget(a.target),a.data,this.getGLBufferUsage(a._dataUsage)))},p.prototype.setShadowType=function(a){this.shadowHandler.shadowType=a},p.prototype.updateShadows=function(a,b,c){this.shadowHandler.checkShadowRendering(this,a,b,c)},p.prototype.render=function(a,c,d,e,f,g){if(this._overrideMaterials=g?g instanceof Array?g:[g]:[],c){null===p.mainCamera&&(p.mainCamera=c),this.setRenderTarget(e),void 0===f||null===f||f===!0?this.clear():"object"==typeof f&&this.clear(f.color,f.depth,f.stencil);var h={camera:c,mainCamera:p.mainCamera,lights:d,shadowHandler:this.shadowHandler,renderer:this};if(Array.isArray(a)){this.renderQueue.sort(a,c);for(var i=0;i<a.length;i++){var j=a[i];this.fillRenderInfo(j,h),this.renderMesh(h)}}else this.fillRenderInfo(a,h),this.renderMesh(h);e&&e.generateMipmaps&&b.isPowerOfTwo(e.width)&&b.isPowerOfTwo(e.height)&&this.updateRenderTargetMipmap(e)}},p.prototype.fillRenderInfo=function(a,b){a instanceof f?(b.meshData=a.meshDataComponent.meshData,b.materials=a.meshRendererComponent.materials,b.transform=a.particleComponent?k.IDENTITY:a.transformComponent.worldTransform,a.meshDataComponent.currentPose?b.currentPose=a.meshDataComponent.currentPose:delete b.currentPose):(b.meshData=a.meshData,b.materials=a.materials,b.transform=a.transform),b.renderable=a},p.prototype._override=function(a,b,c){c.empty();for(var d=Object.keys(c),e=0,f=d.length;f>e;e++){var g=d[e],h=c[g],i=a[g],j=b[g];if(h instanceof Object&&"shader"!==g){for(var k=Object.keys(i),l=0,m=k.length;m>l;l++){var n=k[l];h[n]=i[n]}for(var k=Object.keys(j),l=0,m=k.length;m>l;l++){var n=k[l];void 0===h[n]&&(h[n]=j[n])}}else c[g]=void 0!==i?i:j}},p.prototype.renderMesh=function(a){var b=a.meshData;if(!(null===b.vertexData||null!==b.vertexData&&0===b.vertexData.data.byteLength||null!==b.indexData&&0===b.indexData.data.byteLength)){this.bindData(b.vertexData);var c=a.materials,d=null,e=b,f=0;f=0===this._overrideMaterials.length?c.length:this._overrideMaterials.length;for(var g=0;f>g;g++){var h=null,i=null;if(g<c.length&&(h=c[g]),g<this._overrideMaterials.length&&(i=this._overrideMaterials[g]),h&&i?(this._override(i,h,this._mergedMaterial),h=this._mergedMaterial):i&&(h=i),h.shader){h.errorOnce=!1,h.wireframe&&"wire"!==d?(b.wireframeData||(b.wireframeData=b.buildWireframeData()),b=b.wireframeData,this.bindData(b.vertexData),d="wire"):h.flat&&"flat"!==d?(b.flatMeshData||(b.flatMeshData=b.buildFlatMeshData()),b=b.flatMeshData,this.bindData(b.vertexData),d="flat"):h.wireframe||h.flat||null===d||(b=e,this.bindData(b.vertexData),d=null),a.material=h,a.meshData=b;var j=h.shader;if(j.processors||j.defines){if(j.processors)for(var k=0;k<j.processors.length;k++)j.processors[k](j,a);for(var l=Object.keys(j.defines),m=l.length,n=[],k=0;m>k;k++){var o=l[k];n.push(o+"_"+j.defines[o])}n.sort();var p=n.join("_")+"_"+j.name,q=this.rendererRecord.shaderCache=this.rendererRecord.shaderCache||{};if(q[p]){if(j=q[p],j!==h.shader){for(var o in h.shader.uniforms)j.uniforms[o]=h.shader.uniforms[o];h.shader=j}}else j.builder&&j.builder(j,a),j=h.shader=j.clone(),q[p]=j}j.apply(a,this),this.updateDepthTest(h),this.updateCulling(h),this.updateBlending(h),this.updateOffset(h),this.updateTextures(h),this.updateLineAndPointSettings(h),this._checkDualTransparency(h,b),this.updateCulling(h),this._drawBuffers(b),this.info.calls++,this.info.vertices+=b.vertexCount,this.info.indices+=b.indexCount}else h.errorOnce||(console.warn("No shader set on material: "+h.name),h.errorOnce=!0)}}},p.prototype._drawBuffers=function(a){null!==a.getIndexBuffer()?(this.bindData(a.getIndexData()),null!==a.getIndexLengths()?this.drawElementsVBO(a.getIndexBuffer(),a.getIndexModes(),a.getIndexLengths()):this.drawElementsVBO(a.getIndexBuffer(),a.getIndexModes(),[a.getIndexBuffer().length])):null!==a.getIndexLengths()?this.drawArraysVBO(a.getIndexModes(),a.getIndexLengths()):this.drawArraysVBO(a.getIndexModes(),[a.vertexCount])},p.prototype._checkDualTransparency=function(a,b){if(a.dualTransparency){var c=a.cullState.cullFace,d="Front"===c?"Back":"Front";a.cullState.cullFace=d,this.updateCulling(a),this._drawBuffers(b),a.cullState.cullFace=c}},p.prototype.readPixels=function(a,b,c,d,e){this.context.readPixels(a,b,c,d,r.RGBA,r.UNSIGNED_BYTE,e)},p.prototype.drawElementsVBO=function(a,b,c){for(var d=0,e=0,f=a.type=a.type||this.getGLArrayType(a),g=this.getGLByteSize(a),h=0;h<c.length;h++){var i=c[h],j=this.getGLIndexMode(b[e]);this.context.drawElements(j,i,f,d*g),d+=i,e<b.length-1&&e++}},p.prototype.drawArraysVBO=function(a,b){for(var c=0,d=0,e=0;e<b.length;e++){var f=b[e],g=this.getGLIndexMode(a[d]);this.context.drawArrays(g,c,f),c+=f,d<a.length-1&&d++}},p.prototype.renderToPick=function(a,b,c,f,g,h,i,k){if(0!==this.viewportWidth*this.viewportHeight){var l=4;if(null===this.hardwarePicking){var n=j.createEmptyMaterial(m.pickingShader,"pickingMaterial");n.blendState={blending:"NoBlending",blendEquation:"AddEquation",blendSrc:"SrcAlphaFactor",blendDst:"OneMinusSrcAlphaFactor"},this.hardwarePicking={pickingTarget:new d(this.viewportWidth/l,this.viewportHeight/l,{minFilter:"NearestNeighborNoMipMaps",magFilter:"NearestNeighbor"}),pickingMaterial:n,pickingBuffer:new Uint8Array(4),clearColorStore:new e},f=!1}else null===this.hardwarePicking.pickingTarget&&(this.hardwarePicking.pickingTarget=new d(this.viewportWidth/l,this.viewportHeight/l,{minFilter:"NearestNeighborNoMipMaps",magFilter:"NearestNeighbor"}),f=!1);if(f)this.setRenderTarget(this.hardwarePicking.pickingTarget);else{if(this.hardwarePicking.clearColorStore.setv(this.clearColor),g&&void 0!==h&&void 0!==i){var o=Math.floor(h/l),p=Math.floor((this.viewportHeight-i)/l);this.context.enable(r.SCISSOR_TEST),this.context.scissor(o,p,1,1)}for(var q=[],s=0,t=a.length;t>s;s++){var u=a[s];(!u.meshRendererComponent||u.meshRendererComponent.isPickable)&&q.push(u)}this.render(q,b,[],this.hardwarePicking.pickingTarget,c,k||this.hardwarePicking.pickingMaterial),g&&this.context.disable(r.SCISSOR_TEST)}}},p.prototype.pick=function(a,b,c,d){if(0===this.viewportWidth*this.viewportHeight)return c.id=-1,c.depth=0,void 0;var e=4,f=Math.floor(a/e),g=Math.floor((this.viewportHeight-b)/e);this.readPixels(f,g,1,1,this.hardwarePicking.pickingBuffer);var h=255*this.hardwarePicking.pickingBuffer[0]+this.hardwarePicking.pickingBuffer[1]-1,i=(this.hardwarePicking.pickingBuffer[2]/255+this.hardwarePicking.pickingBuffer[3]/65025)*d.far;c.id=h,c.depth=i},p.prototype.updateLineAndPointSettings=function(a){var b=this.rendererRecord.lineRecord,c=a.lineWidth||1;b.lineWidth!==c&&(this.context.lineWidth(c),b.lineWidth=c)},p.prototype.updateDepthTest=function(a){var b=this.rendererRecord.depthRecord,c=a.depthState;b.enabled!==c.enabled&&(c.enabled?this.context.enable(r.DEPTH_TEST):this.context.disable(r.DEPTH_TEST),b.enabled=c.enabled),b.write!==c.write&&(c.write?this.context.depthMask(!0):this.context.depthMask(!1),b.write=c.write)},p.prototype.updateCulling=function(a){var b=this.rendererRecord.cullRecord,c=a.cullState.cullFace,d=a.cullState.frontFace,e=a.cullState.enabled;if(b.enabled!==e&&(e?this.context.enable(r.CULL_FACE):this.context.disable(r.CULL_FACE),b.enabled=e),b.cullFace!==c){var f="Front"===c?r.FRONT:"Back"===c?r.BACK:r.FRONT_AND_BACK;this.context.cullFace(f),b.cullFace=c}if(b.frontFace!==d){switch(d){case"CCW":this.context.frontFace(r.CCW);break;case"CW":this.context.frontFace(r.CW)}b.frontFace=d}},p.prototype.updateTextures=function(a){for(var e=this.context,f=a.shader.textureSlots,g=0;g<f.length;g++){var h=f[g],i=a.getTexture(h.mapping);if(void 0!==i){var j=i;i instanceof Array==0&&(j=[i]);for(var k=0;k<j.length;k++){i=j[k];var l=h.index instanceof Array?h.index[k]:h.index;(null===i||i instanceof d==0&&(void 0===i.image||i.checkDataReady()===!1))&&("sampler2D"===h.format?i=c.DEFAULT_TEXTURE_2D:"samplerCube"===h.format&&(i=c.DEFAULT_TEXTURE_CUBE));var m=this.rendererRecord.textureRecord[l];void 0===m&&(m=this.rendererRecord.textureRecord[l]={}),null===i.glTexture?(i.glTexture=e.createTexture(),this.updateTexture(e,i,l,m)):i instanceof d==0&&i.checkNeedsUpdate()?(this.updateTexture(e,i,l,m),i.needsUpdate=!1):this.bindTexture(e,i,l,m);var n=void 0!==i.image?i.image:i,o=b.isPowerOfTwo(n.width)&&b.isPowerOfTwo(n.height);this.updateTextureParameters(i,o)}}}},p.prototype.updateTextureParameters=function(a,b){var c=this.context,d=a.textureRecord;void 0===d&&(d={},a.textureRecord=d);var e=this.getGLType(a.variant);d.magFilter!==a.magFilter&&(c.texParameteri(e,r.TEXTURE_MAG_FILTER,this.getGLMagFilter(a.magFilter)),d.magFilter=a.magFilter);var f=b?a.minFilter:this.getFilterFallback(a.minFilter);d.minFilter!==f&&(c.texParameteri(e,r.TEXTURE_MIN_FILTER,this.getGLMinFilter(f)),d.minFilter=f);var g=b?a.wrapS:"EdgeClamp";if(d.wrapS!==g){var h=this.getGLWrap(g,c);c.texParameteri(e,r.TEXTURE_WRAP_S,h),d.wrapS=g}var i=b?a.wrapT:"EdgeClamp";if(d.wrapT!==i){var j=this.getGLWrap(i,c);c.texParameteri(e,r.TEXTURE_WRAP_T,j),d.wrapT=i}if(this.glExtensionTextureFilterAnisotropic&&"Float"!==a.type){var k=a.anisotropy;d.anisotropy!==k&&(c.texParameterf(e,this.glExtensionTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(k,this.capabilities.maxAnisotropy)),d.anisotropy=k)}},p.prototype.bindTexture=function(a,b,c,d){(void 0===d.boundTexture||void 0!==b.glTexture&&d.boundTexture!==b.glTexture)&&(a.activeTexture(r.TEXTURE0+c),a.bindTexture(this.getGLType(b.variant),b.glTexture),d.boundTexture=b.glTexture)},p.prototype.getGLType=function(a){switch(a){case"2D":return r.TEXTURE_2D;case"CUBE":return r.TEXTURE_CUBE_MAP}throw"invalid texture type: "+a},p.prototype.loadCompressedTexture=function(a,b,c,d){var e=c.image.mipmapSizes,f=0,g=0,h=c.image.width,j=c.image.height,k=i.getDdsExtension(a),l=k.COMPRESSED_RGBA_S3TC_DXT5_EXT;if("PrecompressedDXT1"===c.format)l=k.COMPRESSED_RGB_S3TC_DXT1_EXT;else if("PrecompressedDXT1A"===c.format)l=k.COMPRESSED_RGBA_S3TC_DXT1_EXT;else if("PrecompressedDXT3"===c.format)l=k.COMPRESSED_RGBA_S3TC_DXT3_EXT;else{if("PrecompressedDXT5"!==c.format)throw new Error("Unhandled compression format: "+d.getDataFormat().name());l=k.COMPRESSED_RGBA_S3TC_DXT5_EXT}if("undefined"==typeof e||null===e)d instanceof Uint8Array?a.compressedTexImage2D(b,0,l,h,j,0,d):a.compressedTexImage2D(b,0,l,h,j,0,new Uint8Array(d.buffer,d.byteOffset,d.byteLength));else{if(c.generateMipmaps=!1,d instanceof Array)for(var m=0;m<d.length;m++)a.compressedTexImage2D(b,m,l,h,j,0,d[m]),h=~~(h/2)>1?~~(h/2):1,j=~~(j/2)>1?~~(j/2):1;else for(var m=0;m<e.length;m++)g=e[m],a.compressedTexImage2D(b,m,l,h,j,0,new Uint8Array(d.buffer,d.byteOffset+f,g)),h=~~(h/2)>1?~~(h/2):1,j=~~(j/2)>1?~~(j/2):1,f+=g;var n=1+Math.ceil(Math.log(Math.max(c.image.height,c.image.width))/Math.log(2)),o=e[e.length-1];if(e.length<n)for(var m=e.length;n>m;m++)o=2*~~((h+3)/4)*~~((j+3)/4)*c.image.bpp,a.compressedTexImage2D(b,m,l,h,j,0,new Uint8Array(o)),h=~~(h/2)>1?~~(h/2):1,j=~~(j/2)>1?~~(j/2):1}},p.prototype.updateTexture=function(a,c,d,e){a.activeTexture(r.TEXTURE0+d),a.bindTexture(this.getGLType(c.variant),c.glTexture),e.boundTexture=c.glTexture,a.pixelStorei(r.UNPACK_ALIGNMENT,c.unpackAlignment),a.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,c.premultiplyAlpha),a.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,c.flipY);var f=c.image;if("2D"===c.variant)f?(!f.isCompressed&&(c.generateMipmaps||f.width>this.capabilities.maxTexureSize||f.height>this.capabilities.maxTexureSize)&&(this.checkRescale(c,f,f.width,f.height,this.capabilities.maxTexureSize),f=c.image),f.isData===!0?f.isCompressed?this.loadCompressedTexture(a,r.TEXTURE_2D,c,f.data):a.texImage2D(r.TEXTURE_2D,0,this.getGLInternalFormat(c.format),f.width,f.height,c.hasBorder?1:0,this.getGLInternalFormat(c.format),this.getGLPixelDataType(c.type),f.data):a.texImage2D(r.TEXTURE_2D,0,this.getGLInternalFormat(c.format),this.getGLInternalFormat(c.format),this.getGLPixelDataType(c.type),f),c.generateMipmaps&&!f.isCompressed&&a.generateMipmap(r.TEXTURE_2D)):a.texImage2D(r.TEXTURE_2D,0,this.getGLInternalFormat(c.format),c.width,c.height,0,this.getGLInternalFormat(c.format),this.getGLPixelDataType(c.type),null);else if("CUBE"===c.variant){if(f&&(c.generateMipmaps||f.width>this.capabilities.maxCubemapSize||f.height>this.capabilities.maxCubemapSize)){for(var h=0;h<g.CUBE_FACES.length;h++)this.checkRescale(c,f.data[h],f.width,f.height,this.capabilities.maxCubemapSize,h);c.image.width=Math.min(this.capabilities.maxCubemapSize,b.nearestPowerOfTwo(c.image.width)),c.image.height=Math.min(this.capabilities.maxCubemapSize,b.nearestPowerOfTwo(c.image.height)),f=c.image}for(var i=0;i<g.CUBE_FACES.length;i++){var j=g.CUBE_FACES[i];f?f.isData===!0?f.isCompressed?this.loadCompressedTexture(a,this.getGLCubeMapFace(j),c,f.data[i]):a.texImage2D(this.getGLCubeMapFace(j),0,this.getGLInternalFormat(c.format),f.width,f.height,c.hasBorder?1:0,this.getGLInternalFormat(c.format),this.getGLPixelDataType(c.type),f.data[i]):a.texImage2D(this.getGLCubeMapFace(j),0,this.getGLInternalFormat(c.format),this.getGLInternalFormat(c.format),this.getGLPixelDataType(c.type),f.data[i]):a.texImage2D(this.getGLCubeMapFace(j),0,this.getGLInternalFormat(c.format),c.width,c.height,0,this.getGLInternalFormat(c.format),this.getGLPixelDataType(c.type),null)}f&&c.generateMipmaps&&!f.isCompressed&&a.generateMipmap(r.TEXTURE_CUBE_MAP)}},p.prototype.checkRescale=function(a,c,d,e,f,g){var h=b.nearestPowerOfTwo(d),i=b.nearestPowerOfTwo(e);if(h=Math.min(h,f),i=Math.min(i,f),d!==h||e!==i){var j=document.createElement("canvas");j.width=h,j.height=i,c.getAttribute&&j.setAttribute("data-ref",c.getAttribute("data-ref"));var k=j.getContext("2d");k.drawImage(c,0,0,d,e,0,0,h,i),document.body.appendChild(j),j.dataReady=!0,j.src=c.src,void 0===g?a.image=j:a.image.data[g]=j,j.parentNode.removeChild(j)}},p.prototype.getGLWrap=function(a){switch(a){case"Repeat":return r.REPEAT;case"MirroredRepeat":return r.MIRRORED_REPEAT;case"EdgeClamp":return r.CLAMP_TO_EDGE}throw"invalid WrapMode type: "+a},p.prototype.getGLInternalFormat=function(a){switch(a){case"RGBA":return r.RGBA;case"RGB":return r.RGB;case"Alpha":return r.ALPHA;case"Luminance":return r.LUMINANCE;case"LuminanceAlpha":return r.LUMINANCE_ALPHA;default:throw"Unsupported format: "+a}},p.prototype.getGLPixelDataType=function(a){switch(a){case"UnsignedByte":return r.UNSIGNED_BYTE;case"UnsignedShort565":return r.UNSIGNED_SHORT_5_6_5;case"UnsignedShort4444":return r.UNSIGNED_SHORT_4_4_4_4;case"UnsignedShort5551":return r.UNSIGNED_SHORT_5_5_5_1;case"Float":return r.FLOAT;default:throw"Unsupported type: "+a}},p.prototype.getFilterFallback=function(a){switch(a){case"NearestNeighborNoMipMaps":case"NearestNeighborNearestMipMap":case"NearestNeighborLinearMipMap":return"NearestNeighborNoMipMaps";case"BilinearNoMipMaps":case"Trilinear":case"BilinearNearestMipMap":return"BilinearNoMipMaps";default:return"NearestNeighborNoMipMaps"}},p.prototype.getGLMagFilter=function(a){switch(a){case"Bilinear":return r.LINEAR;case"NearestNeighbor":return r.NEAREST}throw"invalid MagnificationFilter type: "+a},p.prototype.getGLMinFilter=function(a){switch(a){case"BilinearNoMipMaps":return r.LINEAR;case"Trilinear":return r.LINEAR_MIPMAP_LINEAR;case"BilinearNearestMipMap":return r.LINEAR_MIPMAP_NEAREST;case"NearestNeighborNoMipMaps":return r.NEAREST;case"NearestNeighborNearestMipMap":return r.NEAREST_MIPMAP_NEAREST;case"NearestNeighborLinearMipMap":return r.NEAREST_MIPMAP_LINEAR}throw"invalid MinificationFilter type: "+a},p.prototype.getGLBufferTarget=function(a){return"ElementArrayBuffer"===a?r.ELEMENT_ARRAY_BUFFER:r.ARRAY_BUFFER},p.prototype.getGLArrayType=function(a){return a instanceof Uint8Array?r.UNSIGNED_BYTE:a instanceof Uint16Array?r.UNSIGNED_SHORT:a instanceof Uint32Array?r.UNSIGNED_INT:a instanceof Int8Array?r.UNSIGNED_BYTE:a instanceof Int16Array?r.UNSIGNED_SHORT:a instanceof Int32Array?r.UNSIGNED_INT:null},p.prototype.getGLByteSize=function(a){return a instanceof Uint8Array?1:a instanceof Uint16Array?2:a instanceof Uint32Array?4:a instanceof Int8Array?1:a instanceof Int16Array?2:a instanceof Int32Array?4:1},p.prototype.getGLCubeMapFace=function(a){switch(a){case"PositiveX":return r.TEXTURE_CUBE_MAP_POSITIVE_X;case"NegativeX":return r.TEXTURE_CUBE_MAP_NEGATIVE_X;case"PositiveY":return r.TEXTURE_CUBE_MAP_POSITIVE_Y;case"NegativeY":return r.TEXTURE_CUBE_MAP_NEGATIVE_Y;case"PositiveZ":return r.TEXTURE_CUBE_MAP_POSITIVE_Z;case"NegativeZ":return r.TEXTURE_CUBE_MAP_NEGATIVE_Z}throw"Invalid cubemap face: "+a},p.prototype.getGLBufferUsage=function(a){var b=r.STATIC_DRAW;switch(a){case"StaticDraw":b=r.STATIC_DRAW;break;case"DynamicDraw":b=r.DYNAMIC_DRAW;break;case"StreamDraw":b=r.STREAM_DRAW}return b},p.prototype.getGLIndexMode=function(a){var b=r.TRIANGLES;switch(a){case"Triangles":b=r.TRIANGLES;break;case"TriangleStrip":b=r.TRIANGLE_STRIP;break;case"TriangleFan":b=r.TRIANGLE_FAN;break;case"Lines":b=r.LINES;break;case"LineStrip":b=r.LINE_STRIP;break;case"LineLoop":b=r.LINE_LOOP;break;case"Points":b=r.POINTS}return b},p.prototype.updateBlending=function(a){var b=this.rendererRecord.blendRecord,c=this.context,d=a.blendState.blending;if(d!==b.blending&&("NoBlending"===d?c.disable(r.BLEND):"AdditiveBlending"===d?(c.enable(r.BLEND),c.blendEquation(r.FUNC_ADD),c.blendFunc(r.SRC_ALPHA,r.ONE)):"SubtractiveBlending"===d?(c.enable(r.BLEND),c.blendEquation(r.FUNC_ADD),c.blendFunc(r.ZERO,r.ONE_MINUS_SRC_COLOR)):"MultiplyBlending"===d?(c.enable(r.BLEND),c.blendEquation(r.FUNC_ADD),c.blendFunc(r.DST_COLOR,r.ONE_MINUS_SRC_ALPHA)):"AlphaBlending"===d?(c.enable(r.BLEND),c.blendEquation(r.FUNC_ADD),c.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA)):"CustomBlending"===d?c.enable(r.BLEND):(c.enable(r.BLEND),c.blendEquationSeparate(r.FUNC_ADD,r.FUNC_ADD),c.blendFuncSeparate(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA)),b.blending=d),"CustomBlending"===d){var e=a.blendState.blendEquation,f=a.blendState.blendSrc,g=a.blendState.blendDst;e!==b.blendEquation&&(c.blendEquation(this.getGLBlendParam(e)),b.blendEquation=e),(f!==b.blendSrc||g!==b.blendDst)&&(c.blendFunc(this.getGLBlendParam(f),this.getGLBlendParam(g)),b.blendSrc=f,b.blendDst=g)}else b.blendEquation=null,b.blendSrc=null,b.blendDst=null},p.prototype.updateOffset=function(a){var b=this.rendererRecord.offsetRecord,c=this.context,d=a.offsetState.enabled,e=a.offsetState.factor,f=a.offsetState.units;b.enabled!==d&&(d?c.enable(r.POLYGON_OFFSET_FILL):c.disable(r.POLYGON_OFFSET_FILL),b.enabled=d),!d||b.factor===e&&b.units===f||(c.polygonOffset(e,f),b.factor=e,b.units=f)},p.prototype.setBoundBuffer=function(a,b){var c=this.rendererRecord.currentBuffer[b];c.valid&&c.buffer===a||(this.context.bindBuffer(this.getGLBufferTarget(b),a),c.buffer=a,c.valid=!0)},p.prototype.bindVertexAttribute=function(a,b){this.context.vertexAttribPointer(a,b.count,this.getGLDataType(b.type),b.normalized,b.stride,b.offset)},p.prototype.getGLDataType=function(a){switch(a){case"Float":case"HalfFloat":case"Double":return r.FLOAT;case"Byte":return r.BYTE;case"UnsignedByte":return r.UNSIGNED_BYTE;case"Short":return r.SHORT;case"UnsignedShort":return r.UNSIGNED_SHORT;case"Int":return r.INT;case"UnsignedInt":return r.UNSIGNED_INT;default:throw"Unknown datatype: "+a}},p.prototype.getGLBlendParam=function(a){switch(a){case"AddEquation":return r.FUNC_ADD;case"SubtractEquation":return r.FUNC_SUBTRACT;case"ReverseSubtractEquation":return r.FUNC_REVERSE_SUBTRACT;case"ZeroFactor":return r.ZERO;case"OneFactor":return r.ONE;case"SrcColorFactor":return r.SRC_COLOR;case"OneMinusSrcColorFactor":return r.ONE_MINUS_SRC_COLOR;case"SrcAlphaFactor":return r.SRC_ALPHA;case"OneMinusSrcAlphaFactor":return r.ONE_MINUS_SRC_ALPHA;case"DstAlphaFactor":return r.DST_ALPHA;case"OneMinusDstAlphaFactor":return r.ONE_MINUS_DST_ALPHA;case"DstColorFactor":return r.DST_COLOR;case"OneMinusDstColorFactor":return r.ONE_MINUS_DST_COLOR;case"SrcAlphaSaturateFactor":return r.SRC_ALPHA_SATURATE;default:throw"Unknown blend param: "+a}},p.prototype.clear=function(a,b,c){var d=0;(void 0===a||a)&&(d|=r.COLOR_BUFFER_BIT),(void 0===b||b)&&(d|=r.DEPTH_BUFFER_BIT),(void 0===c||c)&&(d|=r.STENCIL_BUFFER_BIT);var e=this.rendererRecord.depthRecord;e.write!==!0&&(this.context.depthMask(!0),e.write=!0),this.context.clear(d)},p.prototype.flush=function(){this.context.flush()},p.prototype.finish=function(){this.context.finish()},p.prototype.setupFrameBuffer=function(a,b,c){this.context.bindFramebuffer(r.FRAMEBUFFER,a),this.context.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,c,b.glTexture,0)},p.prototype.setupRenderBuffer=function(a,b){this.context.bindRenderbuffer(r.RENDERBUFFER,a),b.depthBuffer&&!b.stencilBuffer?(this.context.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_COMPONENT16,b.width,b.height),this.context.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.RENDERBUFFER,a)):b.depthBuffer&&b.stencilBuffer?(this.context.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_STENCIL,b.width,b.height),this.context.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.RENDERBUFFER,a)):this.context.renderbufferStorage(r.RENDERBUFFER,r.RGBA4,b.width,b.height)},p.prototype.setRenderTarget=function(a){if(a&&!a._glFrameBuffer){void 0===a.depthBuffer&&(a.depthBuffer=!0),void 0===a.stencilBuffer&&(a.stencilBuffer=!0),a.glTexture=this.context.createTexture();var c=b.isPowerOfTwo(a.width)&&b.isPowerOfTwo(a.height),d=this.getGLInternalFormat(a.format),e=this.getGLDataType(a.type);a._glFrameBuffer=this.context.createFramebuffer(),a._glRenderBuffer=this.context.createRenderbuffer(),this.context.bindTexture(r.TEXTURE_2D,a.glTexture),this.updateTextureParameters(a,c),this.context.texImage2D(r.TEXTURE_2D,0,d,a.width,a.height,0,d,e,null),this.setupFrameBuffer(a._glFrameBuffer,a,r.TEXTURE_2D),this.setupRenderBuffer(a._glRenderBuffer,a),a.generateMipmaps&&c&&this.context.generateMipmap(r.TEXTURE_2D),this.context.bindTexture(r.TEXTURE_2D,null),this.context.bindRenderbuffer(r.RENDERBUFFER,null),this.context.bindFramebuffer(r.FRAMEBUFFER,null)}var f,g,h,i,j;a?(f=a._glFrameBuffer,i=0,j=0,g=a.width,h=a.height):(f=null,i=this.viewportX,j=this.viewportY,g=this.viewportWidth,h=this.viewportHeight),f!==this.rendererRecord.currentFrameBuffer&&(this.context.bindFramebuffer(r.FRAMEBUFFER,f),this.context.viewport(i,j,g,h),this.rendererRecord.currentFrameBuffer=f,this.rendererRecord.textureRecord=[]),this.currentWidth=g,this.currentHeight=h},p.prototype.updateRenderTargetMipmap=function(a){this.context.bindTexture(r.TEXTURE_2D,a.glTexture),this.context.generateMipmap(r.TEXTURE_2D),this.context.bindTexture(r.TEXTURE_2D,null)},p.prototype.getCapabilitiesString=function(){var a=[];for(var b in this.capabilities){var c=this.capabilities[b],d="";if(c instanceof ArrayBufferView){d+="[";for(var e=0;e<c.length;e++)d+=c[e],e<c.length-1&&(d+=",");d+="]"}else d=c;a.push(b+": "+d)}return a.join("\n")},p.prototype._deallocateMeshData=function(){},p.prototype._deallocateTexture=function(){},p.prototype._deallocateRenderTarget=function(){},p.prototype._deallocateShader=function(){},p
}),define("goo/addons/howler/systems/HowlerSystem",["goo/entities/systems/System","goo/math/Vector3","goo/renderer/Renderer"],function(a,b,c){"use strict";function d(b){a.call(this,"HowlerSystem",["HowlerComponent"]),this.settings=b||{},this.settings.scale=this.settings.scale||.1}return d.prototype=Object.create(a.prototype),d.prototype.deleted=function(a){for(var b=a.howlerComponent,c=b.sounds,d=0;d<c.length;d++)c[d].stop()},d.prototype.process=function(a){for(var d=0;d<a.length;d++){var e=a[d],f=e.howlerComponent,g=f.sounds,h=new b;h.copy(e.transformComponent.transform.translation);for(var i=c.mainCamera.getViewMatrix().applyPostPoint(h),d=0;d<g.length;d++)g[d].pos3d(i.data[0]*this.settings.scale,i.data[1]*this.settings.scale,i.data[2]*this.settings.scale)}},d}),define("goo/addons/scripts/PolyBoundingScript",[],function(){"use strict";function a(a){this.collidables=a||[]}return a.prototype.addCollidable=function(a){this.collidables.push(a)},a.prototype.removeAllAt=function(a,b,c){this.collidables=this.collidables.filter(function(d){return d.bottom<=c&&d.top>=c?!window.PolyK.ContainsPoint(d.poly,a,b):void 0})},a.prototype.run=function(a){for(var b=a.transformComponent,c=b.transform.translation,d=0;d<this.collidables.length;d++){var e=this.collidables[d];if(e.bottom<=c.data[1]&&e.top>=c.data[1]&&window.PolyK.ContainsPoint(e.poly,c.data[0],c.data[2])){var f=window.PolyK.ClosestEdge(e.poly,c.data[0],c.data[2]);return c.data[0]=f.point.x,c.data[2]=f.point.y,b.setUpdated(),void 0}}},a}),define("goo/addons/soundmanager2/components/SoundManager2Component",["goo/entities/components/Component"],function(a){"use strict";function b(a){this.type="SoundManager2Component",this.settings=a||{},this.sounds={}}return b.prototype=Object.create(a.prototype),b.prototype.addSound=function(a,b){this.sounds[a]=b},b.prototype.playSound=function(a){this.sounds[a].soundObject.play()},b}),define("goo/addons/soundmanager2/systems/SoundManager2System",["goo/entities/systems/System"],function(a){"use strict";function b(b){a.call(this,"SoundManager2System",["SoundManager2Component","TransformComponent"]),b=b||{},this.isReady=!1,window.soundManager?window.soundManager.bind(this).setup({url:"swf",onready:function(){this.isReady=!0},ontimeout:function(){console.warn("Failed to load soundmanager")}}):console.warn("SoundManager2System: soundManager global not found")}return b.prototype=Object.create(a.prototype),b.prototype.inserted=function(a){for(var b=a.soundManager2Component,c=0;c<b.sounds.length;c++){var d=b.sounds[c],e=window.soundManager.createSound(d);d.soundObject=e}},b.prototype.deleted=function(){},b.prototype.process=function(){},b}),define("goo/entities/components/MeshDataComponent",["goo/renderer/bounds/BoundingSphere","goo/entities/components/Component"],function(a,b){"use strict";function c(b){this.type="MeshDataComponent",this.meshData=b,this.modelBound=new a,this.autoCompute=!0,this.currentPose=null}return c.prototype=Object.create(b.prototype),c.prototype.setModelBound=function(a,b){this.modelBound=a,this.autoCompute=b},c.prototype.computeBoundFromPoints=function(){if(this.autoCompute&&null!==this.modelBound){var a=this.meshData.getAttributeBuffer("POSITION");void 0!==a&&(this.modelBound.computeFromPoints(a),this.autoCompute=!1)}},c}),define("goo/entities/components/MeshRendererComponent",["goo/entities/components/Component"],function(a){"use strict";function b(){this.type="MeshRendererComponent",this.materials=[],this.worldBound=null,this.cullMode="Dynamic",this.castShadows=!0,this.receiveShadows=!0,this.isPickable=!0,this.isReflectable=!0,this.hidden=!1}return b.prototype=Object.create(a.prototype),b.prototype.updateBounds=function(a,b){this.worldBound=a.transform(b,this.worldBound)},b}),define("goo/addons/terrain/Terrain",["goo/entities/components/MeshDataComponent","goo/entities/components/MeshRendererComponent","goo/renderer/MeshData","goo/renderer/Material","goo/renderer/Shader","goo/renderer/TextureCreator"],function(a,b,c,d,e,f){"use strict";function g(a){var b="../resources",c=d.createMaterial(h),e=(new f).loadTexture2D(b+"/head_diffuse.jpg");c.setTexture("DIFFUSE_MAP",e);var g=d.createMaterial(h);g.setTexture("HEIGHT_MAP",e),g.wireframe=!0,this.material=c,this.material2=g;var i=a.createEntity();i.addToWorld();for(var j=0;6>j;j++){var k=this.createClipmapLevel(a,j,0===j);i.transformComponent.attachChild(k.transformComponent)}}g.prototype.createClipmapLevel=function(a,b,c){var d=a.createEntity(),e=Math.pow(2,b);d.transformComponent.transform.scale.set(e,e,1);var f=(2*Math.pow(-1,b+1)+Math.pow(2,b+1))/6,g=0===b%2?f:-f;return d.transformComponent.transform.translation.set(g,-g,0),d.addToWorld(),this.createQuadEntity(a,d,0,0,3,3),this.createQuadEntity(a,d,3,0,3,3),this.createQuadEntity(a,d,6,0,2,3),this.createQuadEntity(a,d,8,0,3,3),this.createQuadEntity(a,d,11,0,3,3),this.createQuadEntity(a,d,0,3,3,3),this.createQuadEntity(a,d,11,3,3,3),this.createQuadEntity(a,d,0,6,3,2),this.createQuadEntity(a,d,11,6,3,2),this.createQuadEntity(a,d,0,8,3,3),this.createQuadEntity(a,d,11,8,3,3),this.createQuadEntity(a,d,0,11,3,3),this.createQuadEntity(a,d,3,11,3,3),this.createQuadEntity(a,d,6,11,2,3),this.createQuadEntity(a,d,8,11,3,3),this.createQuadEntity(a,d,11,11,3,3),c&&this.createQuadEntity(a,d,3,4,7,7),d},g.prototype.createQuadEntity=function(c,d,e,f,g,h){var i=this.createGrid(e,f,g,h),j=c.createEntity();d.transformComponent.attachChild(j.transformComponent);var k=new a(i);j.setComponent(k);var l=new b;return l.materials.push(this.material2),j.setComponent(l),j.addToWorld(),j},g.prototype.createGrid=function(a,b,d,e){for(var f=c.defaultMap([c.POSITION,c.TEXCOORD0]),g=new c(f,(d+1)*(e+1),6*d*e),h=g.getAttributeBuffer(c.POSITION),i=g.getAttributeBuffer(c.TEXCOORD0),j=g.getIndexBuffer(),k=0;d+1>k;k++)for(var l=0;e+1>l;l++){var m=l*(d+1)+k;h[3*m+0]=k+a-7,h[3*m+1]=l+b-7,h[3*m+2]=0,i[2*m+0]=(k+a)/15,i[2*m+1]=(l+b)/15}for(var k=0;d>k;k++)for(var l=0;e>l;l++){var m=l*(d+1)+k,n=l*d+k;j[6*n+0]=m,j[6*n+1]=m+1,j[6*n+2]=m+d+1,j[6*n+3]=m+1,j[6*n+4]=m+d+1+1,j[6*n+5]=m+d+1}return g};var h={attributes:{vertexPosition:c.POSITION,vertexUV0:c.TEXCOORD0},uniforms:{viewMatrix:e.VIEW_MATRIX,projectionMatrix:e.PROJECTION_MATRIX,worldMatrix:e.WORLD_MATRIX,diffuseMap:"DIFFUSE_MAP",time:e.TIME},vshader:["attribute vec3 vertexPosition;","attribute vec2 vertexUV0;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 worldMatrix;","uniform float time;","uniform sampler2D diffuseMap;","varying vec4 texCol;","void main(void) {","	texCol = texture2D(diffuseMap, vertexUV0 + vec2(time*0.0));","	float height = length(texCol.rgb);","	gl_Position = projectionMatrix * viewMatrix * worldMatrix * ","		vec4(vertexPosition.x,vertexPosition.y,height*5.0, 1.0);","}"].join("\n"),fshader:["precision mediump float;","varying vec4 texCol;","void main(void)","{","	gl_FragColor = texCol;","}"].join("\n")};return g}),define("goo/addons/water/FlatWaterRenderer",["goo/renderer/MeshData","goo/renderer/Shader","goo/renderer/Camera","goo/math/Plane","goo/renderer/pass/RenderTarget","goo/math/Vector3","goo/math/Vector4","goo/renderer/Material","goo/renderer/TextureCreator","goo/renderer/shaders/ShaderFragment"],function(a,b,c,d,e,f,g,h,i,j){"use strict";function k(a){a=a||{},this.useRefraction=void 0!==a.useRefraction?a.useRefraction:!0,this.waterCamera=new c(45,1,.1,2e3),this.renderList=[],this.waterPlane=new d;var b=Math.floor(window.innerWidth/(a.divider||2)),j=Math.floor(window.innerHeight/(a.divider||2));this.reflectionTarget=new e(b,j),this.useRefraction&&(this.refractionTarget=new e(b,j),this.depthTarget=new e(b,j));var k=h.createMaterial(l,"WaterMaterial");k.shader.defines.REFRACTION=this.useRefraction,k.cullState.enabled=!1;var n=a.normalsUrl||"../resources/water/waternormals3.png";k.setTexture("NORMAL_MAP",(new i).loadTexture2D(n)),k.setTexture("REFLECTION_MAP",this.reflectionTarget),this.useRefraction&&(k.setTexture("REFRACTION_MAP",this.refractionTarget),k.setTexture("DEPTH_MAP",this.depthTarget)),this.waterMaterial=k,this.followCam=!0,this.updateWaterPlaneFromEntity=void 0!==a.updateWaterPlaneFromEntity?this.updateWaterPlaneFromEntity:!0,this.calcVect=new f,this.camReflectDir=new f,this.camReflectUp=new f,this.camReflectLeft=new f,this.camLocation=new f,this.camReflectPos=new f,this.offset=new f,this.clipPlane=new g,this.waterEntity=null,this.depthMaterial=h.createMaterial(m,"depth")}k.prototype.process=function(a,b,c,d,e){b=b.filter(function(a){return a.meshRendererComponent.isReflectable});var f=this.waterPlane;this.waterCamera.copy(d),this.updateWaterPlaneFromEntity&&(f.constant=this.waterEntity.transformComponent.transform.translation.y);var g=d.translation.y>f.constant;if(this.waterEntity.skip=!0,g){this.useRefraction&&(c.process(this.waterCamera,b,this.renderList),this.clipPlane.setd(f.normal.x,-f.normal.y,f.normal.z,f.constant),this.waterCamera.setToObliqueMatrix(this.clipPlane),a.render(this.renderList,this.waterCamera,e,this.depthTarget,!0,this.depthMaterial),a.render(this.renderList,this.waterCamera,e,this.refractionTarget,!0));var h=this.calcVect,i=this.camReflectDir,j=this.camReflectUp,k=this.camReflectLeft,l=this.camLocation,m=this.camReflectPos;l.set(d.translation);var n=f.pseudoDistance(l);if(h.set(f.normal).mul(2*n),m.set(l.sub(h)),l.set(d.translation).add(d._direction),n=f.pseudoDistance(l),h.set(f.normal).mul(2*n),i.set(l.sub(h)).sub(m).normalize(),l.set(d.translation).add(d._up),n=f.pseudoDistance(l),h.set(f.normal).mul(2*n),j.set(l.sub(h)).sub(m).normalize(),k.set(j).cross(i).normalize(),this.waterCamera.translation.set(m),this.waterCamera._direction.set(i),this.waterCamera._up.set(j),this.waterCamera._left.set(k),this.waterCamera.normalize(),this.waterCamera.update(),this.skybox&&this.followCam){var o=this.skybox.transformComponent.worldTransform;o.translation.setv(m),o.update()}}if(this.waterMaterial.shader.uniforms.abovewater=g,c.process(this.waterCamera,b,this.renderList),a.setRenderTarget(this.reflectionTarget),a.clear(),this.skybox)if(this.skybox instanceof Array){this.clipPlane.setd(f.normal.x,f.normal.y,f.normal.z,f.constant),this.waterCamera.setToObliqueMatrix(this.clipPlane,10);for(var p=0;p<this.skybox.length;p++)a.render(this.skybox[p],this.waterCamera,e,this.reflectionTarget,!1),this.skybox[p].skip=!0}else a.render(this.skybox,this.waterCamera,e,this.reflectionTarget,!1),this.skybox.skip=!0;if(this.clipPlane.setd(f.normal.x,f.normal.y,f.normal.z,f.constant),this.waterCamera.setToObliqueMatrix(this.clipPlane),a.render(this.renderList,this.waterCamera,e,this.reflectionTarget,!1),this.waterEntity.skip=!1,this.skybox)if(this.skybox instanceof Array)for(var p=0;p<this.skybox.length;p++)this.skybox[p].skip=!1;else this.skybox.skip=!1;if(g&&this.skybox&&this.followCam){var q=d.translation,o=this.skybox.transformComponent.worldTransform;o.translation.setv(q).addv(this.offset),o.update(),this.waterCamera._updatePMatrix=!0}},k.prototype.setSkyBox=function(a){this.skybox=a,a.meshRendererComponent&&(this.skybox.meshRendererComponent.materials[0].depthState.enabled=!1,this.skybox.meshRendererComponent.materials[0].renderQueue=0,this.skybox.meshRendererComponent.cullMode="Never")},k.prototype.setWaterEntity=function(a){this.waterEntity=a,this.waterEntity.meshRendererComponent.materials[0]=this.waterMaterial};var l={defines:{REFRACTION:!1},attributes:{vertexPosition:a.POSITION,vertexNormal:a.NORMAL},uniforms:{viewMatrix:b.VIEW_MATRIX,projectionMatrix:b.PROJECTION_MATRIX,worldMatrix:b.WORLD_MATRIX,cameraPosition:b.CAMERA,normalMap:"NORMAL_MAP",reflection:"REFLECTION_MAP",refraction:"REFRACTION_MAP",depthmap:"DEPTH_MAP",vertexTangent:[1,0,0,1],waterColor:[.0625,.0625,.0625],abovewater:!0,fogColor:[1,1,1],sunDirection:[.66,.66,.33],sunColor:[1,1,.5],sunShininess:100,sunSpecPower:4,fogStart:0,fogScale:2e3,timeMultiplier:1,time:b.TIME,distortionMultiplier:.025,fresnelPow:2,normalMultiplier:3,fresnelMultiplier:1,waterScale:5,doFog:!0,resolution:b.RESOLUTION},vshader:["attribute vec3 vertexPosition;","attribute vec3 vertexNormal;","uniform vec4 vertexTangent;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 worldMatrix;","uniform vec3 cameraPosition;","uniform float waterScale;","varying vec2 texCoord0;","varying vec3 eyeVec;","varying vec4 viewCoords;","varying vec3 worldPos;","void main(void) {","	worldPos = (worldMatrix * vec4(vertexPosition, 1.0)).xyz;","	texCoord0 = worldPos.xz * waterScale;","	mat3 normalMatrix = mat3(worldMatrix);","	vec3 n = normalize(normalMatrix * vec3(vertexNormal.x, vertexNormal.y, -vertexNormal.z));","	vec3 t = normalize(normalMatrix * vertexTangent.xyz);","	vec3 b = cross(n, t) * vertexTangent.w;","	mat3 rotMat = mat3(t, b, n);","	vec3 eyeDir = worldPos - cameraPosition;","	eyeVec = eyeDir * rotMat;","	viewCoords = projectionMatrix * viewMatrix * worldMatrix * vec4(vertexPosition, 1.0);","	gl_Position = viewCoords;","}"].join("\n"),fshader:["uniform sampler2D normalMap;","uniform sampler2D reflection;","#ifdef REFRACTION","uniform sampler2D refraction;","uniform sampler2D depthmap;","#endif","uniform vec3 waterColor;","uniform bool abovewater;","uniform vec3 fogColor;","uniform float fogStart;","uniform float fogScale;","uniform float time;","uniform float timeMultiplier;","uniform float distortionMultiplier;","uniform float fresnelPow;","uniform vec3 sunDirection;","uniform vec3 sunColor;","uniform float sunShininess;","uniform float sunSpecPower;","uniform float normalMultiplier;","uniform float fresnelMultiplier;","uniform bool doFog;","uniform vec2 resolution;","varying vec2 texCoord0;","varying vec3 eyeVec;","varying vec4 viewCoords;","varying vec3 worldPos;","vec4 combineTurbulence(in vec2 coords) {","	float t = time * timeMultiplier;","	vec4 coarse1 = texture2D(normalMap, coords * vec2(0.0012, 0.001) + vec2(0.019 * t, 0.021 * t));","	vec4 coarse2 = texture2D(normalMap, coords * vec2(0.001, 0.0011) + vec2(-0.017 * t, 0.016 * t));","	vec4 detail1 = texture2D(normalMap, coords * vec2(0.008) + vec2(0.06 * t, 0.03 * t));","	vec4 detail2 = texture2D(normalMap, coords * vec2(0.006) + vec2(0.05 * t, -0.04 * t));","	return (detail1 * 0.25 + detail2 * 0.25 + coarse1 * 0.75 + coarse2 * 1.0) / 2.25 - 0.48;","}","#ifdef REFRACTION",j.methods.unpackDepth,"#endif","void main(void)","{","	float fogDist = clamp((viewCoords.z-fogStart)/fogScale,0.0,1.0);","	vec2 normCoords = texCoord0;","	vec4 noise = combineTurbulence(normCoords);","	vec3 normalVector = normalize(noise.xyz * vec3(normalMultiplier, normalMultiplier, 1.0));","	vec3 localView = normalize(eyeVec);","	float fresnel = dot(normalize(normalVector * vec3(fresnelMultiplier, fresnelMultiplier, 1.0)), localView);","	if ( abovewater == false ) {","		fresnel = -fresnel;","	}","	fresnel *= 1.0 - fogDist;","	float fresnelTerm = 1.0 - fresnel;","	fresnelTerm = pow(fresnelTerm, fresnelPow);","	fresnelTerm = clamp(fresnelTerm, 0.0, 1.0);","	fresnelTerm = fresnelTerm * 0.95 + 0.05;","	vec2 projCoord = viewCoords.xy / viewCoords.q;","	projCoord = (projCoord + 1.0) * 0.5;","	projCoord.y -= 1.0 / resolution.y;","#ifdef REFRACTION","	float depthUnpack = unpackDepth(texture2D(depthmap, projCoord));","	if (depthUnpack > 0.5) {depthUnpack = 0.0;}","	float depth2 = clamp(depthUnpack * 400.0, 0.0, 1.0);","	vec2 projCoordRefr = vec2(projCoord);","	projCoordRefr += (normalVector.xy * distortionMultiplier) * (depth2);","	projCoordRefr = clamp(projCoordRefr, 0.001, 0.999);","	depthUnpack = unpackDepth(texture2D(depthmap, projCoordRefr));","	float depth = clamp(depthUnpack * 40.0, 0.8, 1.0);","#endif","	projCoord += (normalVector.xy * distortionMultiplier);","	projCoord = clamp(projCoord, 0.001, 0.999);","	if ( abovewater == true ) {","		projCoord.x = 1.0 - projCoord.x;","	}","	vec4 waterColorX = vec4(waterColor, 1.0);","	vec4 reflectionColor = texture2D(reflection, projCoord);","	if ( abovewater == false ) {","		reflectionColor *= vec4(0.8,0.9,1.0,1.0);","		vec4 endColor = mix(reflectionColor,waterColorX,fresnelTerm);","		gl_FragColor = mix(endColor,waterColorX,fogDist);","	}","	else {","		vec3 sunSpecReflection = normalize(reflect(-sunDirection, normalVector));","		float sunSpecDirection = max(0.0, dot(localView, sunSpecReflection));","		vec3 specular = pow(sunSpecDirection, sunShininess) * sunSpecPower * sunColor;","		vec4 endColor = waterColorX;","#ifdef REFRACTION","		vec4 refractionColor = texture2D(refraction, projCoordRefr) * vec4(0.6);","		endColor = mix(refractionColor, waterColorX, depth);","#endif","		endColor = mix(endColor, reflectionColor, fresnelTerm);","		if (doFog) {","			gl_FragColor = (vec4(specular, 1.0) + mix(endColor,reflectionColor,fogDist)) * (1.0-fogDist) + vec4(fogColor, 1.0) * fogDist;","		} else {","			gl_FragColor = vec4(specular, 1.0) + mix(endColor,reflectionColor,fogDist);","		}","	}","}"].join("\n")},m={attributes:{vertexPosition:a.POSITION},uniforms:{viewProjectionMatrix:b.VIEW_PROJECTION_MATRIX,worldMatrix:b.WORLD_MATRIX,farPlane:b.FAR_PLANE},vshader:["attribute vec3 vertexPosition;","uniform mat4 viewProjectionMatrix;","uniform mat4 worldMatrix;","varying vec4 vPosition;","void main(void) {","	vPosition = worldMatrix * vec4(vertexPosition, 1.0);","	gl_Position = viewProjectionMatrix * vPosition;","}"].join("\n"),fshader:["uniform float farPlane;",j.methods.packDepth,"varying vec4 vPosition;","void main(void)","{","	float linearDepth = abs(vPosition.y) / farPlane;","	gl_FragColor = packDepth(linearDepth);","}"].join("\n")};return k}),define("goo/addons/water/ProjectedGridWaterRenderer",["goo/renderer/MeshData","goo/renderer/Shader","goo/renderer/Camera","goo/math/Plane","goo/renderer/pass/RenderTarget","goo/renderer/pass/FullscreenPass","goo/math/Vector3","goo/renderer/Material","goo/renderer/TextureCreator","goo/renderer/shaders/ShaderLib","goo/renderer/shaders/ShaderFragment"],function(a,b,c,d,e,f,g,h,i,j,k){"use strict";function l(b){this.waterCamera=new c(45,1,.1,2e3),this.renderList=[],this.waterPlane=new d,b=b||{};var k=window.innerWidth/(b.divider||4),l=window.innerHeight/(b.divider||4);this.renderTarget=new e(k,l),k=window.innerWidth/(b.divider||1),l=window.innerHeight/(b.divider||1),this.heightTarget=new e(k,l,{type:"Float"}),this.normalTarget=new e(k,l,{}),this.fullscreenPass=new f(j.normalmap),this.fullscreenPass.material.shader.uniforms.resolution=[k,l];var o=this.waterMaterial=h.createMaterial(m,"WaterMaterial");o.cullState.enabled=!1,o.setTexture("NORMAL_MAP",(new i).loadTexture2D("../resources/water/waternormals3.png")),o.setTexture("REFLECTION_MAP",this.renderTarget),o.setTexture("BUMP_MAP",this.heightTarget),o.setTexture("NORMAL_MAP_COARSE",this.normalTarget);var p=this.materialWire=h.createMaterial(j.simple,"mat");p.wireframe=!0,p.wireframeColor=[0,0,0],this.calcVect=new g,this.camReflectDir=new g,this.camReflectUp=new g,this.camReflectLeft=new g,this.camLocation=new g,this.camReflectPos=new g,this.waterEntity=null;var q=this.projData=new a(a.defaultMap([a.POSITION]),4,6);q.getAttributeBuffer(a.POSITION).set([0,0,0,1,0,0,1,1,0,0,1,0]),q.getIndexBuffer().set([1,3,0,2,3,1]);var r=h.createMaterial(n,"mat");this.projRenderable={meshData:q,materials:[r]}}l.prototype.updateHelper=function(b,c,d,e){var f=this.projData.getAttributeBuffer(a.POSITION);f[0]=b.x/b.w,f[1]=0,f[2]=b.z/b.w,f[3]=c.x/c.w,f[4]=0,f[5]=c.z/c.w,f[6]=d.x/d.w,f[7]=0,f[8]=d.z/d.w,f[9]=e.x/e.w,f[10]=0,f[11]=e.z/e.w,this.projData.setVertexDataUpdated()},l.prototype.process=function(a,b,c,d,e){var f=this.waterEntity.meshDataComponent.meshData;f.update(d),this.waterMaterial.shader.uniforms.intersectBottomLeft=[f.intersectBottomLeft.x,f.intersectBottomLeft.y,f.intersectBottomLeft.z,f.intersectBottomLeft.w],this.waterMaterial.shader.uniforms.intersectBottomRight=[f.intersectBottomRight.x,f.intersectBottomRight.y,f.intersectBottomRight.z,f.intersectBottomRight.w],this.waterMaterial.shader.uniforms.intersectTopLeft=[f.intersectTopLeft.x,f.intersectTopLeft.y,f.intersectTopLeft.z,f.intersectTopLeft.w],this.waterMaterial.shader.uniforms.intersectTopRight=[f.intersectTopRight.x,f.intersectTopRight.y,f.intersectTopRight.z,f.intersectTopRight.w],this.updateHelper(f.intersectBottomLeft,f.intersectBottomRight,f.intersectTopRight,f.intersectTopLeft),a.render(this.projRenderable,d,e,this.heightTarget,!0),this.fullscreenPass.render(a,this.normalTarget,this.heightTarget,0);var g=this.waterPlane;this.waterCamera.copy(d),g.constant=this.waterEntity.transformComponent.transform.translation.y;var h=d.translation.y>g.constant;if(h){var i=this.calcVect,j=this.camReflectDir,k=this.camReflectUp,l=this.camReflectLeft,m=this.camLocation,n=this.camReflectPos;m.set(d.translation);var o=g.pseudoDistance(m);if(i.set(g.normal).mul(2*o),n.set(m.sub(i)),m.set(d.translation).add(d._direction),o=g.pseudoDistance(m),i.set(g.normal).mul(2*o),j.set(m.sub(i)).sub(n).normalize(),m.set(d.translation).add(d._up),o=g.pseudoDistance(m),i.set(g.normal).mul(2*o),k.set(m.sub(i)).sub(n).normalize(),l.set(k).cross(j).normalize(),this.waterCamera.translation.set(n),this.waterCamera._direction.set(j),this.waterCamera._up.set(k),this.waterCamera._left.set(l),this.waterCamera.normalize(),this.waterCamera.update(),this.skybox){var p=this.skybox.transformComponent.worldTransform;p.translation.setv(n),p.update()}}if(this.waterMaterial.shader.uniforms.abovewater=h,this.waterEntity.skip=!0,this.renderList.length=0,c.process(this.waterCamera,b,this.renderList),a.render(this.renderList,this.waterCamera,e,this.renderTarget,!0),this.waterEntity.skip=!1,h&&this.skybox){var q=d.translation,p=this.skybox.transformComponent.worldTransform;p.translation.setv(q),p.update()}},l.prototype.setSkyBox=function(a){this.skybox=a},l.prototype.setWaterEntity=function(a){this.waterEntity=a,this.waterEntity.meshRendererComponent.cullMode="Never",this.waterEntity.meshRendererComponent.materials[0]=this.waterMaterial;var b=this.waterEntity.meshDataComponent.meshData;this.waterMaterial.shader.uniforms.density=[b.densityX,b.densityY]};var m={attributes:{vertexUV0:a.TEXCOORD0},uniforms:{viewMatrix:b.VIEW_MATRIX,projectionMatrix:b.PROJECTION_MATRIX,worldMatrix:b.WORLD_MATRIX,cameraPosition:b.CAMERA,normalMap:"NORMAL_MAP",reflection:"REFLECTION_MAP",bump:"BUMP_MAP",normalMapCoarse:"NORMAL_MAP_COARSE",vertexNormal:[0,-1,0],vertexTangent:[1,0,0,1],waterColor:[15,15,15],abovewater:!0,fogColor:[1,1,1,1],sunDirection:[.66,-.1,.66],coarseStrength:.25,detailStrength:2,fogStart:0,camNear:b.NEAR_PLANE,camFar:b.FAR_PLANE,time:b.TIME,intersectBottomLeft:[0,0,0,0],intersectTopLeft:[0,0,0,0],intersectTopRight:[0,0,0,0],intersectBottomRight:[0,0,0,0],grid:!1,heightMultiplier:50,density:[1,1]},vshader:["attribute vec2 vertexUV0;","uniform vec3 vertexNormal;","uniform vec4 vertexTangent;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 worldMatrix;","uniform vec3 cameraPosition;","uniform float time;","uniform vec3 sunDirection;","uniform float coarseStrength;","uniform float heightMultiplier;","uniform sampler2D bump;","uniform vec4 intersectBottomLeft;","uniform vec4 intersectTopLeft;","uniform vec4 intersectTopRight;","uniform vec4 intersectBottomRight;","varying vec2 texCoord0;","varying vec2 texCoord1;","varying vec3 eyeVec;","varying vec3 sunDir;","varying vec4 viewCoords;","varying vec3 worldPos;","varying vec3 normal;","void main(void) {","	vec4 pointTop = mix(intersectTopLeft, intersectTopRight, vertexUV0.x);","	vec4 pointBottom = mix(intersectBottomLeft, intersectBottomRight, vertexUV0.x);","	vec4 pointFinal = mix(pointTop, pointBottom, 1.0 - vertexUV0.y);","	pointFinal.xz /= pointFinal.w;","	pointFinal.y = 0.0;","	vec4 screenpos = projectionMatrix * viewMatrix * worldMatrix * vec4(pointFinal.xyz, 1.0);","	vec2 projCoord = screenpos.xy / screenpos.q;","	projCoord = (projCoord + 1.0) * 0.5;","	float height = texture2D(bump, projCoord).x;","	pointFinal.y = height * heightMultiplier;","	texCoord1 = vertexUV0;","	vec4 pos = worldMatrix * vec4(pointFinal.xyz, 1.0);","	worldPos = pos.xyz;","	texCoord0 = worldPos.xz * 2.0;","	mat3 normalMatrix = mat3(worldMatrix);"," vec3 n = normalize(normalMatrix * vertexNormal);","	vec3 t = normalize(normalMatrix * vertexTangent.xyz);","	vec3 b = cross(n, t) * vertexTangent.w;","	mat3 rotMat = mat3(t, b, n);","	vec3 eyeDir = worldPos - cameraPosition;","	eyeVec = eyeDir * rotMat;","	sunDir = sunDirection * rotMat;","	viewCoords = projectionMatrix * viewMatrix * pos;","	gl_Position = viewCoords;","}"].join("\n"),fshader:["uniform sampler2D normalMap;","uniform sampler2D reflection;","uniform sampler2D normalMapCoarse;","uniform vec3 waterColor;","uniform bool abovewater;","uniform vec4 fogColor;","uniform float time;","uniform bool grid;","uniform vec2 density;","uniform float camNear;","uniform float camFar;","uniform float fogStart;","uniform float coarseStrength;","uniform float detailStrength;","varying vec2 texCoord0;","varying vec2 texCoord1;","varying vec3 eyeVec;","varying vec3 sunDir;","varying vec4 viewCoords;","varying vec3 worldPos;","varying vec3 normal;","const vec3 sunColor = vec3(1.0, 0.96, 0.96);","vec4 getNoise(vec2 uv) {","    vec2 uv0 = (uv/123.0)+vec2(time/17.0, time/29.0);","    vec2 uv1 = uv/127.0-vec2(time/-19.0, time/31.0);","    vec2 uv2 = uv/vec2(897.0, 983.0)+vec2(time/51.0, time/47.0);","    vec2 uv3 = uv/vec2(991.0, 877.0)-vec2(time/59.0, time/-63.0);","    vec4 noise = (texture2D(normalMap, uv0)) +","                 (texture2D(normalMap, uv1)) +","                 (texture2D(normalMap, uv2)*3.0) +","                 (texture2D(normalMap, uv3)*3.0);","    return noise/4.0-1.0;","}","void sunLight(const vec3 surfaceNormal, const vec3 eyeDirection, float shiny, float spec, float diffuse,","              inout vec3 diffuseColor, inout vec3 specularColor){","    vec3 reflection = normalize(reflect(-sunDir, surfaceNormal));","    float direction = max(0.0, dot(eyeDirection, reflection));","    specularColor += pow(direction, shiny)*sunColor*spec;","    diffuseColor += max(dot(sunDir, surfaceNormal),0.0)*sunColor*diffuse;","}","void main(void)","{","	vec2 projCoord = viewCoords.xy / viewCoords.q;","	projCoord = (projCoord + 1.0) * 0.5;","	float fs = camFar * fogStart;","	float fogDist = clamp(max(viewCoords.z - fs, 0.0)/(camFar - camNear - fs), 0.0, 1.0);","	vec3 coarseNormal = texture2D(normalMapCoarse, projCoord).xyz * 2.0 - 1.0;","	vec2 normCoords = texCoord0;","	vec4 noise = getNoise(normCoords);","	vec3 normalVector = normalize(noise.xyz * vec3(1.8 * detailStrength, 1.8 * detailStrength, 1.0) + coarseNormal.xyz * vec3(1.8 * coarseStrength, 1.8 * coarseStrength, 1.0));","	vec3 localView = normalize(eyeVec);","	float fresnel = dot(normalize(normalVector*vec3(1.0, 1.0, 1.0)), localView);","	if ( abovewater == false ) {","		fresnel = -fresnel;","	}","	float fresnelTerm = 1.0 - fresnel;","	fresnelTerm *= fresnelTerm;","	fresnelTerm *= fresnelTerm;","	fresnelTerm = fresnelTerm * 0.95 + 0.05;","	if ( abovewater == true ) {","		projCoord.x = 1.0 - projCoord.x;","	}","	projCoord += (normalVector.xy * 0.05);","	projCoord = clamp(projCoord, 0.001, 0.999);"," vec4 waterColorX = vec4(waterColor / 255.0, 1.0);","	vec4 reflectionColor = texture2D(reflection, projCoord);","	if ( abovewater == false ) {","		reflectionColor *= vec4(0.8,0.9,1.0,1.0);","		vec4 endColor = mix(reflectionColor,waterColorX,fresnelTerm);","		gl_FragColor = mix(endColor,waterColorX,fogDist);","	}","	else {","		vec3 diffuse = vec3(0.0);","		vec3 specular = vec3(0.0);","	    sunLight(normalVector, localView, 100.0, 2.0, 0.4, diffuse, specular);","		vec4 endColor = mix(waterColorX,reflectionColor,fresnelTerm);","		gl_FragColor = mix(vec4(diffuse*0.0 + specular, 1.0) + mix(endColor,reflectionColor,fogDist), fogColor, fogDist);","	}","	if (grid) {","		vec2 low = abs(fract(texCoord1*density)-0.5);","		float dist = 1.0 - step(min(low.x, low.y), 0.05);","		gl_FragColor *= vec4(dist);","	}","}"].join("\n")},n={attributes:{vertexPosition:a.POSITION},uniforms:{viewMatrix:b.VIEW_MATRIX,projectionMatrix:b.PROJECTION_MATRIX,worldMatrix:b.WORLD_MATRIX,time:b.TIME},vshader:["attribute vec3 vertexPosition;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 worldMatrix;","varying vec4 worldPos;","varying vec4 viewCoords;","void main(void) {","	worldPos = worldMatrix * vec4(vertexPosition, 1.0);","	viewCoords = viewMatrix * worldPos;","	gl_Position = projectionMatrix * viewMatrix * worldPos;","}"].join("\n"),fshader:["precision mediump float;","uniform float time;","varying vec4 worldPos;","varying vec4 viewCoords;",k.noise3d,"vec4 getNoise(sampler2D map, vec2 uv) {","    vec2 uv0 = (uv/223.0)+vec2(time/17.0, time/29.0);","    vec2 uv1 = uv/327.0-vec2(time/-19.0, time/31.0);","    vec2 uv2 = uv/vec2(697.0, 983.0)+vec2(time/151.0, time/147.0);","    vec2 uv3 = uv/vec2(791.0, 877.0)-vec2(time/259.0, time/263.0);","    vec4 noise = (texture2D(map, uv0)*0.0) +","                 (texture2D(map, uv1)*0.0) +","                 (texture2D(map, uv2)*0.0) +","                 (texture2D(map, uv3)*10.0);","    return noise/5.0-1.0;","}","void main(void)","{","	float fogDist = clamp(-viewCoords.z / 1000.0, 0.0, 1.0);","	gl_FragColor = vec4((snoise(vec3(worldPos.xz * 0.008, time * 0.4))+snoise(vec3(worldPos.xz * 0.02, time * 0.8))*0.5)/10.0);","}"].join("\n")};return l}),define("goo/animation/Joint",["goo/math/Transform"],function(a){"use strict";function b(b){this._name=b,this._index=0,this._parentIndex=0,this._inverseBindPose=new a}return b.NO_PARENT=-32768,b}),define("goo/animation/Skeleton",["goo/animation/Joint"],function(a){"use strict";function b(a,b){this._name=a,this._joints=b}return b.prototype.copy=function(){for(var c=this._name,d=this._joints,e=[],f=0,g=d.length;g>f;f++){var h=d[f],i=h._name,j=new a(i);j._index=h._index,j._parentIndex=h._parentIndex,j._inverseBindPose.copy(h._inverseBindPose),j._inverseBindPose.update(),e[f]=j}return new b(c,e)},b}),define("goo/animation/SkeletonPose",["goo/math/Transform","goo/animation/Joint","goo/math/Matrix4x4"],function(a,b,c){"use strict";function d(b){this._skeleton=b,this._localTransforms=[],this._globalTransforms=[],this._matrixPalette=[],this._poseListeners=[];for(var d=this._skeleton._joints.length,e=0;d>e;e++)this._localTransforms[e]=new a;for(var e=0;d>e;e++)this._globalTransforms[e]=new a;for(var e=0;d>e;e++)this._matrixPalette[e]=new c;this.setToBindPose()}return d.prototype.setToBindPose=function(){for(var a=0;a<this._localTransforms.length;a++){this._localTransforms[a].matrix.copy(this._skeleton._joints[a]._inverseBindPose.matrix).invert();var d=this._skeleton._joints[a]._parentIndex;d!==b.NO_PARENT&&c.combine(this._skeleton._joints[d]._inverseBindPose.matrix,this._localTransforms[a].matrix,this._localTransforms[a].matrix)}this.updateTransforms()},d.prototype.updateTransforms=function(){for(var a=0;a<this._skeleton._joints.length;a++){var d=this._skeleton._joints[a]._parentIndex;d!==b.NO_PARENT?c.combine(this._globalTransforms[d].matrix,this._localTransforms[a].matrix,this._globalTransforms[a].matrix):this._globalTransforms[a].matrix.copy(this._localTransforms[a].matrix),c.combine(this._globalTransforms[a].matrix,this._skeleton._joints[a]._inverseBindPose.matrix,this._matrixPalette[a])}this.firePoseUpdated()},d.prototype.firePoseUpdated=function(){for(var a=this._poseListeners.length-1;a>=0;a--)this._poseListeners[a].poseUpdated(this)},d}),define("goo/animation/clip/TransformData",["goo/math/Quaternion","goo/math/Vector3"],function(a,b){"use strict";function c(c){this._rotation=(new a).copy(c?c._rotation:a.IDENTITY),this._scale=(new b).copy(c?c._scale:b.ONE),this._translation=(new b).copy(c?c._translation:b.ZERO)}return c.prototype.applyTo=function(a){a.setIdentity(),a.rotation.copyQuaternion(this._rotation),a.scale.setv(this._scale),a.translation.setv(this._translation),a.update()},c.prototype.set=function(a){this._rotation.copy(a._rotation),this._scale.copy(a._scale),this._translation.copy(a._translation)},c.prototype.blend=function(b,d,e){var f=e?e:new c;return f._translation.setv(this._translation).lerp(b._translation,d),f._scale.setv(this._scale).lerp(b._scale,d),a.slerp(this._rotation,b._rotation,d,f._rotation),f
},c}),define("goo/animation/blendtree/BinaryLERPSource",["goo/math/MathUtils","goo/animation/clip/TransformData"],function(a,b){"use strict";function c(a,b,c){this._sourceA=a?a:null,this._sourceB=b?b:null,this.blendWeight=c?c:null}return c.prototype.getSourceData=function(){var a=this._sourceA?this._sourceA.getSourceData():null,b=this._sourceB?this._sourceB.getSourceData():null;return c.combineSourceData(a,b,this.blendWeight)},c.prototype.setTime=function(a){var b=!1,c=!1;return this._sourceA&&(b=this._sourceA.setTime(a)),this._sourceB&&(c=this._sourceB.setTime(a)),b||c},c.prototype.resetClips=function(a){this._sourceA&&this._sourceA.resetClips(a),this._sourceB&&this._sourceB.resetClips(a)},c.prototype.shiftClipTime=function(a){this._sourceA&&this._sourceA.shiftClipTime(a),this._sourceB&&this._sourceB.shiftClipTime(a)},c.prototype.setTimeScale=function(a){this._sourceA.setTimeScale(a),this._sourceB.setTimeScale(a)},c.prototype.isActive=function(){var a=!1;return this._sourceA&&(a=a||this._sourceA.isActive()),this._sourceB&&(a=a||this._sourceB.isActive()),a},c.combineSourceData=function(a,d,e,f){if(!d)return a;if(!a)return d;var g=f?f:{};for(var h in a){var i=a[h],j=d[h];isNaN(i)?i instanceof b?j?g[h]=i.blend(j,e,g[h]):g[h]?g[h].set(i):g[h]=new i.constructor(i):g[h]=i:c.blendFloatValues(g,h,e,i,j)}for(var h in d)g[h]||(g[h]=d[h]);return g},c.blendFloatValues=function(b,c,d,e,f){b[c]=isNaN(f)?e:a.lerp(d,e[0],f[0])},c}),define("goo/animation/clip/AnimationClipInstance",["goo/entities/World"],function(a){"use strict";function b(){this._active=!0,this._loopCount=0,this._timeScale=1,this._startTime=0,this._prevClockTime=0,this._prevUnscaledClockTime=0,this._clipStateObjects={}}return b.prototype.setTimeScale=function(b,c){var c=c||a.time;if(this._active&&this._timeScale!==b)if(0!==this._timeScale&&0!==b){var d=c,e=d-this._startTime;e*=this._timeScale,e/=b,this._startTime=d-e}else if(0===this._timeScale){var d=c;this._startTime=d-this._prevUnscaledClockTime}this._timeScale=b},b.prototype.getApplyTo=function(a){var b=a._channelName,c=this._clipStateObjects[b];return c||(c=a.createStateDataObject(),this._clipStateObjects[b]=c),c},b}),define("goo/animation/blendtree/ClipSource",["goo/math/MathUtils","goo/animation/clip/AnimationClipInstance"],function(a,b){"use strict";function c(a,c,d){this._clip=a,this._clipInstance=new b,this._filterChannels={},this._filter=null,this.setFilter(c,d),this._startTime=-1/0,this._endTime=1/0}return c.prototype.setFilter=function(a,b){if(a&&b){this._filter=["Exclude","Include"].indexOf(a)>-1?a:null;for(var c=0;c<b.length;c++)this._filterChannels[b[c]]=!0}else this._filter=null},c.prototype.setTime=function(b){var c=this._clipInstance;c._startTime||(c._startTime=b);var d,e;if(c._active){0!==c._timeScale?(c._prevUnscaledClockTime=b-c._startTime,d=c._timeScale*c._prevUnscaledClockTime,c._prevClockTime=d):d=c._prevClockTime;var f=Math.min(this._clip._maxTime,this._endTime),g=Math.max(this._startTime,0);if(e=f-g,-1===f)return!1;0!==f&&(-1===c._loopCount?0>d?(d*=-1,d%=e,d=e-d,d+=g):(d%=e,d+=g):c._loopCount>0&&e*c._loopCount>=Math.abs(d)&&(0>d?(d*=-1,d%=e,d=e-d,d+=g):(d%=e,d+=g)),(d>f||0>d)&&(d=a.clamp(d,0,f),c._active=!1)),this._clip.update(d,c)}return c._active},c.prototype.resetClips=function(a){this._clipInstance._startTime=a,this._clipInstance._active=!0},c.prototype.shiftClipTime=function(a){this._clipInstance._startTime+=a,this._clipInstance._active=!0},c.prototype.setTimeScale=function(a){this._clipInstance.setTimeScale(a)},c.prototype.isActive=function(){return this._clipInstance._active&&-1!==this._clip._maxTime},c.prototype.getSourceData=function(){if(!this._filter||!this._filterChannels)return this._clipInstance._clipStateObjects;var a=this._clipInstance._clipStateObjects,b={},c="Include"===this._filter;for(var d in a)void 0!==this._filterChannels[d]===c&&(b[d]=a[d]);return b},c}),define("goo/animation/clip/AbstractAnimationChannel",[],function(){"use strict";function a(a,b,c){this._blendType=c||"Linear",this._channelName=a,this._times=(b instanceof Array||b instanceof Float32Array)&&b.length?new Float32Array(b):[],this._lastStartFrame=0}return a.prototype.getSampleCount=function(){return this._times.length},a.prototype.getMaxTime=function(){return this._times.length?this._times[this._times.length-1]:0},a.prototype.updateSample=function(a,b){var c=this._times.length;if(c){var d=c-1;if(0>a||1===c)this.setCurrentSample(0,0,b);else if(a>=this._times[d])this.setCurrentSample(d,0,b);else{var e=0;if(a>=this._times[this._lastStartFrame]){e=this._lastStartFrame;for(var f=this._lastStartFrame;c-1>f&&!(this._times[f]>=a);f++)e=f}else for(var f=0;f<this._lastStartFrame&&!(this._times[f]>=a);f++)e=f;var g=(a-this._times[e])/(this._times[e+1]-this._times[e]);this.setCurrentSample(e,g,b),this._lastStartFrame=e}}},a}),define("goo/animation/clip/TransformChannel",["goo/animation/clip/AbstractAnimationChannel","goo/animation/clip/TransformData","goo/math/Quaternion","goo/math/Vector3"],function(a,b,c,d){"use strict";function e(b,e,f,g,h,i){if(a.call(this,b,e,i),f.length/4!==e.length||g.length/3!==e.length||h.length/3!==e.length)throw new Error("All provided arrays must be the same length (accounting for type)! Channel: "+b);this._rotations=new Float32Array(f),this._translations=new Float32Array(g),this._scales=new Float32Array(h),this.tmpVec=new d,this.tmpQuat=new c,this.tmpQuat2=new c}return e.prototype=Object.create(a.prototype),e.prototype.createStateDataObject=function(){return new b},e.prototype.setCurrentSample=function(a,b,d){var e=d,f=4*a,g=3*a,h=4*(a+1),i=3*(a+1);return 0===b?(e._rotation.data[0]=this._rotations[f+0],e._rotation.data[1]=this._rotations[f+1],e._rotation.data[2]=this._rotations[f+2],e._rotation.data[3]=this._rotations[f+3],e._translation.data[0]=this._translations[g+0],e._translation.data[1]=this._translations[g+1],e._translation.data[2]=this._translations[g+2],e._scale.data[0]=this._scales[g+0],e._scale.data[1]=this._scales[g+1],e._scale.data[2]=this._scales[g+2],void 0):1===b?(e._rotation.data[0]=this._rotations[h+0],e._rotation.data[1]=this._rotations[h+1],e._rotation.data[2]=this._rotations[h+2],e._rotation.data[3]=this._rotations[h+3],e._translation.data[0]=this._translations[i+0],e._translation.data[1]=this._translations[i+1],e._translation.data[2]=this._translations[i+2],e._scale.data[0]=this._scales[i+0],e._scale.data[1]=this._scales[i+1],e._scale.data[2]=this._scales[i+2],void 0):(e._rotation.data[0]=this._rotations[f+0],e._rotation.data[1]=this._rotations[f+1],e._rotation.data[2]=this._rotations[f+2],e._rotation.data[3]=this._rotations[f+3],this.tmpQuat.data[0]=this._rotations[h+0],this.tmpQuat.data[1]=this._rotations[h+1],this.tmpQuat.data[2]=this._rotations[h+2],this.tmpQuat.data[3]=this._rotations[h+3],e._rotation.equals(this.tmpQuat)||(c.slerp(e._rotation,this.tmpQuat,b,this.tmpQuat2),e._rotation.setv(this.tmpQuat2)),e._translation.data[0]=(1-b)*this._translations[g+0]+b*this._translations[i+0],e._translation.data[1]=(1-b)*this._translations[g+1]+b*this._translations[i+1],e._translation.data[2]=(1-b)*this._translations[g+2]+b*this._translations[i+2],e._scale.data[0]=(1-b)*this._scales[g+0]+b*this._scales[i+0],e._scale.data[1]=(1-b)*this._scales[g+1]+b*this._scales[i+1],e._scale.data[2]=(1-b)*this._scales[g+2]+b*this._scales[i+2],void 0)},e.prototype.getData=function(a,c){var d=c?c:new b;return this.setCurrentSample(a,0,d),d},e}),define("goo/animation/clip/JointData",["goo/animation/clip/TransformData"],function(a){"use strict";function b(b){a.call(this,b),this._jointIndex=b?b._jointIndex:0}return b.prototype=Object.create(a.prototype),b.prototype.constructor=b,b.prototype.set=function(b){a.prototype.set.call(this,b),this._jointIndex=b._jointIndex},b.prototype.blend=function(c,d,e){var f=e;return f?f instanceof b&&(f._jointIndex=this._jointIndex):(f=new b,f._jointIndex=this._jointIndex),a.prototype.blend.call(this,c,d,f)},b}),define("goo/animation/clip/JointChannel",["goo/animation/clip/TransformChannel","goo/animation/clip/JointData"],function(a,b){"use strict";function c(b,d,e,f,g,h,i){a.call(this,c.JOINT_CHANNEL_NAME+d,e,f,g,h,i),this._jointName=b,this._jointIndex=d}return c.prototype=Object.create(a.prototype),c.JOINT_CHANNEL_NAME="_jnt",c.prototype.createStateDataObject=function(){return new b},c.prototype.setCurrentSample=function(b,c,d){a.prototype.setCurrentSample.call(this,b,c,d),d._jointIndex=this._jointIndex},c.prototype.getData=function(c,d){var e=d?d:new b;return a.prototype.getData.call(this,c,e),e._jointIndex=this._jointIndex,e},c}),define("goo/animation/blendtree/ExclusiveClipSource",["goo/animation/clip/JointChannel","goo/animation/blendtree/ClipSource"],function(a,b){"use strict";function c(a){b.call(this,a),this._disabledChannels={}}return c.prototype=Object.create(b.prototype),c.prototype.clearDisabled=function(){this._disabledChannels={}},c.prototype.addDisabledChannels=function(){if(1===arguments.length&&"object"==typeof arguments[0])for(var a=0;a<arguments[0].length;a++)this._disabledChannels[arguments[0][a]]=!0;else for(var a=0;a<arguments.length;a++)this._disabledChannels[arguments[a]]=!0},c.prototype.addDisabledJoints=function(){if(1===arguments.length&&"object"==typeof arguments[0])for(var b=0;b<arguments[0].length;b++){var c=a.JOINT_CHANNEL_NAME+arguments[0][b];this._disabledChannels[c]=!0}else for(var b=0;b<arguments.length;b++){var c=a.JOINT_CHANNEL_NAME+arguments[b];this._disabledChannels[c]=!0}},c.prototype.getSourceData=function(){var a=b.prototype.getSourceData.call(this),c={};for(var d in a)this._disabledChannels[d]||(c[d]=a[d]);return c},c}),define("goo/animation/blendtree/FrozenClipSource",[],function(){"use strict";function a(a,b){this._source=a,this._time=b}return a.prototype.getSourceData=function(){return this._source.getSourceData()},a.prototype.resetClips=function(){this._source.resetClips(0)},a.prototype.setTime=function(){return this._source.setTime(this._time),!0},a.prototype.isActive=function(){return!0},a.prototype.setTimeScale=function(){},a}),define("goo/animation/blendtree/InclusiveClipSource",["goo/animation/clip/JointChannel","goo/animation/blendtree/ClipSource"],function(a,b){"use strict";function c(a){b.call(this,a),this._enabledChannels={}}return c.prototype=Object.create(b.prototype),c.prototype.clearEnabled=function(){this._enabledChannels={}},c.prototype.addEnabledChannels=function(){if(1===arguments.length&&"object"==typeof arguments[0])for(var a=0;a<arguments[0].length;a++)this._enabledChannels[arguments[0][a]]=!0;else for(var a=0;a<arguments.length;a++)this._enabledChannels[arguments[a]]=!0},c.prototype.addEnabledJoints=function(){if(1===arguments.length&&"object"==typeof arguments[0])for(var b=0;b<arguments[0].length;b++){var c=a.JOINT_CHANNEL_NAME+arguments[0][b];this._enabledChannels[c]=!0}else for(var b=0;b<arguments.length;b++){var c=a.JOINT_CHANNEL_NAME+arguments[b];this._enabledChannels[c]=!0}},c.prototype.getSourceData=function(){var a=b.prototype.getSourceData.call(this),c={};for(var d in this._enabledChannels)this._enabledChannels[d]&&(c[d]=a[d]);return c},c}),define("goo/animation/blendtree/ManagedTransformSource",["goo/animation/clip/JointChannel","goo/animation/clip/JointData","goo/animation/clip/JointChannel","goo/animation/clip/JointData"],function(a,b,c,d){"use strict";function e(a){this._sourceName=a?a:null,this._data={}}return e.prototype.setTranslation=function(a,b){var c=this._data[a];c instanceof d&&c._translation.setv(b)},e.prototype.setScale=function(a,b){var c=this._data[a];c instanceof d&&c._scale.setv(b)},e.prototype.setRotation=function(a,b){var c=this._data[a];c instanceof d&&c._rotation.set(b)},e.prototype.initFromClip=function(a,b,c){if("Include"===b&&c&&c.length)for(var d=0,e=c.length;e>d;d++){var f=c[d],g=a.findChannelByName(f),h=g.getData(0);this._data[f]=h}else for(var d=0,e=a._channels.length;e>d;d++){var g=a._channels[d],f=g._channelName;if("Exclude"===b&&c&&c.length&&c.indexOf(f)>-1){var h=g.getData(0);this._data[f]=h}}},e.prototype.resetClips=function(){},e.prototype.setTimeScale=function(){},e.prototype.setTime=function(){return!0},e.prototype.isActive=function(){return!0},e.prototype.getChannelData=function(a){return this._data[a]},e.prototype.getSourceData=function(){return this._data},e}),define("goo/animation/clip/AnimationClip",[],function(){"use strict";function a(a,b){this._name=a,this._channels=b||[],this._maxTime=-1,this.updateMaxTimeIndex()}return a.prototype.update=function(a,b){for(var c=0,d=this._channels.length;d>c;++c){var e=this._channels[c],f=b.getApplyTo(e);e.updateSample(a,f)}},a.prototype.addChannel=function(a){this._channels.push(a),this.updateMaxTimeIndex()},a.prototype.removeChannel=function(a){var b=this._channels.indexOf(a);return b>=0?(this._channels.splice(b,1),this.updateMaxTimeIndex(),!0):!1},a.prototype.findChannelByName=function(a){for(var b=0,c=this._channels.length;c>b;++b){var d=this._channels[b];if(a===d._channelName)return d}return null},a.prototype.updateMaxTimeIndex=function(){this._maxTime=-1;for(var a,b=0;b<this._channels.length;b++){var c=this._channels[b];a=c.getMaxTime(),a>this._maxTime&&(this._maxTime=a)}},a.prototype.toString=function(){return this._name+this._channels.length},a}),define("goo/animation/clip/InterpolatedFloatChannel",["goo/animation/clip/AbstractAnimationChannel","goo/math/MathUtils"],function(a,b){"use strict";function c(b,c,d,e){a.call(this,b,c,e),this._values=d?d.slice(0):null}return c.prototype=Object.create(a.prototype),c.prototype.createStateDataObject=function(){return[0]},c.prototype.setCurrentSample=function(a,c,d){d[0]=b.lerp(c,this._values[a],this._values[a+1])},c.prototype.getData=function(a,b){var c=b||[];return c[0]=this._values[a],c},c}),define("goo/animation/clip/TriggerData",[],function(){"use strict";function a(){this._currentTriggers=[],this._currentIndex=-1,this.armed=!1}return a.prototype.arm=function(a,b){if(null===b||0===b.length)this._currentTriggers.length=0,this.armed=!1;else if(a!==this._currentIndex){this._currentTriggers.length=0;for(var c=0,d=b.length;d>c;c++)b[c]&&""!==b[c]&&this._currentTriggers.push(b[c]);this.armed=!0}this._currentIndex=a},a}),define("goo/animation/clip/TriggerChannel",["goo/animation/clip/AbstractAnimationChannel","goo/animation/clip/TriggerData"],function(a,b){"use strict";function c(b,c,d,e){a.call(this,b,c,e),this._keys=d?d.slice(0):null,this.guarantee=!1}return c.prototype=Object.create(a.prototype),c.prototype.createStateDataObject=function(){return new b},c.prototype.setCurrentSample=function(a,b,c){var d=c._currentIndex,e=1!==b?a:a+1;if(d!==e&&this.guarantee){var f=[];if(d>e){for(var g=d+1;g<this._keys.length;g++)f.push(this._keys[g]);d=-1}for(var g=d+1;e>=g;g++)f.push(this._keys[g]);c.arm(e,f)}else c.arm(e,[this._keys[e]])},c}),define("goo/animation/state/AbstractState",[],function(){"use strict";function a(){this._globalStartTime=0,this.onFinished=null}return a.prototype.update=function(){},a.prototype.postUpdate=function(){},a.prototype.getCurrentSourceData=function(){},a.prototype.resetClips=function(a){this._globalStartTime=a},a.prototype.shiftClipTime=function(a){this._globalStartTime+=a},a}),define("goo/animation/state/SteadyState",["goo/animation/state/AbstractState"],function(a){"use strict";function b(b){a.call(this),this._name=b,this._transitions={},this._sourceTree=null}return b.prototype=Object.create(a.prototype),b.prototype.update=function(a){this._sourceTree.setTime(a)||this.onFinished&&this.onFinished()},b.prototype.getCurrentSourceData=function(){return this._sourceTree.getSourceData()},b.prototype.resetClips=function(b){a.prototype.resetClips.call(this,b),this._sourceTree.resetClips(b)},b.prototype.shiftClipTime=function(b){a.prototype.shiftClipTime.call(this,b),this._sourceTree.shiftClipTime(b)},b.prototype.setTimeScale=function(a){this._sourceTree.setTimeScale(a)},b}),define("goo/animation/layer/AnimationLayer",["goo/animation/state/SteadyState","goo/entities/World"],function(a,b){"use strict";function c(a){this._name=a,this._steadyStates={},this._currentState=null,this._layerBlender=null,this._transitions={},this._transitionStates={}}return c.BASE_LAYER_NAME="-BASE_LAYER-",c.prototype.getStates=function(){return Object.keys(this._steadyStates)},c.prototype.getTransitions=function(){var a;if(a=this._currentState?Object.keys(this._currentState._transitions):[],this._transitions)for(var b in this._transitions)-1===a.indexOf(b)&&a.push(b);return a.sort(),a},c.prototype.update=function(a){this._currentState&&this._currentState.update(a||b.time)},c.prototype.postUpdate=function(){this._currentState&&this._currentState.postUpdate()},c.prototype.transitionTo=function(c,d){d=d||b.time;var e,f=this._currentState;if(this._steadyStates[c]===f)return!1;if(f&&f._transitions&&(e=f._transitions[c]||f._transitions["*"]),!e&&this._transitions&&(e=this._transitions[c]||this._transitions["*"]),f instanceof a&&e){var g=this._transitionStates[e.type];return this._doTransition(g,f,this._steadyStates[c],e,d),!0}if(!f&&(e=this._transitions[c])){var g=this._transitionStates[e.type];if(g)return this._doTransition(g,null,this._steadyStates[c],e,d),!0}return!1},c.prototype._doTransition=function(a,b,c,d,e){if(b){a._sourceState=b;var f=d.timeWindow||[-1,-1];if(!a.isValid(f,e))return console.warn("State not in allowed time window"),void 0;b.onFinished=null}a._targetState=c,a.readFromConfig(d),a.resetClips(e),this.setCurrentState(a)},c.prototype.setCurrentState=function(a,c,d){d=d||b.time,this._currentState=a,a&&(c&&a.resetClips(d),a.onFinished=function(){this.setCurrentState(a._targetState||null),this.update()}.bind(this))},c.prototype.getCurrentState=function(){return this._currentState},c.prototype.setCurrentStateByName=function(a,b,c){if(a){var d=this._steadyStates[a];if(d)return this.setCurrentState(d,b,c),!0;console.warn("unable to find SteadyState named: "+a)}return!1},c.prototype.getCurrentSourceData=function(){return this._layerBlender?this._layerBlender.getBlendedSourceData():this._currentState?this._currentState.getCurrentSourceData():null},c.prototype.updateLayerBlending=function(a){this._layerBlender&&(this._layerBlender._layerA=a,this._layerBlender._layerB=this)},c.prototype.clearCurrentState=function(){this.setCurrentState(null)},c.prototype.resetClips=function(a){this._currentState&&this._currentState.resetClips(a||b.time)},c.prototype.shiftClipTime=function(a){this._currentState&&this._currentState.shiftClipTime(a||0)},c.prototype.setTimeScale=function(a){this._currentState&&this._currentState.setTimeScale(a)},c}),define("goo/animation/layer/LayerLERPBlender",["goo/animation/blendtree/BinaryLERPSource"],function(a){"use strict";function b(){this._blendWeight=null,this._layerA=null,this._layerB=null}return b.prototype.getBlendedSourceData=function(){var b=this._layerA.getCurrentSourceData(),c=this._layerB._currentState?this._layerB._currentState.getCurrentSourceData():null;return a.combineSourceData(b,c,this._blendWeight)},b}),define("goo/animation/state/AbstractTransitionState",["goo/animation/state/AbstractState","goo/animation/blendtree/BinaryLERPSource","goo/math/MathUtils"],function(a,b,c){"use strict";function d(){a.call(this),this._sourceState=null,this._targetState=null,this._percent=0,this._sourceData=null,this._fadeTime=0,this._blendType="Linear"}return d.prototype=Object.create(a.prototype),d.prototype.update=function(a){var b=a-this._globalStartTime;if(b>this._fadeTime&&this.onFinished)return this.onFinished(),void 0;var d=b/this._fadeTime;switch(this._blendType){case"SCurve3":this._percent=c.scurve3(d);break;case"SCurve5":this._percent=c.scurve5(d);break;default:this._percent=d}},d.prototype.readFromConfig=function(a){a&&(void 0!==a.fadeTime&&(this._fadeTime=a.fadeTime),void 0!==a.blendType&&(this._blendType=a.blendType))},d.prototype.getCurrentSourceData=function(){var a=this._sourceState?this._sourceState.getCurrentSourceData():null,c=this._targetState?this._targetState.getCurrentSourceData():null;return this._sourceData||(this._sourceData={}),b.combineSourceData(a,c,this._percent,this._sourceData)},d.prototype.isValid=function(a,b){var c=b-this._sourceState._globalStartTime,d=a[0],e=a[1];return 0>=d?0>=e?!0:e>=c:0>=e?c>=d:e>=d?c>=d&&e>=c:c>=d||e>=c},d.prototype.resetClips=function(b){a.prototype.resetClips.call(this,b),this._percent=0},d.prototype.shiftClipTime=function(b){a.prototype.shiftClipTime.call(this,b)},d.prototype.setTimeScale=function(a){this._sourceState&&this._sourceState.setTimeScale(a),this._targetState&&this._targetState.setTimeScale(a)},d}),define("goo/animation/state/FadeTransitionState",["goo/animation/state/AbstractTransitionState"],function(a){"use strict";function b(){a.call(this)}return b.prototype=Object.create(a.prototype),b.prototype.update=function(b){a.prototype.update.call(this,b),null!==this._sourceState&&this._sourceState.update(b),null!==this._targetState&&this._targetState.update(b)},b.prototype.postUpdate=function(){null!==this._sourceState&&this._sourceState.postUpdate(),null!==this._targetState&&this._targetState.postUpdate()},b.prototype.resetClips=function(b){a.prototype.resetClips.call(this,b),null!==this._targetState&&this._targetState.resetClips(b)},b.prototype.shiftClipTime=function(b){a.prototype.shiftClipTime.call(this,b),null!==this._targetState&&this._targetState.shiftClipTime(b),null!==this._sourceState&&this._sourceState.shiftClipTime(b)},b}),define("goo/animation/state/FrozenTransitionState",["goo/animation/state/AbstractTransitionState"],function(a){"use strict";function b(){a.call(this)}return b.prototype=Object.create(a.prototype),b.prototype.update=function(b){a.prototype.update.call(this,b),null!==this._targetState&&this._targetState.update(b)},b.prototype.postUpdate=function(){null!==this._targetState&&this._targetState.postUpdate()},b.prototype.resetClips=function(b){a.prototype.resetClips.call(this,b),this._targetState.resetClips(b)},b.prototype.shiftClipTime=function(b){a.prototype.shiftClipTime.call(this,b),this._targetState.shiftClipTime(b)},b}),define("goo/animation/state/SyncFadeTransitionState",["goo/animation/state/FadeTransitionState"],function(a){"use strict";function b(){a.call(this)}return b.prototype=Object.create(a.prototype),b.prototype.resetClips=function(b){a.prototype.resetClips.call(this,b),this._targetState.resetClips(this._sourceState._globalStartTime)},b.prototype.shiftClipTime=function(b){a.prototype.shiftClipTime.call(this,b),this._targetState.shiftClipTime(this._sourceState._globalStartTime+b),this._sourceState.shiftClipTime(b)},b}),define("goo/entities/components/CameraComponent",["goo/entities/components/Component","goo/math/Vector3"],function(a,b){"use strict";function c(a){this.type="CameraComponent",this.camera=a,this.leftVec=new b(-1,0,0),this.upVec=new b(0,1,0),this.dirVec=new b(0,0,-1)}return c.prototype=Object.create(a.prototype),c.prototype.setUpVector=function(a){0===a?(this.leftVec.setd(0,-1,0),this.upVec.setd(1,0,0),this.dirVec.setd(0,0,-1)):2===a?(this.leftVec.setd(-1,0,0),this.upVec.setd(0,0,1),this.dirVec.setd(0,-1,0)):(this.leftVec.setd(-1,0,0),this.upVec.setd(0,1,0),this.dirVec.setd(0,0,-1))},c.prototype.updateCamera=function(a){this.camera._left.setv(this.leftVec),a.matrix.applyPostVector(this.camera._left),this.camera._up.setv(this.upVec),a.matrix.applyPostVector(this.camera._up),this.camera._direction.setv(this.dirVec),a.matrix.applyPostVector(this.camera._direction),a.matrix.getTranslation(this.camera.translation),this.camera.update()},c}),define("goo/entities/components/LightComponent",["goo/entities/components/Component"],function(a){"use strict";function b(a){this.type="LightComponent",this.light=a}return b.prototype=Object.create(a.prototype),b.prototype.updateLight=function(a){this.light.update(a)},b}),define("goo/entities/components/ScriptComponent",["goo/entities/components/Component"],function(a){"use strict";function b(a){this.type="ScriptComponent",this.scripts=a instanceof Array?a:a?[a]:[]}return b.prototype=Object.create(a.prototype),b.prototype.run=function(a,b,c){for(var d,e=0,f=this.scripts.length;f>e;e++)d=this.scripts[e],d&&d.run&&(void 0===d.enabled||d.enabled)&&d.run(a,b,c)},b}),define("goo/entities/components/CSSTransformComponent",["goo/entities/components/Component"],function(a){"use strict";function b(b,c){a.call(this),this.type="CSSTransformComponent",this.domElement=b,this.scale=1,this.faceCamera="undefined"==typeof c?!1:c}return b.prototype=Object.create(a.prototype),b}),define("goo/entities/EntityUtils",["goo/entities/components/TransformComponent","goo/entities/components/MeshDataComponent","goo/entities/components/MeshRendererComponent","goo/entities/components/CameraComponent","goo/entities/components/LightComponent","goo/entities/components/ScriptComponent","goo/renderer/Camera","goo/renderer/light/Light","goo/renderer/Material","goo/renderer/MeshData","goo/math/Transform","goo/entities/components/CSSTransformComponent"],function(a,b,c,d,e,f,g,h,i,j,k,l){"use strict";function m(){}function n(d,e,f){for(var g=d.createEntity(e.name),h=0;h<e._components.length;h++){var i=e._components[h];if(i instanceof a)g.transformComponent.transform.copy(i.transform);else if(i instanceof b){var j=new b(i.meshData);j.modelBound=new i.modelBound.constructor,i.currentPose&&(j.currentPose=i.currentPose),g.setComponent(j)}else if(i instanceof c){for(var k=new c,l=0;l<i.materials.length;l++)k.materials.push(i.materials[l]);g.setComponent(k)}else g.setComponent(i)}for(var l=0;l<e.transformComponent.children.length;l++){var m=e.transformComponent.children[l],o=n(d,m.entity,f);g.transformComponent.attachChild(o.transformComponent)}return f.callback&&f.callback(g),g}return m.clone=function(a,b,c){return c=c||{},c.shareData=c.shareData||!0,c.shareMaterial=c.shareMaterial||!0,c.cloneHierarchy=c.cloneHierarchy||!0,n(a,b,c)},m.traverse=function(a,b,c){if(c=void 0!==c?c:0,b(a,c)!==!1)for(var d=0;d<a.transformComponent.children.length;d++){var e=a.transformComponent.children[d];m.traverse(e.entity,b,c+1)}},m.getRoot=function(a){for(;a.transformComponent.parent;)a=a.transformComponent.parent.entity;return a},m.updateWorldTransform=function(a){a.updateWorldTransform();for(var b=0;b<a.children.length;b++)m.updateWorldTransform(a.children[b])},m.show=function(a){a.hidden=!1;for(var b=a;b.transformComponent.parent;)if(b=b.transformComponent.parent.entity,b.hidden)return;m.traverse(a,function(a){return a.hidden?!1:(a.meshRendererComponent&&(a.meshRendererComponent.hidden=a.hidden),void 0)})},m.hide=function(a){a.hidden=!0,m.traverse(a,function(a){a.meshRendererComponent&&(a.meshRendererComponent.hidden=!0)})},m.createTypicalEntity=function(a){for(var l=a.createEntity(),m=1;m<arguments.length;m++){var n=arguments[m];if(n instanceof j){var o=new b(n);if(l.setComponent(o),!l.hasComponent("MeshRendererComponent")){var p=new c;l.setComponent(p)}}else if(n instanceof i){if(!l.hasComponent("MeshRendererComponent")){var p=new c;l.setComponent(p)}l.meshRendererComponent.materials.push(n)}else if(n instanceof h){var q=new e(n);l.setComponent(q)}else if(n instanceof g){var r=new d(n);l.setComponent(r)}else n instanceof k?l.transformComponent.transform=n:"string"==typeof n?l.name=n:Array.isArray(n)&&3===n.length?l.transformComponent.transform.translation.setd(n[0],n[1],n[2]):"function"==typeof n.run&&(l.hasComponent("ScriptComponent")||l.setComponent(new f),l.scriptComponent.scripts.push(n))}return l},m.createDOMEntity=function(a,b){var c=a.createEntity();return c.setComponent(new l(b)),c},m.getChildren=function(a){return a.transformComponent.children.map(function(a){return a.entity})},m}),define("goo/util/MeshBuilder",["goo/renderer/MeshData","goo/math/Vector3","goo/entities/EntityUtils"],function(a,b,c){"use strict";function d(){this.meshDatas=[],this.vertexData={},this.indexData=[],this.vertexCounter=0,this.indexCounter=0,this.indexLengths=[],this.indexModes=[]}d.prototype.addEntity=function(a){c.traverse(a,function(){a.transformComponent._dirty&&a.transformComponent.updateTransform()}),c.traverse(a,function(){a.transformComponent._dirty&&c.updateWorldTransform(a.transformComponent)}),c.traverse(a,function(){a.meshDataComponent&&this.addMeshData(a.meshDataComponent.meshData,a.transformComponent.worldTransform)})};var e=new b;return d.prototype.addMeshData=function(b,c){if(b.vertexCount>=65536)throw new Error("Maximum number of vertices for a mesh to add is 65535. Got: "+b.vertexCount);this.vertexCounter+b.vertexCount>=65536&&this._generateMesh();var d=b.attributeMap;for(var f in d){var g=d[f],h=this.vertexData[f];h||(this.vertexData[f]={},h=this.vertexData[f],h.array=[],h.map={count:g.count,type:g.type,stride:g.stride,offset:g.offset,normalized:g.normalized});var i=b.getAttributeBuffer(f),j=i.length,k=h.array;if(f===a.POSITION)for(var l=0;j>l;l+=3)e.setd(i[l+0],i[l+1],i[l+2]),c.matrix.applyPostPoint(e),k[this.vertexCounter*g.count+l+0]=e[0],k[this.vertexCounter*g.count+l+1]=e[1],k[this.vertexCounter*g.count+l+2]=e[2];else if(f===a.NORMAL)for(var l=0;j>l;l+=3)e.setd(i[l+0],i[l+1],i[l+2]),c.rotation.applyPost(e),k[this.vertexCounter*g.count+l+0]=e[0],k[this.vertexCounter*g.count+l+1]=e[1],k[this.vertexCounter*g.count+l+2]=e[2];else if(f===a.TANGENT)for(var l=0;j>l;l+=3)e.setd(i[l+0],i[l+1],i[l+2]),c.rotation.applyPost(e),k[this.vertexCounter*g.count+l+0]=e[0],k[this.vertexCounter*g.count+l+1]=e[1],k[this.vertexCounter*g.count+l+2]=e[2];else for(var l=0;j>l;l++)k[this.vertexCounter*g.count+l]=i[l]}for(var m=b.getIndexBuffer(),l=0,n=b.indexCount;n>l;l++)this.indexData[this.indexCounter+l]=m[l]+this.vertexCounter;this.vertexCounter+=b.vertexCount,this.indexCounter+=b.indexCount,this.indexLengths=b.indexLengths?this.indexLengths.concat(b.indexLengths):this.indexLengths.concat(b.getIndexBuffer().length),this.indexModes=this.indexModes.concat(b.indexModes)},d.prototype._generateMesh=function(){var b={};for(var c in this.vertexData){var d=this.vertexData[c];b[c]=d.map}var e=new a(b,this.vertexCounter,this.indexCounter);for(var c in this.vertexData){var d=this.vertexData[c].array;e.getAttributeBuffer(c).set(d)}e.getIndexBuffer().set(this.indexData),e.indexLengths=this.indexLengths,e.indexModes=this.indexModes,this.meshDatas.push(e),this.vertexData={},this.indexData=[],this.vertexCounter=0,this.indexCounter=0,this.indexLengths=[],this.indexModes=[]},d.prototype.build=function(){return this.vertexCounter>0&&this._generateMesh(),this.meshDatas},d}),define("goo/debug/BoundingVolumeMeshBuilder",["goo/renderer/bounds/BoundingBox","goo/renderer/bounds/BoundingSphere","goo/util/MeshBuilder","goo/renderer/MeshData","goo/math/Transform"],function(a,b,c,d,e){"use strict";function f(){}function g(a,b,c){var e=[a,b,c,a,b,-c,a,-b,c,a,-b,-c,-a,b,c,-a,b,-c,-a,-b,c,-a,-b,-c],f=[0,1,0,2,1,3,2,3,4,5,4,6,5,7,6,7,0,4,1,5,2,6,3,7],g=new d(d.defaultMap([d.POSITION]),e.length/3,f.length);return g.getAttributeBuffer(d.POSITION).set(e),g.getIndexBuffer().set(f),g.indexLengths=null,g.indexModes=["Lines"],g}function h(a,b){a=a||1,b=b||8;for(var c=[],e=[],f=2*Math.PI/b,g=0,h=0;b>g;g++,h+=f)c.push(Math.cos(h)*a,Math.sin(h)*a,0),e.push(g,g+1);e[e.length-1]=0;var i=new d(d.defaultMap([d.POSITION]),b,e.length);return i.getAttributeBuffer(d.POSITION).set(c),i.getIndexBuffer().set(e),i.indexLengths=null,i.indexModes=["Lines"],i}function i(a){a=a||1;var b,d=new c,f=128,g=h(a,f);b=new e,d.addMeshData(g,b),b=new e,b.rotation.fromAngles(0,Math.PI/2,0),b.update(),d.addMeshData(g,b),b=new e,b.rotation.fromAngles(Math.PI/2,Math.PI/2,0),b.update(),d.addMeshData(g,b);var i=d.build();return i[0]}return f.buildBox=function(a){var b=g(a.xExtent,a.yExtent,a.zExtent);return b},f.buildSphere=function(a){var b=i(a.radius);return b},f.build=function(c){return c instanceof a?f.buildBox(c):c instanceof b?f.buildSphere(c):void 0},f}),define("goo/shapes/debug/LightDebug",["goo/renderer/MeshData","goo/util/MeshBuilder","goo/math/Transform","goo/shapes/ShapeCreator","goo/renderer/light/PointLight","goo/renderer/light/DirectionalLight","goo/renderer/light/SpotLight"],function(a,b,c,d,e,f,g){"use strict";
function h(){this._ball=d.createSphere(12,12,.3),this._pointLightMesh=h._buildPointLightMesh(),this._spotLightMesh=h._buildSpotLightMesh(),this._directionalLightMesh=h._buildDirectionalLightMesh()}function i(b,c){b=b||1,c=c||8;for(var d=[],e=[],f=2*Math.PI/c,g=0,h=0;c>g;g++,h+=f)d.push(Math.cos(h)*b,Math.sin(h)*b,0),e.push(g,g+1);e[e.length-1]=0;var i=new a(a.defaultMap([a.POSITION]),c,e.length);return i.getAttributeBuffer(a.POSITION).set(d),i.getIndexBuffer().set(e),i.indexLengths=null,i.indexModes=["Lines"],i}function j(){var a,d=1,e=new b,f=128,g=i(d,f);a=new c,e.addMeshData(g,a),a=new c,a.rotation.fromAngles(0,Math.PI/2,0),a.update(),e.addMeshData(g,a),a=new c,a.rotation.fromAngles(Math.PI/2,Math.PI/2,0),a.update(),e.addMeshData(g,a);var h=e.build();return h[0]}function k(b){b=b||8;for(var c=[0,0,0],d=[],e=2*Math.PI/b,f=0,g=0;b>f;f++,g+=e)c.push(Math.cos(g),Math.sin(g),1),d.push(0,f+1);var h=new a(a.defaultMap([a.POSITION]),b+1,d.length);return h.getAttributeBuffer(a.POSITION).set(c),h.getIndexBuffer().set(d),h.indexLengths=null,h.indexModes=["Lines"],h}function l(){for(var a=-1,d=new b,e=64,f=2,g=a/2,h=g,j=1;f>=j;j++){var l=i(h*j,e),m=new c;m.translation.set(0,0,g*j),m.update(),d.addMeshData(l,m)}var n=k(4),m=new c;m.scale.set(h*f,h*f,g*f),m.update(),d.addMeshData(n,m);var o=d.build();return o[0]}function m(b){b=b||8;for(var c=[],d=[],e=2*Math.PI/b,f=0,g=0;b>f;f++,g+=e)c.push(Math.cos(g),Math.sin(g),0),c.push(Math.cos(g),Math.sin(g),1),d.push(2*f,2*f+1);var h=new a(a.defaultMap([a.POSITION]),2*b,d.length);return h.getAttributeBuffer(a.POSITION).set(c),h.getIndexBuffer().set(d),h.indexLengths=null,h.indexModes=["Lines"],h}function n(){for(var a=new b,d=64,e=2,f=10/e,g=1,h=0;e>h;h++){var j=i(g,d),k=new c;k.translation.set(0,0,-f*h),k.update(),a.addMeshData(j,k)}var l=m(4),k=new c;k.scale.set(g,g,-f*e),k.update(),a.addMeshData(l,k);var n=a.build();return n[0]}return h.prototype.getMesh=function(a){return a instanceof e?[this._ball,this._pointLightMesh]:a instanceof g?[this._ball,this._spotLightMesh]:a instanceof f?[this._ball,this._directionalLightMesh]:void 0},h._buildPointLightMesh=function(){return j()},h._buildSpotLightMesh=function(){return l()},h._buildDirectionalLightMesh=function(){return n()},h}),define("goo/shapes/debug/CameraDebug",["goo/renderer/MeshData","goo/util/MeshBuilder","goo/math/Transform","goo/shapes/Box","goo/shapes/Cylinder"],function(a,b,c,d,e){"use strict";function f(){this._camera=f.buildCamera()}return f.prototype.getMesh=function(a){var b=a.far/a.near;return[this._camera,f.buildFrustum(b)]},f.buildFrustum=function(b){var c,d,e,f,g=Math.PI/4,h=1,i=h/b,j=1,k=Math.tan(g);c={x:-k*h*j,y:k*h,z:-h},d={x:-k*h*j,y:-k*h,z:-h},e={x:k*h*j,y:-k*h,z:-h},f={x:k*h*j,y:k*h,z:-h};var l,m,n,o;l={x:-k*i*j,y:k*i,z:-i},m={x:-k*i*j,y:-k*i,z:-i},n={x:k*i*j,y:-k*i,z:-i},o={x:k*i*j,y:k*i,z:-i};var p=[];p.push(c.x,c.y,c.z),p.push(d.x,d.y,d.z),p.push(e.x,e.y,e.z),p.push(f.x,f.y,f.z),p.push(l.x,l.y,l.z),p.push(m.x,m.y,m.z),p.push(n.x,n.y,n.z),p.push(o.x,o.y,o.z);var q=[];q.push(0,1),q.push(1,2),q.push(2,3),q.push(3,0),q.push(4,5),q.push(5,6),q.push(6,7),q.push(7,4),q.push(0,4),q.push(1,5),q.push(2,6),q.push(3,7);var r=new a(a.defaultMap([a.POSITION]),8,24);return r.getAttributeBuffer(a.POSITION).set(p),r.getIndexBuffer().set(q),r.indexLengths=null,r.indexModes=["Lines"],r},f.buildCamera=function(){var f=new b,g=new c,h=new e(32,.6),i=new e(32,.6),j=new d(.3,1,1.6),k=new d(.2,.15,.7);k.applyFunction(a.POSITION,function(a){return[a.x+a.x/(.3*(a.z+1.1)),a.y+a.y/(.3*(a.z+1.1)),a.z]}),g.translation.setd(0,0,0),g.update(),f.addMeshData(k,g),g.translation.setd(0,0,1.3),g.update(),f.addMeshData(j,g),g.scale.setd(1,1,.5),g.setRotationXYZ(0,Math.PI/2,0),g.translation.setd(0,1.2,.6),g.update(),f.addMeshData(h,g),g.translation.setd(0,1.2,2),g.update(),f.addMeshData(i,g);var l=f.build();return l[0]},f}),define("goo/shapes/debug/MeshRendererDebug",["goo/renderer/MeshData"],function(a){"use strict";function b(){this._meshes=[c(1,1,1),null]}function c(b,c,d){var e=[b,c,d,b,c,-d,b,-c,d,b,-c,-d,-b,c,d,-b,c,-d,-b,-c,d,-b,-c,-d],f=[0,1,0,2,1,3,2,3,4,5,4,6,5,7,6,7,0,4,1,5,2,6,3,7],g=new a(a.defaultMap([a.POSITION]),e.length/3,f.length);return g.getAttributeBuffer(a.POSITION).set(e),g.getIndexBuffer().set(f),g.indexLengths=null,g.indexModes=["Lines"],g}return b.prototype.getMesh=function(){return this._meshes},b}),define("goo/debug/DebugDrawHelper",["goo/entities/components/LightComponent","goo/entities/components/CameraComponent","goo/entities/components/MeshRendererComponent","goo/renderer/light/PointLight","goo/renderer/light/DirectionalLight","goo/renderer/light/SpotLight","goo/shapes/debug/LightDebug","goo/shapes/debug/CameraDebug","goo/shapes/debug/MeshRendererDebug","goo/renderer/Material","goo/renderer/Util","goo/renderer/shaders/ShaderLib","goo/renderer/shaders/ShaderBuilder","goo/math/Transform"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){"use strict";var o={},p=new g,q=new h,r=new i;return o.getRenderablesFor=function(a){var b,c;return"LightComponent"===a.type?(b=p.getMesh(a.light),c=j.createMaterial(l.simpleColored,"DebugDrawLightMaterial")):"CameraComponent"===a.type?(b=q.getMesh(a.camera),c=j.createMaterial(l.simpleLit,"DebugDrawCameraMaterial"),c.uniforms.materialAmbient=[.2,.2,.2,1],c.uniforms.materialDiffuse=[.8,.8,.8,1],c.uniforms.materialSpecular=[0,0,0,1]):"MeshRendererComponent"===a.type&&(b=r.getMesh(),c=j.createMaterial(l.simpleColored,"DebugMeshRendererComponentMaterial")),[{meshData:b[0],transform:new n,materials:[c]},{meshData:b[1],transform:new n,materials:[c]}]},o.update=function(a,b,c){if(b.camera&&b.camera.changedProperties){var d=b.camera;d.far/d.near!==a[1].farNear&&(a[1].meshData=h.buildFrustum(d.far/d.near),a[1].farNear=d.far/d.near),b.camera.changedProperties=!1}o[b.type].updateMaterial(a[0].materials[0],b),o[b.type].updateMaterial(a[1].materials[0],b),o[b.type].updateTransform(a[1].transform,b);var f=a[0].transform.translation.distance(c)/30;a[0].transform.scale.setd(f,f,f),a[0].transform.update(),b.light&&b.light instanceof e&&(a[1].transform.scale.scale(f),a[1].transform.update())},o.LightComponent={},o.CameraComponent={},o.LightComponent.updateMaterial=function(a,b){var c=b.light,d=a.uniforms.color=a.uniforms.color||[];d[0]=c.color.data[0],d[1]=c.color.data[1],d[2]=c.color.data[2]},o.LightComponent.updateTransform=function(a,b){var c=b.light;if(!(c instanceof e)){var d=c.range;if(a.scale.setd(d,d,d),c instanceof f){var g=c.angle*Math.PI/180,h=Math.tan(g/2);a.scale.muld(h,h,1)}}a.update()},o.CameraComponent.updateMaterial=function(a){a.uniforms.color=a.uniforms.color||[1,1,1]},o.CameraComponent.updateTransform=function(a,b){var c=b.camera,d=c.far,e=d*Math.tan(c.fov/2*Math.PI/180),f=e*c.aspect;a.scale.setd(f,e,d),a.update()},o}),define("goo/debug/components/MarkerComponent",["goo/entities/components/Component","goo/shapes/ShapeCreator","goo/debug/BoundingVolumeMeshBuilder"],function(a,b,c){"use strict";function d(a){this.type="MarkerComponent";var b=a.meshDataComponent.modelBound;this.meshData=c.build(b)}return d.prototype=Object.create(a.prototype),d}),define("goo/debug/systems/MarkerSystem",["goo/entities/systems/System","goo/renderer/Material","goo/renderer/shaders/ShaderLib","goo/shapes/ShapeCreator","goo/debug/components/MarkerComponent","goo/renderer/Renderer"],function(a,b,c,d,e,f){"use strict";function g(d){a.call(this,"MarkerSystem",["MarkerComponent"]),this.material=b.createMaterial(c.simpleColored,""),this.material.depthState.enabled=!1,this.material.shader.uniforms.color=[0,1,0],this.goo=d,this.renderer=this.goo.renderer,this.entities=[],this.goo.callbacks.push(function(){for(var a=0;a<this.entities.length;a++){var b=this.entities[a];if(b.hasComponent("MarkerComponent")){var c=b.transformComponent.transform,d={meshData:b.markerComponent.meshData,materials:[this.material],transform:c};this.goo.renderer.render(d,f.mainCamera,[],null,!1)}}}.bind(this))}return g.prototype=Object.create(a.prototype),g.prototype.process=function(a){this.entities=a},g}),define("goo/debug/Debugger",["goo/debug/components/MarkerComponent","goo/debug/systems/MarkerSystem"],function(MarkerComponent,MarkerSystem){"use strict";function Debugger(a){this.goo=null,this.exportPicked=a||!1,this.picked=null,this.oldPicked=null}function createPanel(){var a=document.createElement("div");a.id="debugdiv";var b='<span style="font-size: x-small;font-family: sans-serif">Filter</span><br /><textarea cols="30" id="debugparams">name, Compo, tran, data</textarea><br /><span style="font-size: x-small;font-family: sans-serif">Result</span><br /><textarea readonly rows="10" cols="30" id="debugtex">Click on an entity</textarea><br />';b+='<hr /><span style="font-size: x-small;font-family: sans-serif">REPL</span><br /><textarea readonly rows="10" cols="30" id="replouttex">...</textarea><br /><textarea cols="30" id="replintex">entity.</textarea>',a.innerHTML=b,a.style.position="absolute",a.style.zIndex="2001",a.style.backgroundColor="#DDDDDD",a.style.left="10px",a.style.top="100px",a.style.webkitTouchCallout="none",a.style.webkitUserSelect="none",a.style.khtmlUserSelect="none",a.style.mozUserSelect="none",a.style.msUserSelect="none",a.style.userSelect="none",a.style.padding="3px",a.style.borderRadius="6px",document.body.appendChild(a)}function getFilterList(a){return a.split(",").map(function(a){return a.replace(/(^[\s]+|[\s]+$)/g,"")}).filter(function(a){return a.length>0}).map(function(a){return new RegExp(a)})}function stringifyTypedArray(a){if(0===a.length)return"[]";for(var b="["+a[0],c=1;c<a.length;c++)b+=" "+a[c];return b+="]"}function filterProperties(a,b,c,d){if(0===b.length)return"No interests specified;\n\nSome popular interests: is, tran, Compo\n\nEvery entry separated by a comma is a regex";if(0>d)return c+"REACHED MAXIMUM DEPH\n";if(null===a)return c+"null\n";var e=typeof a;if("undefined"===e||"number"===e||"boolean"===e||"string"===e||a instanceof Array&&("string"==typeof a[0]||"number"==typeof a[0]||"boolean"==typeof a[0]))return c+JSON.stringify(a)+"\n";if(-1!==Object.prototype.toString.call(a).indexOf("Array]"))return c+stringifyTypedArray(a)+"\n";var f=[];for(var g in a)if(a.hasOwnProperty(g)){if("function"==typeof a[g])continue;for(var h in b)if(b[h].test(g)){var i=filterProperties(a[g],b,c+" ",d-1);f.push(c+g+"\n"+i);break}}return f.join("")}function updateMarker(a,b){a!==b?(null!==b&&b.hasComponent("MarkerComponent")&&b.clearComponent("MarkerComponent"),null!==a&&a.setComponent(new MarkerComponent(a))):a.hasComponent("MarkerComponent")?a.clearComponent("MarkerComponent"):a.setComponent(new MarkerComponent(a))}function displayInfo(a){var b=getFilterList(document.getElementById("debugparams").value);a&&console.log("==> ",a);var c=filterProperties(a,b,"",20),d=document.getElementById("debugtex");d.value=c}return Debugger.prototype._setUpREPL=function(){var lastCommStr="";document.getElementById("replintex").addEventListener("keyup",function(event){event.stopPropagation();var replinElemHandle=document.getElementById("replintex"),reploutElemHandle=document.getElementById("replouttex");if(13!==event.keyCode||event.shiftKey)38===event.keyCode&&(replinElemHandle.value=lastCommStr);else{var commStr=replinElemHandle.value.substr(0,replinElemHandle.value.length-1);lastCommStr=commStr;var entity=this.picked,goo=this.goo,resultStr="";try{resultStr+=eval(commStr)}catch(err){resultStr+=err}replinElemHandle.value="entity.",reploutElemHandle.value+="\n-------\n"+resultStr,displayInfo(this.picked)}}.bind(this),!1)},Debugger.prototype._setUpPicking=function(){document.addEventListener("mouseup",function(a){a.stopPropagation();var b=a.pageX,c=a.pageY;this.goo.pick(b,c,function(a){var b=this.goo.world.entityManager.getEntityById(a);b&&(this.oldPicked=this.picked,this.picked=b,this.picked===this.oldPicked&&(this.picked=null),this.exportPicked&&(window.picked=this.picked),displayInfo(this.picked),updateMarker(this.picked,this.oldPicked))}.bind(this))}.bind(this),!1)},Debugger.prototype.inject=function(a){return this.goo=a,createPanel(),this.goo.world.getSystem("MarkerSystem")||this.goo.world.setSystem(new MarkerSystem(this.goo)),this._setUpPicking(),document.getElementById("debugparams").addEventListener("keyup",function(){displayInfo(this.picked)}.bind(this)),this._setUpREPL(),this},Debugger}),define("goo/debug/EntityCounter",[],function(){"use strict";function a(a){this.goo=null,this.skipFrames=a||20,this.texHandle=null}function b(){var a=document.createElement("div");a.id="_entitycounterdiv";var b='<span style="font-size: x-small;font-family: sans-serif">Counter</span><br /><textarea cols="30" rows="6" id="_entitycountertex">...</textarea>';return a.innerHTML=b,a.style.position="absolute",a.style.zIndex="2001",a.style.backgroundColor="#BBBBBB",a.style.left="10px",a.style.bottom="10px",a.style.webkitTouchCallout="none",a.style.webkitUserSelect="none",a.style.khtmlUserSelect="none",a.style.mozUserSelect="none",a.style.msUserSelect="none",a.style.userSelect="none",a.style.padding="3px",a.style.borderRadius="6px",document.body.appendChild(a),document.getElementById("_entitycountertex")}return a.prototype.inject=function(a){this.goo=a,this.texHandle=b();var c=this,d=0;return this.goo.callbacks.push(function(){if(d--,0>=d){d=c.skipFrames;var a="";for(var b in c.goo.world._systems){var e=c.goo.world._systems[b];a+=e.type+": "+e._activeEntities.length+"\n"}c.texHandle.value=a}}),this},a}),define("goo/debug/FrustumViewer",["goo/renderer/MeshData","goo/util/MeshBuilder","goo/math/Transform","goo/shapes/ShapeCreator","goo/entities/components/MeshDataComponent","goo/entities/components/MeshRendererComponent","goo/renderer/Material","goo/renderer/shaders/ShaderLib","goo/shapes/Box","goo/shapes/Cylinder"],function(a,b,c,d,e,f,g,h,i,j){"use strict";function k(){}function l(b,c,d,e){var f,g,h,i,j=b*Math.PI/180/2,k=Math.tan(j);f={x:-k*e*c,y:k*e,z:-e},g={x:-k*e*c,y:-k*e,z:-e},h={x:k*e*c,y:-k*e,z:-e},i={x:k*e*c,y:k*e,z:-e};var l,m,n,o;l={x:-k*d*c,y:k*d,z:-d},m={x:-k*d*c,y:-k*d,z:-d},n={x:k*d*c,y:-k*d,z:-d},o={x:k*d*c,y:k*d,z:-d};var p=[];p.push(f.x,f.y,f.z),p.push(g.x,g.y,g.z),p.push(h.x,h.y,h.z),p.push(i.x,i.y,i.z),p.push(l.x,l.y,l.z),p.push(m.x,m.y,m.z),p.push(n.x,n.y,n.z),p.push(o.x,o.y,o.z);var q=[];q.push(0,1),q.push(1,2),q.push(2,3),q.push(3,0),q.push(4,5),q.push(5,6),q.push(6,7),q.push(7,4),q.push(0,4),q.push(1,5),q.push(2,6),q.push(3,7);var r=new a(a.defaultMap([a.POSITION]),8,24);return r.getAttributeBuffer(a.POSITION).set(p),r.getIndexBuffer().set(q),r.indexLengths=null,r.indexModes=["Lines"],r}function m(d){var e=new b,f=new c,g=l(d.fov,d.aspect,d.near,d.far);e.addMeshData(g,f);var h=new j(32,.6),k=new j(32,.6),m=new i(.3,1,1.6),n=new i(.2,.15,.7);n.applyFunction(a.POSITION,function(a){return[a.x+a.x/(.3*(a.z+1.1)),a.y+a.y/(.3*(a.z+1.1)),a.z]}),f.translation.setd(0,0,0),f.update(),e.addMeshData(n,f),f.translation.setd(0,0,1.3),f.update(),e.addMeshData(m,f),f.scale.setd(1,1,.5),f.setRotationXYZ(0,Math.PI/2,0),f.translation.setd(0,1.2,.6),f.update(),e.addMeshData(h,f),f.translation.setd(0,1.2,2),f.update(),e.addMeshData(k,f);var o=e.build();return o[0]}return k.getMeshData=function(a){var b=m(a);return b},k.attachGuide=function(a){var b=a.getComponent("CameraComponent").camera,c=l(b.fov,b.aspect,b.near,b.far-b.far/1e3),d=new e(c);a.setComponent(d);var i=new f,j=g.createMaterial(h.simpleColored,"");return j.uniforms.color=[.5,.7,1],i.materials.push(j),a.setComponent(i),a},k.removeMesh=function(a){return a.hasComponent("cameraComponent")&&(a.clearComponent("meshDataComponent"),a.clearComponent("meshRendererComponent")),a},k}),define("goo/debug/LightPointer",["goo/renderer/MeshData","goo/util/MeshBuilder","goo/math/Transform","goo/shapes/ShapeCreator","goo/entities/components/MeshDataComponent","goo/entities/components/MeshRendererComponent","goo/renderer/Material","goo/renderer/shaders/ShaderLib","goo/math/MathUtils","goo/renderer/light/PointLight","goo/renderer/light/DirectionalLight","goo/renderer/light/SpotLight"],function(a,b,c,d,e,f,g,h,i,j,k,l){"use strict";function m(){}function n(b,c){b=b||1,c=c||8;for(var d=[],e=[],f=2*Math.PI/c,g=0,h=0;c>g;g++,h+=f)d.push(Math.cos(h)*b,Math.sin(h)*b,0),e.push(g,g+1);e[e.length-1]=0;var i=new a(a.defaultMap([a.POSITION]),c,e.length);return i.getAttributeBuffer(a.POSITION).set(d),i.getIndexBuffer().set(e),i.indexLengths=null,i.indexModes=["Lines"],i}function o(a){a=a||1;var d,e=new b,f=128,g=n(a,f);d=new c,e.addMeshData(g,d),d=new c,d.rotation.fromAngles(0,Math.PI/2,0),d.update(),e.addMeshData(g,d),d=new c,d.rotation.fromAngles(Math.PI/2,Math.PI/2,0),d.update(),e.addMeshData(g,d);var h=e.build();return h[0]}function p(b){b=b||8;for(var c=[0,0,0],d=[],e=2*Math.PI/b,f=0,g=0;b>f;f++,g+=e)c.push(Math.cos(g),Math.sin(g),1),d.push(0,f+1);var h=new a(a.defaultMap([a.POSITION]),b+1,d.length);return h.getAttributeBuffer(a.POSITION).set(c),h.getIndexBuffer().set(d),h.indexLengths=null,h.indexModes=["Lines"],h}function q(a,d){a=a||45,d=d||1;for(var e=new b,f=64,g=2,h=d/2,j=Math.tan(a*i.DEG_TO_RAD/2)*h,k=1;g>=k;k++){var l=n(j*k,f),m=new c;m.translation.set(0,0,h*k),m.update(),e.addMeshData(l,m)}var o=p(4),m=new c;m.scale.set(j*g,j*g,h*g),m.update(),e.addMeshData(o,m);var q=e.build();return q[0]}function r(b){b=b||8;for(var c=[],d=[],e=2*Math.PI/b,f=0,g=0;b>f;f++,g+=e)c.push(Math.cos(g),Math.sin(g),0),c.push(Math.cos(g),Math.sin(g),1),d.push(2*f,2*f+1);var h=new a(a.defaultMap([a.POSITION]),2*b,d.length);return h.getAttributeBuffer(a.POSITION).set(c),h.getIndexBuffer().set(d),h.indexLengths=null,h.indexModes=["Lines"],h}function s(){for(var a=new b,d=64,e=2,f=10,g=2,h=0;e>h;h++){var i=n(g,d),j=new c;j.translation.set(0,0,f*h),j.update(),a.addMeshData(i,j)}var k=r(4),j=new c;j.scale.set(g,g,f*e),j.update(),a.addMeshData(k,j);var l=a.build();return l[0]}function t(a){var e=new b,f=new c,g=o(a.range),h=d.createSphere(8,8,.1);e.addMeshData(g,f),e.addMeshData(h,f);var i=e.build();return i[0]}function u(a){var e=new b,f=new c,g=q(a.angle,a.range),h=d.createSphere(8,8,.1);e.addMeshData(h,f),f.scale.setd(1,1,-1),f.update(),e.addMeshData(g,f);var i=e.build();return i[0]}function v(){var a=new b,e=new c;e.scale.setd(1,1,-1),e.update();var f=s(),g=d.createSphere(8,8,.1);a.addMeshData(f,e),a.addMeshData(g,e);var h=a.build();return h[0]}function w(a){return a instanceof j?t(a):a instanceof k?v(a):a instanceof l?u(a):void 0}return m.getMeshData=function(a){var b=w(a);return b},m.attachPointer=function(a){var b=a.getComponent("lightComponent").light,c=w(b),d=new e(c);a.setComponent(d);var i=new f;a.setComponent(i);var j=g.createMaterial(h.simpleColored,"");return j.uniforms.color=[b.color.data[0],b.color.data[1],b.color.data[2]],a.meshRendererComponent.materials.push(j),a},m.removeMesh=function(a){return a.clearComponent("meshDataComponent"),a.clearComponent("meshRendererComponent"),a},m}),define("goo/entities/systems/TransformSystem",["goo/entities/systems/System"],function(a){"use strict";function b(){a.call(this,"TransformSystem",["TransformComponent"])}return b.prototype=Object.create(a.prototype),b.prototype.process=function(a){var b,c;for(b=0;b<a.length;b++)c=a[b].transformComponent,c._updated=!1,c._dirty&&c.updateTransform();for(b=0;b<a.length;b++)c=a[b].transformComponent,c._dirty&&this.updateWorldTransform(c)},b.prototype.updateWorldTransform=function(a){a.updateWorldTransform();for(var b=0;b<a.children.length;b++)this.updateWorldTransform(a.children[b])},b}),define("goo/renderer/SimplePartitioner",["goo/renderer/Camera"],function(a){"use strict";function b(){}return b.prototype.added=function(){},b.prototype.removed=function(){},b.prototype.process=function(b,c,d){for(var e=0,f=0;f<c.length;f++){var g=c[f];if(!g.skip&&!g.meshRendererComponent.hidden)if("Never"===g.meshRendererComponent.cullMode)d[e++]=g,g.isVisible=!0;else{var h=g.meshRendererComponent.worldBound,i=b.contains(h);i!==a.Outside?(d[e++]=g,g.isVisible=!0):g.isVisible=!1}}d.length=e},b}),define("goo/entities/systems/RenderSystem",["goo/entities/systems/System","goo/entities/SystemBus","goo/renderer/SimplePartitioner","goo/renderer/Material","goo/renderer/shaders/ShaderLib","goo/renderer/Util"],function(a,b,c,d,e,f){"use strict";function g(){a.call(this,"RenderSystem",["MeshRendererComponent","MeshDataComponent"]),this.entities=[],this.renderList=[],this.postRenderables=[],this.partitioner=new c,this.preRenderers=[],this.composers=[],this._composersActive=!0,this.doRender=!0,this._debugMaterials={},this.overrideMaterials=[],this.camera=null,this.lights=[],this.currentTpf=0;var d=this;b.addListener("goo.setCurrentCamera",function(a){d.camera=a}),b.addListener("goo.setLights",function(a){d.lights=a}),this.picking={doPick:!1,x:0,y:0,pickingStore:{},pickingCallback:function(a,b){console.log(a,b)},skipUpdateBuffer:!1}}return g.prototype=Object.create(a.prototype),g.prototype.pick=function(a,b,c,d){this.picking.x=a,this.picking.y=b,this.picking.skipUpdateBuffer=void 0===d?!1:d,c&&(this.picking.pickingCallback=c),this.picking.doPick=!0},g.prototype.inserted=function(a){this.partitioner&&this.partitioner.added(a)},g.prototype.deleted=function(a){this.partitioner&&this.partitioner.removed(a)},g.prototype.process=function(a,b){this.entities=a,this.currentTpf=b},g.prototype.render=function(a){if(this.doRender&&this.camera){a.updateShadows(this.partitioner,this.entities,this.lights);for(var b=0;b<this.preRenderers.length;b++){var c=this.preRenderers[b];c.process(a,this.entities,this.partitioner,this.camera,this.lights)}if(this.partitioner.process(this.camera,this.entities,this.renderList),this.composers.length>0&&this._composersActive)for(var b=0;b<this.composers.length;b++){var d=this.composers[b];d.render(a,this.currentTpf,this.camera,this.lights,null,!0,this.overrideMaterials)}else a.render(this.renderList,this.camera,this.lights,null,{color:!1,depth:!0,stencil:!0},this.overrideMaterials)}},g.prototype.renderToPick=function(a,b){a.renderToPick(this.renderList,this.camera,!0,b)},g.prototype.enableComposers=function(a){this._composersActive=!!a},g.prototype._createDebugMaterial=function(a){if(""!==a){var b;switch(a){case"wireframe":case"color":b=f.clone(e.simpleColored.fshader);break;case"lit":b=f.clone(e.simpleLit.fshader);break;case"texture":b=f.clone(e.textured.fshader);break;case"normals":b=f.clone(e.showNormals.fshader);break;case"simple":b=f.clone(e.simple.fshader)}var c=f.clone(e.uber);c.fshader=b,"flat"!==a?(this._debugMaterials[a]=d.createMaterial(c,a),"wireframe"===a&&(this._debugMaterials[a].wireframe=!0)):(this._debugMaterials[a]=d.createEmptyMaterial(null,a),this._debugMaterials[a].flat=!0)}},g.prototype.setDebugMaterial=function(a){if(!a||""===a)return this.overrideMaterials=[],void 0;var b=a.split("+");this.overrideMaterials=[];for(var c=0;c<b.length;c++){var a=b[c];this._debugMaterials[a]||this._createDebugMaterial(a),""===a?this.overrideMaterials.push(null):this.overrideMaterials.push(this._debugMaterials[a])}},g}),define("goo/entities/systems/BoundingUpdateSystem",["goo/entities/systems/System","goo/renderer/bounds/BoundingBox"],function(a,b){"use strict";function c(){a.call(this,"BoundingUpdateSystem",["TransformComponent","MeshRendererComponent","MeshDataComponent"]),this._worldBound=new b,this._computeWorldBound=null}return c.prototype=Object.create(a.prototype),c.prototype.process=function(a){for(var b=0;b<a.length;b++){var c=a[b],d=c.meshDataComponent,e=c.transformComponent,f=c.meshRendererComponent;d.autoCompute?(d.computeBoundFromPoints(),f.updateBounds(d.modelBound,e.worldTransform)):e._updated&&f.updateBounds(d.modelBound,e.worldTransform)}if(this._computeWorldBound&&this._computeWorldBound instanceof Function){if(0===a.length)return this._computeWorldBound=null,void 0;this._worldBound=a[0].meshRendererComponent.worldBound.clone();for(var b=1;b<a.length;b++){var g=a[b].meshRendererComponent;this._worldBound=this._worldBound.merge(g.worldBound)}this._computeWorldBound(this._worldBound),this._computeWorldBound=null}},c.prototype.getWorldBound=function(a){this._computeWorldBound=a},c}),define("goo/entities/systems/ScriptSystem",["goo/entities/systems/System"],function(a){"use strict";function b(b){a.call(this,"ScriptSystem",["ScriptComponent"]),this.renderer=b,this.environment={domElement:null,viewportWidth:0,viewportHeight:0}}return b.prototype=Object.create(a.prototype),b.prototype.process=function(a,b){this.environment.domElement=this.renderer.domElement,this.environment.viewportWidth=this.renderer.viewportWidth,this.environment.viewportHeight=this.renderer.viewportHeight;for(var c=0;c<a.length;c++){var d=a[c].scriptComponent;d.run(a[c],b,this.environment)}},b}),define("goo/entities/systems/LightingSystem",["goo/entities/systems/System","goo/entities/SystemBus"],function(a,b){"use strict";function c(){a.call(this,"LightingSystem",["LightComponent","TransformComponent"]),this.lights=[],this.overrideLights=null,this._needsUpdate=!0}return c.prototype=Object.create(a.prototype),c.prototype.addedComponent=function(a,c){"LightComponent"===c.type&&-1===this.lights.indexOf(c.light)&&(a.transformComponent.setUpdated(),this.lights.push(c.light),this.overrideLights||b.emit("goo.setLights",this.lights))},c.prototype.removedComponent=function(a,c){if("LightComponent"===c.type){var d=this.lights.indexOf(c.light);-1!==d&&(this.lights.splice(d,1),this.overrideLights||b.emit("goo.setLights",this.lights))}},c.prototype.setOverrideLights=function(a){this.overrideLights=a,b.emit("goo.setLights",this.overrideLights||this.lights),this._needsUpdate=!0},c.prototype.process=function(a){if(!this.overrideLights){for(var b=0;b<a.length;b++){var c=a[b],d=c.transformComponent,e=c.lightComponent;(d._updated||this._needsUpdate)&&e.updateLight(d.worldTransform)}this._needsUpdate=!1}},c}),define("goo/entities/systems/CameraSystem",["goo/entities/systems/System","goo/entities/SystemBus","goo/renderer/Renderer"],function(a,b,c){"use strict";function d(){a.call(this,"CameraSystem",["TransformComponent","CameraComponent"]),this.mainCamera=null}return d.prototype=Object.create(a.prototype),d.prototype.findMainCamera=function(){for(var a=null,d=0;d<this._activeEntities.length;d++){var e=this._activeEntities[d].cameraComponent;(!a||e.isMain)&&(a=e.camera)}b.emit("goo.setCurrentCamera",a),c.mainCamera=a},d.prototype.inserted=function(){this.findMainCamera()},d.prototype.deleted=function(){this.findMainCamera()},d.prototype.process=function(a){for(var b=0;b<a.length;b++){var c=a[b],d=c.transformComponent,e=c.cameraComponent;d._updated&&e.updateCamera(d.worldTransform)}},d}),define("goo/entities/systems/ParticlesSystem",["goo/entities/systems/System"],function(a){"use strict";function b(){a.call(this,"ParticlesSystem",["TransformComponent","MeshRendererComponent","MeshDataComponent","ParticleComponent"]),this.passive=!1}return b.prototype=Object.create(a.prototype),b.prototype.process=function(a,b){if(!(b>1))for(var c=0,d=a.length;d>c;c++){var e=a[c],f=e.particleComponent;f.enabled&&this.updateParticles(e,f,b)}},b.prototype.updateParticles=function(a,b,c){for(var d,e=0,f=-1,g=!1,h=!1;e<b.particleCount;){for(;void 0===d;)if(f++,b.emitters.length>f){if(d=b.emitters[f],d.influences.length)for(var i=0,j=d.influences.length;j>i;i++)d.influences[i].prepare(a,d);if(!d.enabled){d=void 0;continue}if(0!==d.totalParticlesToSpawn&&(d.particlesWaitingToRelease+=d.releaseRatePerSecond*c,d.particlesWaitingToRelease=Math.max(d.particlesWaitingToRelease,0),h=!0),d.particlesWaitingToRelease<1){d=void 0;continue}}else d=null;var k=b.particles[e];if(k.alive&&k.emitter&&k.emitter.influences.length)for(var i=0,j=k.emitter.influences.length;j>i;i++)k.emitter.influences[i].enabled&&k.emitter.influences[i].apply(c,k,e);k.alive&&(k.update(c,a),g=!0,h=!0),!k.alive&&d&&(d.particlesWaitingToRelease--,d.totalParticlesToSpawn>=1&&d.totalParticlesToSpawn--,k.respawnParticle(d),d.getEmissionPoint(k,a),d.getEmissionVelocity(k,a),(d.particlesWaitingToRelease<1||0===d.totalParticlesToSpawn)&&(d=void 0)),e++}g&&(b.meshData.vertexData._dataNeedsRefresh=!0,a.meshDataComponent.autoCompute=!0),h||(b.enabled=!1)},b}),define("goo/util/Stats",[],function(){"use strict";function a(){var a=Date.now(),b=a,c=a,d=0,e=1/0,f=0,g=0,h=1/0,i=0,j=0,k=0,l=document.createElement("div");l.id="stats",l.addEventListener("mousedown",function(a){a.preventDefault(),v(++k%2)},!1),l.style.cssText="width:80px;cursor:pointer;z-index:1000;-webkit-touch-callout: none;-webkit-user-select: none;-khtml-user-select: none;-moz-user-select: none;-ms-user-select: none;user-select: none;";var m=document.createElement("div");m.id="fps",m.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#002",l.appendChild(m);var n=document.createElement("div");n.id="fpsText",n.style.cssText="color:#0ff;font-family:Helvetica,Arial,sans-serif;font-size:8px;font-weight:bold;line-height:13px",n.innerHTML="FPS",m.appendChild(n);var o=document.createElement("div");for(o.id="fpsGraph",o.style.cssText="position:relative;width:74px;height:30px;background-color:#0ff",m.appendChild(o);o.children.length<74;){var p=document.createElement("span");p.style.cssText="width:1px;height:30px;float:left;background-color:#113",o.appendChild(p)}var q=document.createElement("div");q.id="ms",q.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#020;display:none",l.appendChild(q);var r=document.createElement("div");r.id="msText",r.style.cssText="color:#0f0;font-family:Helvetica,Arial,sans-serif;font-size:8px;font-weight:bold;line-height:13px",r.innerHTML="MS",q.appendChild(r);var s=document.createElement("div");for(s.id="msGraph",s.style.cssText="position:relative;width:74px;height:30px;background-color:#0f0",q.appendChild(s);s.children.length<74;){var p=document.createElement("span");p.style.cssText="width:1px;height:30px;float:left;background-color:#131",s.appendChild(p)}var t=document.createElement("div");t.id="info",t.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#200",l.appendChild(t);var u=document.createElement("div");u.id="infoText",u.style.cssText="color:#f66;font-family:Helvetica,Arial,sans-serif;font-size:8px;font-weight:bold;line-height:13px",u.innerHTML="INFO",t.appendChild(u);var v=function(a){switch(k=a){case 0:m.style.display="block",q.style.display="none";break;case 1:m.style.display="none",q.style.display="block"}},w=function(a,b){var c=a.appendChild(a.firstChild);c.style.height=b+"px"};this.domElement=l,this.setMode=v,this.begin=function(){a=Date.now()},this.end=function(k){var l=Date.now();return l>c+100&&(d=l-a,e=Math.min(e,d),f=Math.max(f,d),r.textContent=d+" MS ("+e+"-"+f+")",w(s,Math.min(30,30-30*(d/200))),c=l,k&&(u.innerHTML="Calls: "+k.calls+"<br>Vertices: "+k.vertices+"<br>Indices: "+k.indices)),j++,l>b+1e3&&(g=Math.round(1e3*j/(l-b)),h=Math.min(h,g),i=Math.max(i,g),n.textContent=g+" FPS ("+h+"-"+i+")",w(o,Math.min(30,30-30*(g/(Math.min(500,i)+10)))),b=l,j=0),l},this.update=function(b){a=this.end(b)}}return a}),define("goo/entities/systems/CSSTransformSystem",["goo/entities/systems/System","goo/renderer/Renderer","goo/math/Matrix4x4","goo/math/MathUtils","goo/math/Vector3"],function(a,b,c,d,e){"use strict";function f(b){a.call(this,"CSSTransformSystem",["TransformComponent","CSSTransformComponent"]),this.renderer=b,this.viewDom=document.querySelector("#view"),this.containerDom=document.querySelector("#cam1"),this.containerDom2=document.querySelector("#cam2"),this.tmpMatrix=new c,this.tmpMatrix2=new c,this.tmpVector=new e}f.prototype=Object.create(a.prototype);var g=function(a){return Math.abs(a)<1e-6?0:a},h=["","-webkit-","-moz-","-ms-","-o-"],i=function(a,b,c){for(var d=0;d<h.length;d++)a.style[h[d]+b]=c},j=function(a){var b=a.data;return"matrix3d("+g(b[0])+","+g(-b[1])+","+g(b[2])+","+g(b[3])+","+g(b[4])+","+g(-b[5])+","+g(b[6])+","+g(b[7])+","+g(b[8])+","+g(-b[9])+","+g(b[10])+","+g(b[11])+","+g(b[12])+","+g(-b[13])+","+g(b[14])+","+g(b[15])+")"};return f.prototype.process=function(a){if(0!==a.length){var c=b.mainCamera,f=.5/Math.tan(.5*d.DEG_TO_RAD*c.fov)*this.renderer.domElement.offsetHeight;
i(this.viewDom,"perspective",f+"px"),this.tmpMatrix.copy(c.getViewInverseMatrix()),this.tmpMatrix2.copy(this.tmpMatrix),this.tmpMatrix.invert(),this.tmpMatrix.setTranslation(new e(0,0,f));var g=j(this.tmpMatrix);i(this.containerDom,"transform",g),this.tmpMatrix2.e03=-this.tmpMatrix2.e03,this.tmpMatrix2.e23=-this.tmpMatrix2.e23,this.tmpMatrix2.setRotationFromVector(new e(0,0,0)),g=j(this.tmpMatrix2),i(this.containerDom2,"transform",g);for(var h=0;h<a.length;h++){var k=a[h],l=k.getComponent("CSSTransformComponent"),m=l.domElement,n=l.scale;n=[n,-n,n].join(","),l.faceCamera?(k.transformComponent.worldTransform.matrix.getTranslation(this.tmpVector),this.tmpMatrix.copy(c.getViewInverseMatrix()),this.tmpMatrix.setTranslation(this.tmpVector)):this.tmpMatrix.copy(k.transformComponent.worldTransform.matrix),g="translate3d(-50%,-50%,0) "+j(this.tmpMatrix)+"scale3d("+n+")",i(m,"transform",g),m.parentNode!==this.containerDom2&&this.containerDom2.appendChild(m)}}},f}),define("goo/entities/systems/AnimationSystem",["goo/entities/systems/System","goo/entities/World"],function(a,b){"use strict";function c(){a.call(this,"AnimationSystem",["AnimationComponent"]),this.entities=[]}return c.prototype=Object.create(a.prototype),c.prototype.process=function(a){this.entities=a;for(var c=0;c<a.length;c++){var d=a[c],e=d.animationComponent;e.update(b.time),e.apply(d.transformComponent),e.postUpdate()}},c.prototype.pause=function(){this.passive=!0;for(var a=this.entities.length;a--;)this.entities[a].animationComponent.pause()},c.prototype.stop=function(){this.passive=!0;for(var a=0;a<this.entities.length;a++){var b=this.entities[a];b.animationComponent.stop()}},c.prototype.resume=function(){this.passive=!1;for(var a=0;a<this.entities.length;a++){var b=this.entities[a];b.animationComponent.resume()}},c}),define("goo/entities/systems/LightDebugSystem",["goo/entities/systems/System","goo/entities/components/MeshDataComponent","goo/entities/components/MeshRendererComponent","goo/renderer/Material","goo/renderer/shaders/ShaderLib","goo/debug/LightPointer"],function(a,b,c,d,e,f){"use strict";function g(){a.call(this,"LightDebugSystem",["LightDebugComponent"])}return g.prototype=Object.create(a.prototype),g.prototype.inserted=function(a){var g=a.lightComponent.light,h=f.getMeshData(g);a.setComponent(new b(h));var i=d.createMaterial(e.simpleColored,"");i.uniforms.color=[g.color.data[0],g.color.data[1],g.color.data[2]];var j=new c;j.materials.push(i),a.setComponent(j),j.updateBounds(a.meshDataComponent.modelBound,a.transformComponent.worldTransform)},g.prototype.process=function(a){for(var b=0;b<a.length;b++){var c=a[b],d=c.lightComponent.light;d.changedProperties&&(d.changedProperties=!1,c.meshDataComponent.meshData=f.getMeshData(d),c.meshRendererComponent.updateBounds(c.meshDataComponent.modelBound,c.transformComponent.worldTransform)),d.changedColor&&(d.changedColor=!1,c.meshRendererComponent.materials[0].uniforms.color=[d.color.data[0],d.color.data[1],d.color.data[2]])}},g.prototype.deleted=function(a){a.clearComponent("MeshDataComponent"),a.clearComponent("MeshRendererComponent")},g}),define("goo/entities/systems/CameraDebugSystem",["goo/entities/systems/System","goo/entities/components/MeshDataComponent","goo/entities/components/MeshRendererComponent","goo/renderer/Material","goo/renderer/shaders/ShaderLib","goo/debug/FrustumViewer"],function(a,b,c,d,e,f){"use strict";function g(){a.call(this,"CameraDebugSystem",["CameraDebugComponent"])}return g.prototype=Object.create(a.prototype),g.prototype.inserted=function(a){var g=a.cameraComponent.camera,h=f.getMeshData(g);a.setComponent(new b(h));var i=d.createMaterial(e.simpleColored,"");i.uniforms.color=[.4,.7,1];var j=new c;j.materials.push(i),a.setComponent(j),j.updateBounds(a.meshDataComponent.modelBound,a.transformComponent.worldTransform)},g.prototype.process=function(a){for(var b=0;b<a.length;b++){var c=a[b],d=c.cameraComponent.camera;d.changedProperties&&(c.meshDataComponent.meshData=f.getMeshData(d),c.meshRendererComponent.updateBounds(c.meshDataComponent.modelBound,c.transformComponent.worldTransform),d.changedProperties=!1)}},g.prototype.deleted=function(a){a.clearComponent("MeshDataComponent"),a.clearComponent("MeshRendererComponent")},g}),define("goo/util/GameUtils",[],function(){"use strict";function a(){}return a.supported={fullscreen:!0,pointerLock:!0},a.toggleFullScreen=function(){document.fullscreenElement?document.cancelFullScreen&&document.cancelFullScreen():document.documentElement.requestFullScreen&&document.documentElement.requestFullScreen()},a.requestPointerLock=function(){document.documentElement.requestPointerLock&&document.documentElement.requestPointerLock()},a.exitPointerLock=function(){document.exitPointerLock&&document.exitPointerLock()},a.togglePointerLock=function(){document.pointerLockElement?document.exitPointerLock&&document.exitPointerLock():document.documentElement.requestPointerLock&&document.documentElement.requestPointerLock()},a.addVisibilityChangeListener=function(a){if("function"==typeof a){for(var b,c,d=["","ms","moz","webkit"],e=0;e<d.length;++e){var f=d[e]+(0===d[e].length?"hidden":"Hidden"),g=d[e]+"visibilitychange";if("undefined"!=typeof document[f]){b=f,c=g;break}}"undefined"!=typeof document.addEventListener&&"undefined"!=typeof b&&document.addEventListener(c,function(){document[b]?a(!0):a(!1)})}},a.initAllShims=function(a){this.initAnimationShims(),this.initFullscreenShims(a),this.initPointerLockShims(a)},a.initAnimationShims=function(){for(var a=0,b=["ms","moz","webkit","o"],c=0;c<b.length&&!window.requestAnimationFrame;++c)window.requestAnimationFrame=window[b[c]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[c]+"CancelAnimationFrame"]||window[b[c]+"CancelRequestAnimationFrame"];void 0===window.requestAnimationFrame&&(window.requestAnimationFrame=function(b){var c=Date.now(),d=Math.max(0,16-(c-a)),e=window.setTimeout(function(){b(c+d)},d);return a=c+d,e}),void 0===window.cancelAnimationFrame&&(window.cancelAnimationFrame=function(a){clearTimeout(a)})},a.initFullscreenShims=function(b){function c(){var a=document.createEvent("CustomEvent");a.initCustomEvent("fullscreenchange",!0,!1,null),document.dispatchEvent(a)}function d(){var a=document.createEvent("CustomEvent");a.initCustomEvent("fullscreenerror",!0,!1,null),document.dispatchEvent(a)}b=b||window;var e=(b.HTMLElement||b.Element).prototype;if(!document.hasOwnProperty("fullscreenEnabled")){var f=function(){return"webkitIsFullScreen"in document?function(){return document.webkitFullscreenEnabled}:"mozFullScreenEnabled"in document?function(){return document.mozFullScreenEnabled}:(a.supported.fullscreen=!1,function(){return!1})}();Object.defineProperty(document,"fullscreenEnabled",{enumerable:!0,configurable:!1,writeable:!1,get:f})}if(!document.hasOwnProperty("fullscreenElement")){var f=function(){for(var a=["webkitCurrentFullScreenElement","webkitFullscreenElement","mozFullScreenElement"],b=function(b){return function(){return document[a[b]]}},c=0;c<a.length;c++)if(a[c]in document)return b(c);return function(){return null}}();Object.defineProperty(document,"fullscreenElement",{enumerable:!0,configurable:!1,writeable:!1,get:f})}document.addEventListener("webkitfullscreenchange",c,!1),document.addEventListener("mozfullscreenchange",c,!1),document.addEventListener("webkitfullscreenerror",d,!1),document.addEventListener("mozfullscreenerror",d,!1),e.requestFullScreen||(e.requestFullScreen=function(){return e.webkitRequestFullScreen?function(){this.webkitRequestFullScreen(b.Element.ALLOW_KEYBOARD_INPUT)}:e.mozRequestFullScreen?function(){this.mozRequestFullScreen()}:function(){}}()),document.cancelFullScreen||(document.cancelFullScreen=function(){return document.webkitCancelFullScreen||document.mozCancelFullScreen||function(){}}())},a.initPointerLockShims=function(b){function c(){var a=document.createEvent("CustomEvent");a.initCustomEvent("pointerlockchange",!0,!1,null),document.dispatchEvent(a)}function d(){var a=document.createEvent("CustomEvent");a.initCustomEvent("pointerlockerror",!0,!1,null),document.dispatchEvent(a)}b=b||window;var e=(b.HTMLElement||b.Element).prototype,f=b.MouseEvent.prototype;if("movementX"in f||Object.defineProperty(f,"movementX",{enumerable:!0,configurable:!1,writeable:!1,get:function(){return this.webkitMovementX||this.mozMovementX||0}}),"movementY"in f||Object.defineProperty(f,"movementY",{enumerable:!0,configurable:!1,writeable:!1,get:function(){return this.webkitMovementY||this.mozMovementY||0}}),navigator.pointer||(navigator.pointer=navigator.webkitPointer||navigator.mozPointer),document.addEventListener("webkitpointerlockchange",c,!1),document.addEventListener("webkitpointerlocklost",c,!1),document.addEventListener("mozpointerlockchange",c,!1),document.addEventListener("mozpointerlocklost",c,!1),document.addEventListener("webkitpointerlockerror",d,!1),document.addEventListener("mozpointerlockerror",d,!1),!document.hasOwnProperty("pointerLockElement")){var g=function(){return"webkitPointerLockElement"in document?function(){return document.webkitPointerLockElement}:"mozPointerLockElement"in document?function(){return document.mozPointerLockElement}:function(){return null}}();Object.defineProperty(document,"pointerLockElement",{enumerable:!0,configurable:!1,writeable:!1,get:g})}e.requestPointerLock||(e.requestPointerLock=function(){return e.webkitRequestPointerLock?function(){this.webkitRequestPointerLock()}:e.mozRequestPointerLock?function(){this.mozRequestPointerLock()}:navigator.pointer?function(){var a=this;navigator.pointer.lock(a,c,d)}:(a.supported.pointerLock=!1,function(){})}()),document.exitPointerLock||(document.exitPointerLock=function(){return document.webkitExitPointerLock||document.mozExitPointerLock||function(){navigator.pointer&&navigator.pointer.unlock()}}())},a}),define("goo/util/Logo",[],function(){"use strict";function a(){}a.blue="#2A3276",a.white="#FFFFFF";var b={color:a.blue,shadow:!1};return a.getLogo=function(a){a=a||{};for(var c in b)void 0===a[c]&&(a[c]=b[c]);var d="http://www.w3.org/2000/svg",e=document.createElementNS(d,"svg");e.setAttribute("version","1.1"),e.setAttribute("xmlns",d),e.setAttribute("x","0px"),e.setAttribute("y","0px"),e.setAttribute("viewBox","0 0 396.603 277.343"),e.setAttribute("enable-background","new 0 0 396.603 277.343"),e.setAttribute("xml:space","preserve"),a.width&&e.setAttribute("width",a.width),a.height&&e.setAttribute("height",a.height);var f=document.createElementNS(d,"g");e.appendChild(f);var g=document.createElementNS(d,"filter");g.setAttribute("id","insetShadow");var h=document.createElementNS(d,"feGaussianBlur");h.setAttribute("in","SourceAlpha"),h.setAttribute("stdDeviation","0");var i=document.createElementNS(d,"feOffset");i.setAttribute("dx","0"),i.setAttribute("dy","-5"),i.setAttribute("result","offsetblur");var j=document.createElementNS(d,"feComponentTransfer"),k=document.createElementNS(d,"feFuncA");k.setAttribute("type","linear"),k.setAttribute("slope","0.5"),j.appendChild(k);var l=document.createElementNS(d,"feMerge"),m=document.createElementNS(d,"feMergeNode"),n=document.createElementNS(d,"feMergeNode");n.setAttribute("in","SourceGraphic"),l.appendChild(m),l.appendChild(n),g.appendChild(h),g.appendChild(i),g.appendChild(j),g.appendChild(l),f.appendChild(g);var o=document.createElementNS(d,"path");o.setAttribute("d","M303.337,46.286c-13.578,0-25.784,5.744-34.396,14.998c-9.86,10.59-26.319,10.59-36.172,0c-8.605-9.254-20.818-14.998-34.402-14.998c-25.936,0-46.971,21.034-46.971,46.978c0,25.936,21.035,46.972,46.971,46.972c13.584,0,25.797-5.744,34.402-14.998c9.853-10.598,26.325-10.598,36.172,0c8.612,9.254,20.818,14.998,34.396,14.998c25.941,0,46.977-21.036,46.977-46.972C350.313,67.32,329.278,46.286,303.337,46.286z M198.296,116.39c-12.785,0-23.146-10.359-23.146-23.144s10.361-23.151,23.146-23.151c12.795,0,23.156,10.367,23.156,23.151S211.091,116.39,198.296,116.39z M303.337,116.407c-12.785,0-23.146-10.36-23.146-23.144c0-12.784,10.36-23.151,23.146-23.151c12.795,0,23.156,10.367,23.156,23.151C326.493,106.047,316.132,116.407,303.337,116.407z M156.18,138.347c-14.087-3.23-22.316-17.482-18.068-31.305c3.704-12.072,2.568-25.511-4.22-37.256C120.927,47.323,92.22,39.63,69.766,52.587C47.317,65.552,39.624,94.26,52.581,116.713c6.795,11.761,17.853,19.462,30.17,22.282c14.084,3.235,22.314,17.497,18.074,31.317c-3.711,12.08-2.582,25.504,4.213,37.264c12.965,22.455,41.666,30.148,64.127,17.178c22.447-12.945,30.148-41.658,17.185-64.111C179.554,148.881,168.497,141.181,156.18,138.347z M104.802,113.287c-11.064,6.387-25.219,2.599-31.604-8.474c-6.397-11.07-2.604-25.225,8.474-31.609c11.057-6.398,25.22-2.598,31.611,8.46C119.673,92.741,115.872,106.897,104.802,113.287z M145.687,207.256c-12.785,0-23.145-10.361-23.145-23.145s10.359-23.15,23.145-23.15c12.797,0,23.156,10.367,23.156,23.15S158.483,207.256,145.687,207.256z"),o.setAttribute("fill",a.color),a.shadow&&(f.appendChild(g),o.setAttribute("style","filter:url(#insetShadow)")),f.appendChild(o);var p=new XMLSerializer,q=p.serializeToString(e);return q},a}),define("goo/entities/GooRunner",["goo/entities/World","goo/entities/systems/TransformSystem","goo/entities/systems/RenderSystem","goo/renderer/Renderer","goo/entities/systems/BoundingUpdateSystem","goo/entities/systems/ScriptSystem","goo/entities/systems/LightingSystem","goo/entities/systems/CameraSystem","goo/entities/systems/ParticlesSystem","goo/util/Stats","goo/entities/systems/CSSTransformSystem","goo/entities/systems/AnimationSystem","goo/entities/systems/LightDebugSystem","goo/entities/systems/CameraDebugSystem","goo/util/GameUtils","goo/util/Logo"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){"use strict";function q(p){if(p=p||{},this.world=new a(this),this.renderer=new d(p),this.world.setSystem(new f(this.renderer)),this.world.setSystem(new b),this.world.setSystem(new h),this.world.setSystem(new k(this.renderer)),this.world.setSystem(new i),this.world.setSystem(new e),this.world.setSystem(new g),this.world.setSystem(new l),this.world.setSystem(new m),this.world.setSystem(new n),this.renderSystem=new c,this.renderSystems=[this.renderSystem],this.world.setSystem(this.renderSystem),this.doProcess=!0,this.doRender=!0,o.initAllShims(),this.tpfSmoothingCount=void 0!==p.tpfSmoothingCount?p.tpfSmoothingCount:10,p.showStats&&(this.stats=new j,this.stats.domElement.style.position="absolute",this.stats.domElement.style.left="10px",this.stats.domElement.style.top="10px",document.body.appendChild(this.stats.domElement)),void 0===p.logo||p.logo){var q=this._buildLogo(p.logo);document.body.appendChild(q)}this.callbacks=[],this.callbacksPreProcess=[],this.callbacksPreRender=[],this._takeSnapshots=[];var r=this;this.start=-1,this.run=function(a){try{r._updateFrame(a)}catch(b){b instanceof Error?console.error(b.stack):console.error(b)}},this.animationId=0,p.manuallyStartGameLoop||this.startGameLoop(this.run),p.debugKeys&&this._addDebugKeys(),this._events={click:null,mousedown:null,mouseup:null,mousemove:null},this._eventListeners={click:[],mousedown:[],mouseup:[],mousemove:[]},this._eventTriggered={click:null,mousedown:null,mouseup:null,mousemove:null},o.addVisibilityChangeListener(function(a){a?this.stopGameLoop():this.startGameLoop()}.bind(this)),this._picking={x:0,y:0,skipUpdateBuffer:!1,doPick:!1,pickingCallback:null,pickingStore:{},clearColorStore:[]}}q.prototype.setRenderSystem=function(a,b){this.world.setSystem(a),void 0!==b?this.renderSystems.splice(b,0,a):this.renderSystems.push(a)};var r=[],s=0;return q.prototype._updateFrame=function(b){this.start<0&&(this.start=b);var c=(b-this.start)/1e3;if(0>c||c>1)return this.start=b,this.animationId=window.requestAnimationFrame(this.run),void 0;c=Math.max(Math.min(c,.5),1e-4),r[s]=c,s=(s+1)%this.tpfSmoothingCount;for(var e=0,f=0;f<r.length;f++)e+=r[f];e/=r.length,this.world.tpf=e,this.world.time+=this.world.tpf,a.time=this.world.time,a.tpf=this.world.tpf,this.start=b;for(var f=0;f<this.callbacksPreProcess.length;f++)this.callbacksPreProcess[f](this.world.tpf);if(this.doProcess&&this.world.process(),this.renderer.info.reset(),this.doRender){this.renderer.checkResize(d.mainCamera),this.renderer.setRenderTarget(),this.renderer.clear();for(var f=0;f<this.callbacksPreRender.length;f++)this.callbacksPreRender[f](this.world.tpf);for(var f=0;f<this.renderSystems.length;f++)this.renderSystems[f].render(this.renderer);if(this._picking.doPick){var g=this.renderer.clearColor.data;this._picking.clearColorStore[0]=g[0],this._picking.clearColorStore[1]=g[1],this._picking.clearColorStore[2]=g[2],this._picking.clearColorStore[3]=g[3],this.renderer.setClearColor(0,0,0,1);for(var f=0;f<this.renderSystems.length;f++)this.renderSystems[f].renderToPick&&this.renderSystems[f].renderToPick(this.renderer,this._picking.skipUpdateBuffer);this.renderer.pick(this._picking.x,this._picking.y,this._picking.pickingStore,d.mainCamera),this._picking.pickingCallback(this._picking.pickingStore.id,this._picking.pickingStore.depth),this._picking.doPick=!1,this.renderer.setClearColor.apply(this.renderer,this._picking.clearColorStore)}}for(var f=0;f<this.callbacks.length;f++)this.callbacks[f](this.world.tpf);if(this.stats&&this.stats.update(this.renderer.info),this._takeSnapshots.length){try{for(var h=this.renderer.domElement.toDataURL(),f=this._takeSnapshots.length-1;f>=0;f--)this._takeSnapshots[f](h)}catch(i){console.error("Failed to take snapshot",i.message)}this._takeSnapshots=[]}this.animationId=window.requestAnimationFrame(this.run)},q.prototype._buildLogo=function(a){var b=document.createElement("div"),c=p.getLogo({width:"70px",height:"50px",color:p.blue}),d='<span style="color: #EEE; font-family: Helvetica, sans-serif; font-size: 11px; display: inline-block; margin-top: 14px; margin-right: -3px; vertical-align: top;">Powered by</span>';return b.innerHTML='<a style="text-decoration: none;" href="http://www.gooengine.com" target="_blank">'+d+c+"</a>",b.style.position="absolute",b.style.zIndex="2000","topright"===a?(b.style.top="10px",b.style.right="10px"):"topleft"===a?(b.style.top="10px",b.style.left="10px"):"bottomright"===a?(b.style.bottom="10px",b.style.right="10px"):"bottomleft"===a?(b.style.bottom="10px",b.style.left="10px"):(b.style.top="10px",b.style.right="10px"),b.id="goologo",b.style.webkitTouchCallout="none",b.style.webkitUserSelect="none",b.style.khtmlUserSelect="none",b.style.mozUserSelect="none",b.style.msUserSelect="none",b.style.userSelect="none",b.ondragstart=function(){return!1},b},q.prototype._addDebugKeys=function(){var a="shiftKey";document.addEventListener("keydown",function(b){32===b.which&&b[a]?o.toggleFullScreen():13===b.which&&b[a]?o.togglePointerLock():49===b.which&&b[a]?this.renderSystem.setDebugMaterial():50!==b.which&&222!==b.which||!b[a]?51===b.which&&b[a]?this.renderSystem.setDebugMaterial("lit"):52===b.which&&b[a]?this.renderSystem.setDebugMaterial("color"):53===b.which&&b[a]?this.renderSystem.setDebugMaterial("wireframe"):54===b.which&&b[a]?this.renderSystem.setDebugMaterial("flat"):55!==b.which&&191!==b.which||!b[a]?56===b.which&&b[a]&&this.renderSystem.setDebugMaterial("+wireframe"):this.renderSystem.setDebugMaterial("texture"):this.renderSystem.setDebugMaterial("normals")}.bind(this),!1),document.addEventListener("mousedown",function(b){if(b[a]){var c=b.clientX,d=b.clientY;this.pick(c,d,function(a,b){var c=this.world.entityManager.getEntityById(a);console.log("Picked entity:",c,"At depth:",b)}.bind(this))}}.bind(this),!1)},q.prototype.addEventListener=function(a,b){!this._eventListeners[a]||this._eventListeners[a].indexOf(b)>-1||"function"==typeof b&&(this._eventListeners[a].push(b),1===this._eventListeners[a].length&&this._enableEvent(a))},q.prototype.removeEventListener=function(a,b){if(this._eventListeners[a]){var c=this._eventListeners[a].indexOf(b);c>-1&&this._eventListeners[a].splice(c,1),0===this._eventListeners[a].length&&this._disableEvent(a)}},q.prototype._dispatchEvent=function(a){for(var b in this._eventTriggered)if(this._eventTriggered[b]&&this._eventListeners[b]){for(var c={entity:a.entity,depth:a.depth,x:a.x,y:a.y,type:b,domEvent:this._eventTriggered[b],id:a.id},d=0;d<this._eventListeners[b].length&&this._eventListeners[b][d](c)!==!1;d++);this._eventTriggered[b]=null}},q.prototype._enableEvent=function(a){if(!this._events[a]){var b=function(b){var c=b.layerX,d=b.layerY;this._eventTriggered[a]=b,this.pick(c,d,function(a,b){var e=this.world.entityManager.getEntityById(a);this._dispatchEvent({entity:e,depth:b,x:c,y:d,id:a})}.bind(this))}.bind(this);this.renderer.domElement.addEventListener(a,b),this._events[a]=b}},q.prototype._disableEvent=function(a){this._events[a]&&this.renderer.domElement.removeEventListener(a,this._events[a]),this._events[a]=null},q.prototype.startGameLoop=function(){this.animationId||(this.start=-1,this.animationId=window.requestAnimationFrame(this.run))},q.prototype.stopGameLoop=function(){window.cancelAnimationFrame(this.animationId),this.animationId=0},q.prototype.takeSnapshot=function(a){this._takeSnapshots.push(a)},q.prototype.pick=function(a,b,c,d){this._picking.x=a,this._picking.y=b,this._picking.skipUpdateBuffer=void 0===d?!1:d,c&&(this._picking.pickingCallback=c),this._picking.doPick=!0},q}),define("goo/entities/components/AnimationComponent",["goo/entities/components/Component","goo/entities/World","goo/animation/layer/AnimationLayer","goo/animation/clip/JointData","goo/animation/clip/TransformData","goo/animation/clip/TriggerData"],function(a,b,c,d,e,f){"use strict";function g(a){this.type="AnimationComponent",this.layers=[],this.floats={},this._updateRate=1/60,this._lastUpdate=0,this._triggerCallbacks={};var b=new c(c.BASE_LAYER_NAME);this.layers.push(b),this._skeletonPose=a,this.paused=!1,this.lastTimeOfPause=null,this.accumulatedDelay=0}return g.prototype=Object.create(a.prototype),g.prototype.transitionTo=function(a){return this.layers[0].transitionTo(a)},g.prototype.getStates=function(){return this.layers[0].getStates()},g.prototype.getCurrentState=function(){return this.layers[0].getCurrentState()},g.prototype.getTransitions=function(){return this.layers[0].getTransitions()},g.prototype.update=function(a){if(!this.paused){if(a=a||b.time,0!==this._updateRate){if(a>this._lastUpdate&&a-this._lastUpdate<this._updateRate)return;this._lastUpdate=a-(a-this._lastUpdate)%this._updateRate}for(var c=0,d=this.layers.length;d>c;c++)this.layers[c].update(a)}},g.prototype.apply=function(a){var b=this.getCurrentSourceData(),c=this._skeletonPose;if(b){for(var g in b){var h=b[g];if(h instanceof d)c&&h._jointIndex>=0&&h.applyTo(c._localTransforms[h._jointIndex]);else if(h instanceof e)a&&(h.applyTo(a.transform),a.updateTransform(),this._updateWorldTransform(a));else if(h instanceof f){if(h.armed){for(var i=0,j=h._currentTriggers.length;j>i;i++){var k=this._triggerCallbacks[h._currentTriggers[i]];if(k&&k.length)for(var l=0,m=k.length;m>l;l++)k[l]()}h.armed=!1}}else h instanceof Array&&(this.floats[g]=h[0])}c&&c.updateTransforms()}},g.prototype._updateWorldTransform=function(a){a.updateWorldTransform();for(var b=0;b<a.children.length;b++)this._updateWorldTransform(a.children[b])},g.prototype.postUpdate=function(){for(var a=0,b=this.layers.length;b>a;a++)this.layers[a].postUpdate()},g.prototype.getCurrentSourceData=function(){var a=this.layers.length-1;this.layers[0]._layerBlender=null;for(var b=0;a>b;b++)this.layers[b+1].updateLayerBlending(this.layers[b]);return this.layers[a].getCurrentSourceData()},g.prototype.addLayer=function(a,b){isNaN(b)?this.layers.push(a):this.layers.splice(b,0,a)},g.prototype.resetClips=function(a){for(var b=0;b<this.layers.length;b++)this.layers[b].resetClips(a)},g.prototype.shiftClipTime=function(a){for(var b=0;b<this.layers.length;b++)this.layers[b].shiftClipTime(a)},g.prototype.setTimeScale=function(a){for(var b=0;b<this.layers.length;b++)this.layers[b].setTimeScale(a)},g.prototype.pause=function(){this.paused||(this.lastTimeOfPause=b.time,this.paused=!0)},g.prototype.stop=function(){this.resetClips(),this.paused=!1,this.update(),this.paused=!0,this.lastTimeOfPause=-1},g.prototype.resume=function(){this.paused&&(-1===this.lastTimeOfPause?this.resetClips():this.shiftClipTime(b.time-this.lastTimeOfPause),console.log(this.accumulatedDelay)),this.paused=!1},g}),define("goo/entities/components/CameraDebugComponent",["goo/entities/components/Component"],function(a){"use strict";function b(){this.type="CameraDebugComponent"}return b.prototype=Object.create(a.prototype),b}),define("goo/entities/components/LightDebugComponent",["goo/entities/components/Component"],function(a){"use strict";function b(){this.type="LightDebugComponent"}return b.prototype=Object.create(a.prototype),b}),define("goo/entities/components/OccludeeComponent",["goo/entities/components/Component","goo/renderer/bounds/BoundingBox","goo/renderer/bounds/BoundingSphere"],function(a,b,c){"use strict";function d(a,d){this.type="OccludeeComponent",this.modelBound=d===!0?new b:new c;var e=a.getAttributeBuffer("POSITION");if(void 0!==e&&this.modelBound.computeFromPoints(e),this.positionArray=new Float32Array(32),d===!0){var f=this.modelBound.xExtent,g=this.modelBound.yExtent,h=this.modelBound.zExtent;this.positionArray.set([-f,g,-h,1,-f,g,h,1,f,g,h,1,f,g,-h,1,-f,-g,-h,1,-f,-g,h,1,f,-g,h,1,f,-g,-h,1])}}return d.prototype=Object.create(a.prototype),d}),define("goo/entities/components/OccluderComponent",["goo/entities/components/Component"],function(a){"use strict";function b(a){this.type="OccluderComponent",this.meshData=a}return b.prototype=Object.create(a.prototype),b}),define("goo/particles/ParticleUtils",["goo/math/Vector3"],function(a){"use strict";function b(){}return b.getRandomVelocityOffY=function(a,c,d,e,f){var g=c+Math.random()*(d-c),h=2*Math.PI*Math.random();return a.x=Math.cos(h)*Math.sin(g),a.y=Math.cos(g),a.z=Math.sin(h)*Math.sin(g),f&&b.applyEntityTransformVector(a,f),a.mul(e),a},b.randomPointInCube=function(a,b,c,d,e){return a.x=2*Math.random()*b-b+(e?e.x:0),a.y=2*Math.random()*c-c+(e?e.y:0),a.z=2*Math.random()*d-d+(e?e.z:0),a},b.createConstantForce=function(b){var c=new a(b);return{enabled:!0,prepare:function(){},apply:function(a,b){b.velocity.x+=c.x*a,b.velocity.y+=c.y*a,b.velocity.z+=c.z*a}}},b.applyEntityTransformPoint=function(a,b){return b.transformComponent&&b.transformComponent.worldTransform?b.transformComponent.worldTransform.applyForward(a,a):a},b.applyEntityTransformVector=function(a,b){return b.transformComponent&&b.transformComponent.worldTransform?b.transformComponent.worldTransform.applyForwardVector(a,a):a},b.applyTimeline=function(a,b){for(var c=a.age,d=a.lifeSpan,e=0,f=0,g=0,h=0,i=d,j=d,k=d,l=d,m=0,n=0,o=null,p=null,q=null,r=null,s=null,t=null,u=null,v=null,w=null,x=0,y=b.length;y>x;x++){var z=b[x];m+=(z.timeOffset?z.timeOffset:0)*d,null===t&&(m>c?void 0!==z.color&&(i=m,t=z):void 0!==z.color&&(e=m,o=z)),null===u&&(m>c?void 0!==z.mass&&(j=m,u=z):void 0!==z.mass&&(f=m,p=z)),c>=m&&void 0!==z.uvIndex&&(s=z),null===v&&(m>c?void 0!==z.size&&(k=m,v=z):void 0!==z.size&&(g=m,q=z)),null===w&&(m>c?void 0!==z.spin&&(l=m,w=z):void 0!==z.spin&&(h=m,r=z))}n=(c-e)/(i-e);var A=null!==o?o.color:[1,1,1,1],B=null!==t?t.color:A;a.color.data[0]=(1-n)*A[0]+n*B[0],a.color.data[1]=(1-n)*A[1]+n*B[1],a.color.data[2]=(1-n)*A[2]+n*B[2],a.color.data[3]=(1-n)*A[3]+n*B[3],n=(c-f)/(j-f);var A=null!==p?p.mass:1,B=null!==u?u.mass:A;a.mass=(1-n)*A+n*B,a.uvIndex=null!==s?s.uvIndex:0,n=(c-g)/(k-g);var A=null!==q?q.size:1,B=null!==v?v.size:A;a.size=(1-n)*A+n*B,n=(c-h)/(l-h);var A=null!==r?r.spin:0,B=null!==w?w.spin:A;a.spin=(1-n)*A+n*B},b}),define("goo/particles/Particle",["goo/particles/ParticleUtils","goo/math/Vector","goo/math/Vector3","goo/math/Vector4","goo/renderer/MeshData"],function(a,b,c,d,e){"use strict";function f(a,b){this.alive=!1,this.position=new c,this.velocity=new c,this.lifeSpan=0,this.parent=a,this.age=0,this.index=b,this.color=new d(1,0,0,1),this.size=0,this.spin=0,this.mass=1,this.emitter=null,this.uvIndex=0,this.lastUVIndex=-1,this.bbX=new c,this.bbY=new c,this.lastColor=new d}var g=new c;return f.prototype.respawnParticle=function(a){this.emitter=a,this.lifeSpan=a.nextParticleLifeSpan(),this.alive=!0,this.age=0},f.prototype.update=function(d,f){if(this.alive){if(this.age+=d,this.age>this.lifeSpan)return this.kill(),void 0;if(this.position.add_d(this.velocity.x*d,this.velocity.y*d,this.velocity.z*d),a.applyTimeline(this,this.emitter&&this.emitter.timeline?this.emitter.timeline:this.parent.timeline),!b.equals(this.lastColor,this.color)){var h=this.parent.meshData.getAttributeBuffer(e.COLOR);h.set(this.color.data,16*this.index+0),h.set(this.color.data,16*this.index+4),h.set(this.color.data,16*this.index+8),h.set(this.color.data,16*this.index+12),this.lastColor.setv(this.color)}if(this.emitter&&this.emitter.getParticleBillboardVectors(this,f),0===this.spin)this.bbX.muld(this.size,this.size,this.size),this.bbY.muld(this.size,this.size,this.size);else{var i=Math.cos(this.spin)*this.size,j=Math.sin(this.spin)*this.size,k=this.bbY.x,l=this.bbY.y,m=this.bbY.z;this.bbY.setv(this.bbX),this.bbX.muld(i,i,i).add_d(k*j,l*j,m*j),this.bbY.muld(-j,-j,-j).add_d(k*i,l*i,m*i)}var n=this.parent.meshData.getAttributeBuffer(e.POSITION);if(c.subv(this.position,this.bbX,g).subv(this.bbY),n.set(g.data,12*this.index+0),c.subv(this.position,this.bbX,g).addv(this.bbY),n.set(g.data,12*this.index+3),c.addv(this.position,this.bbX,g).addv(this.bbY),n.set(g.data,12*this.index+6),c.addv(this.position,this.bbX,g).subv(this.bbY),n.set(g.data,12*this.index+9),this.lastUVIndex!==this.uvIndex){var o=this.parent.meshData.getAttributeBuffer(e.TEXCOORD0),p=this.uvIndex%this.parent.uRange/this.parent.uRange,q=1-Math.floor(this.uvIndex/this.parent.vRange)/this.parent.vRange,r=1/this.parent.uRange,s=1/this.parent.vRange;o.set([p+r,q-s],8*this.index+0),o.set([p+r,q],8*this.index+2),o.set([p,q],8*this.index+4),o.set([p,q-s],8*this.index+6),this.lastUVIndex=this.uvIndex}}},f.prototype.kill=function(){this.alive=!1;var a=this.parent.meshData.getAttributeBuffer(e.POSITION),b=a.subarray(12*this.index,12*this.index+3);a.set(b,12*this.index+3),a.set(b,12*this.index+6),a.set(b,12*this.index+9)},f}),define("goo/particles/ParticleEmitter",["goo/particles/ParticleUtils","goo/renderer/Renderer"],function(a,b){"use strict";function c(b){b=b||{},this.totalParticlesToSpawn=isNaN(b.totalParticlesToSpawn)?-1:b.totalParticlesToSpawn,this.maxLifetime=isNaN(b.maxLifetime)?3:b.maxLifetime,this.minLifetime=isNaN(b.minLifetime)?2:b.minLifetime,this.timeline=b.timeline?b.timeline:void 0,this.influences=b.influences?b.influences:[],this.getEmissionPoint=b.getEmissionPoint?b.getEmissionPoint:function(b,c){var d=b.position;return d.setd(0,0,0),a.applyEntityTransformPoint(d,c)},this.getEmissionVelocity=b.getEmissionVelocity?b.getEmissionVelocity:function(b,c){var d=b.velocity;return d.setd(0,1,0),a.applyEntityTransformVector(d,c)},this.getParticleBillboardVectors=b.getParticleBillboardVectors?b.getParticleBillboardVectors:c.CAMERA_BILLBOARD_FUNC,this.releaseRatePerSecond=isNaN(b.releaseRatePerSecond)?10:b.releaseRatePerSecond,this.particlesWaitingToRelease=0,this.enabled=void 0!==b.enabled?b.enabled===!0:!0}return c.CAMERA_BILLBOARD_FUNC=function(a){var c=b.mainCamera;a.bbX.setv(c._left),a.bbY.setv(c._up)},c.prototype.nextParticleLifeSpan=function(){return this.minLifetime+(this.maxLifetime-this.minLifetime)*Math.random()},c}),define("goo/entities/components/ParticleComponent",["goo/entities/components/Component","goo/particles/Particle","goo/particles/ParticleEmitter","goo/renderer/MeshData"],function(a,b,c,d){"use strict";function e(b){if(this.type="ParticleComponent",a.call(this),b=b||{},this.emitters=[],b.emitters)for(var d=0,e=b.emitters.length;e>d;d++)this.emitters.push(new c(b.emitters[d]));this.timeline=b.timeline?b.timeline:[],this.uRange=isNaN(b.uRange)?1:b.uRange,this.vRange=isNaN(b.vRange)?1:b.vRange;var f=isNaN(b.particleCount)?100:b.particleCount;this.recreateParticles(f),this.enabled=!0}return e.prototype=Object.create(a.prototype),e.prototype.generateMeshData=function(){var a=d.defaultMap([d.POSITION,d.COLOR,d.TEXCOORD0]);
this.meshData=new d(a,4*this.particleCount,6*this.particleCount);for(var b=this.meshData.getAttributeBuffer(d.TEXCOORD0),c=this.meshData.getIndexBuffer(),e=0,f=this.particleCount;f>e;e++)b.set([1,0],8*e+0),b.set([1,1],8*e+2),b.set([0,1],8*e+4),b.set([0,0],8*e+6),c.set([4*e+0,4*e+3,4*e+1,4*e+1,4*e+3,4*e+2],6*e)},e.prototype.recreateParticles=function(a){this.particleCount=a,this.particles=[];for(var c=0;c<this.particleCount;c++)this.particles[c]=new b(this,c);this.generateMeshData()},e}),define("goo/entities/components/PortalComponent",["goo/entities/components/Component","goo/renderer/pass/RenderTarget"],function(a,b){"use strict";function c(a,c,d,e){c=c||200,this.options=d||{},this.options.preciseRecursion=!!this.options.preciseRecursion,this.options.autoUpdate=this.options.autoUpdate!==!1,this.options.alwaysRender=!!this.options.alwaysRender,this.overrideMaterial=e,this.doUpdate=!0;var f=a.aspect;this.type="PortalComponent",this.camera=a,this.target=new b(c,c/f),this.options.preciseRecursion&&(this.secondaryTarget=new b(c,c/f))}return c.prototype=Object.create(a.prototype),c.prototype.requestUpdate=function(){this.doUpdate=!0},c}),define("goo/shapes/TextureGrid",["goo/renderer/MeshData"],function(a){"use strict";function b(b,d){this.matrix=b,this.textureUnitsPerLine=d||8;var e=a.defaultMap([a.POSITION,a.NORMAL,a.TEXCOORD0]),f=c(b);a.call(this,e,4*f,6*f),this.rebuild()}function c(a){for(var b=0,c=0;c<a.length;c++)b+=a[c].length;return b}function d(a){var b=[],c=a.split("\n");return c.forEach(function(a){var c=a.split(""),d=c.map(function(a){return a.charCodeAt(0)});b.push(d)}),b}return b.prototype=Object.create(a.prototype),b.prototype.rebuild=function(){for(var b=[],c=[],d=[],e=[],f=0,g=0;g<this.matrix.length;g++)for(var h=0;h<this.matrix[g].length;h++){b.push(h,-g-1,0,h,-g,0,h+1,-g,0,h+1,-g-1,0),c.push(0,0,1,0,0,1,0,0,1,0,0,1);var i=this.matrix[g][h]%this.textureUnitsPerLine/this.textureUnitsPerLine,j=Math.floor(this.matrix[g][h]/this.textureUnitsPerLine)/this.textureUnitsPerLine;j=1-j,e.push(i,j-1/this.textureUnitsPerLine,i,j,i+1/this.textureUnitsPerLine,j,i+1/this.textureUnitsPerLine,j-1/this.textureUnitsPerLine),d.push(f+3,f+1,f+0,f+2,f+1,f+3),f+=4}return this.getAttributeBuffer(a.POSITION).set(b),this.getAttributeBuffer(a.NORMAL).set(c),this.getAttributeBuffer(a.TEXCOORD0).set(e),this.getIndexBuffer().set(d),this},b.fromString=function(a){return new b(d(a),16)},b}),define("goo/entities/components/TextComponent",["goo/entities/components/Component","goo/shapes/TextureGrid","goo/entities/components/MeshDataComponent"],function(a){"use strict";function b(a){this.type="TextComponent",this.text=a||"",this.dirty=!0}return b.prototype=Object.create(a.prototype),b.prototype.setText=function(a){return this.text=a,this.dirty=!0,this},b}),define("goo/entities/systems/DebugRenderSystem",["goo/entities/systems/System","goo/entities/SystemBus","goo/renderer/SimplePartitioner","goo/renderer/Material","goo/renderer/shaders/ShaderLib","goo/renderer/Util","goo/debug/DebugDrawHelper"],function(a,b,c,d,e,f,g){"use strict";function h(){a.call(this,"DebugRenderSystem",["TransformComponent"]),this._renderablesTree={},this.renderList=[],this.preRenderers=[],this.composers=[],this.doRender={CameraComponent:!0,LightComponent:!0,MeshRendererComponent:!1},this.inserted(),this._interestComponents=["CameraComponent","LightComponent"],this.camera=null,this.lights=[],this.currentTpf=0,this.scale=20;var c=this;b.addListener("goo.setCurrentCamera",function(a){c.camera=a}),b.addListener("goo.setLights",function(a){c.lights=a}),this.selectionRenderable=g.getRenderablesFor({type:"MeshRendererComponent"}),this.selectionActive=!1}return h.prototype=Object.create(a.prototype),h.prototype.inserted=function(){},h.prototype.deleted=function(){},h.prototype.process=function(a,b){for(var c=this.renderList.length=0,d=0;d<a.length;d++)for(var e=a[d],f=0,h=this._interestComponents.length;h>f;f++){var i=this._interestComponents[f];if("ToolCameraEntity"!==e.name&&e.hasComponent(i)&&(this.doRender[i]||e.getComponent(i).forceDebug)){var j,k=e.getComponent(i),l=this._renderablesTree[e.id]=this._renderablesTree[e.id]||{};l[i]?j=l[i]:(j=g.getRenderablesFor(k),j[0].id=e.id,j[1].id=e.id,l[i]=j),j[0].transform.copy(e.transformComponent.worldTransform),j[1].transform.copy(e.transformComponent.worldTransform),g.update(j,k,this.camera.translation),this.renderList[c++]=j[0],this.renderList[c++]=j[1]}}this.selectionActive&&(this.renderList[c++]=this.selectionRenderable[0]),this.renderList.length=c,this.currentTpf=b},h.prototype.render=function(a){a.checkResize(this.camera),this.camera&&a.render(this.renderList,this.camera,this.lights,null,!1)},h.prototype.renderToPick=function(a,b){a.renderToPick(this.renderList,this.camera,!1,b)},h}),define("goo/util/gizmos/Gizmo",["goo/renderer/shaders/ShaderBuilder","goo/renderer/MeshData","goo/renderer/Shader","goo/renderer/Material","goo/renderer/Renderer","goo/math/Transform","goo/math/Matrix4x4","goo/math/Plane","goo/math/Ray","goo/math/Vector3"],function(a,b,c,d,e,f,g,h,i,j){"use strict";function k(a,b){this.name=a||"Default Gizmo",this.gizmoRenderSystem=b,this._colors=[[1,.1,.3],[.2,1,.3],[.2,.3,1],[.8,.8,.8]],this._gizmoSize=1/55,this._plane=new h,this._line=new j,this._activeHandle=null,this._mouse={position:[0,0],oldPosition:[0,0]},this.dirty=!1,this.visible=!1,this.transform=new f,this.renderables=[],this.onChange=null,this._oldRay=new i,this._newRay=new i,this._result=new j,this._v0=new j,this._v1=new j,this._v2=new j,this._v3=new j,this._s0=new j,this._s1=new j,this._s2=new j,this._s3=new j}return k.handleStore=[],k.registerHandle=function(a){var b=k.handleStore.length+16e3;return k.handleStore.push(a),b},k.getHandle=function(a){return 16e3>a?null:k.handleStore[a-16e3]},k.prototype.getRenderable=function(a){for(var b=0;b<this.renderables.length;b++){var c=this.renderables[b];if(c.id===a)return c}},k.prototype.activate=function(a){this._activeHandle=a.data,this._mouse.oldPosition[0]=a.x,this._mouse.oldPosition[1]=a.y,this._activeRenderable=this.getRenderable(a.id),this._activeRenderable.materials[0].uniforms.color=[1,1,0]},k.prototype.deactivate=function(){if(this._activeRenderable){var a=this._activeRenderable.originalColor;this._activeRenderable.materials[0].uniforms.color=[a[0],a[1],a[2]]}},k.prototype.copyTransform=function(a){this.transform.setIdentity(),a&&(a.matrix.getTranslation(this.transform.translation),this.transform.rotation.copy(a.rotation),this.updateTransforms())},k.prototype.update=function(a){this._mouse.position[0]=a[0],this._mouse.position[1]=a[1],this.dirty=!0},k.prototype.updateTransforms=function(){if(e.mainCamera){var a=e.mainCamera.translation,b=this.transform.translation,c=Math.sqrt(a.distanceSquared(b)),d=c*this._gizmoSize;this.transform.scale.setd(d,d,d)}this.transform.update();for(var f=this.renderables.length-1;f>=0;f--)this.renderables[f].transform.update(),g.combine(this.transform.matrix,this.renderables[f].transform.matrix,this.renderables[f].transform.matrix)},k.prototype._setPlane=function(){var a=this._plane.normal,b=this._v0,c=this._v1,d=this._v2,f=this._v3,g=this._s0,h=this._s1,i=this._s2,k=this._s3;"Plane"===this._activeHandle.type?(a.setv([j.UNIT_X,j.UNIT_Y,j.UNIT_Z][this._activeHandle.axis]),this.transform.matrix.applyPostVector(a),a.normalize(),b.setv(j.ZERO),this.transform.matrix.applyPostPoint(b),this._plane.constant=b.dot(a)):(b.setv(j.ZERO),this.transform.matrix.applyPostPoint(b),c.setv(j.UNIT_X),this.transform.matrix.applyPostPoint(c),d.setv(j.UNIT_Y),this.transform.matrix.applyPostPoint(d),f.setv(j.UNIT_Z),this.transform.matrix.applyPostPoint(f),e.mainCamera.getScreenCoordinates(b,1,1,g),e.mainCamera.getScreenCoordinates(c,1,1,h),h.subv(g),e.mainCamera.getScreenCoordinates(d,1,1,i),i.subv(g),e.mainCamera.getScreenCoordinates(f,1,1,k),k.subv(g),0===this._activeHandle.axis?i.cross(h).length()>k.cross(h).length()?a.setv(f).subv(b).normalize():a.setv(d).subv(b).normalize():1===this._activeHandle.axis?k.cross(i).length()>h.cross(i).length()?a.setv(c).subv(b).normalize():a.setv(f).subv(b).normalize():h.cross(k).length()>i.cross(k).length()?a.setv(d).subv(b).normalize():a.setv(c).subv(b).normalize(),this._plane.constant=b.dot(a))},k.prototype._setLine=function(){this._line.setv([j.UNIT_X,j.UNIT_Y,j.UNIT_Z][this._activeHandle.axis]),this.transform.matrix.applyPostVector(this._line),this._line.normalize()},k.prototype.addRenderable=function(a){a.originalColor=a.materials[0].uniforms.color,this.renderables.push(a)},k.prototype._buildMaterialForAxis=function(a,b){var c=d.createMaterial(k._shaderDef,a+"Material");return c.uniforms.color=this._colors[a],void 0!==b&&1>b&&(c.blendState.blending="CustomBlending",c.uniforms.opacity=b,c.renderQueue=3e3),c.cullState.enabled=!1,c},k._shaderDef={attributes:{vertexPosition:b.POSITION,vertexNormal:b.NORMAL},uniforms:{viewProjectionMatrix:c.VIEW_PROJECTION_MATRIX,worldMatrix:c.WORLD_MATRIX,cameraPosition:c.CAMERA,color:[1,1,1],opacity:1,light:[-20,20,20]},vshader:["attribute vec3 vertexPosition;","attribute vec3 vertexNormal;","uniform mat4 viewProjectionMatrix;","uniform mat4 worldMatrix;","uniform vec3 cameraPosition;","varying vec3 normal;","varying vec3 viewPosition;","void main(void) {","	vec4 worldPos = worldMatrix * vec4(vertexPosition, 1.0);","	gl_Position = viewProjectionMatrix * worldPos;","	normal = vertexNormal;","	viewPosition = cameraPosition - worldPos.xyz;","}"].join("\n"),fshader:["varying vec3 normal;","varying vec3 viewPosition;","uniform vec3 color;","uniform float opacity;","uniform vec3 light;","void main(void)","{","	vec3 N = normalize(normal);","	vec4 final_color = vec4(color, 1.0);"," vec3 lVector = normalize(light);"," float dotProduct = dot(N, lVector);"," float diffuse = max(dotProduct, 0.0);"," final_color.rgb *= (0.5*diffuse+0.5);"," final_color.a = opacity;","	gl_FragColor = final_color;","}"].join("\n")},k}),define("goo/shapes/Disk",["goo/renderer/MeshData"],function(a){"use strict";function b(b,c,d){if(1===arguments.length&&arguments[0]instanceof Object){var e=arguments[0];b=e.nSegments,c=e.radius,d=e.pointiness}this.nSegments=b||8,this.radius=c||1,this.pointiness=d||0;var f=a.defaultMap([a.POSITION,a.NORMAL,a.TEXCOORD0]);a.call(this,f,this.nSegments+1,this.nSegments+2),this.indexModes=["TriangleFan"],this.rebuild()}return b.prototype=Object.create(a.prototype),b.prototype.rebuild=function(){var b=[],c=[],d=[],e=[];b.push(0,0,this.pointiness),c.push(0,0,1),d.push(.5,.5),e.push(0);for(var f=Math.atan2(this.radius,this.pointiness),g=2*Math.PI/this.nSegments,h=1,i=0;h<=this.nSegments;h++,i+=g)b.push(Math.cos(i)*this.radius,Math.sin(i)*this.radius,0),c.push(Math.cos(i)*Math.cos(f),Math.sin(i)*Math.cos(f),Math.sin(f)),d.push(.5*Math.cos(i)+.5,.5*Math.sin(i)+.5),e.push(h);return e.push(1),this.getAttributeBuffer(a.POSITION).set(b),this.getAttributeBuffer(a.NORMAL).set(c),this.getAttributeBuffer(a.TEXCOORD0).set(d),this.getIndexBuffer().set(e),this},b}),define("goo/util/gizmos/TranslationGizmo",["goo/util/gizmos/Gizmo","goo/renderer/MeshData","goo/util/MeshBuilder","goo/shapes/Disk","goo/shapes/Quad","goo/math/Transform","goo/renderer/Renderer"],function(a,b,c,d,e,f,g){"use strict";function h(){a.call(this,"TranslationGizmo"),this._quadMesh=new e(2,2),this._arrowMesh=this._buildArrowMesh(),this._buildArrow(0),this._buildArrow(1),this._buildArrow(2)}return h.prototype=Object.create(a.prototype),h.prototype.activate=function(b){a.prototype.activate.call(this,b),this._setPlane(),"Axis"===this._activeHandle.type&&this._setLine()},h.prototype.process=function(){var a=this._mouse.oldPosition,b=this._mouse.position;g.mainCamera.getPickRay(a[0],a[1],1,1,this._oldRay),g.mainCamera.getPickRay(b[0],b[1],1,1,this._newRay),"Plane"===this._activeHandle.type?this._moveOnPlane():"Axis"===this._activeHandle.type&&this._moveOnLine(),a[0]=b[0],a[1]=b[1],this.updateTransforms(),this.dirty=!1,this.onChange instanceof Function&&this.onChange(this.transform.translation)},h.prototype.copyTransform=function(b,c){a.prototype.copyTransform.call(this,b),b&&c&&(this.transform.rotation.setIdentity(),this.updateTransforms())},h.prototype._moveOnPlane=function(){var a=this._v0,b=this._v1,c=this._result;this._plane.rayIntersect(this._oldRay,a),this._plane.rayIntersect(this._newRay,b),c.setv(b).subv(a),this.transform.translation.add(c)},h.prototype._moveOnLine=function(){var a=this._v0,b=this._v1,c=this._result,d=this._line;this._plane.rayIntersect(this._oldRay,a),this._plane.rayIntersect(this._newRay,b),c.setv(b).subv(a);var e=c.dot(d);c.setv(d).muld(e,e,e),this.transform.translation.addv(c)},h.prototype._buildArrow=function(b){var c=new f,d=new f,e=1;d.scale.setd(e,e,e),2===b?d.translation.setd(e,-e,0):0===b?(d.translation.setd(0,-e,e),d.setRotationXYZ(0,Math.PI/2,0),c.setRotationXYZ(0,Math.PI/2,0)):1===b&&(d.translation.setd(e,0,e),d.setRotationXYZ(Math.PI/2,0,0),c.setRotationXYZ(Math.PI/2,0,0)),this.addRenderable({meshData:this._arrowMesh,materials:[this._buildMaterialForAxis(b)],transform:c,id:a.registerHandle({type:"Axis",axis:b})}),this.addRenderable({meshData:this._quadMesh,materials:[this._buildMaterialForAxis(b,.6)],transform:d,id:a.registerHandle({type:"Plane",axis:b})})},h.prototype._buildArrowMesh=function(){var a=new c,e=new d(32,.6,2.3),g=new d(32,.6),h=new b(b.defaultMap([b.POSITION]),2,2);h.getAttributeBuffer(b.POSITION).set([0,0,0,0,0,7]),h.getIndexBuffer().set([0,1]),h.indexLengths=null,h.indexModes=["Lines"];var i=new f;i.translation.setd(0,0,7),i.update(),a.addMeshData(e,i),i.setRotationXYZ(0,Math.PI,0),i.update(),a.addMeshData(g,i);var i=new f;i.update(),a.addMeshData(h,i);var j=a.build()[0];return j},h}),define("goo/util/gizmos/RotationGizmo",["goo/util/gizmos/Gizmo","goo/shapes/Sphere","goo/shapes/Torus","goo/math/Vector3","goo/math/Matrix3x3","goo/math/Transform","goo/renderer/Renderer","goo/math/Ray"],function(a,b,c,d,e,f,g,h){"use strict";function i(){a.call(this,"RotationGizmo"),this._ballMesh=new b(32,32,1.1),this._torusMesh=new c(64,8,.1,2.4),this._buildBall(),this._buildTorus(0),this._buildTorus(1),this._buildTorus(2),this._rotation=new e,this._rotationScale=4,this._axis=new d,this._direction=new d,this._ray=new h,this._m1=new e,this._m2=new e,this.snap=!1,this.accumulatedRotationX=0,this.accumulatedRotationY=0,this.accumulatedRotationThorX=0,this.accumulatedRotationThorY=0,this.accumulatedRotationThorZ=0,this.oldAngleX=0,this.oldAngleY=0,this.oldAngleZ=0}function j(a){return function(b){return Math.floor(b/a)*a}}function k(a,b){return function(c){var d=c%a;return d+=0>d?a:0,b>d?c-d:d>a-b?c+a-d:c}}i.prototype=Object.create(a.prototype),i.prototype.activate=function(b){a.prototype.activate.call(this,b);var c=this._v0,e=this._v1,f=this._v2,h=this._axis,i=this._ray;if(this._activeHandle.axis<3){h.setv([d.UNIT_X,d.UNIT_Y,d.UNIT_Z][this._activeHandle.axis]),this.transform.rotation.applyPost(h),c.setv(d.ZERO),this.transform.matrix.applyPostPoint(c),g.mainCamera.getPickRay(b.x,b.y,1,1,i),e.setv(i.origin).subv(c);var j=.9*e.length();e.setv(i.direction).muld(j,j,j).addv(i.origin),f.setv(e).subv(c),d.cross(h,f,f),f.addv(e),g.mainCamera.getScreenCoordinates(f,1,1,this._direction),this._direction.sub_d(b.x,1-b.y,0),this._direction.y*=-1,this._direction.z=0,this._direction.normalize()}},i.prototype.process=function(){var a=this._mouse.oldPosition,b=this._mouse.position,c=b[0]-a[0],d=b[1]-a[1];3===this._activeHandle.axis?this._rotateOnScreen(c,d):this._rotateOnAxis(c,d),a[0]=b[0],a[1]=b[1],this.updateTransforms(),this.dirty=!1,this.onChange instanceof Function&&this.onChange(this.transform.rotation)},i.prototype._rotateOnScreen=function(a,b){this._rotation.setIdentity(),this._rotation.rotateY(a*this._rotationScale),this._rotation.rotateX(b*this._rotationScale);var c=g.mainCamera.getViewMatrix().data,d=this._m1,f=this._m2;d.set(c[0],c[1],c[2],c[4],c[5],c[6],c[8],c[9],c[10]),f.set(d).invert(),f.combine(this._rotation),f.combine(d),e.combine(f,this.transform.rotation,this.transform.rotation)},j(Math.PI/8);var l=k(Math.PI/4,Math.PI/16),m=l;return i.prototype._rotateOnAxis=function(a,b){this._rotation.setIdentity();var c=a*this._direction.x+b*this._direction.y;if(c*=this._rotationScale,this.snap)switch(this._activeHandle.axis){case 0:this.accumulatedRotationThorX+=c;var d=m(this.accumulatedRotationThorX);this._rotation.rotateX(d-this.oldAngleX),this.oldAngleX=d;break;case 1:this.accumulatedRotationThorY+=c;var f=m(this.accumulatedRotationThorY);this._rotation.rotateY(f-this.oldAngleY),this.oldAngleY=f;break;case 2:this.accumulatedRotationThorZ+=c;var g=m(this.accumulatedRotationThorZ);this._rotation.rotateZ(g-this.oldAngleZ),this.oldAngleZ=g}else switch(this._activeHandle.axis){case 0:this.accumulatedRotationThorX+=c;var d=this.accumulatedRotationThorX;this._rotation.rotateX(d-this.oldAngleX),this.oldAngleX=d;break;case 1:this.accumulatedRotationThorY+=c;var f=this.accumulatedRotationThorY;this._rotation.rotateY(f-this.oldAngleY),this.oldAngleY=f;break;case 2:this.accumulatedRotationThorZ+=c;var g=this.accumulatedRotationThorZ;this._rotation.rotateZ(g-this.oldAngleZ),this.oldAngleZ=g}e.combine(this.transform.rotation,this._rotation,this.transform.rotation)},i.prototype._buildBall=function(){var b=new f;b.scale.setd(1.2,1.2,1.2),this.addRenderable({meshData:this._ballMesh,materials:[this._buildMaterialForAxis(3,.6)],transform:new f,id:a.registerHandle({type:"Rotate",axis:3})})},i.prototype._buildTorus=function(b){var c=new f;c.scale.setd(1.7,1.7,1.7),0===b?c.setRotationXYZ(0,Math.PI/2,0):1===b&&c.setRotationXYZ(Math.PI/2,0,0),this.addRenderable({meshData:this._torusMesh,materials:[this._buildMaterialForAxis(b)],transform:c,id:a.registerHandle({type:"Rotate",axis:b}),thickness:.35})},i}),define("goo/util/gizmos/ScaleGizmo",["goo/util/gizmos/Gizmo","goo/renderer/MeshData","goo/util/MeshBuilder","goo/shapes/Box","goo/math/Transform","goo/renderer/Renderer","goo/math/Vector3","goo/math/MathUtils"],function(a,b,c,d,e,f,g,h){"use strict";function i(b){a.call(this,"ScaleGizmo",b),this._boxMesh=new d(1.3,1.3,1.3),this._arrowMesh=this._buildArrowMesh(),this._scale=1,this._transformScale=new g,this._transformScale.setd(1,1,1),this._buildBox(),this._buildArrow(0),this._buildArrow(1),this._buildArrow(2)}return i.prototype=Object.create(a.prototype),i.prototype.activate=function(b){a.prototype.activate.call(this,b),3!==this._activeHandle.axis&&(this._setPlane(),this._setLine())},i.prototype.copyTransform=function(b){a.prototype.copyTransform.call(this,b),this._transformScale.setv(b.scale)},i.prototype.process=function(){var a=this._mouse.oldPosition,b=this._mouse.position;3===this._activeHandle.axis?this._scaleUniform():this._scaleNonUniform(),a[0]=b[0],a[1]=b[1],this.updateTransforms(),this.dirty=!1,this.onChange instanceof Function&&this.onChange(this._transformScale)},i.prototype._scaleUniform=function(){var a=this._mouse.oldPosition,b=this._mouse.position,c=Math.pow(1+b[0]+a[1]-a[0]-b[1],this._scale),d=this.gizmoRenderSystem.entity.transformComponent.worldTransform.translation,e=f.mainCamera.translation,g=e.distance(d);c+=g/2e5*h.sign(c-1),this._transformScale.muld(c,c,c)},i.prototype._scaleNonUniform=function(){var a=this._mouse.position,b=this._mouse.oldPosition;f.mainCamera.getPickRay(b[0],b[1],1,1,this._oldRay),f.mainCamera.getPickRay(a[0],a[1],1,1,this._newRay);var c=this._v0,d=this._v1,e=this._line,g=this._result;this._plane.rayIntersect(this._oldRay,c),this._plane.rayIntersect(this._newRay,d),g.setv(d).subv(c),g.div(this.transform.scale).scale(.07);var h=g.dot(e);g.setv(e).muld(h,h,h);var i=Math.pow(1+h,this._scale);switch(this._activeHandle.axis){case 0:this._transformScale.data[0]*=i;break;case 1:this._transformScale.data[1]/=i;break;case 2:this._transformScale.data[2]*=i}},i.prototype._buildBox=function(){this.addRenderable({meshData:this._boxMesh,materials:[this._buildMaterialForAxis(3)],transform:new e,id:a.registerHandle({type:"Scale",axis:3})})},i.prototype._buildArrow=function(b){var c=new e;0===b?c.setRotationXYZ(0,Math.PI/2,0):1===b&&c.setRotationXYZ(Math.PI/2,0,0),this.addRenderable({meshData:this._arrowMesh,materials:[this._buildMaterialForAxis(b)],transform:c,id:a.registerHandle({type:"Scale",axis:b})})},i.prototype._buildArrowMesh=function(){var a=new c,f=new d,g=new b(b.defaultMap([b.POSITION]),2,2);g.getAttributeBuffer(b.POSITION).set([0,0,0,0,0,1]),g.getIndexBuffer().set([0,1]),g.indexLengths=null,g.indexModes=["Lines"];var h=new e;h.translation.setd(0,0,8),h.update(),a.addMeshData(f,h);var h=new e;h.scale.setd(1,1,8),h.update(),a.addMeshData(g,h);var i=a.build()[0];return i},i}),define("goo/entities/systems/GizmoRenderSystem",["goo/entities/systems/System","goo/entities/SystemBus","goo/renderer/SimplePartitioner","goo/renderer/Material","goo/renderer/shaders/ShaderLib","goo/renderer/shaders/ShaderFragment","goo/renderer/Util","goo/math/Matrix3x3","goo/math/Matrix4x4","goo/renderer/MeshData","goo/renderer/Shader","goo/util/gizmos/Gizmo","goo/util/gizmos/TranslationGizmo","goo/util/gizmos/RotationGizmo","goo/util/gizmos/ScaleGizmo"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){"use strict";function p(c){a.call(this,"GizmoRenderSystem",null),this.renderables=[],this.camera=null,this.gizmos=[new m(this),new n(this),new o(this)],this.active=!1,this.nextGizmo=null,this.setupCallbacks(c),this.activeGizmo=null,this.viewportWidth=0,this.viewportHeight=0,this.domElement=null,this.global=!1,this.pickingMaterial=d.createEmptyMaterial(q,"pickingMaterial"),this.pickingMaterial.blendState={blending:"NoBlending",blendEquation:"AddEquation",blendSrc:"SrcAlphaFactor",blendDst:"OneMinusSrcAlphaFactor"},this.mouseMove=function(a){this.activeGizmo&&this.activeGizmo.update([a.layerX/this.viewportWidth,a.layerY/this.viewportHeight])}.bind(this);var e=this;b.addListener("goo.setCurrentCamera",function(a){e.camera=a})}p.prototype=Object.create(a.prototype),p.prototype.activate=function(a,b,c){this.active=!0;var d=l.getHandle(a);d&&this.activeGizmo&&(this.activeGizmo.activate({id:a,data:d,x:b/this.viewportWidth,y:c/this.viewportHeight}),this.domElement.addEventListener("mousemove",this.mouseMove))},p.prototype.deactivate=function(){this.activeGizmo.deactivate(),this.active=!1,this.domElement.removeEventListener("mousemove",this.mouseMove),null!==this.nextGizmo&&(this.setActiveGizmo(this.nextGizmo),this.nextGizmo=null)},p.prototype.getGizmo=function(a){return this.gizmos[a]},p.prototype.show=function(a){this.entity=a,this.activeGizmo&&(this.entity?this.showGizmo(this.activeGizmo):this.hideGizmo(this.activeGizmo))},p.prototype.showGizmo=function(a){a.copyTransform(this.entity.transformComponent.worldTransform,this.global),a.visible||(this.renderables=a.renderables,a.visible=!0)},p.prototype.hideGizmo=function(a){a.visible&&(this.renderables=[],a.visible=!1)},p.prototype.setActiveGizmo=function(a){return this.active?(this.nextGizmo=a,void 0):(this.activeGizmo&&this.hideGizmo(this.activeGizmo),this.activeGizmo=this.gizmos[a]||null,this.activeGizmo&&this.entity&&this.showGizmo(this.activeGizmo),void 0)},p.prototype.setGlobal=function(a){this.global!==a&&(this.global=!!a,this.entity&&this.activeGizmo&&this.showGizmo(this.activeGizmo))},p.prototype.setupCallbacks=function(a){if(a&&3===a.length)return this.gizmos[0].onChange=a[0],this.gizmos[1].onChange=a[1],this.gizmos[2].onChange=a[2],void 0;var b=new h,c=new i;this.gizmos[0].onChange=function(a){if(this.entity){var b=this.entity.transformComponent.transform.translation;b.setv(a),this.entity.transformComponent.parent&&(c.copy(this.entity.transformComponent.parent.worldTransform.matrix),c.invert(),c.applyPostPoint(b)),this.entity.transformComponent.setUpdated()}}.bind(this),this.gizmos[1].onChange=function(a){this.entity&&(this.entity.transformComponent.transform.rotation.copy(a),this.entity.transformComponent.parent&&(b.copy(this.entity.transformComponent.parent.worldTransform.rotation),b.invert()),h.combine(b,this.entity.transformComponent.transform.rotation,this.entity.transformComponent.transform.rotation),this.entity.transformComponent.setUpdated())}.bind(this),this.gizmos[2].onChange=function(a){if(this.entity){var b=this.entity.transformComponent.transform.scale;b.setv(a),this.entity.transformComponent.parent&&b.div(this.entity.transformComponent.parent.worldTransform.scale),this.entity.transformComponent.setUpdated()}}.bind(this)},p.prototype.inserted=function(){},p.prototype.deleted=function(){},p.prototype.process=function(){this.activeGizmo&&(this.activeGizmo.dirty?this.activeGizmo.process():this.entity&&this.entity.transformComponent._updated&&this.activeGizmo.copyTransform(this.entity.transformComponent.worldTransform,this.global),this.activeGizmo.updateTransforms())},p.prototype.render=function(a){a.checkResize(this.camera),this.domElement||(this.domElement=a.domElement),this.viewportHeight=a.viewportHeight,this.viewportWidth=a.viewportWidth,this.camera&&a.render(this.renderables,this.camera,this.lights,null,{color:!1,stencil:!0,depth:!0},this.overrideMaterials)},p.prototype.renderToPick=function(a,b){for(var c=0;c<this.renderables.length;c++){var d=this.renderables[c];void 0!==d.thickness&&(d.materials[0].uniforms.thickness=d.thickness)}a.renderToPick(this.renderables,this.camera,{color:!1,stencil:!0,depth:!0},b,void 0,void 0,void 0,this.pickingMaterial);for(var c=0;c<this.renderables.length;c++){var d=this.renderables[c];d.thickness&&(d.materials[0].uniforms.thickness=0)}};var q={attributes:{vertexPosition:j.POSITION,vertexNormal:j.NORMAL},processors:[function(a,b){var c=b.meshData.attributeMap;a.defines=a.defines||{};for(var d in c)a.defines[d]||(a.defines[d]=!0)}],uniforms:{viewMatrix:k.VIEW_MATRIX,projectionMatrix:k.PROJECTION_MATRIX,worldMatrix:k.WORLD_MATRIX,cameraFar:k.FAR_PLANE,thickness:0,id:function(a){return a.renderable.id+1}},vshader:["attribute vec3 vertexPosition;","#ifdef NORMAL","attribute vec3 vertexNormal;","#endif","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 worldMatrix;","uniform float cameraFar;","uniform float thickness;","varying float depth;","void main() {","#ifdef NORMAL","vec4 mvPosition = viewMatrix * worldMatrix * vec4( vertexPosition + vertexNormal * thickness, 1.0 );","#else","vec4 mvPosition = viewMatrix * worldMatrix * vec4( vertexPosition, 1.0 );","#endif","depth = length(mvPosition.xyz) / cameraFar;","gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fshader:["uniform float id;","varying float depth;",f.methods.packDepth16,"void main() {","vec2 packedId = vec2(floor(id/255.0), mod(id, 255.0)) * vec2(1.0/255.0);","vec2 packedDepth = packDepth16(depth);","gl_FragColor = vec4(packedId, packedDepth);","}"].join("\n")};return p}),define("goo/shapes/Grid",["goo/renderer/MeshData"],function(a){"use strict";function b(b,c,d,e){if(1===arguments.length&&arguments[0]instanceof Object){var f=arguments[0];b=f.xSegments,c=f.ySegments,d=f.width,e=f.height}this.xSegments=b||10,this.ySegments=c||10,this.width=d||1,this.height=e||1;var g=a.defaultMap([a.POSITION]),h=4+2*(this.xSegments-1)+2*(this.ySegments-1),i=8+2*(this.xSegments-1)+2*(this.ySegments-1);a.call(this,g,h,i),this.indexModes[0]="Lines",this.rebuild()}return b.prototype=Object.create(a.prototype),b.prototype.rebuild=function(){var b=this.width/2,c=this.height/2,d=[],e=[];d.push(-b,-c,0,-b,c,0,b,c,0,b,-c,0),e.push(0,1,1,2,2,3,3,0);for(var f,g=this.width/this.xSegments,h=1;h<this.xSegments;h++)f=h*g-b,d.push(f,-c,0,f,c,0);var i;g=this.height/this.ySegments;for(var h=1;h<this.ySegments;h++)i=h*g-c,d.push(-b,i,0,b,i,0);for(var h=e.length/2;h<d.length/3;h+=2)e.push(h,h+1);this.getAttributeBuffer(a.POSITION).set(d),this.getIndexBuffer().set(e)},b}),define("goo/entities/systems/GridRenderSystem",["goo/entities/systems/System","goo/entities/SystemBus","goo/renderer/SimplePartitioner","goo/renderer/MeshData","goo/renderer/Material","goo/renderer/Shader","goo/renderer/shaders/ShaderLib","goo/renderer/Util","goo/debug/DebugDrawHelper","goo/math/Transform","goo/shapes/Grid","goo/shapes/Quad"],function(a,b,c,d,e,f,g,h,i,j,k,l){"use strict";function m(){a.call(this,"GridRenderSystem",[]),this.renderList=[],this.doRender={grid:!0,surface:!0},this.camera=null,this.lights=[],this.transform=new j,this.transform.rotation.rotateX(-Math.PI/2),this.transform.scale.setd(1e3,1e3,1e3),this.transform.update();var c=e.createMaterial(n,"Grid Material");c.depthState.write=!0,c.depthState.enabled=!0,this.grid={meshData:new k(100,100),materials:[c],transform:this.transform};var d=h.clone(g.simpleColored),f=e.createMaterial(d,"Surface Material");f.uniforms.color=[.4,.4,.4],f.uniforms.opacity=.9,f.blendState.blending="CustomBlending",f.cullState.enabled=!1,f.depthState.write=!0,f.depthState.enabled=!0,f.offsetState.enabled=!0,f.offsetState.units=10,f.offsetState.factor=.8,this.surface={meshData:new l,materials:[f],transform:this.transform};var i=this;b.addListener("goo.setCurrentCamera",function(a){i.camera=a}),b.addListener("goo.setLights",function(a){i.lights=a})}m.prototype=Object.create(a.prototype),m.prototype.inserted=function(){},m.prototype.deleted=function(){},m.prototype.process=function(){var a=this.renderList.length=0;this.doRender.surface&&(this.renderList[a++]=this.surface),this.doRender.grid&&(this.renderList[a++]=this.grid),this.renderList.length=a},m.prototype.render=function(a){a.checkResize(this.camera),this.camera&&a.render(this.renderList,this.camera,this.lights,null,{color:!1,depth:!1,stencil:!1})};var n={attributes:{vertexPosition:d.POSITION},uniforms:{viewMatrix:f.VIEW_MATRIX,projectionMatrix:f.PROJECTION_MATRIX,worldMatrix:f.WORLD_MATRIX,color:[.55,.55,.55,1],fogOn:!1,fogColor:[.1,.1,.1,1],fogNear:f.NEAR_PLANE,fogFar:f.FAR_PLANE},vshader:["attribute vec3 vertexPosition;","uniform mat4 worldMatrix;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","varying float depth;","void main(void)","{","vec4 viewPosition = viewMatrix * worldMatrix * vec4(vertexPosition, 1.0);","depth = viewPosition.z;","gl_Position = projectionMatrix * viewPosition;","}"].join("\n"),fshader:["precision mediump float;","uniform vec4 fogColor;","uniform vec4 color;","uniform float fogNear;","uniform float fogFar;","uniform bool fogOn;","varying float depth;","void main(void)","{","if (fogOn) {","float lerpVal = clamp(depth / (-fogFar + fogNear), 0.0, 1.0);","lerpVal = pow(lerpVal, 1.5);","gl_FragColor = mix(color, fogColor, lerpVal);","} else {","gl_FragColor = color;","}","}"].join("\n")};return m}),define("goo/renderer/scanline/Edge",[],function(){"use strict";function a(){this.x0=0,this.x1=0,this.y0=0,this.y1=0,this.z0=0,this.z1=0,this.dx=0,this.dy=0,this.dz=0,this.xIncrement=0,this.zIncrement=0,this.betweenFaces=!1}return a.prototype.setData=function(a,b){var c=a.data[1],d=b.data[1];d>c?(this.x0=a.data[0],this.x1=b.data[0],this.y0=c,this.y1=d,this.z0=a.data[2],this.z1=b.data[2]):(this.x0=b.data[0],this.x1=a.data[0],this.y0=d,this.y1=c,this.z0=b.data[2],this.z1=a.data[2]),this.betweenFaces=!1},a.prototype.computeDerivedData=function(){var a=this.x1-this.x0,b=this.y1-this.y0,c=this.z1-this.z0;this.dy=b,this.dx=a,this.dz=c,this.xIncrement=a/b,this.zIncrement=c/b},a.prototype.roundOccludeeCoordinates=function(){this.y0=Math.round(this.y0),this.y1=Math.round(this.y1)},a}),define("goo/renderer/scanline/EdgeData",[],function(){"use strict";function a(){var a=2,b=8,c=a*Int16Array.BYTES_PER_ELEMENT,d=b*Float32Array.BYTES_PER_ELEMENT;this._dataBuffer=new ArrayBuffer(c+d),this.floatData=new Float32Array(this._dataBuffer,0,b),this.integerData=new Int16Array(this._dataBuffer,d,a)}return a.prototype.setData=function(a){this.integerData[0]=a[0],this.integerData[1]=a[1],this.floatData[0]=a[2],this.floatData[1]=a[3],this.floatData[2]=a[4],this.floatData[3]=a[5],this.floatData[4]=a[6],this.floatData[5]=a[7],this.floatData[6]=a[8],this.floatData[7]=a[9]},a.prototype.getStartLine=function(){return this.integerData[0]},a.prototype.getStopLine=function(){return this.integerData[1]},a.prototype.getLongX=function(){return this.floatData[0]},a.prototype.setLongX=function(a){this.floatData[0]=a
},a.prototype.getShortX=function(){return this.floatData[1]},a.prototype.setShortX=function(a){this.floatData[1]=a},a.prototype.getLongZ=function(){return this.floatData[2]},a.prototype.getShortZ=function(){return this.floatData[3]},a.prototype.getLongXIncrement=function(){return this.floatData[4]},a.prototype.getShortXIncrement=function(){return this.floatData[5]},a.prototype.getLongZIncrement=function(){return this.floatData[6]},a.prototype.getShortZIncrement=function(){return this.floatData[7]},a}),define("goo/renderer/scanline/OccludeeTriangleData",[],function(){"use strict";function a(a){var b=a.numberOfPositions,c=a.numberOfIndices;this.indexCount=0;var d=b*Float32Array.BYTES_PER_ELEMENT,e=c*Uint8Array.BYTES_PER_ELEMENT;this._dataBuffer=new ArrayBuffer(d+e),this.positions=new Float32Array(this._dataBuffer,0,b),this.indices=new Uint8Array(this._dataBuffer,d,c)}return a.prototype.addIndices=function(a){var b=this.indexCount;this.indices[b]=a[0],b++,this.indices[b]=a[1],b++,this.indices[b]=a[2],b++,this.indexCount=b},a.prototype.clear=function(){this.indexCount=0},a}),define("goo/renderer/scanline/BoundingBoxOcclusionChecker",["goo/math/Matrix4x4","goo/math/Vector4","goo/math/Vector2","goo/renderer/scanline/OccludeeTriangleData"],function(a,b,c,d){"use strict";function e(a){this.renderer=a,this._clipY=a.height-1,this._clipX=a.width-1,this._halfClipX=this._clipX/2,this._halfClipY=this._clipY/2}var f=0,g=1,h=2,i=4,j=8,k=new Uint8Array(8),l=new Float32Array(32),m=new Float32Array(5),n=new Uint8Array([0,3,4,3,7,4,0,4,5,0,5,1,2,1,5,2,5,6,3,2,6,3,6,7,0,1,2,0,2,3,5,4,6,7,6,4]),o=new Uint8Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,0,0,4,1,5,2,6,3,7]),p=new d({numberOfPositions:32,numberOfIndices:18}),q=new b(0,0,0,1),r=new b(0,0,0,1),s=new b(0,0,0,1),t=new Uint8Array(3),u=new a;return e.prototype.occlusionCull=function(a,b){return this._doSSAABBOcclusionTest(a,b)},e.prototype._doRenderedBoundingBoxOcclusionTest=function(a,b){if(this._copyEntityVerticesToPositionArray(a),!this._projectionTransformTriangleData(a,b))return!1;this._addVisibleTrianglesToTriangleData(),this._screenSpaceTransformTriangleData();for(var c=p.indexCount,d=0;c>d;)if(t[0]=p.indices[d++],t[1]=p.indices[d++],t[2]=p.indices[d++],!this.renderer.isRenderedTriangleOccluded(t,p.positions))return!1;return!0},e.prototype._doSSAABBOcclusionTest=function(b,c){this._copyEntityVerticesToPositionArray(b);var d=b.transformComponent.worldTransform.matrix;a.combine(c,d,u);for(var e=0;32>e;){var f=e++,g=e++,h=e++,i=e++;q.data[0]=l[f],q.data[1]=l[g],q.data[2]=l[h],q.data[3]=l[i],u.applyPost(q);var j=q.data[3];if(j<this.renderer.camera.near)return!1;var k=1/j;q.data[0]*=k,q.data[1]*=k,l[f]=(q.data[0]+1)*this._halfClipX,l[g]=(q.data[1]+1)*this._halfClipY,l[i]=k}return this._clipBox(l),m[0]=Math.floor(m[0]),m[1]=Math.ceil(m[1]),m[2]=Math.floor(m[2]),m[3]=Math.ceil(m[3]),this._isBoundingBoxScanlineOccluded(m)},e.prototype._copyEntityVerticesToPositionArray=function(a){l.set(a.occludeeComponent.positionArray)},e.prototype._clipBox=function(a){var b,c,d,e,l;b=1/0,c=-1/0,d=1/0,e=-1/0,l=-1/0;for(var n,p=0;8>p;p++){n=4*p,q.data[0]=a[n],q.data[1]=a[n+1],q.data[3]=a[n+3];var t=this._calculateOutCode(q);if(k[p]=t,t===f){l=Math.max(l,q.data[3]);var u=q.data[0];b=Math.min(b,u),c=Math.max(c,u);var v=q.data[1];d=Math.min(d,v),e=Math.max(e,v)}}for(var w,x,y,z=0;24>z;z++)for(y=o[z],n=4*y,q.data[0]=a[n],q.data[1]=a[n+1],q.data[3]=a[n+3],w=k[y],z++,y=o[z],n=4*y,r.data[0]=a[n],r.data[1]=a[n+1],r.data[3]=a[n+3],x=k[y];w|x&&!(w&x);){var A,B,C=w?w:x;if(C&j){if(A=(this._clipY-q.data[1])/(r.data[1]-q.data[1]),s.data[0]=q.data[0]+(r.data[0]-q.data[0])*A,s.data[1]=this._clipY,B=this._calculateOutCode(s),B===f){e=this._clipY;var u=s.data[0];b=Math.min(b,u),c=Math.max(c,u)}}else if(C&i){if(A=-q.data[1]/(r.data[1]-q.data[1]),s.data[0]=q.data[0]+(r.data[0]-q.data[0])*A,s.data[1]=0,B=this._calculateOutCode(s),B===f){d=0;var u=s.data[0];b=Math.min(b,u),c=Math.max(c,u)}}else if(C&h){if(A=(this._clipX-q.data[0])/(r.data[0]-q.data[0]),s.data[1]=q.data[1]+(r.data[1]-q.data[1])*A,s.data[0]=this._clipX,B=this._calculateOutCode(s),B===f){c=this._clipX;var v=s.data[1];d=Math.min(d,v),e=Math.max(e,v)}}else if(C&g&&(A=-q.data[0]/(r.data[0]-q.data[0]),s.data[1]=q.data[1]+(r.data[1]-q.data[1])*A,s.data[0]=0,B=this._calculateOutCode(s),B===f)){b=0;var v=s.data[1];d=Math.min(d,v),e=Math.max(e,v)}var D;C===w?(w=B,D=(1-A)*q.data[3]+A*r.data[3]):(x=B,D=(1-A)*r.data[3]+A*q.data[3]),l=Math.max(l,D)}m[0]=b,m[1]=c,m[2]=d,m[3]=e,m[4]=l},e.prototype._calculateOutCode=function(a){var b=f;return a.data[0]<0?b|=g:a.data[0]>this._clipX&&(b|=h),a.data[1]<0?b|=i:a.data[1]>this._clipY&&(b|=j),b},e.prototype._isBoundingBoxScanlineOccluded=function(a){for(var b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=this.renderer.width,h=e;h>=d;h--)for(var i=h*g+b,j=b;c>=j;j++){if(this.renderer._depthData[i]<f)return!1;i++}return!0},e.prototype._projectionTransformTriangleData=function(b,c){p.clear();var d=b.transformComponent.worldTransform.matrix;a.combine(c,d,u);for(var e,f,g,h,i,j=l.length,k=0;j>k;k++){if(e=k+1,f=k+2,g=k+3,q.data[0]=l[k],q.data[1]=l[e],q.data[2]=l[f],q.data[3]=1,u.applyPost(q),h=q.data[3],h<this.renderer.camera.near)return!1;i=1/h,q.data[0]*=i,q.data[1]*=i,p.positions[k]=q.data[0],p.positions[e]=q.data[1],p.positions[g]=i,k=g}return!0},e.prototype._addVisibleTrianglesToTriangleData=function(){for(var a,b=0;b<n.length;b++)t=[n[b],n[++b],n[++b]],a=4*t[0],q.data[0]=p.positions[a],q.data[1]=p.positions[a+1],a=4*t[1],r.data[0]=p.positions[a],r.data[1]=p.positions[a+1],a=4*t[2],s.data[0]=p.positions[a],s.data[1]=p.positions[a+1],this.renderer._isBackFacingProjected(q,r,s)||p.addIndices(t)},e.prototype._screenSpaceTransformTriangleData=function(){for(var a=p.positions.length,b=0;a>b;b+=4){p.positions[b]=(p.positions[b]+1)*this._halfClipX;var c=b+1;p.positions[c]=(p.positions[c]+1)*this._halfClipY}},e}),define("goo/renderer/scanline/BoundingSphereOcclusionChecker",["goo/math/Matrix4x4","goo/math/Vector4"],function(a,b){"use strict";function c(a){this.renderer=a,this._clipY=a.height-1,this._clipX=a.width-1,this._halfClipX=this._clipX/2,this._halfClipY=this._clipY/2}var d=new b(0,0,0,1),e=new a,f=new Float32Array(20),g=[0,255,0],h=[0,190,190];return c.prototype.occlusionCull=function(b,c,g,h){var i=b.transformComponent.worldTransform.matrix;a.combine(c,i,e);var j=b.meshDataComponent.modelBound;d.data[0]=0,d.data[1]=0,d.data[2]=0,d.data[3]=1,e.applyPost(d);var k=b.transformComponent.transform.scale,l=k.maxAxis()*j.radius,m=d.data[0],n=d.data[1],o=d.data[2],p=Math.sqrt(m*m+n*n+o*o);if(l>=p)return!1;var q=p*Math.tan(Math.asin(l/p)),r=o+q;if(r>h)return!1;f[0]=m,f[1]=n,f[2]=r,f[4]=m-q,f[5]=n,f[6]=o,f[8]=m+q,f[9]=n,f[10]=o,f[12]=m,f[13]=n+q,f[14]=o,f[16]=m,f[17]=n-q,f[18]=o;for(var s=0;20>s;){var t=s++,u=s++,v=s++,w=s++;d.data[0]=f[t],d.data[1]=f[u],d.data[2]=f[v],d.data[3]=1,g.applyPost(d);var x=1/d.data[3];d.data[0]*=x,d.data[1]*=x,f[t]=(d.data[0]+1)*this._halfClipX,f[u]=(d.data[1]+1)*this._halfClipY,f[w]=x}return this._isSSAABBScanlineOccluded()},c.prototype._isSSAABBScanlineOccluded=function(){var a=f[3],b=f[4],c=f[8],d=f[13],e=f[17];b=Math.floor(b),c=Math.ceil(c),d=Math.ceil(d),e=Math.floor(e),0>b&&(b=0),c>this._clipX&&(c=this._clipX),d>this._clipY&&(d=this._clipY),0>e&&(e=0);for(var h,i=this.renderer.width,j=d;j>=e;j--){h=j*i+b;for(var k=b;c>=k;k++){if(this.renderer._colorData.set(g,4*h),this.renderer._depthData[h]<a)return!1;h++}}return!0},c.prototype._isPythagorasCircleScanlineOccluded=function(a,b,c,d,e,f){var g=a.y-c.y,i=c.y-b.y,j=c.x-a.x,k=j*j,l=this.renderer.width,m=l/this.renderer.height,n=a.y-1;if(1>=g&&1>=i||a.y<=0||b.y>=this._clipY){var o;return this._isCoordinateInsideScreen(a)&&(o=a.y*l+a.x,this.renderer._colorData.set(h,4*o)),this._isCoordinateInsideScreen(b)&&(o=b.y*l+b.x,this.renderer._colorData.set(h,4*o)),this._isCoordinateInsideScreen(d)&&(o=d.y*l+d.x,this.renderer._colorData.set(h,4*o)),this._isCoordinateInsideScreen(c)&&(o=c.y*l+c.x,this.renderer._colorData.set(h,4*o)),!0}var p=1;if(c.y>=this._clipY)g=0,n=this._clipY;else{var q=n-this._clipY;q>0&&(g-=q,p+=q,n=this._clipY);var r=-(c.y+1);r>0&&(g-=r)}g-=1;for(var s=0;g>s;s++){var t=j-m*p,u=Math.sqrt(k-t*t),v=Math.ceil(a.x+u),w=Math.floor(a.x-u);0>w&&(w=0),v>this._clipX&&(v=this._clipX);for(var o=n*this.width+w,x=w;v>=x;x++){if(this.renderer._colorData.set(f,4*o),this.renderer._depthData[o]<e)return!1;o++}n--,p++}if(0>n)return!0;if(g>=-1&&c.y<=this._clipY){var w=d.x+1;0>w&&(w=0);var v=c.x-1;v>this._clipX&&(v=this._clipX);for(var y=n*this.width+w,s=w;v>=s;s++){if(this.renderer._colorData.set(f,4*y),this.renderer._depthData[y]<e)return!1;y++}n--}p=i-1;var q=c.y-n-1;q>0&&(i-=q,p-=q);var z=-(b.y+1);z>0&&(i-=z),i-=1,j=c.x-b.x;for(var s=0;i>s;s++){var t=j-m*p,u=Math.sqrt(k-t*t),v=Math.ceil(a.x+u),w=Math.floor(a.x-u);0>w&&(w=0),v>this._clipX&&(v=this._clipX);for(var o=n*this.width+w,x=w;v>=x;x++){if(this.renderer._colorData.set(f,4*o),this.renderer._depthData[o]<e)return!1;o++}n--,p--}return!0},c.prototype._isOccluded=function(a,b,c){if(this._isCoordinateInsideScreen(a)){var d=a.y*this.renderer.width+a.x;return this.renderer._colorData.set(b,4*d),c<this.renderer._depthData[d]}return!0},c.prototype._isCoordinateInsideScreen=function(a){return a.data[0]>=0&&a.data[0]<=this._clipX&&a.data[1]<=this._clipY&&a.data[1]>=0},c}),define("goo/renderer/scanline/OccluderTriangleData",[],function(){"use strict";function a(a){var b=a.vertCount,c=a.indexCount,d=c/3,e=4*b,f=e+8*d,g=2*c;this.posCount=0,this.largestIndex=-1,this.indexCount=0;var h=f*Float32Array.BYTES_PER_ELEMENT,i=g*Uint8Array.BYTES_PER_ELEMENT;this._dataBuffer=new ArrayBuffer(h+i),this.positions=new Float32Array(this._dataBuffer,0,f),this.indices=new Uint8Array(this._dataBuffer,h,g)}return a.prototype.addVertex=function(a){var b=this.posCount;return this.positions[b]=a[0],b++,this.positions[b]=a[1],b++,this.positions[b]=a[2],b++,this.positions[b]=a[3],b++,this.posCount=b,this.largestIndex++,this.largestIndex},a.prototype.setCountersToNewEntity=function(a){this.indexCount=0;var b=a/3;this.posCount=4*b,this.largestIndex=b-1},a.prototype.addIndices=function(a){var b=this.indexCount;this.indices[b]=a[0],b++,this.indices[b]=a[1],b++,this.indices[b]=a[2],b++,this.indexCount=b},a}),define("goo/renderer/scanline/EdgeMap",["goo/renderer/scanline/Edge"],function(a){"use strict";function b(b){this._edges=new Array(b),this._edgeCount=0;for(var c=0;b>c;c++)this._edges[c]=new a;this._map={},this.numberOfSharedEdges=0}return b.prototype.addEdge=function(a,b,c,d){var e=this._indicesToKey(a,b);if(this._contains(e)){var f=this._map[e];this._edges[f].betweenFaces=!0,this.numberOfSharedEdges++}else{var g=this._indicesToKey(b,a),f=this._edgeCount,h=this._edges[f];h.setData(c,d,a,b),h.computeDerivedData(),this._map[e.toString()]=f,this._map[g.toString()]=f,this._edgeCount++}},b.prototype._contains=function(a){return this._map.hasOwnProperty(a)},b.prototype.getEdge=function(a,b){var c=this._indicesToKey(a,b),d=this._map[c];return this._edges[d]},b.prototype.clear=function(){this._map={},this._edgeCount=0,this.numberOfSharedEdges=0},b.prototype._indicesToKey=function(a,b){return(a<<8)+b},b}),define("goo/renderer/scanline/SoftwareRenderer",["goo/math/Vector4","goo/math/Matrix4x4","goo/renderer/scanline/Edge","goo/renderer/bounds/BoundingSphere","goo/renderer/bounds/BoundingBox","goo/renderer/scanline/EdgeData","goo/renderer/scanline/BoundingBoxOcclusionChecker","goo/renderer/scanline/BoundingSphereOcclusionChecker","goo/renderer/scanline/OccluderTriangleData","goo/renderer/scanline/EdgeMap"],function(a,b,c,d,e,f,g,h,i,j){"use strict";function k(a){a=a||{},this.width=a.width,this.height=a.height,this._clipY=this.height-1,this._clipX=this.width-1,this._halfClipX=this._clipX/2,this._halfClipY=this._clipY/2,this.camera=a.camera;var b=this.width*this.height,c=4*b*Uint8Array.BYTES_PER_ELEMENT,d=b*Float32Array.BYTES_PER_ELEMENT;this._frameBuffer=new ArrayBuffer(c+2*d),this._colorData=new Uint8Array(this._frameBuffer,0,4*b),this._depthData=new Float32Array(this._frameBuffer,c,b),this._depthClear=new Float32Array(this._frameBuffer,c+d,b);for(var e=0;b>e;e++)this._depthClear[e]=0;this._triangleData=new i({vertCount:a.maxVertCount,indexCount:a.maxIndexCount}),this.edgeMap=new j(a.maxVertCount),this.boundingBoxModule=new g(this),this.boundingSphereModule=new h(this),q.data[2]=-this.camera.near}var l=new Uint8Array(4),m=new Uint16Array(3),n=new a(0,0,0,1),o=new a(0,0,0,1),p=new a(0,0,0,1),q=new a(0,0,0,1),r=[n,o,p],s=new Uint8Array(3),t=new Uint8Array(3),u=new Uint8Array(3),v=new b,w=new b,x=new f,y=[new c,new c,new c];return k.prototype._clearDepthData=function(){this._depthData.set(this._depthClear)},k.prototype.render=function(a){this._clearDepthData();for(var b,c=this.camera.getViewMatrix(),d=this.camera.getProjectionMatrix(),e=0;e<a.length;e++){this._setupTriangleDataForEntity(a[e],c,d),this._fillEdgeMap(),b=this._triangleData.indexCount;for(var f=0;b>f;f++)l[0]=this._triangleData.indices[f],l[1]=this._triangleData.indices[++f],l[2]=this._triangleData.indices[++f],this._renderTriangle(l)}},k.prototype._fillEdgeMap=function(){this.edgeMap.clear();for(var a=this._triangleData.indexCount,b=0;a>b;b++){var c=this._triangleData.indices[b],d=this._triangleData.indices[++b],e=this._triangleData.indices[++b],f=4*c;n.data[0]=this._triangleData.positions[f],n.data[1]=this._triangleData.positions[f+1],n.data[2]=this._triangleData.positions[f+3],f=4*d,o.data[0]=this._triangleData.positions[f],o.data[1]=this._triangleData.positions[f+1],o.data[2]=this._triangleData.positions[f+3],f=4*e,p.data[0]=this._triangleData.positions[f],p.data[1]=this._triangleData.positions[f+1],p.data[2]=this._triangleData.positions[f+3],this.edgeMap.addEdge(c,d,n,o),this.edgeMap.addEdge(d,e,o,p),this.edgeMap.addEdge(e,c,p,n)}},k.prototype.performOcclusionCulling=function(a){var c=this.camera.getViewMatrix(),f=this.camera.getProjectionMatrix();b.combine(f,c,v);for(var g=-this.camera.near,h=[],i=0;i<a.length;i++){var j=a[i];if("NeverOcclusionCull"!==j.meshRendererComponent.cullMode){var k,l,m=j.occludeeComponent;l=m?j.occludeeComponent.modelBound:j.modelBound,l instanceof d?k=this.boundingSphereModule.occlusionCull(j,c,f,g):l instanceof e&&(k=this.boundingBoxModule.occlusionCull(j,v)),k||h.push(j)}else h.push(j)}return h},k.prototype._viewSpaceTransformAndCopyVertices=function(a,c){var d=a.occluderComponent.meshData.dataViews.POSITION,e=a.transformComponent.worldTransform.matrix;b.combine(c,e,w),n.data[3]=1;for(var f=d.length,g=0,h=0;f>h;h++)n.data[0]=d[h],h++,n.data[1]=d[h],h++,n.data[2]=d[h],w.applyPost(n),this._triangleData.positions[g]=n.data[0],g++,this._triangleData.positions[g]=n.data[1],g++,this._triangleData.positions[g]=n.data[2],g+=2;this._triangleData.setCountersToNewEntity(f)},k.prototype._nearPlaneClipAndAddTriangle=function(a){var b,c,d,e,f,g,h,i,j=this._categorizeVertices(-a);switch(j){case 0:this._triangleData.addIndices(l);break;case 3:break;case 1:b=s[0],c=r[b],d=c.data[0],e=c.data[1],f=r[t[0]],i=this._calculateIntersectionRatio(c,f,a),q.data[0]=d+i*(f.data[0]-d),q.data[1]=e+i*(f.data[1]-e),l[b]=this._triangleData.addVertex(q.data),f=r[t[1]],i=this._calculateIntersectionRatio(c,f,a),q.data[0]=d+i*(f.data[0]-d),q.data[1]=e+i*(f.data[1]-e),l[3]=this._triangleData.addVertex(q.data);var k=t[0],m=l[3];u[0]=l[b],u[1]=l[k],u[2]=m,this._triangleData.addIndices(u),u[0]=m,u[2]=l[t[1]],this._triangleData.addIndices(u);break;case 2:f=r[t[0]],g=f.data[0],h=f.data[1],b=s[0],c=r[b],d=c.data[0],e=c.data[1],i=this._calculateIntersectionRatio(c,f,a),q.data[0]=d+i*(g-d),q.data[1]=e+i*(h-e),l[b]=this._triangleData.addVertex(q.data),b=s[1],c=r[b],d=c.data[0],e=c.data[1],i=this._calculateIntersectionRatio(c,f,a),q.data[0]=d+i*(g-d),q.data[1]=e+i*(h-e),l[b]=this._triangleData.addVertex(q.data),this._triangleData.addIndices(l)}},k.prototype._screenSpaceTransformTriangleData=function(a){for(var b=this._triangleData.posCount,c=0;b>c;){var d=c++,e=c++,f=c++,g=c++;n.data[0]=this._triangleData.positions[d],n.data[1]=this._triangleData.positions[e],n.data[2]=this._triangleData.positions[f],n.data[3]=1,a.applyPost(n);var h=1/n.data[3],i=n.data[0]*h,j=n.data[1]*h;this._triangleData.positions[d]=(i+1)*this._halfClipX,this._triangleData.positions[e]=(j+1)*this._halfClipY,this._triangleData.positions[g]=h}},k.prototype._setupTriangleDataForEntity=function(a,b,c){this._viewSpaceTransformAndCopyVertices(a,b);for(var d=a.occluderComponent.meshData.indexData.data,e=d.length,f=this.camera.near,g=0;e>g;g++){l[0]=d[g],l[1]=d[++g],l[2]=d[++g],m[0]=4*l[0],m[1]=4*l[1],m[2]=4*l[2];var h=m[0];n.data[0]=this._triangleData.positions[h],n.data[1]=this._triangleData.positions[h+1],n.data[2]=this._triangleData.positions[h+2],h=m[1],o.data[0]=this._triangleData.positions[h],o.data[1]=this._triangleData.positions[h+1],o.data[2]=this._triangleData.positions[h+2],h=m[2],p.data[0]=this._triangleData.positions[h],p.data[1]=this._triangleData.positions[h+1],p.data[2]=this._triangleData.positions[h+2],this._isBackFacingCameraViewSpace(n,o,p)||this._nearPlaneClipAndAddTriangle(f)}this._screenSpaceTransformTriangleData(c)},k.prototype._categorizeVertices=function(a){for(var b=0,c=0,d=0;3>d;d++)r[d].data[2]<=a?(t[c]=d,c++):(s[b]=d,b++);return b},k.prototype._calculateIntersectionRatio=function(a,b,c){var d=a.data[2];return(d+c)/(d-b.data[2])},k.prototype._isBackFacingCameraViewSpace=function(a,b,c){var d=a.data[0],e=a.data[1],f=a.data[2],g=b.data[0]-d,h=b.data[1]-e,i=b.data[2]-f,j=c.data[0]-d,k=c.data[1]-e,l=c.data[2]-f,m=l*h-k*i,n=j*i-l*g,o=k*g-j*h,p=m*d+n*e+o*f;return p>0},k.prototype._isBackFacingProjected=function(a,b,c){var d=a.data[0],e=a.data[1],f=b.data[0]-d,g=b.data[1]-e,h=c.data[0]-d,i=c.data[1]-e,j=i*f-h*g;return 0>j},k.prototype._createOccludeeEdges=function(a,b){var c=4*a[0];n.data[0]=b[c],n.data[1]=b[c+1],n.data[2]=b[c+3],c=4*a[1],o.data[0]=b[c],o.data[1]=b[c+1],o.data[2]=b[c+3],c=4*a[2],p.data[0]=b[c],p.data[1]=b[c+1],p.data[2]=b[c+3],y[0].setData(n,o),y[1].setData(o,p),y[2].setData(p,n),y[0].roundOccludeeCoordinates(),y[1].roundOccludeeCoordinates(),y[2].roundOccludeeCoordinates(),y[0].computeDerivedData(),y[1].computeDerivedData(),y[2].computeDerivedData()},k.prototype._getLongEdgeAndShortEdgeIndices=function(){for(var a=y[0].dy,b=0,c=1;3>c;c++){var d=y[c].dy;d>a&&(a=d,b=c)}var e=(b+1)%3,f=(b+2)%3;return[b,e,f]},k.prototype._calculateOrientationData=function(a,b){var c=x.getShortX(),d=x.getLongX();return[d>c,b.z1<a.z0]},k.prototype.isRenderedTriangleOccluded=function(a,b){this._createOccludeeEdges(a,b);var c=this._getLongEdgeAndShortEdgeIndices(),d=y[c[0]],e=c[1],f=c[2];if(this._verticalLongEdgeCull(d))return console.log("renderingocclusion : vertical cull"),!0;var g=y[e],h=null;if(this._createEdgeData(d,g)){if(h=this._calculateOrientationData(x,g,d),this._horizontalLongEdgeCull(d,h))return console.log("renderingocclusion : horizontal cull"),!0;if(!this._isEdgeOccluded(x,h))return!1}if(g=y[f],this._createEdgeData(d,g)){if(null===h&&(h=this._calculateOrientationData(x,g,d),this._horizontalLongEdgeCull(d,h)))return console.log("renderingocclusion : horizontal cull"),!0;if(!this._isEdgeOccluded(x,h))return!1}return!0},k.prototype._renderTriangle=function(a){var b=a[0],c=a[1],d=a[2];y[0]=this.edgeMap.getEdge(b,c),y[1]=this.edgeMap.getEdge(c,d),y[2]=this.edgeMap.getEdge(d,b);var e=this._getLongEdgeAndShortEdgeIndices(),f=y[e[0]],g=e[1],h=e[2];if(!this._verticalLongEdgeCull(f)){var i=y[g],j=[f.betweenFaces,i.betweenFaces],k=null;if(this._createEdgeData(f,i)){if(k=this._calculateOrientationData(i,f),this._horizontalLongEdgeCull(f,k))return;this._drawEdges(x,k,j)}if(i=y[h],j=[f.betweenFaces,i.betweenFaces],this._createEdgeData(f,i)){if(k=this._calculateOrientationData(i,f),this._horizontalLongEdgeCull(f,k))return;this._drawEdges(x,k,j)}}},k.prototype._verticalLongEdgeCull=function(a){return a.y1<0||a.y0>this._clipY},k.prototype._horizontalLongEdgeCull=function(a,b){return b[0]?a.x1<0&&a.x0<0:a.x1>this._clipX&&a.x0>this._clipX},k.prototype._isEdgeOccluded=function(a,b){var c,d,e,f,g,h,i,j,k,l=a.getStartLine(),m=a.getStopLine(),n=a.getLongXIncrement(),o=a.getShortXIncrement(),p=a.getLongZIncrement(),q=a.getShortZIncrement();if(b[0])if(b[1])for(j=l;m>=j;j++){if(c=a.getShortX(),d=a.getLongX(),g=Math.floor(c),h=Math.ceil(d),e=a.getShortZ(),f=a.getLongZ(),i=h-g,k=.5/(i+1),f=(1-k)*f+k*e,!this._isScanlineOccluded(g,h,j,e,f))return!1;a.floatData[0]+=n,a.floatData[1]+=o,a.floatData[2]+=p,a.floatData[3]+=q}else for(j=l;m>=j;j++){if(c=a.getShortX(),d=a.getLongX(),g=Math.floor(c),h=Math.ceil(d),e=a.getShortZ(),f=a.getLongZ(),i=h-g,k=.5/(i+1),e=(1-k)*e+k*f,!this._isScanlineOccluded(g,h,j,e,f))return!1;a.floatData[0]+=n,a.floatData[1]+=o,a.floatData[2]+=p,a.floatData[3]+=q}else if(b[1])for(j=l;m>=j;j++){if(c=a.getLongX(),d=a.getShortX(),g=Math.floor(c),h=Math.ceil(d),e=a.getLongZ(),f=a.getShortZ(),i=h-g,k=.5/(i+1),f=(1-k)*f+k*e,!this._isScanlineOccluded(g,h,j,e,f))return!1;a.floatData[0]+=n,a.floatData[1]+=o,a.floatData[2]+=p,a.floatData[3]+=q}else for(j=l;m>=j;j++){if(c=a.getLongX(),d=a.getShortX(),g=Math.floor(c),h=Math.ceil(d),e=a.getLongZ(),f=a.getShortZ(),i=h-g,k=.5/(i+1),e=(1-k)*e+k*f,!this._isScanlineOccluded(g,h,j,e,f))return!1;a.floatData[0]+=n,a.floatData[1]+=o,a.floatData[2]+=p,a.floatData[3]+=q}return!0},k.prototype._drawEdges=function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s=a.getStartLine(),t=a.getStopLine(),u=a.getLongXIncrement(),v=a.getShortXIncrement(),w=a.getLongZIncrement(),x=a.getShortZIncrement(),y=c[0],z=c[1],A=.5,B=A,C=.5;if(b[0])if(b[1])for(n=y,d=a.getShortX(),e=a.getLongX(),f=a.getShortZ(),g=a.getLongZ(),l=v,m=u,j=d+Math.abs(.5*l),n?(k=e+Math.abs(C*m),B=-A):k=e-Math.abs(.5*m),h=j+A,i=k-B,a.setLongX(i+m),a.setShortX(h+l),h=Math.ceil(h),i=Math.floor(i),a.floatData[3]+=x,a.floatData[2]+=w,this._fillPixels(h,i,s,f,g),s++,o=s;t>=o;o++)d=a.getShortX(),e=a.getLongX(),f=a.getShortZ(),g=a.getLongZ(),h=Math.ceil(d),i=Math.floor(e),p=h-d,q=e-d,r=p/q,f=(1-r)*f+r*g,q=i-h+1,r=.5/q,f=(1-r)*f+r*g,this._fillPixels(h,i,o,f,g),a.floatData[0]+=u,a.floatData[1]+=v,a.floatData[2]+=w,a.floatData[3]+=x;else for(n=y,d=a.getShortX(),e=a.getLongX(),f=a.getShortZ(),g=a.getLongZ(),l=v,m=u,j=d+Math.abs(.5*l),n?(k=e+Math.abs(C*m),B=-A):k=e-Math.abs(.5*m),h=j+A,i=k-B,a.setLongX(i+m),a.setShortX(h+l),h=Math.ceil(h),i=Math.floor(i),a.floatData[3]+=x,a.floatData[2]+=w,this._fillPixels(h,i,s,f,g),s++,o=s;t>=o;o++)d=a.getShortX(),e=a.getLongX(),f=a.getShortZ(),g=a.getLongZ(),h=Math.ceil(d),i=Math.floor(e),p=e-i,q=e-d,r=p/q,g=(1-r)*g+r*f,q=i-h+1,r=.5/q,g=(1-r)*g+r*f,this._fillPixels(h,i,o,f,g),a.floatData[0]+=u,a.floatData[1]+=v,a.floatData[2]+=w,a.floatData[3]+=x;else if(b[1])for(n=z,d=a.getLongX(),e=a.getShortX(),f=a.getLongZ(),g=a.getShortZ(),l=u,m=v,j=d+Math.abs(.5*l),n?(k=e+Math.abs(C*m),B=-A):k=e-Math.abs(.5*m),h=j+A,i=k-B,a.setShortX(i+m),a.setLongX(h+l),h=Math.ceil(h),i=Math.floor(i),a.floatData[2]+=x,a.floatData[3]+=w,this._fillPixels(h,i,s,f,g),s++,o=s;t>=o;o++)d=a.getLongX(),e=a.getShortX(),f=a.getLongZ(),g=a.getShortZ(),h=Math.ceil(d),i=Math.floor(e),p=h-d,q=e-d,r=p/q,f=(1-r)*f+r*g,q=i-h+1,r=.5/q,f=(1-r)*f+r*g,this._fillPixels(h,i,o,f,g),a.floatData[0]+=u,a.floatData[1]+=v,a.floatData[2]+=w,a.floatData[3]+=x;else for(n=z,d=a.getLongX(),e=a.getShortX(),f=a.getLongZ(),g=a.getShortZ(),l=u,m=v,j=d+Math.abs(.5*l),n?(k=e+Math.abs(C*m),B=-A):k=e-Math.abs(.5*m),h=j+A,i=k-B,a.setShortX(i+m),a.setLongX(h+l),h=Math.ceil(h),i=Math.floor(i),a.floatData[2]+=x,a.floatData[3]+=w,this._fillPixels(h,i,s,f,g),s++,o=s;t>=o;o++)d=a.getLongX(),e=a.getShortX(),f=a.getLongZ(),g=a.getShortZ(),h=Math.ceil(d),i=Math.floor(e),p=e-i,q=e-d,r=p/q,g=(1-r)*g+r*f,q=i-h+1,r=.5/q,g=(1-r)*g+r*f,this._fillPixels(h,i,o,f,g),a.floatData[0]+=u,a.floatData[1]+=v,a.floatData[2]+=w,a.floatData[3]+=x},k.prototype._createEdgeData=function(a,b){var c=Math.ceil(b.y0),d=Math.floor(b.y1),e=a.zIncrement,f=b.zIncrement,g=b.xIncrement,h=a.xIncrement;if(c>d)return!1;if(c===d){if(!b.betweenFaces)return!1;g=0,h=0}var i=(b.y0-a.y0)/a.dy,j=a.x0+a.dx*i,k=a.z0+a.dz*i,l=b.x0,m=b.z0,n=c-b.y0;return j+=n*h,l+=n*g,k+=n*e,m+=n*f,0>c&&(j+=-c*h,l+=-c*g,k+=-c*e,m+=-c*f,c=0),d=Math.min(this._clipY,d),x.setData([c,d,j,l,k,m,h,g,e,f]),!0},k.prototype._isScanlineOccluded=function(a,b,c,d,e){if(a>b||0>b||a>this._clipX)return!0;var f;0>a&&(f=-a/(b-a+1),d=(1-f)*d+f*e,a=0);var g=b-this._clipX+1;g>0&&(f=g/(b-a+1),e=(1-f)*e+f*d,b=this._clipX);for(var h=c*this.width+a,i=d,j=(e-d)/(b-a),k=a;b>=k;k++){if(this._colorData.set([Math.min(255*i+50,255),0,0],4*h),i>this._depthData[h])return!1;h++,i+=j}return!0},k.prototype._fillPixels=function(a,b,c,d,e){if(!(0>b||a>this._clipX||a>b)){var f;0>a&&(f=-a/(b-a+1),d=(1-f)*d+f*e,a=0);var g=b-this._clipX+1;g>0&&(f=g/(b-a+1),e=(1-f)*e+f*d,b=this._clipX);for(var h=c*this.width+a,i=d,j=(e-d)/(b-a),k=a;b>=k;k++)i>this._depthData[h]&&(this._depthData[h]=i),h++,i+=j}},k.prototype.copyDepthToColor=function(){for(var a=0,b=0;b<this._depthData.length;b++){var c=this._depthData[b];c>0?(c*=255,this._colorData[a]=c,this._colorData[++a]=c,this._colorData[++a]=c,this._colorData[++a]=255):(this._colorData[a]=0,this._colorData[++a]=0,this._colorData[++a]=0,this._colorData[++a]=0),a++}},k.prototype.getColorData=function(){return this._colorData},k.prototype.getDepthData=function(){return this._depthData},k.prototype.calculateDifference=function(a,b){for(var c=0;c<this._depthData.length;c++){var d=this._depthData[c],e=4*c,f=a[e],g=a[e+1],h=a[e+2],i=a[e+3];d>0&&!(f>256*b[0]||g>256*b[1]||h>256*b[2]||i>256*b[3])&&(this._colorData[e]=255,this._colorData[e+1]=0,this._colorData[e+2]=0,this._colorData[e+3]=255)}},k}),define("goo/entities/systems/OcclusionCullingSystem",["goo/entities/systems/System","goo/renderer/SimplePartitioner","goo/renderer/scanline/SoftwareRenderer"],function(a,b,c){"use strict";function d(d){a.call(this,"OcclusionCullingSystem",["MeshRendererComponent"]),d=d||{},this.partitioner=new b,this.renderList=[],this.occluderList=[],this.camera=d.camera,this.renderer=new c({width:d.width,height:d.height,camera:d.camera})}return d.prototype=Object.create(a.prototype),d.prototype.inserted=function(a){this.partitioner&&this.partitioner.added(a)},d.prototype.deleted=function(a){this.partitioner&&this.partitioner.removed(a)},d.prototype.process=function(a){this.renderList.length=0,this.partitioner.process(this.camera,a,this.renderList),this._addVisibleOccluders(),this.renderer.render(this.occluderList),this.renderer.copyDepthToColor(),this.renderer.performOcclusionCulling(this.renderList)},d.prototype._addVisibleOccluders=function(){this.occluderList.length=0;for(var a=0;a<this.renderList.length;a++){var b=this.renderList[a];b.getComponent("OccluderComponent")&&this.occluderList.push(b)}},d}),define("goo/entities/systems/PickingSystem",["goo/entities/systems/System"],function(a){"use strict";function b(b){a.call(this,"PickingSystem",["MeshRendererComponent","TransformComponent"]),this.passive=!0,this.pickRay=null,this.onPick=null,b=b||{},this.setPickLogic(b.pickLogic||null)}return b.prototype=Object.create(a.prototype),b.prototype.setPickLogic=function(a){this.pickLogic=a,a&&-1===this.interests.indexOf("MeshDataComponent")&&this.interests.push("MeshDataComponent")},b.prototype.inserted=function(a){a.meshRendererComponent.isPickable&&this.pickLogic&&this.pickLogic.added(a)},b.prototype.deleted=function(a){this.pickLogic&&this.pickLogic.removed(a)},b.prototype.process=function(a){if(this.pickRay&&this.onPick){for(var b=[],c=0;c<a.length;c++){var d=a[c],e=d.meshRendererComponent;if(e.isPickable)if(this.pickLogic){this.pickLogic.isConstructed(d)||this.pickLogic.added(d);var f=this.pickLogic.getPickResult(this.pickRay,d);f&&f.distances&&f.distances.length&&b.push({entity:d,intersection:f})}else if(e.worldBound){var f=e.worldBound.intersectsRayWhere(this.pickRay);f&&f.distances.length&&b.push({entity:d,intersection:f})}}b.sort(function(a,b){return a.intersection.distances[0]-b.intersection.distances[0]}),this.onPick(b)}},b}),define("goo/entities/systems/PortalSystem",["goo/entities/systems/System"],function(a){"use strict";function b(b,c){a.call(this,"PortalSystem",["MeshRendererComponent","MeshDataComponent","PortalComponent"]),this.renderer=b,this.renderSystem=c,this.renderList=[]}return b.prototype=Object.create(a.prototype),b.prototype.process=function(a){for(var b=0;b<a.length;b++){var c=a[b],d=c.portalComponent;if(d.options.autoUpdate||d.doUpdate){d.doUpdate=!1;var e=d.camera,f=d.target,g=d.secondaryTarget,h=d.overrideMaterial;if(d.alwaysRender||c.isVisible){this.render(this.renderer,e,f,h);var i=c.meshRendererComponent.materials[0];if(i.setTexture("DIFFUSE_MAP",f),d.options.preciseRecursion){var j=f;d.target=g,d.secondaryTarget=j}}}}},b.prototype.render=function(a,b,c,d){a.updateShadows(this.renderSystem.partitioner,this.renderSystem.entities,this.renderSystem.lights);for(var e=0;e<this.renderSystem.preRenderers.length;e++){var f=this.renderSystem.preRenderers[e];f.process(a,this.renderSystem.entities,this.renderSystem.partitioner,b,this.renderSystem.lights)}if(this.renderSystem.partitioner.process(b,this.renderSystem.entities,this.renderList),this.renderSystem.composers.length>0)for(var e=0;e<this.renderSystem.composers.length;e++){var g=this.renderSystem.composers[e];g.render(a,this.renderSystem.currentTpf,b,this.renderSystem.lights,null,!0)}else a.render(this.renderList,b,this.renderSystem.lights,c,!0,d)},b}),define("goo/entities/systems/TextSystem",["goo/entities/systems/System","goo/shapes/TextureGrid","goo/entities/components/MeshDataComponent"],function(a,b,c){"use strict";function d(){a.call(this,"TextSystem",["TextComponent"])}return d.prototype=Object.create(a.prototype),d.prototype.process=function(a){for(var d=0;d<a.length;d++){var e=a[d],f=e.textComponent;if(f.dirty){if(e.hasComponent("MeshDataComponent"))e.getComponent("MeshDataComponent").meshData=b.fromString(f.text);else{var g=b.fromString(f.text),h=new c(g);e.setComponent(h)}this.dirty=!1}}},d}),define("goo/loaders/handlers/ConfigHandler",[],function(){"use strict";function a(a,b,c,d){this.world=a,this.getConfig=b,this.updateObject=c,this.options=d}return a.prototype.update=function(){},a.prototype.remove=function(){},a.handlerClasses={},a.getHandler=function(b){return a.handlerClasses[b]},a._registerClass=function(b,c){return c._type=b,a.handlerClasses[b]=c},a}),define("goo/loaders/handlers/ComponentHandler",[],function(){"use strict";function a(a,b,c,d){this.world=a,this.getConfig=b,this.updateObject=c,this.options=d}return a.prototype._prepare=function(){},a.prototype._create=function(){throw new Error("ComponentHandler._create is abstract, use ComponentHandler.getHandler(type)")},a.prototype.update=function(a,b){this._prepare(b);var c;return c=null==a||null==a[this.constructor._type+"Component"]?this._create(a,b):a[this.constructor._type+"Component"]},a.prototype.remove=function(a){return null!=a&&a.clearComponent(this.constructor._type+"Component"),a},a.handlerClasses={},a.getHandler=function(b){return a.handlerClasses[b]},a._registerClass=function(b,c){c._type=b,a.handlerClasses[b]=c},a}),define("goo/util/StringUtil",[],function(){"use strict";var a={};return a.endsWith=function(a,b){return-1!==a.indexOf(b,a.length-b.length)},a.startsWith=function(a,b){return 0===a.indexOf(b)},a.capitalize=function(a){return a.charAt(0).toUpperCase()+a.substring(1)},a.uncapitalize=function(a){return a.charAt(0).toLowerCase()+a.substring(1)},a.getIndexedName=function(a,b,c){c||(c="_");var d,e=new RegExp(a+"("+c+"\\d+)?"),f=0;for(d in b){var g=b[d],h=e.exec(g);if(h)if(h.length>1&&h[1]){var i=parseInt(h[1].substring(c.length),10);i>=f&&(f=i+1)}else f=1}return a+c+f},a.getUniqueName=function(b,c,d){return-1===c.indexOf(b)?b:a.getIndexedName(b,c,d)},a.toAscii=function(a){return a.replace(/([^\x00-\x7F])*/g,"")},a.hashCode=function(a){var b=0;if(0===a.length)return b;for(var c=0;c<a.length;c++){var d=a.charCodeAt(c);b=(b<<5)-b+d,b&=b}return btoa(b).replace("/","_").replace("+","-")},a}),define("goo/util/PromiseUtil",["goo/util/rsvp"],function(a){"use strict";
var b={};return b.createDummyPromise=function(b,c){var d;return d=new a.Promise,c?d.reject(c):d.resolve(b),d},b.defer=function(b,c){var d,e,f;return f=new a.Promise,c.apply?(d=new a.Promise,e=d.then(function(){return c()}),setTimeout(function(){d.resolve()},b),e):(setTimeout(function(){f.resolve(c)},b),f)},b}),define("goo/util/ObjectUtil",[],function(){"use strict";var a={},b=Array.prototype,c=Object.prototype,d={},e=b.slice,f=c.toString,g=c.hasOwnProperty,h=Array.isArray,i=Object.keys,j=b.forEach;a.has=function(a,b){return g.call(a,b)},a.defaults=function(a){return k(e.call(arguments,1),function(b){if(b)for(var c in b)("undefined"==typeof a[c]||null===a[c])&&(a[c]=b[c])}),a},a.extend=function(a){return k(e.call(arguments,1),function(b){if(b)for(var c in b)a[c]=b[c]}),a},a.isObject=function(a){return a===Object(a)},a.clone=function(b){return a.isObject(b)?a.isArray(b)?b.slice():a.extend({},b):b},a.keys=i||function(b){if(b!==Object(b))throw new TypeError("Invalid object");var c=[];for(var d in b)a.has(b,d)&&(c[c.length]=d);return c},a.isArray=h||function(a){return"[object Array]"===f.call(a)};var k=a.each=a.forEach=function(b,c,e){if("undefined"!=typeof b&&null!==b)if(j&&b.forEach===j)b.forEach(c,e);else if(b.length===+b.length){for(var f=0,g=b.length;g>f;f++)if(c.call(e,b[f],f,b)===d)return}else for(var h in b)if(a.has(b,h)&&c.call(e,b[h],h,b)===d)return};return a.deepClone=function(b){if(!b)return b;var c,d=[Number,String,Boolean];if(d.forEach(function(a){b instanceof a&&(c=a(b))}),"undefined"==typeof c)if("[object Array]"===Object.prototype.toString.call(b))c=[],b.forEach(function(b,d){c[d]=a.deepClone(b)});else if("object"==typeof b)if(b.nodeType&&"function"==typeof b.cloneNode)var c=b.cloneNode(!0);else if(b.prototype)c=b;else if(b instanceof Date)c=new Date(b);else{c={};for(var e in b)c[e]=a.deepClone(b[e])}else c=b;return c},a.indexOf=function(a,b){for(var c=0;c<a.length;c++)if(c in a&&a[c]===b)return c;return-1},a}),define("goo/loaders/handlers/CameraComponentHandler",["goo/loaders/handlers/ComponentHandler","goo/entities/components/CameraComponent","goo/renderer/Camera","goo/util/rsvp","goo/util/PromiseUtil","goo/util/ObjectUtil"],function(a,b,c,d,e,f){"use strict";function g(){a.apply(this,arguments)}return g.prototype=Object.create(a.prototype),a._registerClass("camera",g),g.prototype.constructor=g,g.prototype._prepare=function(a){return f.defaults(a,{fov:45,near:1,far:1e4})},g.prototype._create=function(a){var d=new c(45,1,1,1e3),e=new b(d);return a.setComponent(e),e},g.prototype.update=function(b,c){var d=a.prototype.update.call(this,b,c);return d.camera.setFrustumPerspective(c.fov,c.aspect||1,c.near,c.far),e.createDummyPromise(d)},g.prototype.remove=function(b){return null!=b&&null!=b.cameraComponent&&null!=b.cameraComponent.camera&&this.world.removeEntity(b.cameraComponent.camera),a.prototype.remove.call(this,b)},g}),define("goo/loaders/handlers/EntityHandler",["goo/loaders/handlers/ConfigHandler","goo/loaders/handlers/ComponentHandler","goo/util/rsvp","goo/util/PromiseUtil","goo/util/ObjectUtil","goo/entities/EntityUtils"],function(a,b,c,d,e,f){"use strict";function g(){a.apply(this,arguments)}return g.prototype=Object.create(a.prototype),a._registerClass("entity",g),g.prototype._prepare=function(){},g.prototype._create=function(a){var b=this.world.createEntity(a);return b.ref=a,b},g.prototype.update=function(a,g,h){function i(b){return b.ref===a}var j=this.world.entityManager.getEntityByName(a);if(!j){var k=this.world._addedEntities.filter(i);k&&(j=k[0])}j||(j=this._create(a)),g.hidden?f.hide(j):f.show(j);var l=[];for(var m in g.components){var n=g.components[m],o=b.getHandler(m);if(o){this._componentHandlers||(this._componentHandlers={});var p=this._componentHandlers[m];p?e.extend(p,{world:this._world,getConfig:this.getConfig,updateObject:this.updateObject,options:e.clone(this.options)}):p=this._componentHandlers[m]=new o(this.world,this.getConfig,this.updateObject,this.options);var q=p.update(j,n,h);q&&q.then?l.push(q):console.error("Handler for "+m+" did not return promise")}else console.warn("No componentHandler for "+m)}return l.length?c.all(l).then(function(){return j}):(console.error("No promises in "+a+" ",g),d.createDummyPromise(j))},g.prototype.remove=function(a){var b=this.world.entityManager.getEntityByName(a);"object"==typeof b&&this.world.removeEntity(b)},g}),define("goo/loaders/handlers/LightComponentHandler",["goo/loaders/handlers/ComponentHandler","goo/entities/components/LightComponent","goo/renderer/light/PointLight","goo/renderer/light/SpotLight","goo/renderer/light/DirectionalLight","goo/math/Vector","goo/util/rsvp","goo/util/PromiseUtil","goo/util/ObjectUtil"],function(a,b,c,d,e,f,g,h,i){"use strict";function j(){a.apply(this,arguments)}return j.prototype=Object.create(a.prototype),j.prototype.constructor=j,a._registerClass("light",j),j.prototype._prepare=function(a){i.defaults(a,{direction:[0,0,0],color:[1,1,1,1],attenuate:!0,shadowCaster:!1}),"DirectionalLight"!==a.type&&(a.range=void 0!==a.range?a.range:1e3),a.shadowCaster&&(a.shadowSettings=a.shadowSettings||{},i.defaults(a.shadowSettings,{type:"Blur",projection:"DirectionalLight"===a.type?"Parallel":"Perspective",fov:55,size:400,near:1,far:1e3,resolution:[512,512],upVector:[0,1,0],darkness:.5}))},j.prototype._create=function(a,f){var g;switch(f.type){case"SpotLight":g=new d;break;case"DirectionalLight":g=new e;break;default:g=new c}var h=new b(g);return a.setComponent(h),h},j.prototype.update=function(b,c){var d=a.prototype.update.call(this,b,c),e=d.light;for(var g in c){var j=c[g];if(e.hasOwnProperty(g))if("shadowSettings"===g)for(var g in j){var k=j[g];e.shadowSettings[g]instanceof f?e.shadowSettings[g].set(k):e.shadowSettings[g]=i.clone(k)}else e[g]instanceof f?e[g].set(j):e[g]=i.clone(j)}return h.createDummyPromise(d)},j}),define("goo/loaders/handlers/MaterialHandler",["goo/loaders/handlers/ConfigHandler","goo/renderer/Material","goo/renderer/Util","goo/renderer/shaders/ShaderLib","goo/util/rsvp","goo/util/PromiseUtil","goo/util/ObjectUtil"],function(a,b,c,d,e,f,g){"use strict";function h(){a.apply(this,arguments),this._objects={}}return h.prototype=Object.create(a.prototype),a._registerClass("material",h),h.ENGINE_SHADER_PREFIX="GOO_ENGINE_SHADERS/",h.prototype._prepare=function(a){a.blendState||(a.blendState={}),g.defaults(a.blendState,{blending:"NoBlending",blendEquation:"AddEquation",blendSrc:"SrcAlphaFactor",blendDst:"OneMinusSrcAlphaFactor"}),a.cullState||(a.cullState={}),g.defaults(a.cullState,{enabled:!0,cullFace:"Back",frontFace:"CCW"}),a.depthState||(a.depthState={}),g.defaults(a.depthState,{enabled:!0,write:!0}),null==a.renderQueue&&(a.renderQueue=-1)},h.prototype._create=function(a){return this._objects||(this._objects={}),this._objects[a]=new b(a)},h.prototype.update=function(a,b){var d=this,f=this._objects[a]||this._create(a);return this._prepare(b),this._getShaderObject(b.shaderRef,b.wireframe).then(function(h){if(!h)return console.warn("Unknown shader",b.shaderRef,"- not updating material",a),void 0;b.wireframe&&(f.wireframe=b.wireframe),f.blendState=c.clone(b.blendState),f.cullState=c.clone(b.cullState),f.depthState=c.clone(b.depthState),f.dualTransparency=b.dualTransparency||!1,f.renderQueue=-1===b.renderQueue?null:b.renderQueue,f.shader=h,f.uniforms={};for(var i in b.uniforms)"undefined"==typeof b.uniforms[i].enabled?f.uniforms[i]=g.clone(b.uniforms[i]):b.uniforms[i].enabled?f.uniforms[i]=g.clone(b.uniforms[i].value):delete f.uniforms[i];var j=[],k=function(a,b){return j.push(d.getConfig(b).then(function(c){return d.updateObject(b,c,d.options).then(function(c){return{type:a,ref:b,texture:c}})}))};for(var l in b.texturesMapping){var m=b.texturesMapping[l];"string"==typeof m?k(l,m):m&&m.enabled?k(l,m.textureRef):f.removeTexture(l)}return j.length?e.all(j).then(function(a){for(var b=0;b<a.length;b++){var c=a[b];c.texture&&f.setTexture(c.type,c.texture)}return f}).then(null,function(a){return console.error("Error loading textures: "+a)}):f})},h.prototype.remove=function(a){return delete this._objects[a]},h.prototype._getShaderObject=function(a,c){var g=this;if(c){var i=new e.Promise,j=b.createShader(d.simple);return i.resolve(j),i}if(a){if(0===a.indexOf(h.ENGINE_SHADER_PREFIX)){var k=a.slice(h.ENGINE_SHADER_PREFIX.length),j=b.createShader(d[k]);return f.createDummyPromise(j)}return this.getConfig(a).then(function(b){return g.updateObject(a,b,g.options)})}var l=b.createShader(d.texturedLit,"DefaultShader");return f.createDummyPromise(l)},h}),define("goo/util/ShapeCreatorMemoized",["goo/shapes/Box","goo/shapes/Quad","goo/shapes/Sphere","goo/shapes/Cylinder","goo/shapes/Torus","goo/shapes/Disk"],function(a,b,c,d,e,f){"use strict";function g(){}function h(a,b){var c=Object.keys(b),d=c.map(function(a){return a+""+b[a]}).join("");return a+d}function i(a,b,c){var d=h(a,b);if(j[d])return j[d];var e=c();return j[d]=e,e}var j={};return g.createQuad=function(a,c){var d=1,e=1,f=1,g=1;return c&&d===c.xExtent&&e===c.yExtent&&f===c.tileX&&g===c.tileY?c:i("quad",{},function(){return new b(d,e,f,g)})},g.createBox=function(b,c){var d=1,e=1,f=1,g=1,h=1;return c&&d===c.xExtent&&e===c.yExtent&&f===c.zExtent&&g===c.tileX&&h===c.tileY?c:i("box",{},function(){return new a(d,e,f,g,h)})},g.createSphere=function(a,b){a=a||{},a.zSamples=a.zSamples||8,a.radialSamples=a.radialSamples||8,a.textureMode=a.textureMode||"Projected";var d=1;return b&&a.zSamples===b.zSamples-1&&a.radialSamples===b.radialSamples&&a.textureMode===b.textureMode.name&&d===b.radius?b:i("sphere",a,function(){return new c(a.zSamples,a.radialSamples,d,a.textureMode)})},g.createCylinder=function(a,b){a=a||{},a.radialSamples=a.radialSamples||8;var c=1;return b&&a.radialSamples===b.radialSamples&&c===b.radius?b:i("cylinder",a,function(){return new d(a.radialSamples,c)})},g.createTorus=function(a,b){a=a||{},a.radialSamples=a.radialSamples||8,a.circleSamples=a.circleSamples||12,a.tubeRadius=a.tubeRadius||.2;var c=1;return b&&a.radialSamples===b._radialSamples&&a.circleSamples===b._circleSamples&&a.tubeRadius===b._tubeRadius&&c===b._centerRadius?b:new e(a.circleSamples,a.radialSamples,a.tubeRadius,c)},g.createDisk=function(a,b){a=a||{},a.radialSamples=a.radialSamples||8,a.pointiness="undefined"==typeof a.pointiness?0:a.pointiness;var c=1;return b&&a.radialSamples===b.nSegments&&a.pointiness===b.pointiness&&c===b.radius?b:a.pointiness===Math.floor(a.pointiness)?i("disk",a,function(){return new f(a.radialSamples,c,a.pointiness)}):new f(a.radialSamples,c,a.pointiness)},g}),define("goo/loaders/handlers/MeshDataComponentHandler",["goo/loaders/handlers/ComponentHandler","goo/entities/components/MeshDataComponent","goo/renderer/bounds/BoundingBox","goo/util/ShapeCreatorMemoized","goo/util/rsvp","goo/util/PromiseUtil","goo/util/ObjectUtil","goo/util/StringUtil"],function(a,b,c,d,e,f,g,h){"use strict";function i(){a.apply(this,arguments)}return i.prototype=Object.create(a.prototype),a._registerClass("meshData",i),i.prototype._prepare=function(a){return g.defaults(a,{meshRef:null})},i.prototype._create=function(){},i.prototype.update=function(g,i){var j,k,l=this;a.prototype.update.call(this,g,i);var m;if(i.shape&&(m=d["create"+h.capitalize(i.shape)]),m instanceof Function){var n=m(i.shapeOptions,g.meshDataComponent?g.meshDataComponent.meshData:null);j=f.createDummyPromise(n),k=f.createDummyPromise()}else{var o=i.meshRef;o||console.error("No meshRef in meshDataComponent for "+g.ref),j=this.getConfig(o).then(function(a){return l.updateObject(o,a)});var p=i.poseRef||i.pose;k=p?this.getConfig(p).then(function(a){return l.updateObject(p,a)}):f.createDummyPromise()}return e.all([j,k]).then(function(a){var d=a[0],e=a[1],f=new b(d);if(d.boundingBox){var h=d.boundingBox.min,i=d.boundingBox.max,j=[i[0]-h[0],i[1]-h[1],i[2]-h[2]],k=[.5*(i[0]+h[0]),.5*(i[1]+h[1]),.5*(i[2]+h[2])],l=new c;l.xExtent=j[0]/2,l.yExtent=j[1]/2,l.zExtent=j[2]/2,l.center.seta(k),f.modelBound=l,f.autoCompute=!1}return e&&(f.currentPose=e),g.clearComponent("MeshDataComponent"),g.setComponent(f),f})},i}),define("goo/loaders/JsonUtils",["goo/renderer/BufferUtils","goo/math/Transform","goo/math/Matrix3x3","goo/math/Matrix4x4","goo/math/Vector3","goo/math/Quaternion"],function(a,b,c,d,e,f){"use strict";function g(){}g.fillAttributeBufferFromCompressedString=function(a,b,c,d,e){var f,h,i,j,k,l=b.getAttributeBuffer(c),m=d.length,n=a.length/d.length;for(k=0;m>k;k++)if(0===d[k])return;for(k=0;m>k;k++)for(f=0,j=0;n>j;j++){h=a.charCodeAt(j+k*n),i=j*m+k,f+=g.unzip(h);var o=(f+e[k])*d[k];l[i]=o}},g.fillAttributeBuffer=function(a,b,c){for(var d=b.getAttributeBuffer(c),e=0;e<a.length;e++)d[e]=a[e]},g.getIntBuffer=function(b,c){var d=a.createIndexBuffer(b.length,c);return d.set(b),d};var h=61404;return g.rewrap=function(a){var b=a%h;return 0>b&&(b+=h),b},g.getIntBufferFromCompressedString=function(b,c){for(var d=0,e=a.createIndexBuffer(b.length,c),f=0;f<b.length;++f){var h=b.charCodeAt(f),i=d+g.unzip(h);d=i,e[f]=this.rewrap(i)}return e},g.unzip=function(a){return a>=57344&&(a-=2048),a-=35,a=a>>1^-(1&a)},g.parseTransform=function(a){var c=new b;return c.translation=g.parseVector3(a.translation),c.scale=g.parseVector3(a.scale),c.rotation=g.parseMatrix3(a.rotation),c},g.parseTransformQuat=function(a){var c=new b;return c.translation=g.parseVector3(a.translation),c.scale=g.parseVector3(a.scale),c.rotation=g.parseQuaternion(a.rotation).toRotationMatrix(),c},g.parseTransformEuler=function(a){var c=new b;c.translation=g.parseVector3(a.translation),c.scale=g.parseVector3(a.scale);var d=g.parseVector3(a.rotation);return c.setRotationXYZ(d.x,d.y,d.z),c},g.parseTransformMatrix=function(a){var c=new b;return c.matrix=g.parseMatrix4(a.matrix),c},g.parseMatrix3=function(a){var b=new c;return b.e00=a[0],b.e01=a[1],b.e02=a[2],b.e10=a[3],b.e11=a[4],b.e12=a[5],b.e20=a[6],b.e21=a[7],b.e22=a[8],b},g.parseMatrix4=function(a){var b=new d;return b.e00=a[0],b.e01=a[1],b.e02=a[2],b.e03=a[3],b.e10=a[4],b.e11=a[5],b.e12=a[6],b.e13=a[7],b.e20=a[8],b.e21=a[9],b.e22=a[10],b.e23=a[11],b.e30=a[12],b.e31=a[13],b.e32=a[14],b.e33=a[15],b},g.parseQuaternion=function(a){var b=new f;return b.x=a[0],b.y=a[1],b.z=a[2],b.w=a[3],b},g.parseVector3=function(a){return new e(a[0],a[1],a[2])},g.parseChannelTimes=function(a,b){var c=a.times;if(c){if(b){var d=a.timeOffsetScale,e=d[0],f=d[1];return g.parseFloatArrayFromCompressedString(c,[f],[e])}return c}return null},g.parseFloatLERPValues=function(a,b){var c=a.values;if(c){if(b){var d=a.offsetScale,e=d[0],f=d[1];return g.parseFloatArrayFromCompressedString(c,[f],[e])}return c}return null},g.parseRotationSamples=function(a,b,c){var d=a.rotationSamples;if(d){if(c){var e=1-(b+1>>1),f=1/-e;return g.parseFloatArrayFromCompressedString(d,[f,f,f,f],[e,e,e,e])}return g.parseQuaternionSamples(d)}return null},g.parseTranslationSamples=function(a,b,c){var d=a.uniformTranslation;if(d){for(var e=d,f=e[0],h=e[1],i=e[2],j=[],k=0;b>k;k++)j[3*k+0]=f,j[3*k+1]=h,j[3*k+2]=i;return j}var l=a.translationSamples;if(l){if(c){var m=a.translationOffsetScale,n=m[0],o=m[1],p=m[2],q=m[3];return g.parseFloatArrayFromCompressedString(l,[q,q,q],[n,o,p])}return g.parseVector3Samples(l)}return null},g.parseScaleSamples=function(a,b,c){var d=a.uniformScale;if(d){for(var e=d,f=e[0],h=e[1],i=e[2],j=[],k=0;b>k;k++)j[3*k+0]=f,j[3*k+1]=h,j[3*k+2]=i;return j}var l=a.scaleSamples;if(l){if(c){var m=a.scaleOffsetScale,n=m[0],o=m[1],p=m[2],e=m[3];return g.parseFloatArrayFromCompressedString(l,[e,e,e],[n,o,p])}return g.parseVector3Samples(l)}return null},g.parseQuaternionSamples=function(a){var b=a;if(!b)return null;for(var c=[],d=new f,e=0,g=b.length;g>e;e++){var h=b[e];if("*"===h)c[4*e+0]=d.x,c[4*e+1]=d.y,c[4*e+2]=d.z,c[4*e+3]=d.w;else if(h instanceof Array&&4===h.length){var i=h[0],j=h[1],k=h[2],l=h[3];d.set(i,j,k,l),c[4*e+0]=d.x,c[4*e+1]=d.y,c[4*e+2]=d.z,c[4*e+3]=d.w}}return c},g.parseVector3Samples=function(a){var b=a;if(!b)return null;for(var c=[],d=new e,f=0,g=b.length;g>f;f++){var h=b[f];if("*"===h)c[3*f+0]=d.x,c[3*f+1]=d.y,c[3*f+2]=d.z;else if(h instanceof Array&&3===h.length){var i=h[0],j=h[1],k=h[2];d.set(i,j,k),c[3*f+0]=d.x,c[3*f+1]=d.y,c[3*f+2]=d.z}}return c},g.parseFloatArrayFromCompressedString=function(a,b,c){var d,e,f,h,i,j=a,k=[],l=b.length,m=j.length/b.length;for(i=0;l>i;i++)for(d=0,h=0;m>h;h++){e=j.charCodeAt(h+i*m),f=h*l+i,d+=g.unzip(e);var n=(d+c[i])*b[i];k[f]=n}return k},g}),define("goo/loaders/handlers/MeshDataHandler",["goo/loaders/handlers/ConfigHandler","goo/renderer/MeshData","goo/animation/SkeletonPose","goo/loaders/JsonUtils","goo/util/PromiseUtil","goo/util/ArrayUtil"],function(a,b,c,d,e,f){"use strict";function g(){a.apply(this,arguments),this._objects={}}return g.prototype=Object.create(a.prototype),a._registerClass("mesh",g),g.prototype.update=function(a,b){var c=this;return this._objects[a]?e.createDummyPromise(this._objects[a]):b.binaryRef?this.getConfig(b.binaryRef).then(function(d){if(!d)throw new Error("Binary mesh data was empty");return c._createMeshData(b,d).then(function(b){return c._objects[a]=b})}):this._createMeshData(b,null).then(function(b){return c._objects[a]=b})},g.prototype.remove=function(){},g.prototype._createMeshData=function(a,b){var c;a.compression&&a.compression.compressed&&(c={compressedVertsRange:a.compression.compressedVertsRange||16383,compressedColorsRange:a.compression.compressedColorsRange||255,compressedUnitVectorRange:a.compression.compressedUnitVectorRange||1023});var d=this._createMeshDataObject(a);return this._fillMeshData(d,a,b,c),e.createDummyPromise(d)},g.prototype._createMeshDataObject=function(a){var c,d,e,f,g,h,i=a.data||a;if("SkinnedMesh"===a.type?(h=4,f=b.SKINMESH):(h=0,f=b.MESH),g=i.vertexCount,0===g)return null;if(d=null!=i.indexLengths?i.indexLengths[0]:null!=i.indices?i.indices.length:0,c={},i.vertices&&i.vertices.length>0&&(c.POSITION=b.createAttribute(3,"Float")),i.normals&&i.normals.length>0&&(c.NORMAL=b.createAttribute(3,"Float")),i.tangents&&i.tangents.length>0&&(c.TANGENT=b.createAttribute(4,"Float")),i.colors&&i.colors.length>0&&(c.COLOR=b.createAttribute(4,"Float")),h>0&&i.weights&&(c.WEIGHTS=b.createAttribute(4,"Float")),h>0&&i.joints&&(c.JOINTIDS=b.createAttribute(4,"Short")),i.textureCoords&&i.textureCoords.length>0)for(var j=0;j<i.textureCoords.length;j++)c["TEXCOORD"+j]=b.createAttribute(2,"Float");return e=new b(c,g,d),e.type=f,e},g.prototype._fillMeshData=function(a,c,e,g){var h,i=this,j=c.data||c;h=a.type===b.SKINMESH?4:0;var k=function(b,h){var j;(null!=h?h.length:void 0)&&(g&&"string"==typeof h?(j=i._getCompressionOptions(b,c,g),d.fillAttributeBufferFromCompressedString(h,a,b,j.scale,j.offset)):e?a.getAttributeBuffer(b).set(f.getTypedArray(e,h)):d.fillAttributeBuffer(h,a,b))};if(k(b.POSITION,j.vertices),k(b.NORMAL,j.normals),k(b.TANGENT,j.tangents),k(b.COLOR,j.colors),a.type===b.SKINMESH&&k(b.WEIGHTS,j.weights),null!=j.textureCoords&&j.textureCoords.length>0)for(var l=j.textureCoords,m=0;m<l.length;m++){var n=l[m],o="TEXCOORD"+m;k(o,n.UVs||n)}if(h>0&&null!=j.joints&&j.joints.length>0){var p=a.getAttributeBuffer(b.JOINTIDS),q=this._getIntBuffer(j.joints,32767,e,g);if(a.type===b.SKINMESH){for(var r=[],s=0,t=0;t<q.length;t++){var u=q[t];void 0===r[u]&&(r[u]=s++),p.set([r[u]],t)}for(var v=[],u=0;u<r.length;u++){var s=r[u];null!==s&&(v[s]=u)}a.paletteMap=v,a.weightsPerVertex=h}else for(var w=0;0<q.capacity();w++)p.putCast(w,q.get(w))}if(j.indices&&a.getIndexBuffer().set(this._getIntBuffer(j.indices,j.vertexCount,e,g)),j.indexModes&&(a.indexModes=j.indexModes.slice(0)),j.indexLengths&&(a.indexLengths=j.indexLengths.slice(0)),j.boundingVolume){if("BoundingBox"!==j.boundingVolume.type)throw new Error("Bounding volume was not BoundingBox");a.boundingBox={min:j.boundingVolume.min,max:j.boundingVolume.max}}return a},g.prototype._getIntBuffer=function(a,b,c,e){return a?e?d.getIntBufferFromCompressedString(a,b):c?f.getTypedArray(c,a):d.getIntBuffer(a,b):null},g.prototype._getCompressionOptions=function(a,c,d){var e,f,g,h,i=c.data||c;if(a===b.POSITION)f=i.vertexOffsets,g={offset:[f.xOffset,f.yOffset,f.zOffset],scale:[i.vertexScale,i.vertexScale,i.vertexScale]};else if(a===b.WEIGHTS)e=0,h=1/d.compressedVertsRange,g={offset:[e],scale:[h]};else if(a===b.NORMAL)e=1-(d.compressedUnitVectorRange+1>>1),h=1/-e,g={offset:[e,e,e],scale:[h,h,h]};else if(a===b.TANGENT)e=1-(d.compressedUnitVectorRange+1>>1),h=1/-e,g={offset:[e,e,e,e],scale:[h,h,h,h]};else if(a===b.COLOR)e=0,h=1/(d.compressedColorsRange+1),g={offset:[e,e,e,e],scale:[h,h,h,h]};else if("TEXCOORD"===a.substr(0,8)){var j=parseInt(a.substr(8),10),k=i.textureCoords[j];g={offset:k.UVOffsets,scale:k.UVScales}}return g},g}),define("goo/loaders/handlers/MeshRendererComponentHandler",["goo/loaders/handlers/ComponentHandler","goo/entities/components/MeshRendererComponent","goo/renderer/Material","goo/renderer/shaders/ShaderLib","goo/util/rsvp","goo/util/PromiseUtil","goo/util/ObjectUtil"],function(a,b,c,d,e,f,g){"use strict";function h(){a.apply(this,arguments)}return h.prototype=Object.create(a.prototype),a._registerClass("meshRenderer",h),h.prototype.constructor=h,h.prototype._prepare=function(a){return g.defaults(a,{materialRefs:[],cullMode:"Dynamic",castShadows:!0,receiveShadows:!0,hidden:!1})},h.prototype._create=function(a){var c=new b;return a.setComponent(c),c},h.prototype.update=function(b,h){var i,j=this,k=a.prototype.update.call(this,b,h),l=h.materialRefs;if(l&&0!==l.length){for(var m=[],n=function(a){return m.push(j._getMaterial(a))},o=0;o<l.length;o++)n(l[o]);i=e.all(m)}else{var p=c.createShader(d.uber,"DefaultShader"),q=new c;q.shader=p,i=f.createDummyPromise([q])}return i.then(function(a){var b,c;if(k.materials&&k.materials.length){for(var d,e=0;e<k.materials.length;e++){var f=k.materials[e];if("gooSelectionIndicator"===f.name){d=f;break}}d&&a.push(d)}k.materials=a;for(b in h)c=h[b],"materials"!==b&&"hidden"!==b&&k.hasOwnProperty(b)&&(k[b]=g.clone(c));return k}).then(null,function(a){return console.error("Error handling materials "+a)})},h.prototype._getMaterial=function(a){var b=this;return this.getConfig(a).then(function(c){return b.updateObject(a,c,b.options)})},h}),define("goo/loaders/handlers/SceneHandler",["goo/loaders/handlers/ConfigHandler","goo/util/rsvp"],function(a,b){"use strict";function c(){a.apply(this,arguments)}return c.prototype=Object.create(a.prototype),a._registerClass("scene",c),c.prototype._prepare=function(){},c.prototype._create=function(){},c.prototype.update=function(a,c){var d=this,e=[];if(null!=c.entityRefs&&c.entityRefs.length){for(var f=function(a){return e.push(d.getConfig(a).then(function(b){return d.updateObject(a,b,d.options)}))},g=0;g<c.entityRefs.length;g++)f(c.entityRefs[g]);return b.all(e).then(function(a){for(var b=0;b<a.length;b++){var c=a[b];(null==d.options.beforeAdd||null==d.options.beforeAdd.apply||d.options.beforeAdd(c))&&c.addToWorld()}}).then(null,function(a){return console.error("Error updating entities: "+a)})}return console.warn("No entity refs in scene "+a),c},c.prototype.remove=function(){},c}),define("goo/loaders/handlers/ShaderHandler",["goo/loaders/handlers/ConfigHandler","goo/renderer/Material","goo/renderer/MeshData","goo/renderer/Shader","goo/renderer/shaders/ShaderBuilder","goo/util/rsvp","goo/util/ObjectUtil"],function(a,b,c,d,e,f,g){"use strict";function h(){a.apply(this,arguments)}return h.prototype=Object.create(a.prototype),a._registerClass("shader",h),h.prototype._create=function(){},h.prototype.update=function(a,c){var d;if(null!=c&&null!=c.attributes&&null!=c.uniforms){d={attributes:c.attributes,uniforms:c.uniforms};for(var h in d.uniforms){var i=d.uniforms[h];if("string"==typeof i){var j=/^function\s?\(([^\)]*)\)\s*\{(.*)\}$/,k=i.match(j);if(3===(null!=k?k.length:void 0)){var l=k[1].replace(" ","").split(","),m=k[2];d.uniforms[h]=new Function(l,m)}}}if(c.processors){d.processors=[];for(var n=0;n<c.processors.length;n++){var o=c.processors[n];if(!e[o])throw new Error("Unknown processor: "+o);d.processors.push(e[o].processor)}}c.defines&&(d.defines=c.defines)}else d=this._getDefaultShaderDefinition();var p=[this.getConfig(c.vshaderRef),this.getConfig(c.fshaderRef)];return f.all(p).then(function(e){var f,h;return h=e[0],f=e[1],h?f?(g.extend(d,{attributes:c.attributes||{},uniforms:c.uniforms||{},vshader:h,fshader:f}),b.createShader(d,a)):(console.warn("Fragment shader",c.fshaderRef,"in shader",a,"not found"),void 0):(console.warn("Vertex shader",c.vshaderRef,"in shader",a,"not found"),void 0)})},h.prototype.remove=function(){},h.prototype._getDefaultShaderDefinition=function(){return{attributes:{vertexPosition:c.POSITION,vertexNormal:c.NORMAL,vertexUV0:c.TEXCOORD0},uniforms:{viewMatrix:d.VIEW_MATRIX,projectionMatrix:d.PROJECTION_MATRIX,worldMatrix:d.WORLD_MATRIX,cameraPosition:d.CAMERA,lightPosition:d.LIGHT0,diffuseMap:d.DIFFUSE_MAP,materialAmbient:d.AMBIENT,materialDiffuse:d.DIFFUSE,materialSpecular:d.SPECULAR,materialSpecularPower:d.SPECULAR_POWER}}},h}),define("goo/loaders/handlers/SkeletonHandler",["goo/loaders/handlers/ConfigHandler","goo/animation/Joint","goo/animation/Skeleton","goo/animation/SkeletonPose","goo/loaders/JsonUtils","goo/util/PromiseUtil"],function(a,b,c,d,e,f){"use strict";function g(){a.apply(this,arguments)}return g.prototype=Object.create(a.prototype),a._registerClass("skeleton",g),g.prototype._create=function(a){for(var f=[],g=0;g<a.joints.length;g++){var h=a.joints[g],i=new b(h.name);i._index=Math.round(h.index),i._parentIndex=Math.round(h.parentIndex);var j;j=h.inverseBindPose.matrix?e.parseTransformMatrix:4===h.inverseBindPose.rotation.length?e.parseTransformQuat:3===h.inverseBindPose.rotation.length?e.parseTransformEuler:e.parseTransform,i._inverseBindPose.copy(j(h.inverseBindPose)),h.inverseBindPose.matrix||i._inverseBindPose.update(),f.push(i)}var k=new c(a.name,f),l=new d(k);return l.setToBindPose(),l},g.prototype.update=function(a,b){var c=this._create(b);return f.createDummyPromise(c)},g.prototype.remove=function(){},g}),define("goo/loaders/handlers/TextureHandler",["goo/loaders/handlers/ConfigHandler","goo/renderer/TextureCreator","goo/renderer/Texture","goo/loaders/dds/DdsLoader","goo/loaders/crunch/CrunchLoader","goo/loaders/tga/TgaLoader","goo/util/rsvp","goo/util/PromiseUtil","goo/renderer/Util","goo/util/ObjectUtil"],function(a,b,c,d,e,f,g,h,i,j){"use strict";function k(){a.apply(this,arguments),this._objects={}}return k.prototype=Object.create(a.prototype),a._registerClass("texture",k),k.prototype.constructor=k,k.loaders={dds:d,crn:e,tga:f},k.prototype._prepare=function(a){j.defaults(a,{wrapU:"Repeat",wrapV:"Repeat",magFilter:"Bilinear",minFilter:"Trilinear",anisotropy:1,offset:[0,0],repeat:[1,1],flipY:!0})},k.prototype._create=function(a){var d=this._objects[a]=new c(i.clone(b.DEFAULT_TEXTURE_2D.image));return d.image.dataReady=!1,d},k.prototype.update=function(a,c,d){var e,f,i=c.url,l=i?i.split(".").pop().toLowerCase():void 0,m=d&&d.texture&&void 0!==d.texture.reload;if("mp4"===l){f=new g.Promise;var n=new b;return e=n.loadTextureVideo(c.url,!0),h.createDummyPromise(e)}if(e=this._objects[a]||this._create(a),this._prepare(c),e.wrapS=c.wrapU,e.wrapT=c.wrapV,e.magFilter=c.magFilter,e.minFilter=c.minFilter,e.anisotropy=Math.max(c.anisotropy,1),e.offset.set(c.offset),e.repeat.set(c.repeat),e.flipY=c.flipY,e.setNeedsUpdate(),!c.url)return console.log("Texture "+a+" has no url"),h.createDummyPromise(e);if(!m&&(c.url===e.a||e.image&&e.image.src&&c.url===e.image.src.slice(-c.url.length)))return h.createDummyPromise(e);if(l in k.loaders){var o=new k.loaders[l];e.a=i,f=this.getConfig(i).then(function(a){if(a&&a.preloaded)j.extend(e.image,a.image),e.format=a.format,e.needsUpdate=!0;else{if(!o.load)throw new Error("Loader for type "+l+" has no load() function");o.load(a,e,c.flipY,0,a.byteLength)}return e}).then(null,function(a){console.error("Error loading texture: ",a)})}else{if("jpg"!==l&&"jpeg"!==l&&"png"!==l&&"gif"!==l)throw new Error("Unknown texture type "+l);f=this.getConfig(i,m).then(function(a){return e.setImage(a),e}).then(null,function(a){console.error("Error loading texture: ",a)})}return this.options&&this.options.dontWaitForTextures?h.createDummyPromise(e):f},k.prototype.remove=function(a){return console.log("Deleting texture "+a),delete this._objects[a]},k}),define("goo/loaders/handlers/TransformComponentHandler",["goo/loaders/handlers/ComponentHandler","goo/entities/components/TransformComponent","goo/math/MathUtils","goo/math/Quaternion","goo/util/PromiseUtil","goo/util/ObjectUtil","goo/util/ArrayUtil"],function(a,b,c,d,e,f,g){"use strict";function h(){a.apply(this,arguments)}return h.prototype=Object.create(a.prototype),h.prototype.constructor=h,a._registerClass("transform",h),h.prototype._prepare=function(a){return f.defaults(a,{translation:[0,0,0],rotation:[0,0,0],scale:[1,1,1]})},h.prototype._create=function(a){var c=new b;return a.setComponent(c),c},h.prototype.update=function(b,f){var h=this,i=a.prototype.update.call(this,b,f);if(i.transform.translation.set(f.translation),3===f.rotation.length?i.transform.setRotationXYZ(c.radFromDeg(f.rotation[0]),c.radFromDeg(f.rotation[1]),c.radFromDeg(f.rotation[2])):4===f.rotation.length?new d(f.rotation).toRotationMatrix(i.transform.rotation):i.transform.rotation.set(f.rotation),i.transform.scale.set(f.scale),null!=f.parentRef){var j=this.getConfig(f.parentRef).then(function(a){return h.updateObject(f.parentRef,a,h.options).then(function(a){if(null==a)return console.warn("Could not find parent with ref "+f.parentRef);var b=i.parent;return null==b||b.entity!==a?a.transformComponent.attachChild(i):void 0})});return j.then(function(){return i.setUpdated(),i})}return i.parent&&(console.log("Orphaned entity"),g.remove(i.parent.children,i),i.parent.setUpdated(),i.parent=null),i.setUpdated(),e.createDummyPromise(i)},h.prototype.remove=function(a){var b=a.transformComponent;b.transform.translation.set(0,0,0),b.transform.setRotationXYZ(0,0,0),b.transform.scale.set(1,1,1),b.setUpdated()},h}),define("goo/loaders/handlers/AnimationComponentHandler",["goo/loaders/handlers/ComponentHandler","goo/entities/components/AnimationComponent","goo/math/MathUtils","goo/util/rsvp","goo/util/PromiseUtil"],function(a,b,c,d,e){"use strict";function f(){a.apply(this,arguments)}return f.prototype=Object.create(a.prototype),f.prototype.constructor=f,a._registerClass("animation",f),f.prototype._prepare=function(){},f.prototype._create=function(a){var c=new b;return a.setComponent(c),c},f.prototype.update=function(b,c,f){var g,h,i=this,j=a.prototype.update.call(this,b,c);f&&f.animation&&void 0!==f.animation.paused&&(f.animation.paused?j.stop():j.resume());var k=c.layersRef,l=c.poseRef,m=[];return g=l?this.getConfig(l).then(function(a){i.updateObject(l,a,i.options).then(function(a){return j._skeletonPose=a})}):e.createDummyPromise(),m.push(g),k?h=this._getAnimationLayers(k).then(function(a){return j.layers=a}):(console.warn("No animation tree ref"),h=e.createDummyPromise([])),m.push(h),d.all(m).then(function(){var a=j.paused;return j.paused=!1,j.resetClips(),j.update(),j.paused=a,j})},f.prototype._getAnimationLayers=function(a){var b=this;return this.getConfig(a).then(function(c){return b.updateObject(a,c,b.options)})},f}),define("goo/loaders/handlers/AnimationStateHandler",["goo/loaders/handlers/ConfigHandler","goo/animation/state/SteadyState","goo/animation/blendtree/ClipSource","goo/animation/blendtree/ManagedTransformSource","goo/animation/blendtree/BinaryLERPSource","goo/animation/blendtree/FrozenClipSource","goo/util/rsvp","goo/util/PromiseUtil"],function(a,b,c,d,e,f,g,h){"use strict";function i(){a.apply(this,arguments),this._objects={}}return i.prototype=Object.create(a),i.prototype.construcor=i,a._registerClass("animstate",i),i.prototype.update=function(a,b){var c=this._objects[a]||this._create(a);return c.name=b.name,this._parseClipSource(b.clipSource,c._sourceTree).then(function(a){return c._sourceTree=a,c})},i.prototype.remove=function(a){this._objects[a]&&delete this._objects[a]},i.prototype._create=function(a){return this._objects[a]=new b},i.prototype._parseClipSource=function(a,b){var i=this;
switch(a.type){case"Clip":return this.getConfig(a.clipRef).then(function(d){return i.updateObject(a.clipRef,d,i.options).then(function(d){return!b||!b instanceof c?b=new c(d,a.filter,a.channels):(b._clip=d,b.setFilter(a.filter,a.channels)),a.loopCount&&(b._clipInstance._loopCount=+a.loopCount),a.timeScale&&(b._clipInstance._timeScale=a.timeScale),b})});case"Managed":(!b||!b instanceof d)&&(b=new d);var j=b;return a.clipRef?this.getConfig(a.clipRef).then(function(b){return i.updateObject(a.clipRef,b,i.options)}).then(function(b){return j.initFromClip(b,a.filter,a.channels),j}):h.createDummyPromise(j);case"Lerp":var k=[this._parseClipSource(a.clipSourceA),this._parseClipSource(a.clipSourceB)];return g.all(k).then(function(b){var c=new e(b[0],b[1]);return a.blendWeight&&(c.blendWeight=a.blendWeight),c});case"Frozen":return this._parseClipSource(a.clipSource).then(function(c){return b&&b instanceof f?(b._source=c,b._time=a.frozenTime||0):b=new f(c,a.frozenTime||0),b});default:return console.error("Unable to parse clip source"),h.createDummyPromise()}},i}),define("goo/loaders/handlers/AnimationLayersHandler",["goo/loaders/handlers/ConfigHandler","goo/animation/layer/AnimationLayer","goo/animation/layer/LayerLERPBlender","goo/animation/state/FadeTransitionState","goo/animation/state/SyncFadeTransitionState","goo/animation/state/FrozenTransitionState","goo/util/rsvp","goo/util/PromiseUtil","goo/util/ObjectUtil"],function(a,b,c,d,e,f,g,h,i){"use strict";function j(){a.apply(this,arguments),this._objects={}}return j.prototype=Object.create(a),a._registerClass("animation",j),j.prototype.update=function(a,b,c){var d=this._objects[a]||this._create(a),e=[];if(c&&c.animation&&c.animation.shallow){for(var f=0;f<b.layers.length;f++){var i=d[f];i._layerBlender&&(i._layerBlender._blendWeight=b.layers[f].blendWeight),b.layers[f].defaultState&&i._steadyStates[b.layers[f].defaultState]?i._currentState!==i._steadyStates[b.layers[f].defaultState]&&i.setCurrentStateByName(b.layers[f].defaultState,!0):i.setCurrentState()}return h.createDummyPromise(d)}if(b.layers instanceof Array)for(var f=0;f<b.layers.length;f++){var j=b.layers[f];e.push(this._parseLayer(j,d[f]))}else{var f=1;e.push(this._parseLayer(b.layers.DEFAULT,d[0]));for(var k in b.layers){var j=b.layers[k];"DEFAULT"!==k&&e.push(this._parseLayer(j,d[f++]))}}return g.all(e).then(function(a){d.length=0;for(var b=0;b<a.length;b++)d.push(a[b]);return d})},j.prototype.remove=function(a){this._objects[a]&&delete this._objects[a]},j.prototype._create=function(a){return this._objects[a]=[]},j.prototype._parseLayer=function(a,d){function e(a,b){return f.getConfig(b).then(function(c){return f.updateObject(b,c,f.options).then(function(d){return{state:d,ref:b,config:c,key:a}})})}var f=this;void 0===a.blendWeight&&(a.blendWeight=1),d?d._name=a.name:(d=new b(a.name),d._layerBlender=new c),d._layerBlender&&(d._layerBlender._blendWeight=void 0!==a.blendWeight?a.blendWeight:1);var h=[];for(var j in a.states)h.push(e(j,a.states[j].stateRef));return g.all(h).then(function(a){d._steadyStates={};for(var b=0;b<a.length;b++){var c=a[b];d._steadyStates[c.key]=c.state}for(var b=0;b<a.length;b++){var e=a[b].config.transitions,g=a[b].state;if(e)for(var h in e){var j=e[h];if(d._steadyStates[h]||"*"===h){var k=i.clone(j);g._transitions[h]=k,d._transitionStates[k.type]||(d._transitionStates[k.type]=f._getTransitionByType(k.type))}}}}).then(function(){if(a.transitions)for(var b in a.transitions){var c=a.transitions[b];if(d._steadyStates[b]||"*"===b){var e=i.clone(c);d._transitions[b]=e,d._transitionStates[e.type]||(d._transitionStates[e.type]=f._getTransitionByType(e.type))}}return a.defaultState&&d._steadyStates[a.defaultState]?d._currentState!==d._steadyStates[a.defaultState]&&d.setCurrentStateByName(a.defaultState,!0):d.setCurrentState(),d})},j.prototype._getTransitionByType=function(a){switch(a){case"Fade":return new d;case"SyncFade":return new e;case"Frozen":return new f;default:return console.log("Defaulting to frozen transition type"),new f}},j}),define("goo/loaders/handlers/AnimationClipHandler",["goo/loaders/handlers/ConfigHandler","goo/animation/clip/AnimationClip","goo/loaders/JsonUtils","goo/animation/clip/JointChannel","goo/animation/clip/TransformChannel","goo/animation/clip/InterpolatedFloatChannel","goo/animation/clip/TriggerChannel","goo/util/PromiseUtil","goo/util/ArrayUtil"],function(a,b,c,d,e,f,g,h,i){"use strict";function j(){a.apply(this,arguments),this._objects={}}return j.prototype=Object.create(a.prototype),a._registerClass("clip",j),j.prototype._create=function(a){return this._objects[a]=new b},j.prototype.update=function(a,b){var c=this._objects[a]||this._create(a);c._name=b.name;var d,e=this;return b.binaryRef?this.getConfig(b.binaryRef).then(function(a){if(!a)throw new Error("Binary clip data was empty");return e._updateAnimationClip(b,a,c)}):(d=this._updateAnimationClip(b,null,c),h.createDummyPromise(d))},j.prototype._updateAnimationClip=function(a,b,h){h._channels=[];var j=a.useCompression||!1,k=null;if(j&&(k=a.compressedRange||32767),a.channels&&a.channels.length)for(var l=0;l<a.channels.length;l++){var m,n,o,p,q,r,s=a.channels[l];n=b?i.getTypedArray(b,s.times):new Float32Array(c.parseChannelTimes(s,j));var r=s.blendType,t=s.type;if(("Joint"===t||"Transform"===t)&&(b?(o=i.getTypedArray(b,s.rotationSamples),p=i.getTypedArray(b,s.translationSamples),q=i.getTypedArray(b,s.scaleSamples)):(o=c.parseRotationSamples(s,k,j),p=c.parseTranslationSamples(s,n.length,j),q=c.parseScaleSamples(s,n.length,j))),"Joint"===t)m=new d(s.jointName,s.jointIndex,n,o,p,q,r);else if("Transform"===s.type)m=new e(s.name,n,o,p,q,r);else if("FloatLERP"===s.type)m=new f(s.name,n,c.parseFloatLERPValues(s,j),r);else{if("Trigger"!==s.type){console.warn("Unhandled channel type: "+s.type);continue}m=new g(s.name,n,s.keys),s.guarantee&&(m.guarantee=!0)}h.addChannel(m)}return h},j}),define("goo/util/Skybox",["goo/shapes/ShapeCreator","goo/shapes/Sphere","goo/renderer/MeshData","goo/renderer/Material","goo/renderer/Shader","goo/renderer/TextureCreator","goo/math/Transform"],function(a,b,c,d,e,f,g){"use strict";function h(c,j,k,l){var m;if(c===h.SPHERE)this.meshData=a.createSphere(48,48,1,k||b.TextureModes.Projected),j instanceof Array&&(j=j[0]),j&&(m=(new f).loadTexture2D(j));else{if(c!==h.BOX)throw new Error("Unknown geometry type");this.meshData=a.createBox(1,1,1),j.length&&(m=(new f).loadTextureCube(j,{flipY:!1}))}var n=d.createMaterial(i[c],"Skybox material");n.setTexture(e.DIFFUSE_MAP,m),n.cullState.cullFace="Front",n.depthState.enabled=!1,n.renderQueue=1,this.materials=[n],this.transform=new g;var o=c===h.SPHERE?Math.PI/2:0;this.transform.rotation.fromAngles(o,l,0),this.transform.update(),this.active=!0}h.SPHERE="sphere",h.BOX="box";var i={};return i.box={attributes:{vertexPosition:c.POSITION},uniforms:{viewMatrix:e.VIEW_MATRIX,projectionMatrix:e.PROJECTION_MATRIX,worldMatrix:e.WORLD_MATRIX,cameraPosition:e.CAMERA,near:e.NEAR_PLANE,diffuseMap:e.DIFFUSE_MAP},vshader:["attribute vec3 vertexPosition;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 worldMatrix;","uniform vec3 cameraPosition;","uniform float near;","varying vec3 eyeVec;","void main(void) {","	vec4 worldPos = worldMatrix * vec4(vertexPosition * near * 10.0, 1.0);"," worldPos += vec4(cameraPosition, 0.0);","	gl_Position = projectionMatrix * viewMatrix * worldPos;","	eyeVec = worldPos.xyz - cameraPosition;"," eyeVec.x = -eyeVec.x;"," eyeVec = (worldMatrix * vec4(eyeVec, 0.0)).xyz;","}"].join("\n"),fshader:["precision mediump float;","uniform samplerCube diffuseMap;","varying vec3 eyeVec;","void main(void)","{","	vec4 cube = textureCube(diffuseMap, eyeVec);","	gl_FragColor = cube;","}"].join("\n")},i.sphere={attributes:{vertexPosition:c.POSITION,vertexUV0:c.TEXCOORD0},uniforms:{viewMatrix:e.VIEW_MATRIX,projectionMatrix:e.PROJECTION_MATRIX,worldMatrix:e.WORLD_MATRIX,cameraPosition:e.CAMERA,near:e.NEAR_PLANE,diffuseMap:e.DIFFUSE_MAP},vshader:["attribute vec3 vertexPosition;","attribute vec2 vertexUV0;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 worldMatrix;","uniform vec3 cameraPosition;","uniform float near;","varying vec2 texCoord0;","varying vec3 eyeVec;","void main(void) {","	texCoord0 = vertexUV0;","	vec4 worldPos = worldMatrix * vec4(vertexPosition * near * 10.0, 1.0);"," worldPos += vec4(cameraPosition, 0.0);","	gl_Position = projectionMatrix * viewMatrix * worldPos;","	eyeVec = cameraPosition - worldPos.xyz;","}"].join("\n"),fshader:["precision mediump float;","uniform sampler2D diffuseMap;","varying vec2 texCoord0;","void main(void)","{","	gl_FragColor = texture2D(diffuseMap, texCoord0);","}"].join("\n")},h}),define("goo/renderer/pass/Composer",["goo/renderer/pass/RenderTarget","goo/renderer/pass/FullscreenPass","goo/renderer/shaders/ShaderLib"],function(a,b,c){"use strict";function d(d){if(this.renderTarget1=d,void 0===this.renderTarget1){var e=window.innerWidth||1,f=window.innerHeight||1;this.renderTarget1=new a(e,f)}this.renderTarget2=this.renderTarget1.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.passes=[],this._clearColor=[0,0,0,1],this.copyPass=new b(c.copy)}var e=window.WebGLRenderingContext;return d.prototype.swapBuffers=function(){var a=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=a},d.prototype.addPass=function(a){this.passes.push(a)},d.prototype.setClearColor=function(a){this._clearColor[0]=a[0],this._clearColor[1]=a[1],this._clearColor[2]=a[2],this._clearColor[3]=a[3]},d.prototype.render=function(a,b,c,d){this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2;var f,g,h=!1,i=this.passes.length;for(g=0;i>g;g++)if(f=this.passes[g],f.enabled&&(f.render(a,this.writeBuffer,this.readBuffer,b,h,c,d,this._clearColor),f.needsSwap)){if(h){var j=this.renderer.context;j.stencilFunc(e.NOTEQUAL,1,4294967295),this.copyPass.render(a,this.writeBuffer,this.readBuffer,b,c,d),j.stencilFunc(e.EQUAL,1,4294967295)}this.swapBuffers()}},d}),define("goo/renderer/pass/RenderPass",["goo/renderer/Renderer","goo/math/Vector4"],function(a,b){"use strict";function c(a,c){this.renderList=a,this.filter=c,this.clearColor=new b(0,0,0,0),this.oldClearColor=new b,this.renderToScreen=!1,this.overrideMaterial=null,this.enabled=!0,this.clear=!0,this.needsSwap=!1}return c.prototype.render=function(b,c,d,e,f,g,h,i){g=g||a.mainCamera,h=h||[],i&&(this.oldClearColor.setv(b.clearColor),b.setClearColor(i[0],i[1],i[2],i[3]));var j;if(j=this.filter?this.renderList.filter(this.filter):this.renderList,this.renderToScreen?b.render(j,g,h):b.render(j,g,h,d,this.clear,this.overrideMaterial),this.clearColor){var k=this.oldClearColor.data;b.setClearColor(k[0],k[1],k[2],k[3])}},c}),define("goo/loaders/handlers/ProjectHandler",["goo/loaders/handlers/ConfigHandler","goo/util/rsvp","goo/util/PromiseUtil","goo/util/Skybox","goo/math/MathUtils","goo/shapes/Sphere","goo/renderer/Renderer","goo/renderer/pass/Composer","goo/renderer/pass/RenderPass","goo/math/Vector4","goo/renderer/shaders/ShaderLib","goo/renderer/shaders/ShaderBuilder","goo/renderer/pass/FullscreenPass","goo/renderer/Util","goo/renderer/Texture","goo/entities/EntityUtils","goo/entities/SystemBus","goo/util/ArrayUtil","goo/util/ObjectUtil"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){"use strict";function t(){a.apply(this,arguments),this._skybox=null,this._skyboxTexture=null,this._skyboxGeographic=!1,this._composer=null,this._passes=[]}return t.prototype=Object.create(a.prototype),a._registerClass("project",t),t.prototype._prepare=function(a){a.skybox=a.skybox||{},s.defaults(a.skybox,{shape:"Box",imageUrls:["","","","","",""],rotation:0,environmentType:1}),a.backgroundColor=a.backgroundColor||[.75,.76,.78,1],a.globalAmbient=a.globalAmbient||[0,0,0],a.useFog=a.useFog||!1,a.fogColor=a.fogColor||[1,1,1],a.fogNear=a.fogNear||0,a.fogFar=null==a.fogFar?1e4:a.fogFar},t.prototype._create=function(){},t.prototype._createSkybox=function(a,b,c,e,g){var g=g?f.TextureModes.Projected:f.TextureModes.Chromeball,h=new d(b,[],g,e),i=this._skybox=p.createTypicalEntity(a.world,h.meshData,h.materials[0],h.transform);i.name="Skybox_"+b,i.isSkybox=!0,i.transformComponent.updateWorldTransform(),i.meshRendererComponent.hidden=!0,a.world.getSystem("RenderSystem").added(i)},t.prototype._updateSkybox=function(a,f){if(a){var g=a.shape.toLowerCase(),h=a.rotation*e.DEG_TO_RAD,i=a.imageUrls,j=this._skybox?this._skybox.name.split("_")[1]:null;(!g||j!==g||"sphere"===j&&a.environmentType!==this._skyboxGeographic)&&(this._skybox&&this.world.getSystem("RenderSystem").removed(this._skybox),this._createSkybox(this.world.gooRunner,g,i,h,a.environmentType),this._skyboxTexture=null,j=g,this._skyboxGeographic=a.environmentType);var k=0;j===d.SPHERE&&(k=a.environmentType?Math.PI/2:Math.PI),this._skybox.transformComponent.transform.rotation.fromAngles(k,h,0),this._skybox.transformComponent.updateTransform(),this._skybox.transformComponent.updateWorldTransform();var m=this._skybox,n=m.meshRendererComponent.materials[0],p=this._skyboxTexture,r=!p;if(!r&&f&&f.skybox&&f.skybox.reload&&(r=!0),!r)if(p.image.data)for(var s=0;s<i.length;s++){var t=p.image.data[s];if(t&&t.getAttribute("data-ref")!==i[s]){r=!0;break}}else p.image&&p.image.getAttribute("data-ref")!==i[0]&&(r=!0);if(l.ENVIRONMENT_TYPE=a.environmentType?1:0,!r)return c.createDummyPromise();for(var u=[],s=0;s<i.length;s++)i[s]&&""!==i[s]&&u.push(this.getConfig(i[s]));if(!u.length)return m.meshRendererComponent.hidden=!0,n.setTexture("DIFFUSE_MAP",null),c.createDummyPromise();var v=this;return b.all(u).then(function(b){if(j===d.SPHERE){if(""===i[0])return q.emit("goo.error.skybox",{type:"Sphere",message:"The skysphere needs an image to display."}),void 0;b=b[0],b.setAttribute("data-ref",i[0])}else{if(b.length<6)return q.emit("goo.error.skybox",{type:"Box",message:"The skybox needs six images of the same size to display"}),m.meshRendererComponent.hidden=!0,n.setTexture("DIFFUSE_MAP",null),void 0;for(var c=b[0].width,e=b[0].height,f=0;6>f;f++){var g=b[f];if(c!==g.width||e!==g.height)return q.emit("goo.error.skybox",{type:"Box",message:"The skybox needs six images of the same size to display"}),m.meshRendererComponent.hidden=!0,n.setTexture("DIFFUSE_MAP",null),void 0;g.setAttribute("data-ref",i[f])}}p||(p=v._skyboxTexture=new o(null,{flipY:!1}),j===d.BOX&&(p.variant="CUBE")),p.setImage(b),j===d.BOX&&b.length&&(p.image.width=b[0].width,p.image.height=b[0].height,p.image.dataReady=!0),p.setNeedsUpdate(),(j===d.BOX&&b.length||b)&&(n.setTexture("DIFFUSE_MAP",p),j===d.BOX?(l.SKYBOX=p,l.SKYSPHERE=null):(l.SKYBOX=null,l.SKYSPHERE=p,l.ENVIRONMENT_TYPE=a.environmentType?1:0),m.meshRendererComponent.hidden=!1)})}},t.prototype._updateEntities=function(a){var d=this,e=[];if(a.entityRefs&&Array.isArray(a.entityRefs)&&a.entityRefs.length>0){for(var f=function(a){return e.push(d.getConfig(a).then(function(b){return d.updateObject(a,b,d.options)}))},g=0;g<a.entityRefs.length;g++)f(a.entityRefs[g]);return b.all(e).then(function(a){for(var b=0;b<a.length;b++){var c=a[b];null!=d.options.beforeAdd&&null!=d.options.beforeAdd.apply&&!d.options.beforeAdd(c)||d.world.entityManager.containsEntity(c)||d.world._addedEntities.filter(function(a){return a.id===c.id}).length>0||c.addToWorld()}}).then(null,function(a){return console.error("Error updating entities: "+a)})}return console.warn("No entity refs in project"),c.createDummyPromise(a)},t.prototype._updatePosteffects=function(a){var d=this,e=[],f=d.world.getSystem("RenderSystem");if(a.posteffectRefs&&Array.isArray(a.posteffectRefs)&&a.posteffectRefs.length>0){for(var g=function(a){return d.getConfig(a).then(function(b){return d.updateObject(a,b,d.options)})},j=0;j<a.posteffectRefs.length;j++)a.posteffectRefs[j]&&e.push(g(a.posteffectRefs[j]));return b.all(e).then(function(a){var b,c,e;if(d._composer)b=d._composer,c=b.passes[0],e=b.passes[b.passes.length-1];else{b=d._composer=new h,c=new i(f.renderList);var e=new m(n.clone(k.copy));e.renderToScreen=!0}b.passes=[],b.addPass(c);for(var g=!1,j=0;j<a.length;j++)if(a[j]){var l=a[j].get();l.enabled&&!g&&(g=!0),b.addPass(l)}b.addPass(e),g?-1===f.composers.indexOf(b)&&f.composers.push(b):r.remove(f.composers,b)}).then(null,function(a){return console.error("Error updating posteffects: "+a)})}return f.composers.length=0,c.createDummyPromise(a)},t.prototype.update=function(a,c,d){var e=this;this._prepare(c);var f=[];return f.push(this._updateSkybox(c.skybox,d)),d&&d.shallow||f.push(this._updateEntities(c)),f.push(this._updatePosteffects(c)),b.all(f).then(function(a){var b=e.world.gooRunner.renderer;return b.setClearColor.apply(b,c.backgroundColor),e._composer&&e._composer.setClearColor(c.backgroundColor),l.GLOBAL_AMBIENT=c.globalAmbient,l.USE_FOG=c.useFog,l.FOG_SETTINGS=[c.fogNear,c.fogFar],l.FOG_COLOR=c.fogColor,a})},t.prototype.remove=function(){this._skybox&&this.world.getSystem("RenderSystem").removed(this._skybox),this._skybox=null,this._skyboxTexture=null,this._skyboxGeographic=!1,this._composer=null,this._passes=[]},t}),define("goo/loaders/handlers/ScriptComponentHandler",["goo/loaders/handlers/ComponentHandler","goo/entities/components/ScriptComponent","goo/util/rsvp","goo/util/PromiseUtil"],function(a,b,c,d){"use strict";function e(){a.apply(this,arguments)}return e.prototype=Object.create(a.prototype),e.prototype.constructor=e,a._registerClass("script",e),e.prototype._prepare=function(){},e.prototype._create=function(a){var c=new b;return a.setComponent(c),c},e.prototype.update=function(b,e){function f(a){return g.getConfig(a).then(function(b){return g.updateObject(a,b)})}var g=this,h=[],i=a.prototype.update.call(this,b,e);if(e.scriptRefs&&e.scriptRefs.length)for(var j=e.scriptRefs,k=0;k<j.length;k++)h.push(f(j[k]));return h.length>0?c.all(h).then(function(a){i.scripts=a[0]?a:[]}):d.createDummyPromise(i)},e}),define("goo/scripts/OrbitCamControlScript",["goo/math/Vector2","goo/math/Vector3","goo/math/MathUtils"],function(a,b,c){"use strict";function d(c){c=c||{};for(var d in f)this[d]="boolean"==typeof f[d]?void 0!==c[d]?c[d]===!0:f[d]:isNaN(f[d])?f[d]instanceof b?c[d]?new b(c[d]):(new b).set(f[d]):c[d]||f[d]:isNaN(c[d])?f[d]:c[d];this.name="OrbitCamControlScript",this.timeSamples=[0,0,0,0,0],this.xSamples=[0,0,0,0,0],this.ySamples=[0,0,0,0,0],this.sample=0,this.velocity=new a(0,0),this.targetSpherical=new b(this.spherical),this.cartesian=new b,this.dirty=!0,this.mouseState={buttonDown:!1,lastX:0/0,lastY:0/0},this.domElement&&this.setupMouseControls(),c.demoMode&&(this.demoMode=!0,this.moveInterval=c.moveInterval,this.lastTimeMoved=Date.now()+(c.moveInitialDelay-this.moveInterval))}function e(a,b,d){var e=(b+d)/2+(d>b?Math.PI:0),f=c.moduloPositive(a-e,c.TWO_PI),g=c.moduloPositive(b-e,c.TWO_PI),h=c.moduloPositive(d-e,c.TWO_PI);return 0>a&&b>0?b-=c.TWO_PI:a>0&&0>b&&(b+=c.TWO_PI),a>c.TWO_PI&&d<c.TWO_PI&&(d+=c.TWO_PI),g>f?b:f>h?d:a}var f={domElement:null,turnSpeedHorizontal:.005,turnSpeedVertical:.005,zoomSpeed:.2,dragOnly:!0,dragButton:-1,worldUpVector:new b(0,1,0),baseDistance:15,minZoomDistance:1,maxZoomDistance:1e3,minAscent:-89.95*c.DEG_TO_RAD,maxAscent:89.95*c.DEG_TO_RAD,clampAzimuth:!1,minAzimuth:90*c.DEG_TO_RAD,maxAzimuth:270*c.DEG_TO_RAD,releaseVelocity:!0,invertedX:!1,invertedY:!1,invertedWheel:!0,drag:5,maxSampleTimeMS:200,lookAtPoint:new b(0,0,0),spherical:new b(15,0,0),interpolationSpeed:7,onRun:null};return d.prototype.updateButtonState=function(a,b){this.domElement!==document&&this.domElement.focus(),!this.dragOnly||-1!==this.dragButton&&this.dragButton!==a||(this.mouseState.buttonDown=b,b?(this.mouseState.lastX=0/0,this.mouseState.lastY=0/0,this.velocity.set(0,0),this.spherical.y=c.moduloPositive(this.spherical.y,c.TWO_PI),this.targetSpherical.copy(this.spherical)):this.applyReleaseDrift())},d.prototype.updateDeltas=function(a,b){var c=0,d=0;isNaN(this.mouseState.lastX)||isNaN(this.mouseState.lastY)?(this.mouseState.lastX=a,this.mouseState.lastY=b):(c=-(a-this.mouseState.lastX),d=b-this.mouseState.lastY,this.mouseState.lastX=a,this.mouseState.lastY=b),this.dragOnly&&!this.mouseState.buttonDown||0===c&&0===d||(this.timeSamples[this.sample]=Date.now(),this.xSamples[this.sample]=c,this.ySamples[this.sample]=d,this.sample++,this.sample>this.timeSamples.length-1&&(this.sample=0),this.velocity.set(0,0),this.move(this.turnSpeedHorizontal*c,this.turnSpeedVertical*d))},d.prototype.move=function(a,b){var d=this.invertedX?-a:a,f=this.invertedY?-b:b;this.targetSpherical.y=this.clampAzimuth?e(this.targetSpherical.y-d,this.minAzimuth,this.maxAzimuth):this.targetSpherical.y-d,this.targetSpherical.z=c.clamp(this.targetSpherical.z+f,this.minAscent,this.maxAscent),this.dirty=!0},d.prototype.applyWheel=function(a){var b=(this.invertedWheel?-1:1)*Math.max(-1,Math.min(1,a.wheelDelta||-a.detail));this.zoom(this.zoomSpeed*b)},d.prototype.zoom=function(a){var b=a*this.baseDistance;this.targetSpherical.x=c.clamp(this.targetSpherical.x+b,this.minZoomDistance,this.maxZoomDistance),this.dirty=!0},d.prototype.applyReleaseDrift=function(){for(var a=Date.now(),b=0,c=0,d=!1,e=0,f=this.timeSamples.length;f>e;e++)a-this.timeSamples[e]<this.maxSampleTimeMS&&(b+=this.xSamples[e],c+=this.ySamples[e],d=!0);d?this.velocity.set(b*this.turnSpeedHorizontal/this.timeSamples.length,c*this.turnSpeedVertical/this.timeSamples.length):this.velocity.set(0,0)},d.prototype.setupMouseControls=function(){var a=this;if(this.domElement.addEventListener("mousedown",function(b){a.updateButtonState(b.button,!0)},!1),document.addEventListener("mouseup",function(b){a.updateButtonState(b.button,!1)},!1),document.addEventListener("mousemove",function(b){a.updateDeltas(b.clientX,b.clientY),a.lastTimeMoved=Date.now()},!1),this.domElement.addEventListener("mousewheel",function(b){a.applyWheel(b),a.lastTimeMoved=Date.now()},!1),this.domElement.addEventListener("DOMMouseScroll",function(b){a.applyWheel(b)},!1),this.domElement.addEventListener("dragstart",function(a){a.preventDefault()},!1),"undefined"!=typeof window.Hammer){var b=window.Hammer(this.domElement,{transform_always_block:!0,transform_min_scale:1});b.on("touch drag transform release",function(b){switch(b.type){case"transform":var c=b.gesture.scale;1>c?a.zoom(1*a.zoomSpeed):c>1&&a.zoom(-1*a.zoomSpeed);break;case"touch":a.updateButtonState(0,!0);break;case"release":a.updateButtonState(0,!1);break;case"drag":a.updateDeltas(b.gesture.center.pageX,b.gesture.center.pageY),a.lastTimeMoved=Date.now()}})}this.domElement.oncontextmenu=function(){return!1}},d.prototype.updateVelocity=function(a){this.velocity.lengthSquared()>1e-6?(this.move(this.velocity.x,this.velocity.y),this.velocity.mul(c.clamp(c.lerp(a,1,1-this.drag),0,1)),this.dirty=!0):this.velocity.set(0,0,0)},d.prototype.run=function(a,b,d){if(this.demoMode){var e=Date.now();e-this.lastTimeMoved>this.moveInterval&&(this.lastTimeMoved=e,this.move(Math.round(Math.random())-.5,Math.round(Math.random())-.5))}d&&!this.domElement&&d.domElement&&(this.domElement=d.domElement,this.setupMouseControls());var f=a.transformComponent;if(f){var g=f.transform;if(this.releaseVelocity&&this.updateVelocity(a._world.tpf),this.dirty){var h=c.clamp(this.interpolationSpeed*a._world.tpf,0,1);this.spherical.y=this.clampAzimuth?c.lerp(h,this.spherical.y,this.targetSpherical.y):c.lerp(h,this.spherical.y,this.targetSpherical.y),this.spherical.x=c.lerp(h,this.spherical.x,this.targetSpherical.x),this.spherical.z=c.lerp(h,this.spherical.z,this.targetSpherical.z),c.sphericalToCartesian(this.spherical.x,this.spherical.y,this.spherical.z,this.cartesian),g.translation.set(this.cartesian.add(this.lookAtPoint)),g.translation.equals(this.lookAtPoint)||g.lookAt(this.lookAtPoint,this.worldUpVector),this.spherical.distanceSquared(this.targetSpherical)<1e-6&&(this.dirty=!1,this.spherical.y=c.moduloPositive(this.spherical.y,c.TWO_PI),this.targetSpherical.copy(this.spherical)),f.setUpdated()}}},d}),define("goo/scripts/OrbitNPanControlScript",["goo/scripts/OrbitCamControlScript","goo/renderer/Renderer","goo/math/Vector3","goo/math/MathUtils"],function(a,b,c,d){"use strict";function e(b){b=b||{},this.detailZoom=b.detailZoom||.15,this.zoomDistanceFactor=b.zoomDistanceFactor||.035,a.call(this,b),this.panState={buttonDown:!1,lastX:0/0,lastY:0/0,lastPos:new c},this.viewportWidth=0,this.viewportHeight=0,this.shiftKey=!1,this.altKey=!1,this.goingToLookAt=(new c).setv(this.lookAtPoint)}return e.prototype=Object.create(a.prototype),e.prototype.setupMouseControls=function(){var a=this;if(this.domElement.addEventListener("mousedown",function(b){a.shiftKey=b.shiftKey,a.altKey=b.altKey,a.updateButtonState(b.button,!0,b)},!1),document.addEventListener("mouseup",function(b){a.updateButtonState(b.button,!1,b)},!1),document.addEventListener("mousemove",function(b){a.updateDeltas(b.clientX,b.clientY)},!1),this.domElement.addEventListener("mousewheel",function(b){a.shiftKey=b.shiftKey,a.applyWheel(b.wheelDelta||-b.detail)},!1),this.domElement.addEventListener("DOMMouseScroll",function(b){a.shiftKey=b.shiftKey,a.applyWheel(b.wheelDelta||-b.detail)},!1),this.domElement.addEventListener("dragstart",function(a){a.preventDefault()},!1),this.domElement.oncontextmenu=function(){return!1},"undefined"!=typeof window.Hammer){var b=window.Hammer(this.domElement,{transform_always_block:!0,transform_min_scale:1});b.on("touch drag transform release",function(b){if(b.gesture&&"mouse"!==b.gesture.pointerType)switch(b.type){case"transform":var c=b.gesture.scale;1>c?a.applyWheel(1*a.zoomSpeed):c>1&&a.applyWheel(-1*a.zoomSpeed);break;case"touch":a.updateButtonState(2,!0);break;case"release":a.updateButtonState(2,!1);break;case"drag":a.updateDeltas(b.gesture.center.pageX,b.gesture.center.pageY)}})}},e.prototype.updateButtonState=function(b,c){2===b||0===b&&this.altKey?a.prototype.updateButtonState.call(this,0,c):(1===b||0===b&&this.shiftKey)&&(this.panState.buttonDown=c,c&&(this.panState.lastX=0/0,this.panState.lastY=0/0,this.panState.lastPos.setv(this.lookAtPoint)))},e.prototype.resetLookAt=function(a,b,c,e){this.goingToLookAt.setv(a),this.lookAtPoint.setv(a),this.panState.lastX=0/0,this.panState.lastY=0/0,this.panState.lastPos.setv(a),this.velocity.set(0),d.cartesianToSpherical(b,c,e,this.spherical),this.targetSpherical.setv(this.spherical),d.sphericalToCartesian(this.spherical.x,this.spherical.y,this.spherical.z,this.cartesian)},e.prototype.updateDeltas=function(d,e){a.prototype.updateDeltas.call(this,d,e);var f=new c,g=new c;if((isNaN(this.panState.lastX)||isNaN(this.panState.lastY))&&(this.panState.lastX=d,this.panState.lastY=e),this.panState.buttonDown){var h=b.mainCamera;h.getScreenCoordinates(this.panState.lastPos,1,1,g),g.x-=(d-this.panState.lastX)/this.viewportWidth,g.y+=(e-this.panState.lastY)/this.viewportHeight,h.getWorldCoordinates(g.x,g.y,1,1,g.z,f),this.lookAtPoint.setv(f),this.goingToLookAt.setv(this.lookAtPoint),this.dirty=!0}},e.prototype.applyWheel=function(a){var a=(this.invertedWheel?-1:1)*d.clamp(a,-1,1);this.shiftKey&&(a*=this.detailZoom),a*=this.zoomDistanceFactor*this.targetSpherical.x,this.zoom(this.zoomSpeed*a)},e.prototype.run=function(b,c,d){if(!this.goingToLookAt.equals(this.lookAtPoint)){var e=7*c;this.lookAtPoint.lerp(this.goingToLookAt,e),this.dirty=!0}a.prototype.run.call(this,b,c,d),d&&(this.viewportWidth=d.viewportWidth,this.viewportHeight=d.viewportHeight)},e}),define("goo/scripts/WASDControlScript",["goo/math/Vector","goo/math/Vector3"],function(a,b){"use strict";function c(a){a=a||{},this.name="WASDControlScript",this.domElement=a.domElement||null,this.walkSpeed=isNaN(a.walkSpeed)?100:a.walkSpeed,this.crawlSpeed=isNaN(a.crawlSpeed)?10:a.crawlSpeed,this.fwdVector=a.fwdVector||new b(0,0,-1),this.leftVector=a.leftVector||new b(-1,0,0),this.crawlKey=isNaN(a.crawlKey)?16:a.crawlKey,this.forwardKey=isNaN(a.forwardKey)?87:a.forwardKey,this.backKey=isNaN(a.backKey)?83:a.backKey,this.strafeLeftKey=isNaN(a.strafeLeftKey)?65:a.strafeLeftKey,this.strafeRightKey=isNaN(a.strafeRightKey)?68:a.strafeRightKey,this.XZ=a.XZ||!1,this.onRun=a.onRun,this.moveState={strafeLeft:0,strafeRight:0,forward:0,back:0,crawling:!1},this.moveVector=new b(0,0,0),this.calcVector=new b,this.domElement&&this.setupKeyControls()}return c.prototype.updateMovementVector=function(){this.moveVector.x=this.moveState.strafeLeft-this.moveState.strafeRight,this.moveVector.z=this.moveState.forward-this.moveState.back},c.prototype.updateKeys=function(a,b){if(!a.altKey){var c=!1;switch(a.keyCode){case this.crawlKey:this.moveState.crawling=b;break;case this.forwardKey:this.moveState.forward=b?1:0,c=!0;break;case this.backKey:this.moveState.back=b?1:0,c=!0;break;case this.strafeLeftKey:this.moveState.strafeLeft=b?1:0,c=!0;break;case this.strafeRightKey:this.moveState.strafeRight=b?1:0,c=!0}c&&this.updateMovementVector()}},c.prototype.setupKeyControls=function(){var a=this;this.domElement.setAttribute("tabindex",-1),this.domElement.addEventListener("keydown",function(b){a.updateKeys(b,!0)},!1),this.domElement.addEventListener("keyup",function(b){a.updateKeys(b,!1)},!1)},c.prototype.run=function(c,d,e){e&&!this.domElement&&e.domElement&&(this.domElement=e.domElement,this.setupKeyControls());var f=c.transformComponent,g=f.transform;if(!a.equals(this.moveVector,b.ZERO)){this.calcVector.set(this.fwdVector.x*this.moveVector.z+this.leftVector.x*this.moveVector.x,this.fwdVector.y*this.moveVector.z+this.leftVector.y*this.moveVector.x,this.fwdVector.z*this.moveVector.z+this.leftVector.z*this.moveVector.x),this.calcVector.normalize();var h=c._world.tpf*(this.moveState.crawling?this.crawlSpeed:this.walkSpeed);this.calcVector.mul(h);var i=g.rotation;i.applyPost(this.calcVector),this.XZ&&(this.calcVector.data[1]=0),g.translation.add(this.calcVector),f.setUpdated()}},c}),define("goo/scripts/BasicControlScript",["goo/math/Vector3","goo/math/Matrix3x3"],function(a,b){"use strict";function c(c){c=c||{},this.domElement=void 0===c.domElement?null:c.domElement.domElement||c.domElement,this.name="BasicControlScript",this.movementSpeed=10,this.rollSpeed=2,this.movementSpeedMultiplier=1,this.mouseStatus=0,this.moveState={up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0},this.moveVector=new a(0,0,0),this.rotationVector=new a(0,0,0),this.multiplier=new a(1,1,1),this.rotationMatrix=new b,this.tmpVec=new a,this.handleEvent=function(a){"function"==typeof this[a.type]&&this[a.type](a)},this.keydown=function(a){if(!a.altKey){switch(a.keyCode){case 16:this.movementSpeedMultiplier=.1;break;case 87:this.moveState.forward=1;break;case 83:this.moveState.back=1;break;case 65:this.moveState.left=1;break;case 68:this.moveState.right=1;break;case 82:this.moveState.up=1;break;case 70:this.moveState.down=1;break;case 38:this.moveState.pitchUp=1;break;case 40:this.moveState.pitchDown=1;break;case 37:this.moveState.yawLeft=1;break;case 39:this.moveState.yawRight=1;break;case 81:this.moveState.rollLeft=1;break;case 69:this.moveState.rollRight=1}this.updateMovementVector(),this.updateRotationVector()}},this.keyup=function(a){switch(a.keyCode){case 16:this.movementSpeedMultiplier=1;break;case 87:this.moveState.forward=0;break;case 83:this.moveState.back=0;break;case 65:this.moveState.left=0;break;case 68:this.moveState.right=0;break;case 82:this.moveState.up=0;break;case 70:this.moveState.down=0;break;case 38:this.moveState.pitchUp=0;break;case 40:this.moveState.pitchDown=0;break;case 37:this.moveState.yawLeft=0;break;case 39:this.moveState.yawRight=0;break;case 81:this.moveState.rollLeft=0;break;case 69:this.moveState.rollRight=0}this.updateMovementVector(),this.updateRotationVector()},this.mousedown=function(a){this.domElement!==document&&this.domElement.focus(),a.preventDefault(),a=a.touches&&1===a.touches.length?a.touches[0]:a,this.mouseDownX=a.pageX,this.mouseDownY=a.pageY,this.mouseStatus=1,document.addEventListener("mousemove",this.mousemove,!1),document.addEventListener("mouseup",this.mouseup,!1),document.addEventListener("touchmove",this.mousemove,!1),document.addEventListener("touchend",this.mouseup,!1)}.bind(this),this.mousemove=function(a){this.mouseStatus>0&&(a=a.touches&&1===a.touches.length?a.touches[0]:a,this.moveState.yawLeft=a.pageX-this.mouseDownX,this.moveState.pitchDown=a.pageY-this.mouseDownY,this.updateRotationVector(),this.mouseDownX=a.pageX,this.mouseDownY=a.pageY)
}.bind(this),this.mouseup=function(a){this.mouseStatus&&(a.preventDefault(),this.mouseStatus=0,this.moveState.yawLeft=this.moveState.pitchDown=0,this.updateRotationVector(),document.removeEventListener("mousemove",this.mousemove),document.removeEventListener("mouseup",this.mouseup),document.removeEventListener("touchmove",this.mousemove),document.removeEventListener("touchend",this.mouseup))}.bind(this),this.updateMovementVector=function(){var a=this.moveState.forward||this.autoForward&&!this.moveState.back?1:0;this.moveVector.x=-this.moveState.left+this.moveState.right,this.moveVector.y=-this.moveState.down+this.moveState.up,this.moveVector.z=-a+this.moveState.back},this.updateRotationVector=function(){this.rotationVector.x=-this.moveState.pitchDown+this.moveState.pitchUp,this.rotationVector.y=-this.moveState.yawRight+this.moveState.yawLeft,this.rotationVector.z=-this.moveState.rollRight+this.moveState.rollLeft},this.getContainerDimensions=function(){return this.domElement!==document?{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,this.domElement.offsetTop]}:{size:[window.innerWidth,window.innerHeight],offset:[0,0]}},this.domElement&&this.setupMouseControls(),this.updateMovementVector(),this.updateRotationVector()}return c.prototype.setupMouseControls=function(){this.domElement.setAttribute("tabindex",-1),this.domElement.addEventListener("mousedown",this.mousedown,!1),this.domElement.addEventListener("touchstart",this.mousedown,!1),this.domElement.addEventListener("keydown",this.keydown.bind(this),!1),this.domElement.addEventListener("keyup",this.keyup.bind(this),!1)},c.prototype.externals=function(){return[{variable:"movementSpeed",type:"number"},{variable:"rollSpeed",type:"number"}]},c.prototype.run=function(b,c,d){d&&!this.domElement&&d.domElement&&(this.domElement=d.domElement,this.setupMouseControls());var e=b.transformComponent,f=e.transform,g=b._world.tpf,h=g*this.movementSpeed*this.movementSpeedMultiplier,i=g*this.rollSpeed*this.movementSpeedMultiplier;(!this.moveVector.equals(a.ZERO)||!this.rotationVector.equals(a.ZERO)||this.mouseStatus>0)&&(f.translation.x+=this.moveVector.x*h,f.translation.y+=this.moveVector.y*h,f.translation.z+=this.moveVector.z*h,this.tmpVec.x+=-this.rotationVector.x*i*this.multiplier.x,this.tmpVec.y+=this.rotationVector.y*i*this.multiplier.y,this.tmpVec.z+=this.rotationVector.z*i*this.multiplier.z,f.rotation.fromAngles(this.tmpVec.x,this.tmpVec.y,this.tmpVec.z),this.mouseStatus>0&&(this.moveState.yawLeft=0,this.moveState.pitchDown=0,this.updateRotationVector()),e.setUpdated())},c}),define("goo/loaders/handlers/ScriptHandler",["goo/loaders/handlers/ConfigHandler","goo/util/rsvp","goo/scripts/OrbitCamControlScript","goo/scripts/OrbitNPanControlScript","goo/scripts/WASDControlScript","goo/scripts/BasicControlScript","goo/util/PromiseUtil"],function(a,b,c,d,e,f,g){"use strict";function h(){a.apply(this,arguments)}return h.scripts={OrbitCamControlScript:c,OrbitNPanControlScript:d,WASDControlScript:e,BasicControlScript:f},h.prototype=Object.create(a.prototype),h.prototype.constructor=h,a._registerClass("script",h),h.prototype._prepare=function(){},h.prototype._create=function(){},h.prototype.update=function(a,b){var c=b.className,d=null;return h.scripts[c]instanceof Function&&(d=new h.scripts[c](b.options)),g.createDummyPromise(d)},h}),define("goo/statemachine/FSMComponent",["goo/entities/components/Component","goo/util/ArrayUtil","goo/entities/SystemBus"],function(a,b,c){"use strict";function d(){this.type="FSMComponent",this._machines=[],this.entity=null,this.vars={},this.system=null,this.time=0,this.active=!0}return d.prototype=Object.create(a.prototype),d.vars={},d.getVariable=function(a){return d.vars[a]},d.prototype.getVariable=function(a){return void 0!==this.vars[a]?this.vars[a]:d.getVariable(a)},d.applyOnVariable=function(a,b){d.vars[a]=b(d.vars[a])},d.prototype.applyOnVariable=function(a,b){void 0!==this.vars[a]?this.vars[a]=b(this.vars[a]):d.applyOnVariable(a,b)},d.prototype.defineVariable=function(a,b){this.vars[a]=b},d.prototype.removeVariable=function(a){delete this.vars[a]},d.applyOnVariable=function(a,b){this.vars[a]?this.vars[a]=b(this.vars[a]):d.vars[a]&&d.applyOnVariable(a,b)},d.prototype.addMachine=function(a){a._fsm=this,a.parent=this,this._machines.push(a)},d.prototype.removeMachine=function(a){a.recursiveRemove(),b.remove(this._machines,a)},d.prototype.init=function(){for(var a=0;a<this._machines.length;a++){var b=this._machines[a];b.setRefs(this),b.reset(),b.ready()}},d.prototype.doEnter=function(){for(var a=0;a<this._machines.length;a++){var b=this._machines[a];b.enter()}},d.prototype.kill=function(){for(var a=0;a<this._machines.length;a++){var b=this._machines[a];b.kill()}},d.prototype.cleanup=function(){for(var a=0;a<this._machines.length;a++){var b=this._machines[a];b.cleanup()}},d.prototype.update=function(){if(this.active)for(var a=0;a<this._machines.length;a++){var b=this._machines[a];b.update()}},d.prototype.pause=function(){this.active=!1,c.emit("goo.entity."+this.entity.name+".fsm.pause")},d.prototype.play=function(){this.active=!0,c.emit("goo.entity."+this.entity.name+".fsm.play")},d}),define("goo/loaders/handlers/FSMComponentHandler",["goo/loaders/handlers/ComponentHandler","goo/statemachine/FSMComponent","goo/util/rsvp","goo/util/PromiseUtil","goo/util/ArrayUtil"],function(a,b,c,d,e){"use strict";function f(){a.apply(this,arguments)}return f.prototype=Object.create(a.prototype),f.prototype.constructor=f,a._registerClass("stateMachine",f),f._type="fSM",f.prototype._prepare=function(){},f.prototype._create=function(a){var c=new b;return a.setComponent(c),c},f.prototype.update=function(b,f){function g(a){return h.getConfig(a).then(function(b){return h.updateObject(a,b)})}var h=this,i=[],j=a.prototype.update.call(this,b,f);if(f.machineRefs&&f.machineRefs.length)for(var k=f.machineRefs,l=0;l<k.length;l++)i.push(g(k[l]));return i.length>0?c.all(i).then(function(a){var b=j._machines;j._machines=[];for(var c=0;c<a.length;c++)j.addMachine(a[c]),e.remove(b,a[c]);for(var c=0;c<b.length;c++)j.removeMachine(b[c]);return j}):d.createDummyPromise(j)},f}),define("goo/statemachine/State",["goo/util/ArrayUtil"],function(a){"use strict";function b(a){this.uuid=a,this._fsm=null,this.parent=null,this._actions=[],this._machines=[],this._transitions={},this.vars={},this.transitionTarget=null,this.proxy={getTpf:function(){return this._fsm.entity._world.tpf}.bind(this),getTime:function(){return this._fsm.system.time}.bind(this),getState:function(){return this}.bind(this),getFsm:function(){return this._fsm}.bind(this),getOwnerEntity:function(){return this._fsm.entity}.bind(this),send:function(a){a&&"string"==typeof a&&this._transitions[a]&&this.requestTransition(this._transitions[a])}.bind(this),addListener:function(a,b){this._fsm._bus.addListener(a,b)}.bind(this),removeListener:function(a,b){this._fsm._bus.removeListener(a,b)}.bind(this),defineVariable:function(a,b){this.vars[a]=b}.bind(this),removeVariable:function(a){delete this.vars[a]}.bind(this),getVariable:function(a){return void 0!==this.vars[a]?this.vars[a]:this._fsm.getVariable(a)}.bind(this),applyOnVariable:function(a,b){void 0!==this.vars[a]?this.vars[a]=b(this.vars[a]):this._fsm.applyOnVariable(a,b)}.bind(this)}}return b.prototype.setRefs=function(a){this._fsm=a;for(var b=0;b<this._machines.length;b++){var c=this._machines[b];c.setRefs(a)}},b.prototype.isCurrentState=function(){return this===this.parent.getCurrentState()},b.prototype.requestTransition=function(a){this.isCurrentState()&&(this.transitionTarget=a)},b.prototype.setTransition=function(a,b){this._transitions[a]=b},b.prototype.clearTransition=function(a){delete this._transitions[a]},b.prototype.update=function(){for(var a=0;a<this._actions.length;a++)if(this._actions[a].update(this.proxy),this.transitionTarget){var b=this.transitionTarget;return this.transitionTarget=null,b}for(var c,a=0;a<this._machines.length;a++){var d=this._machines[a];if(c=d.update())return c}},b.prototype.reset=function(){for(var a=0;a<this._machines.length;a++)this._machines[a].reset()},b.prototype.kill=function(){for(var a=0;a<this._machines.length;a++)this._machines[a].kill();for(var a=0;a<this._actions.length;a++)this._actions[a].exit(this.proxy)},b.prototype.ready=function(){for(var a=0;a<this._machines.length;a++)this._machines[a].ready();for(var a=0;a<this._actions.length;a++)this._actions[a].ready(this.proxy)},b.prototype.cleanup=function(){for(var a=0;a<this._machines.length;a++)this._machines[a].cleanup();for(var a=0;a<this._actions.length;a++)this._actions[a].cleanup(this.proxy)},b.prototype.enter=function(){for(var a=0;a<this._actions.length;a++)this._actions[a].enter(this.proxy);for(var a=0;a<this._machines.length;a++)this._machines[a].enter()},b.prototype.getAction=function(a){if(!this._actions)return void 0;for(var b=0;b<this._actions.length;b++){var c=this._actions[b];if(void 0!==a&&c.id===a)return c}return void 0},b.prototype.addAction=function(a){this._actions[a.id]||(a.onCreate&&a.onCreate(this.proxy),this._actions.push(a))},b.prototype.recursiveRemove=function(){this.removeAllActions();for(var a=0;a<this._machines.length;a++)this._machines[a].recursiveRemove();this._machines=[]},b.prototype.removeAllActions=function(){for(var a=0;a<this._actions.length;a++){var b=this._actions[a];b.onDestroy&&b.onDestroy(this.proxy)}this._actions=[]},b.prototype.removeAction=function(b){b.onDestroy&&b.onDestroy(this.proxy),a.remove(this._actions,b)},b.prototype.addMachine=function(a){var b=this._machines.indexOf(a);-1===b&&(a._fsm=this._fsm,a.parent=this,this._machines.push(a))},b.prototype.removeMachine=function(b){b.recursiveRemove(),a.remove(this._machines,b)},b}),define("goo/statemachine/Machine",[],function(){"use strict";function a(a){this.name=a,this._fsm=null,this._states=null,this.initialState="entry",this.currentState=null,this.parent=null}return a.prototype.setRefs=function(a){this._fsm=a;for(var b=Object.keys(this._states),c=0;c<b.length;c++){var d=this._states[b[c]];d.setRefs(a)}},a.prototype.update=function(){if(this.currentState){var a=this.currentState.update();return a&&this.contains(a)&&(this.currentState.kill(),this.setState(this._states[a])),a}},a.prototype.contains=function(a){return!!this._states[a]},a.prototype.setState=function(a){this.currentState=a,this.currentState.reset(),this.currentState.enter()},a.prototype.reset=function(){this.currentState=this._states[this.initialState],this.currentState&&this.currentState.reset()},a.prototype.kill=function(){this.currentState&&this.currentState.kill()},a.prototype.ready=function(){for(var a=Object.keys(this._states),b=0;b<a.length;b++){var c=this._states[a[b]];c.ready()}},a.prototype.cleanup=function(){for(var a=Object.keys(this._states),b=0;b<a.length;b++){var c=this._states[a[b]];c.cleanup()}},a.prototype.enter=function(){this.currentState&&this.currentState.enter()},a.prototype.getCurrentState=function(){return this.currentState},a.prototype.addState=function(a){this._states||(this._states={},this.initialState=a.uuid),a.parent=this,a._fsm=this._fsm,this._states[a.uuid]=a},a.prototype.removeFromParent=function(){this.parent.removeMachine(this)},a.prototype.recursiveRemove=function(){for(var a=Object.keys(this._states),b=0;b<a.length;b++){var c=this._states[a[b]];c.recursiveRemove()}this._states={}},a.prototype.removeState=function(a){if(this._states[a]){if(this.initialState===a)throw new Error("Cannot remove initial state");this.currentState===this._states[a]&&this.reset(),delete this._states[a]}},a.prototype.setInitialState=function(a){this.initialState=a},a}),define("goo/statemachine/FSMUtil",[],function(){"use strict";function a(){}function b(a){for(var b=[],c=Object.keys(a),d=0;d<c.length;d++)b[a[c[d]]]=c[d];return b}a.setParameters=function(a,b){for(var c=0;c<b.length;c++){var d=b[c],e=d.key;this[e]="undefined"!=typeof a[e]?a[e]:d["default"]}},a.setTransitions=function(a,b){for(var c=0;c<b.length;c++){var d=b[c],e=d.key;this.transitions=this.transitions||{},this.transitions[e]=a.transitions[e]}},a.getKey=function(b){return a.keys[b]?a.keys[b]:b.charCodeAt(0)},a.keys={Backspace:8,Tab:9,Enter:13,Shift:16,Ctrl:17,Alt:18,Pause:19,Capslock:20,Esc:27,Space:32,Pageup:33,Pagedown:34,End:35,Home:36,Leftarrow:37,Uparrow:38,Rightarrow:39,Downarrow:40,Insert:45,Delete:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,"0numpad":96,"1numpad":97,"2numpad":98,"3numpad":99,"4numpad":100,"5numpad":101,"6numpad":102,"7numpad":103,"8numpad":104,"9numpad":105,Multiply:106,Plus:107,Minus:109,Dot:110,Slash1:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,Equals:187,Comma:188,Slash:191,Backslash:220},a.keyInverse=[],a.keyInverse=b(a.keys),a.keyForCode=function(b){return a.keyInverse[b]?a.keyInverse[b]:"FSMUtil.keyForCode: key not found for code "+b};var c=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)};return a.guid=function(){return c()+c()+"-"+c()+"-"+c()+"-"+c()+"-"+c()+c()+c()},a.getValue=function(a,b){return"number"==typeof a?a:b.getVariable(a)},a.createComposableTween=function(a,b,c,d,e,f){var g=new window.TWEEN.Tween,h=c;return g.from({v:c}).to({v:d}).onUpdate(function(){a[b]+=this.v-h,h=this.v,f&&f()})},a}),define("goo/statemachine/actions/Action",["goo/statemachine/FSMUtil"],function(a){"use strict";function b(a,b){this.id=a,this.configure(b||{})}return b.prototype._setup=function(){},b.prototype._run=function(){},b.prototype.configure=function(b){a.setParameters.call(this,b,this.constructor.external.parameters),a.setTransitions.call(this,b,this.constructor.external.transitions)},b.prototype.enter=function(a){this._setup(a),this.everyFrame||this._run(a)},b.prototype.update=function(a){this.everyFrame&&this._run(a)},b.prototype.ready=function(){},b.prototype.cleanup=function(){},b.prototype.exit=function(){},b}),define("goo/statemachine/actions/MoveAction",["goo/statemachine/actions/Action","goo/math/Vector3"],function(a,b){"use strict";function c(){a.apply(this,arguments)}return c.prototype=Object.create(a.prototype),c.prototype.constructor=c,c.external={name:"Move",description:"Moves the entity",parameters:[{name:"Translation",key:"translation",type:"position",description:"Move","default":[0,0,0]},{name:"Oriented",key:"oriented",type:"boolean",description:"If true translate with rotation","default":!0},{name:"Relative",key:"relative",type:"boolean",description:"If true add to current translation","default":!0},{name:"On every frame",key:"everyFrame",type:"boolean",description:"Repeat this action every frame","default":!0}],transitions:[]},c.prototype._setup=function(a){var c=a.getOwnerEntity(),d=c.transformComponent.transform;this.forward=(new b).seta(this.translation);var e=d.rotation;e.applyPost(this.forward)},c.prototype._run=function(a){var c=a.getOwnerEntity(),d=c.transformComponent.transform,e=d.translation;if(this.oriented)if(this.relative){var f=(new b).seta(this.translation),g=d.rotation;g.applyPost(f),this.everyFrame?(f.scale(1e3*a.getTpf()),e.add(f)):e.add(f)}else e.set(this.forward);else if(this.relative)if(this.everyFrame){var h=1e3*a.getTpf();e.data[0]+=this.translation[0]*h,e.data[1]+=this.translation[1]*h,e.data[2]+=this.translation[2]*h}else e.add(this.translation);else e.set(this.translation);c.transformComponent.setUpdated()},c}),define("goo/statemachine/actions/RotateAction",["goo/statemachine/actions/Action","goo/math/MathUtils"],function(a,b){"use strict";function c(){a.apply(this,arguments)}return c.prototype=Object.create(a.prototype),c.prototype.constructor=c,c.external={name:"Rotate",description:"Rotates the entity",parameters:[{name:"Rotation",key:"rotation",type:"rotation",description:"Rotate","default":[0,0,0]},{name:"Relative",key:"relative",type:"boolean",description:"If true add to current rotation","default":!0},{name:"On every frame",key:"everyFrame",type:"boolean",description:"Repeat this action every frame","default":!0}],transitions:[]},c.prototype._run=function(a){var c=a.getOwnerEntity(),d=c.transformComponent.transform;if(this.relative)if(this.everyFrame){var e=1e3*a.getTpf();d.rotation.rotateX(this.rotation[0]*b.DEG_TO_RAD*e),d.rotation.rotateY(this.rotation[1]*b.DEG_TO_RAD*e),d.rotation.rotateZ(this.rotation[2]*b.DEG_TO_RAD*e)}else d.rotation.rotateX(this.rotation[0]*b.DEG_TO_RAD),d.rotation.rotateY(this.rotation[1]*b.DEG_TO_RAD),d.rotation.rotateZ(this.rotation[2]*b.DEG_TO_RAD);else if(this.everyFrame){var e=1e3*a.getTpf();d.setRotationXYZ(this.rotation[0]*b.DEG_TO_RAD*e,this.rotation[1]*b.DEG_TO_RAD*e,this.rotation[2]*b.DEG_TO_RAD*e)}else d.setRotationXYZ(this.rotation[0]*b.DEG_TO_RAD,this.rotation[1]*b.DEG_TO_RAD,this.rotation[2]*b.DEG_TO_RAD);c.transformComponent.setUpdated()},c}),define("goo/statemachine/actions/ScaleAction",["goo/statemachine/actions/Action"],function(a){"use strict";function b(){a.apply(this,arguments)}return b.prototype=Object.create(a.prototype),b.prototype.constructor=b,b.external={name:"Scale",description:"Scales the entity",parameters:[{name:"Scale",key:"scale",type:"position",description:"Move","default":[0,0,0]},{name:"Relative",key:"relative",type:"boolean",description:"If true add/multiply the current scaling","default":!0},{name:"Multiply",key:"multiply",type:"boolean",description:"If true multiply, otherwise add","default":!1},{name:"On every frame",key:"everyFrame",type:"boolean",description:"Repeat this action every frame","default":!1}],transitions:[]},b.prototype._run=function(a){var b=a.getOwnerEntity(),c=b.transformComponent.transform;if(this.relative)if(this.multiply)if(this.everyFrame){var d=1e3*a.getTpf();c.scale.data[0]*=this.scale[0]*d,c.scale.data[1]*=this.scale[1]*d,c.scale.data[2]*=this.scale[2]*d}else c.scale.mul(this.scale);else if(this.everyFrame){var d=1e3*a.getTpf();c.scale.data[0]+=this.scale[0]*d,c.scale.data[1]+=this.scale[1]*d,c.scale.data[2]+=this.scale[2]*d}else c.scale.add(this.scale);else c.scale.set(this.scale);b.transformComponent.setUpdated()},b}),define("goo/statemachine/actions/LookAtAction",["goo/statemachine/actions/Action","goo/math/Vector3"],function(a,b){"use strict";function c(){a.apply(this,arguments)}return c.prototype=Object.create(a.prototype),c.prototype.constructor=c,c.external={name:"Look At",description:"Reorients an entity so that it's facing a specific point",parameters:[{name:"Look at position",key:"lookAt",type:"position",description:"Position to look at","default":[0,0,0]},{name:"On every frame",key:"everyFrame",type:"boolean",description:"Repeat this action every frame","default":!0}],transitions:[]},c.prototype._run=function(a){var c=a.getOwnerEntity(),d=c.transformComponent;d.transform.lookAt(new b(this.lookAt),b.UNIT_Y),d.setUpdated()},c}),define("goo/statemachine/actions/TweenMoveAction",["goo/statemachine/actions/Action","goo/math/Vector3"],function(a,b){"use strict";function c(){a.apply(this,arguments)}return c.prototype=Object.create(a.prototype),c.prototype.constructor=c,c.external={name:"Tween Move",description:"Smoothly transitions between two locations",canTransition:!0,parameters:[{name:"Translation",key:"to",type:"position",description:"Move","default":[0,0,0]},{name:"Relative",key:"relative",type:"boolean",description:"If true add, otherwise set","default":!0},{name:"Time",key:"time",type:"number",description:"Time it takes for this movement to complete","default":1e3},{name:"Easing type",key:"easing1",type:"dropdown",description:"Easing type","default":"Linear",options:["Linear","Quadratic","Exponential","Circular","Elastic","Back","Bounce"]},{name:"Direction",key:"easing2",type:"dropdown",description:"Easing direction","default":"In",options:["In","Out","InOut"]}],transitions:[{key:"complete",name:"On Completion",description:"State to transition to when the movement completes"}]},c.prototype.configure=function(a){this.to=a.to,this.relative=a.relative,this.time=a.time,this.easing="Linear"===a.easing1?window.TWEEN.Easing.Linear.None:window.TWEEN.Easing[a.easing1][a.easing2],this.eventToEmit={channel:a.transitions.complete}},c.prototype._setup=function(){this.tween=new window.TWEEN.Tween},c.prototype.cleanup=function(){this.tween&&this.tween.stop()},c.prototype._run=function(a){var c,d=a.getOwnerEntity(),e=d.transformComponent,f=e.transform.translation,g=(new b).copy(f),h={x:g.x,y:g.y,z:g.z},i={x:h.x,y:h.y,z:h.z};if(this.relative){var j=b.add(g,this.to);c={x:j.x,y:j.y,z:j.z},this.tween.from(h).to(c,+this.time).easing(this.easing).onUpdate(function(){f.data[0]+=this.x-i.x,f.data[1]+=this.y-i.y,f.data[2]+=this.z-i.z,i.x=this.x,i.y=this.y,i.z=this.z,e.setUpdated()}).onComplete(function(){a.send(this.eventToEmit.channel)}.bind(this)).start(1e3*a.getTime())}else c={x:this.to[0],y:this.to[1],z:this.to[2]},this.tween.from(h).to(c,+this.time).easing(this.easing).onUpdate(function(){f.data[0]+=this.x-i.x,f.data[1]+=this.y-i.y,f.data[2]+=this.z-i.z,i.x=this.x,i.y=this.y,i.z=this.z,e.setUpdated()}).onComplete(function(){a.send(this.eventToEmit.channel)}.bind(this)).start(1e3*a.getTime())},c}),define("goo/statemachine/actions/TweenRotationAction",["goo/statemachine/actions/Action","goo/math/Quaternion","goo/math/Matrix3x3","goo/math/MathUtils"],function(a,b,c,d){"use strict";function e(){a.apply(this,arguments)}return e.prototype=Object.create(a.prototype),e.prototype.constructor=e,e.external={name:"Tween Rotation",description:"Smoothly transitions between two orientations",canTransition:!0,parameters:[{name:"Rotation",key:"to",type:"rotation",description:"Rotation","default":[0,0,0]},{name:"Relative",key:"relative",type:"boolean",description:"If true add, otherwise set","default":!0},{name:"Time",key:"time",type:"number",description:"Time it takes for this movement to complete","default":1e3},{name:"Easing type",key:"easing1",type:"dropdown",description:"Easing type","default":"Linear",options:["Linear","Quadratic","Exponential","Circular","Elastic","Back","Bounce"]},{name:"Direction",key:"easing2",type:"dropdown",description:"Easing direction","default":"In",options:["In","Out","InOut"]}],transitions:[{key:"complete",name:"On Completion",description:"State to transition to when the rotation completes"}]},e.prototype.configure=function(a){this.to=a.to,this.relative=a.relative,this.time=a.time,this.easing="Linear"===a.easing1?window.TWEEN.Easing.Linear.None:window.TWEEN.Easing[a.easing1][a.easing2],this.eventToEmit={channel:a.transitions.complete}},e.prototype._setup=function(){this.tween=new window.TWEEN.Tween},e.prototype.cleanup=function(){this.tween&&this.tween.stop()},e.prototype._run=function(a){var e=a.getOwnerEntity(),f=e.transformComponent,g=f.transform.rotation,h=(new b).fromRotationMatrix(g),i=(new b).fromRotationMatrix((new c).fromAngles(this.to[0]*d.DEG_TO_RAD,this.to[1]*d.DEG_TO_RAD,this.to[2]*d.DEG_TO_RAD)),j=new b;this.relative&&b.mul2(h,i,i),this.tween.from({t:0}).to({t:1},+this.time).easing(this.easing).onUpdate(function(){b.slerp(h,i,this.t,j),g.copyQuaternion(j),f.setUpdated()}).onComplete(function(){a.send(this.eventToEmit.channel)}.bind(this)).start(1e3*a.getTime())},e}),define("goo/statemachine/actions/TweenScaleAction",["goo/statemachine/actions/Action","goo/math/Vector3"],function(a,b){"use strict";function c(){a.apply(this,arguments)}return c.prototype=Object.create(a.prototype),c.prototype.constructor=c,c.external={name:"Tween Scale",description:"Smoothly scales the entity",canTransition:!0,parameters:[{name:"Scale",key:"to",type:"position",description:"Scale","default":[0,0,0]},{name:"Relative",key:"relative",type:"boolean",description:"If true add, otherwise set","default":!0},{name:"Time",key:"time",type:"number",description:"Time it takes for this movement to complete","default":1e3},{name:"Easing type",key:"easing1",type:"dropdown",description:"Easing type","default":"Linear",options:["Linear","Quadratic","Exponential","Circular","Elastic","Back","Bounce"]},{name:"Direction",key:"easing2",type:"dropdown",description:"Easing direction","default":"In",options:["In","Out","InOut"]}],transitions:[{key:"complete",name:"On Completion",description:"State to transition to when the scaling completes"}]},c.prototype.configure=function(a){this.to=a.to,this.relative=a.relative,this.time=a.time,this.easing="Linear"===a.easing1?window.TWEEN.Easing.Linear.None:window.TWEEN.Easing[a.easing1][a.easing2],this.eventToEmit={channel:a.transitions.complete}},c.prototype._setup=function(){this.tween=new window.TWEEN.Tween},c.prototype.cleanup=function(){this.tween&&this.tween.stop()},c.prototype._run=function(a){var c,d=a.getOwnerEntity(),e=d.transformComponent,f=e.transform.scale,g=(new b).copy(f),h={x:g.x,y:g.y,z:g.z};if(this.relative){var i=b.add(g,this.to);c={x:i.x,y:i.y,z:i.z},this.tween.from(h).to(c,+this.time).easing(this.easing).onUpdate(function(){f.setd(this.x,this.y,this.z),e.setUpdated()}).onComplete(function(){a.send(this.eventToEmit.channel)}.bind(this)).start(1e3*a.getTime())}else c={x:this.to[0],y:this.to[1],z:this.to[2]},this.tween.from(h).to(c,+this.time).easing(this.easing).onUpdate(function(){f.setd(this.x,this.y,this.z),e.setUpdated()}).onComplete(function(){a.send(this.eventToEmit.channel)}.bind(this)).start(1e3*a.getTime())},c}),define("goo/statemachine/actions/TweenLookAtAction",["goo/statemachine/actions/Action","goo/math/Vector3"],function(a,b){"use strict";function c(){a.apply(this,arguments)}return c.prototype=Object.create(a.prototype),c.prototype.constructor=c,c.external={name:"Tween Look At",description:"Smoothly transitions between two look at points",canTransition:!0,parameters:[{name:"Position",key:"to",type:"position",description:"Look at point","default":[0,0,0]},{name:"Time",key:"time",type:"number",description:"Time it takes for this movement to complete","default":1e3},{name:"Easing type",key:"easing1",type:"dropdown",description:"Easing type","default":"Linear",options:["Linear","Quadratic","Exponential","Circular","Elastic","Back","Bounce"]},{name:"Direction",key:"easing2",type:"dropdown",description:"Easing direction","default":"In",options:["In","Out","InOut"]}],transitions:[{key:"complete",name:"On completion",description:"State to transition to when the transition completes"}]},c.prototype.configure=function(a){this.to=a.to,this.relative=a.relative,this.time=a.time,this.easing="Linear"===a.easing1?window.TWEEN.Easing.Linear.None:window.TWEEN.Easing[a.easing1][a.easing2],this.eventToEmit={channel:a.transitions.complete}},c.prototype._setup=function(){this.tween=new window.TWEEN.Tween},c.prototype.cleanup=function(){this.tween&&this.tween.stop()},c.prototype._run=function(a){var c=a.getOwnerEntity(),d=c.transformComponent,e=d.transform,f=b.distance(new b(this.to),e.translation),g=new b(0,0,1),h=e.rotation;h.applyPost(g),g.scale(f);var i={x:g.x,y:g.y,z:g.z},j={x:this.to[0],y:this.to[1],z:this.to[2]},k=new b;this.tween.from(i).to(j,+this.time).easing(this.easing).onUpdate(function(){k.data[0]=this.x,k.data[1]=this.y,k.data[2]=this.z,e.lookAt(k,b.UNIT_Y),d.setUpdated()}).onComplete(function(){a.send(this.eventToEmit.channel)}.bind(this)).start(1e3*a.getTime())},c}),define("goo/statemachine/actions/HideAction",["goo/statemachine/actions/Action","goo/entities/EntityUtils"],function(a,b){"use strict";function c(){a.apply(this,arguments)}return c.prototype=Object.create(a.prototype),c.prototype.constructor=c,c.external={name:"Hide",description:"Hides an entity and its children",parameters:[],transitions:[]},c.prototype._run=function(a){var c=a.getOwnerEntity();b.hide(c)},c}),define("goo/statemachine/actions/ShowAction",["goo/statemachine/actions/Action","goo/entities/EntityUtils"],function(a,b){"use strict";function c(){a.apply(this,arguments)}return c.prototype=Object.create(a.prototype),c.prototype.constructor=c,c.external={name:"Show",description:"Makes an entity visible",parameters:[],transitions:[]},c.prototype._run=function(a){var c=a.getOwnerEntity();b.show(c)},c}),define("goo/statemachine/actions/RemoveAction",["goo/statemachine/actions/Action"],function(a){"use strict";function b(){a.apply(this,arguments)}return b.prototype=Object.create(a.prototype),b.prototype.constructor=b,b.external={name:"Remove",description:"Removes the entity from the world",parameters:[{name:"Recursive",key:"recursive",type:"boolean",description:"Remove children too","default":!1}],transitions:[]},b.prototype._run=function(a){var b=a.getOwnerEntity();b.removeFromWorld(this.recursive)},b}),define("goo/statemachine/actions/AddLightAction",["goo/statemachine/actions/Action","goo/entities/components/LightComponent","goo/renderer/light/PointLight"],function(a,b,c){"use strict";function d(){a.apply(this,arguments)}return d.prototype=Object.create(a.prototype),d.prototype.constructor=d,d.external={name:"Add Light",description:"Adds a light on the entity",parameters:[{name:"Color",key:"color",type:"color",description:"Color of the light","default":[1,1,1]},{name:"Range",key:"range",type:"int",control:"slider",min:0,max:5e3,description:"Range of the light","default":200}],transitions:[]},d.prototype._run=function(a){var d=new c;d.range=+this.range,d.color.setd(this.color[0],this.color[1],this.color[2]);var e=a.getOwnerEntity();e.setComponent(new b(d))},d.prototype.cleanup=function(a){var b=a.getOwnerEntity();b.hasComponent("LightComponent")&&b.clearComponent("LightComponent")},d}),define("goo/statemachine/actions/RemoveLightAction",["goo/statemachine/actions/Action"],function(a){"use strict";function b(){a.apply(this,arguments)}return b.prototype=Object.create(a.prototype),b.prototype.constructor=b,b.external={name:"Remove Light",description:"Removes the light attached to the entity",parameters:[],transitions:[]},b.prototype._run=function(a){var b=a.getOwnerEntity();b.hasComponent("LightComponent")&&b.clearComponent("LightComponent")},b}),define("goo/statemachine/actions/InBoxAction",["goo/statemachine/actions/Action"],function(a){"use strict";function b(){a.apply(this,arguments)}function c(a,b,c){var d=!1,e=function(a,b,c){if(b>c){if(b>a&&a>c)return!0}else if(c>b){if(c>a&&a>b)return!0}else if(a===c)return!0;return!1},f=e(a[0],b[0],c[0]),g=e(a[1],b[1],c[1]),h=e(a[2],b[2],c[2]);return f&&g&&h&&(d=!0),d}return b.prototype=Object.create(a.prototype),b.prototype.constructor=b,b.external={name:"In Box",description:"Performs a transition based on whether an entity is inside a user defined box or not",canTransition:!0,parameters:[{name:"Point1",key:"point1",type:"position",description:"First box point","default":[-1,-1,-1]},{name:"Point2",key:"point2",type:"position",description:"Second box point","default":[1,1,1]},{name:"On every frame",key:"everyFrame",type:"boolean",description:"Repeat this action every frame","default":!0}],transitions:[{key:"inside",name:"Inside",description:"State to transition to if the entity is inside the box"},{key:"outside",name:"Outside",description:"State to transition to if the entity is outside the box"}]},b.prototype._run=function(a){var b=a.getOwnerEntity(),d=b.transformComponent.worldTransform.translation,e=c(d.data,this.point1,this.point2);e?a.send(this.transitions.inside):a.send(this.transitions.outside)},b}),define("goo/statemachine/actions/CompareDistanceAction",["goo/statemachine/actions/Action","goo/math/Vector3","goo/renderer/Renderer"],function(a,b,c){"use strict";function d(){a.apply(this,arguments)}return d.prototype=Object.create(a.prototype),d.prototype.constructor=d,d.external={name:"Compare Distance",description:"Performs a transition based on the distance to the main camera or to a location",canTransition:!0,parameters:[{name:"Current camera",key:"camera",type:"boolean",description:"Measure the distance to the current camera or to an arbitrary point","default":!0},{name:"Position",key:"position",type:"position",description:"Position to measure the distance to; Will be ignored if previous option is selected","default":[0,0,0]},{name:"Value",key:"value",type:"number",description:"Value to compare to","default":0},{name:"Tolerance",key:"tolerance",type:"number","default":.1},{name:"Type",key:"distanceType",type:"dropdown",description:"The type of distance","default":"Euclidean",options:["Euclidean","Manhattan"]},{name:"On every frame",key:"everyFrame",type:"boolean",description:"Repeat this action every frame","default":!0}],transitions:[{key:"less",name:"Less",description:"State to transition to if the measured distance is smaller than the specified value"},{key:"equal",name:"Equal",description:"State to transition to if the measured distance is about the same as the specified value"},{key:"greater",name:"Greater",description:"State to transition to if the measured distance is greater than the specified value"}]},d.prototype._run=function(a){var d,e=a.getOwnerEntity(),f=e.transformComponent.worldTransform.translation;
d=this.camera?b.sub(f,c.mainCamera.translation):b.sub(f,new b(this.position));var g;g="Euclidean"===this.type?d.length():Math.abs(d.x)+Math.abs(d.y)+Math.abs(d.z);var h=this.value-g;Math.abs(h)<=this.tolerance?a.send(this.transitions.equal):h>0?a.send(this.transitions.less):a.send(this.transitions.greater)},d}),define("goo/statemachine/actions/SetClearColorAction",["goo/statemachine/actions/Action"],function(a){"use strict";function b(){a.apply(this,arguments)}return b.prototype=Object.create(a.prototype),b.prototype.constructor=b,b.external={name:"Set Clear Color",description:"Sets the clear color",parameters:[{name:"Color",key:"color",type:"color",description:"Color","default":[1,1,1]}],transitions:[]},b.prototype._run=function(a){var b=a.getOwnerEntity(),c=b._world.gooRunner;c.renderer.setClearColor(this.color[0],this.color[1],this.color[2],1)},b}),define("goo/statemachine/actions/InFrustumAction",["goo/statemachine/actions/Action","goo/renderer/Camera","goo/renderer/bounds/BoundingSphere"],function(a,b,c){"use strict";function d(){a.apply(this,arguments)}return d.prototype=Object.create(a.prototype),d.prototype.constructor=d,d.external={name:"In Frustum",description:"Performs a transition based on whether the entity is in a camera's frustum or not",canTransition:!0,parameters:[{name:"Current camera",key:"current",type:"boolean",description:"Check this to always use the current camera","default":!0},{name:"Camera",key:"cameraEntityRef",type:"cameraEntity",description:"Other camera; Will be ignored if the previous option is checked","default":null},{name:"On every frame",key:"everyFrame",type:"boolean",description:"Repeat this action every frame","default":!0}],transitions:[{key:"inside",name:"Inside",description:"State to transition to if entity is in the frustum"},{key:"outside",name:"Outside",description:"State to transition to if entity is outside the frustum"}]},d.prototype._setup=function(a){if(!this.current){var b=a.getOwnerEntity()._world,c=b.entityManager.getEntityByName(this.cameraEntityRef);this.camera=c.cameraComponent.camera}},d.prototype._run=function(a){var d=a.getOwnerEntity();if(this.current)d.isVisible?a.send(this.transitions.inside):a.send(this.transitions.outside);else{var e=d.meshDataComponent?d.meshDataComponent.modelBound:new c(d.transformComponent.worldTransform.translation,.001);this.camera.contains(e)===b.Outside?a.send(this.transitions.outside):a.send(this.transitions.inside)}},d}),define("goo/statemachine/actions/TransitionAction",["goo/statemachine/actions/Action"],function(a){"use strict";function b(){a.apply(this,arguments)}return b.prototype=Object.create(a.prototype),b.prototype.constructor=b,b.external={name:"Transition",description:"Performs a transition",canTransition:!0,parameters:[],transitions:[{key:"transition",name:"To",description:"State to transition to"}]},b.prototype._run=function(a){a.send(this.transitions.transition)},b}),define("goo/statemachine/actions/EmitAction",["goo/statemachine/actions/Action"],function(a){"use strict";function b(){a.apply(this,arguments)}return b.prototype=Object.create(a.prototype),b.prototype.constructor=b,b.external={name:"Emit message",description:"Emits a message on the bus",parameters:[{name:"Channel",key:"channel",type:"string",description:"Channel to transmit on","default":""},{name:"Data",key:"data",type:"string",description:"Data to send","default":""}],transitions:[]},b.prototype._run=function(a){a.send(this.channel,this.data)},b}),define("goo/statemachine/actions/EvalAction",["goo/statemachine/actions/Action"],function(Action){"use strict";function EvalAction(){Action.apply(this,arguments)}return EvalAction.prototype=Object.create(Action.prototype),EvalAction.prototype.constructor=EvalAction,EvalAction.external={name:"Eval",description:"Evaluates a JS expression",parameters:[{name:"expression",key:"expression",type:"string",description:"JavaScript expression to evaluate","default":""}],transitions:[]},EvalAction.prototype._run=function(){eval(this.expression)},EvalAction}),define("goo/statemachine/actions/SwitchCameraAction",["goo/statemachine/actions/Action","goo/entities/SystemBus","goo/renderer/Renderer"],function(a,b,c){"use strict";function d(){a.apply(this,arguments),this._camera=null}return d.prototype=Object.create(a.prototype),d.prototype.constructor=d,d.external={name:"Switch Camera",description:"Switches between cameras",parameters:[{name:"Camera",key:"cameraEntityRef",type:"cameraEntity",description:"Camera to switch to","default":null}],transitions:[]},d.prototype.ready=function(){this._camera=c.mainCamera},d.prototype._run=function(a){var c=a.getOwnerEntity()._world,d=c.entityManager.getEntityByName(this.cameraEntityRef);d&&d.cameraComponent&&b.emit("goo.setCurrentCamera",d.cameraComponent.camera)},d.prototype.cleanup=function(){b.emit("goo.setCurrentCamera",this._camera)},d}),define("goo/statemachine/actions/LogMessageAction",["goo/statemachine/actions/Action"],function(a){"use strict";function b(){a.apply(this,arguments)}return b.prototype=Object.create(a.prototype),b.prototype.constructor=b,b.external={name:"Log Message",description:"Prints a message in the debug console of your browser",parameters:[{name:"Message",key:"message",type:"string",description:"Message to print","default":"hello"},{name:"On every frame",key:"everyFrame",type:"boolean",description:"Repeat this action every frame","default":!1}],transitions:[]},b.prototype._run=function(){console.log(this.message)},b}),define("goo/statemachine/actions/PauseAnimationAction",["goo/statemachine/actions/Action"],function(a){"use strict";function b(){a.apply(this,arguments)}return b.prototype=Object.create(a.prototype),b.prototype.constructor=b,b.external={name:"Pause Animation",description:"Pauses animations",parameters:[{name:"On all",key:"onAll",type:"boolean",description:"Pause animation on all entities or just one","default":!1}],transitions:[]},b.prototype._run=function(a){if(this.onAll){var b=a.getWorld(),c=b.getSystem("AnimationSystem");c.pause()}else{var d=a.getOwnerEntity();d.animationComponent&&d.animationComponent.pause()}},b}),define("goo/statemachine/actions/ResumeAnimationAction",["goo/statemachine/actions/Action"],function(a){"use strict";function b(){a.apply(this,arguments)}return b.prototype=Object.create(a.prototype),b.prototype.constructor=b,b.external={name:"Resume Animation",description:"Continues playing an animation",parameters:[{name:"On all",key:"onAll",type:"boolean",description:"Resume animation on all entities or just one","default":!1}],transitions:[]},b.prototype._run=function(a){if(this.onAll){var b=a.getWorld(),c=b.getSystem("AnimationSystem");c.resume()}else{var d=a.getOwnerEntity();d.animationComponent&&d.animationComponent.resume()}},b}),define("goo/statemachine/actions/SetAnimationAction",["goo/statemachine/actions/Action"],function(a){"use strict";function b(){a.apply(this,arguments),this.everyFrame=!1}return b.prototype=Object.create(a.prototype),b.prototype.constructor=b,b.external={name:"Set Animation",description:"Transitions between animations",parameters:[{name:"Animation",key:"animation",type:"animstate"}],transitions:[]},b.prototype._run=function(a){var b=a.getOwnerEntity();"string"==typeof this.animation&&b.animationComponent&&b.animationComponent.transitionTo(this.animation)},b}),define("goo/statemachine/actions/MouseUpAction",["goo/statemachine/actions/Action"],function(a){"use strict";function b(){a.apply(this,arguments),this.everyFrame=!0,this.updated=!1,this.eventListener=function(){this.updated=!0}.bind(this)}return b.prototype=Object.create(a.prototype),b.prototype.constructor=b,b.external={name:"Mouse Up",description:"Listens for a mouse button release and performs a transition",canTransition:!0,parameters:[],transitions:[{key:"mouseup",name:"Mouse up",description:"State to transition to when the mouse button is pressed"}]},b.prototype._setup=function(){document.addEventListener("mouseup",this.eventListener)},b.prototype._run=function(a){this.updated&&(this.updated=!1,a.send(this.transitions.mouseup))},b.prototype.exit=function(){document.removeEventListener("mouseup",this.eventListener)},b}),define("goo/statemachine/actions/MouseDownAction",["goo/statemachine/actions/Action"],function(a){"use strict";function b(){a.apply(this,arguments),this.everyFrame=!0,this.updated=!1,this.eventListener=function(){this.updated=!0}.bind(this)}return b.prototype=Object.create(a.prototype),b.prototype.constructor=b,b.external={name:"Mouse down",description:"Listens for a mouse button press and performs a transition",canTransition:!0,parameters:[],transitions:[{key:"mousedown",name:"Mouse down",description:"State to transition to when the mouse button is pressed"}]},b.prototype._setup=function(){document.addEventListener("mousedown",this.eventListener)},b.prototype._run=function(a){this.updated&&(this.updated=!1,a.send(this.transitions.mousedown))},b.prototype.exit=function(){document.removeEventListener("mousedown",this.eventListener)},b}),define("goo/statemachine/actions/MouseMoveAction",["goo/statemachine/actions/Action"],function(a){"use strict";function b(){a.apply(this,arguments),this.everyFrame=!0,this.updated=!1,this.eventListener=function(){this.updated=!0}.bind(this)}return b.prototype=Object.create(a.prototype),b.prototype.constructor=b,b.external={name:"Mouse Move",description:"Listens for mouse movement and performs a transition",canTransition:!0,parameters:[],transitions:[{key:"mousemove",name:"Mouse move",description:"State to transition to when on mouse movement"}]},b.prototype._setup=function(){document.addEventListener("mousemove",this.eventListener)},b.prototype._run=function(a){this.updated&&(this.updated=!1,a.send(this.transitions.mousemove))},b.prototype.exit=function(){document.removeEventListener("mousemove",this.eventListener)},b}),define("goo/statemachine/actions/KeyUpAction",["goo/statemachine/actions/Action"],function(a){"use strict";function b(){a.apply(this,arguments),this.everyFrame=!0,this.updated=!1,this.eventListener=function(a){this.key&&a.which!==+this.key||(this.updated=!0)}.bind(this)}return b.prototype=Object.create(a.prototype),b.prototype.constructor=b,b.external={name:"Key Up",description:"Listens for a key release and performs a transition",canTransition:!0,parameters:[{name:"Key",key:"key",type:"key",description:"Key to listen for"}],transitions:[{key:"keyup",name:"Key up",description:"State to transition to when the key is released"}]},b.prototype._setup=function(){document.addEventListener("keyup",this.eventListener)},b.prototype._run=function(a){this.updated&&(this.updated=!1,a.send(this.transitions.keyup))},b.prototype.exit=function(){document.removeEventListener("keyup",this.eventListener)},b}),define("goo/statemachine/actions/KeyDownAction",["goo/statemachine/actions/Action"],function(a){"use strict";function b(){a.apply(this,arguments),this.everyFrame=!0,this.updated=!1,this.eventListener=function(a){a.which===+this.key&&(this.updated=!0)}.bind(this)}return b.prototype=Object.create(a.prototype),b.prototype.constructor=b,b.external={name:"Key Down",description:"Listens for a key press and performs a transition",canTransition:!0,parameters:[{name:"Key",key:"key",type:"key",description:"Key to listen for"}],transitions:[{key:"keydown",name:"Key down",description:"State to transition to when the key is pressed"}]},b.prototype._setup=function(){document.addEventListener("keydown",this.eventListener)},b.prototype._run=function(a){this.updated&&(this.updated=!1,a.send(this.transitions.keydown))},b.prototype.exit=function(){document.removeEventListener("keydown",this.eventListener)},b}),define("goo/statemachine/actions/WASDAction",["goo/statemachine/actions/Action"],function(a){"use strict";function b(){a.apply(this,arguments),this.updated=!1,this.keysPressed={},this.eventListener=function(a){var c=b._keys[a.which];void 0!==c&&(this.updated=!0,this.keysPressed[c]=!0)}.bind(this)}return b.prototype=Object.create(a.prototype),b.prototype.configure=function(a){this.everyFrame=!0,this.targets=a.transitions},b._keys={87:"w",65:"a",83:"s",68:"d"},b.external=function(){var a=[];for(var c in b._keys){var d=b._keys[c];a.push({key:d,name:"Key "+d.toUpperCase(),description:"Key '"+d+"' pressed"})}return{name:"WASD Keys Listener",description:"A 4-in-1 key down listener",canTransition:!0,parameters:[],transitions:a}}(),b.prototype._setup=function(){document.addEventListener("keydown",this.eventListener)},b.prototype._run=function(a){if(this.updated){this.updated=!1;for(var b in this.keysPressed){var c=this.targets[b];"string"==typeof c&&a.send(c)}this.keysPressed=[]}},b.prototype.exit=function(){document.removeEventListener("keydown",this.eventListener)},b}),define("goo/statemachine/actions/ArrowsAction",["goo/statemachine/actions/Action"],function(a){"use strict";function b(){a.apply(this,arguments),this.updated=!1,this.keysPressed={},this.eventListener=function(a){var c=b._keys[a.which];void 0!==c&&(this.updated=!0,this.keysPressed[c]=!0)}.bind(this)}return b.prototype=Object.create(a.prototype),b.prototype.configure=function(a){this.everyFrame=!0,this.targets=a.transitions},b._keys={38:"up",37:"left",40:"down",39:"right"},b.external=function(){var a=[];for(var c in b._keys){var d=b._keys[c];a.push({name:d,key:"Key "+d.toUpperCase(),description:"Key '"+d+"' pressed"})}return{name:"Arrow Keys Listener",description:"A 4-in-1 key down listener",canTransition:!0,parameters:[],transitions:a}}(),b.prototype._setup=function(){document.addEventListener("keydown",this.eventListener)},b.prototype._run=function(a){if(this.updated){this.updated=!1;for(var b in this.keysPressed){var c=this.targets[b];"string"==typeof c&&a.send(c)}this.keysPressed=[]}},b.prototype.exit=function(){document.removeEventListener("keydown",this.eventListener)},b}),define("goo/statemachine/actions/SetRenderTargetAction",["goo/statemachine/actions/Action","goo/entities/components/PortalComponent","goo/entities/systems/PortalSystem","goo/math/Vector3","goo/entities/components/CameraComponent","goo/renderer/Camera","goo/renderer/Material","goo/renderer/shaders/ShaderLib"],function(a,b,c,d,e,f,g,h){"use strict";function i(){a.apply(this,arguments)}return i.prototype=Object.create(a.prototype),i.prototype.constructor=i,i.external={name:"Set Render Target",description:"Renders what a camera sees on the current entity's texture",parameters:[{name:"Camera",key:"cameraEntityRef",type:"cameraEntity",description:"Camera to use as source","default":null}],transitions:[]},i.prototype._run=function(a){var d=a.getOwnerEntity(),e=d._world;if(!e.getSystem("PortalSystem")){var f=e.getSystem("RenderSystem"),i=e.gooRunner.renderer;e.setSystem(new c(i,f))}var j=e.entityManager.getEntityByName(this.cameraEntityRef),k=j.cameraComponent.camera,l=g.createMaterial(h.textured,"");this.oldMaterials=d.meshRendererComponent.materials,d.meshRendererComponent.materials=[l];var m=new b(k,500,{preciseRecursion:!0});d.setComponent(m)},i.prototype.cleanup=function(a){var b=a.getOwnerEntity();b.meshRendererComponent.materials=this.oldMaterials},i}),define("goo/statemachine/actions/WaitAction",["goo/statemachine/actions/Action"],function(a){"use strict";function b(){a.apply(this,arguments),this.everyFrame=!0,this.currentTime=0,this.totalWait=0}return b.prototype=Object.create(a.prototype),b.prototype.constructor=b,b.external={name:"Wait",description:"Performs a transition after a specified amount of time",canTransition:!0,parameters:[{name:"Base Time",key:"waitTime",type:"number",description:"Base time in seconds before transition fires","default":5},{name:"Random Time",key:"randomTime",type:"number",description:"Add up to this much Random time to the base time","default":0}],transitions:[{key:"timeUp",name:"Time up",description:"State to transition to when time up"}]},b.prototype._setup=function(){this.currentTime=0,this.totalWait=parseFloat(this.waitTime)+Math.random()*parseFloat(this.randomTime)},b.prototype._run=function(a){this.currentTime+=a.getTpf(),this.currentTime>=this.totalWait&&a.send(this.transitions.timeUp)},b}),define("goo/statemachine/actions/RandomTransitionAction",["goo/statemachine/actions/Action"],function(a){"use strict";function b(){a.apply(this,arguments)}return b.prototype=Object.create(a.prototype),b.prototype.constructor=b,b.external={name:"Random Transition",description:"Performs a random transition",canTransition:!0,parameters:[{name:"Skewness",key:"skewness",type:"float",control:"slider",min:0,max:1,description:"Determines the chance that the first destination is picked over the second","default":1}],transitions:[{key:"transition1",name:"Destination 1",description:"First choice"},{key:"transition2",name:"Destination 2",description:"Second choice"}]},b.prototype._run=function(a){Math.random()<+this.skewness?a.send(this.transitions.transition1):a.send(this.transitions.transition2)},b}),define("goo/statemachine/actions/ShakeAction",["goo/statemachine/actions/Action","goo/math/Vector3"],function(a,b){"use strict";function c(){a.apply(this,arguments)}return c.prototype=Object.create(a.prototype),c.prototype.constructor=c,c.external={name:"Shake",description:"Shakes the entity",canTransition:!0,parameters:[{name:"Start level",key:"startLevel",type:"number",description:"Shake amount at start","default":0},{name:"End level",key:"endLevel",type:"number",description:"Shake amount at the end","default":10},{name:"Time",key:"time",type:"number",description:"Shake time amount","default":1e3},{name:"Speed",key:"speed",type:"dropdown",description:"Speed of shaking","default":"Fast",options:["Fast","Medium","Slow"]}],transitions:[{key:"complete",name:"On Completion",description:"State to transition to when the shake completes"}]},c.prototype.configure=function(a){this.startLevel=a.startLevel,this.endLevel=a.endLevel,this.time=a.time,this.speed={Fast:1,Medium:2,Slow:4}[a.speed],this.easing=window.TWEEN.Easing.Quadratic.InOut,this.eventToEmit={channel:a.transitions.complete}},c.prototype._setup=function(){this.tween=new window.TWEEN.Tween},c.prototype.cleanup=function(){this.tween&&this.tween.stop()},c.prototype._run=function(a){var c=a.getOwnerEntity(),d=c.transformComponent,e=d.transform.translation,f=new b,g=new b,h=new b,i=this,j=0;this.tween.from({level:+this.startLevel}).to({level:+this.endLevel},+this.time).easing(this.easing).onUpdate(function(){j++,j>i.speed&&(j=0,g.setd(-f.data[0]+2*(Math.random()-.5)*this.level,-f.data[1]+2*(Math.random()-.5)*this.level,-f.data[2]+2*(Math.random()-.5)*this.level)),h.setd(.98*h.data[0]+.1*g.data[0],.98*h.data[1]+.1*g.data[1],.98*h.data[2]+.1*g.data[2]),e.add(h).sub(f),f.copy(h),d.setUpdated()}).onComplete(function(){e.sub(f),d.setUpdated(),a.send(this.eventToEmit.channel)}.bind(this)).start(1e3*a.getTime())},c}),define("goo/particles/ParticleLib",["goo/particles/ParticleUtils"],function(){"use strict";var a={};return a.getSmoke=function(a){return a=a||{},a.scale="undefined"!=typeof a.scale?a.scale:1,a.spread="undefined"!=typeof a.spread?a.speed:2,a.velocity="undefined"!=typeof a.velocity?a.velocity:2,a.color=a.color||[0,0,0],{totalParticlesToSpawn:-1,releaseRatePerSecond:25,minLifetime:.5,maxLifetime:4,getEmissionVelocity:function(b){var c=b.velocity;return c.data[0]=2*(Math.random()-.5)*a.spread*a.scale,c.data[1]=(Math.random()+4)*a.velocity*a.scale,c.data[2]=2*(Math.random()-.5)*a.spread*a.scale,c},timeline:[{timeOffset:0,spin:0,mass:1,size:3*a.scale,color:[a.color[0],a.color[1],a.color[2],1]},{timeOffset:1,size:6*a.scale,color:[a.color[0],a.color[1],a.color[2],0]}]}},a.getFire=function(a){return a=a||{},a.scale="undefined"!=typeof a.scale?a.scale:1,a.spread="undefined"!=typeof a.spread?a.spread:2,a.velocity="undefined"!=typeof a.velocity?a.velocity:10,a.startColor=a.startColor||[1,1,0],a.endColor=a.endColor||[1,0,0],{totalParticlesToSpawn:-1,releaseRatePerSecond:30,minLifetime:.5,maxLifetime:2,getEmissionVelocity:function(b){var c=b.velocity;return c.data[0]=2*(Math.random()-.5)*a.spread*a.scale,c.data[1]=(Math.random()+1)*a.velocity*a.scale,c.data[2]=2*(Math.random()-.5)*a.spread*a.scale,c},timeline:[{timeOffset:0,spin:0,mass:1,size:2*a.scale,color:[a.startColor[0],a.startColor[1],a.startColor[2],1]},{timeOffset:.25,color:[a.endColor[0],a.endColor[1],a.endColor[2],1]},{timeOffset:.25,color:[0,0,0,1]},{timeOffset:.5,size:3,color:[0,0,0,0]}]}},a}),define("goo/util/ParticleSystemUtils",["goo/entities/components/ParticleComponent","goo/entities/components/MeshRendererComponent","goo/entities/components/MeshDataComponent","goo/renderer/Texture","goo/particles/ParticleEmitter"],function(a,b,c,d,e){"use strict";function f(){}return f.createParticleSystemEntity=function(d,f,g){var h=d.world.createEntity(),i=new a({particleCount:500});i.emitters.push(new e(f)),h.setComponent(i);var j=new c(i.meshData);h.setComponent(j);var k=new b;return k.materials.push(g),h.setComponent(k),h},f.createFlareTexture=function(a,b){a=a||64,b=b||{},b.startRadius="undefined"!=typeof b.startRadius?b.startRadius:0,b.endRadius="undefined"!=typeof b.endRadius?b.endRadius:a/2,b.steps=b.steps||[{fraction:0,value:1},{fraction:1,value:0}];var c=document.createElement("canvas");document.body.appendChild(c),c.width=a,c.height=a;for(var e=c.getContext("2d"),f=e.createRadialGradient(a/2,a/2,b.startRadius,a/2,a/2,b.endRadius),g=0;g<b.steps.length;g++){var h=b.steps[g];f.addColorStop(h.fraction,"rgba(255, 255, 255, "+h.value+")")}e.fillStyle=f,e.fillRect(0,0,a,a);var i=e.getImageData(0,0,a,a).data;i=new Uint8Array(i);var j=new d(i,null,a,a);return j},f.createSplashTexture=function(a,b){function c(a,b,c){var d=h.createRadialGradient(a,b,0,a,b,c);d.addColorStop(0,"rgba(255, 255, 255, 0.5)"),d.addColorStop(1,"rgba(255, 255, 255, 0)"),h.fillStyle=d,h.fillRect(a-c,b-c,2*c,2*c)}function e(a,b,d,e,f,g){for(var h=(d-a)/i,j=(e-b)/i,k=(g-f)/i,l=0,m=a,n=b,o=f;i>l;l++,m+=h,n+=j,o+=k)c(m,n,o)}function f(a,b,c,d,f,g,h){for(var i=0;h>i;i++){var j=2*Math.random()*Math.PI,k=4*Math.random()+c,l=4*Math.random()-d;e(a+Math.cos(j)*k,b+Math.sin(j)*k,a+Math.cos(j)*l,b+Math.sin(j)*l,f,g)}}a=a||64,b=b||{},b.nTrails="undefined"!=typeof b.nTrails?b.nTrails:8,b.trailStartRadius="undefined"!=typeof b.trailStartRadius?b.trailStartRadius:1,b.trailEndRadius="undefined"!=typeof b.trailEndRadius?b.trailEndRadius:4;var g=document.createElement("canvas");document.body.appendChild(g),g.width=a,g.height=a;var h=g.getContext("2d"),i=30;f(a/2,a/2,1*(a/2/10),9*(a/2/10),b.trailStartRadius,b.trailEndRadius,b.nTrails);var j=h.getImageData(0,0,a,a).data;j=new Uint8Array(j);var k=new d(j,null,a,a);return k},f.createPlanktonTexture=function(a,b){function c(a,b,c){var d=g.createRadialGradient(a,b,0,a,b,c);d.addColorStop(0,"rgba(255, 255, 255, 1)"),d.addColorStop(.3,"rgba(255, 255, 255, 1)"),d.addColorStop(1,"rgba(255, 255, 255, 0)"),g.fillStyle=d,g.fillRect(a-c,b-c,2*c,2*c)}function e(d){for(var e=0;d>e;e++){var f=Math.random()*(a-2*b.maxRadius)+b.maxRadius,g=Math.random()*(a-2*b.maxRadius)+b.maxRadius;c(f,g,Math.random()*(b.maxRadius-b.minRadius)+b.minRadius)}}a=a||64,console.log(a),b=b||{},b.nPoints="undefined"!=typeof b.nPoints?b.nPoints:10,b.minRadius="undefined"!=typeof b.minRadius?b.minRadius:2,b.maxRadius="undefined"!=typeof b.maxRadius?b.maxRadius:5;var f=document.createElement("canvas");document.body.appendChild(f),f.width=a,f.height=a;var g=f.getContext("2d");e(b.nPoints);var h=g.getImageData(0,0,a,a).data;h=new Uint8Array(h);var i=new d(h,null,a,a);return i},f}),define("goo/statemachine/actions/SmokeAction",["goo/statemachine/actions/Action","goo/renderer/Material","goo/renderer/shaders/ShaderLib","goo/renderer/TextureCreator","goo/particles/ParticleLib","goo/util/ParticleSystemUtils","goo/entities/EntityUtils"],function(a,b,c,d,e,f,g){"use strict";function h(){a.apply(this,arguments)}return h.material=null,h.prototype=Object.create(a.prototype),h.prototype.constructor=h,h.external={name:"Smoke",description:"Makes the entity emit smoke",parameters:[{name:"Color",key:"color",type:"color",description:"Smoke color","default":[0,0,0]}],transitions:[]},h.prototype._run=function(a){var d=a.getOwnerEntity(),g=d._world.gooRunner;if(!h.material){h.material=b.createMaterial(c.particles);var i=f.createFlareTexture();i.generateMipmaps=!0,h.material.setTexture("DIFFUSE_MAP",i),h.material.blendState.blending="AlphaBlending",h.material.cullState.enabled=!1,h.material.depthState.write=!1,h.material.renderQueue=2001}var j=d.transformComponent.worldTransform.scale,k=(j.data[0]+j.data[1]+j.data[2])/3,l=f.createParticleSystemEntity(g,e.getSmoke({scale:k,color:this.color}),h.material);l.name="_ParticleSystemSmoke",d.transformComponent.attachChild(l.transformComponent),l.addToWorld()},h.prototype.cleanup=function(a){for(var b=a.getOwnerEntity(),c=g.getChildren(b),d=0;d<c.length;d++){var e=c[d];-1!==e.name.indexOf("_ParticleSystem")&&e.hasComponent("ParticleComponent")&&e.removeFromWorld()}},h}),define("goo/statemachine/actions/FireAction",["goo/statemachine/actions/Action","goo/renderer/Material","goo/renderer/shaders/ShaderLib","goo/renderer/TextureCreator","goo/particles/ParticleLib","goo/util/ParticleSystemUtils","goo/entities/EntityUtils"],function(a,b,c,d,e,f,g){"use strict";function h(){a.apply(this,arguments)}return h.material=null,h.prototype=Object.create(a.prototype),h.prototype.constructor=h,h.external={name:"Fire",description:"Makes the entity emit fire",parameters:[{name:"Start Color",key:"startColor",type:"color",description:"Flame color at source","default":[1,1,0]},{name:"End color",key:"endColor",type:"color",description:"Color near the end of a flame's life","default":[1,0,0]}],transitions:[]},h.prototype._run=function(a){var d=a.getOwnerEntity(),g=d._world.gooRunner;if(!h.material){h.material=b.createMaterial(c.particles);var i=f.createFlareTexture();i.generateMipmaps=!0,h.material.setTexture("DIFFUSE_MAP",i),h.material.blendState.blending="AdditiveBlending",h.material.cullState.enabled=!1,h.material.depthState.write=!1,h.material.renderQueue=2002}var j=d.transformComponent.worldTransform.scale,k=(j.data[0]+j.data[1]+j.data[2])/3,l=f.createParticleSystemEntity(g,e.getFire({scale:k,startColor:this.startColor,endColor:this.endColor}),h.material);l.name="_ParticleSystemFire",d.transformComponent.attachChild(l.transformComponent),l.addToWorld()},h.prototype.cleanup=function(a){for(var b=a.getOwnerEntity(),c=g.getChildren(b),d=0;d<c.length;d++){var e=c[d];-1!==e.name.indexOf("_ParticleSystem")&&e.hasComponent("ParticleComponent")&&e.removeFromWorld()}},h}),define("goo/statemachine/actions/RemoveParticlesAction",["goo/statemachine/actions/Action","goo/entities/EntityUtils"],function(a,b){"use strict";function c(){a.apply(this,arguments)}return c.prototype=Object.create(a.prototype),c.prototype.constructor=c,c.external={name:"Remove Particles",description:"Removes any particle emitter attached to the entity",parameters:[],transitions:[]},c.prototype._run=function(a){for(var c=a.getOwnerEntity(),d=b.getChildren(c),e=0;e<d.length;e++){var f=d[e];-1!==f.name.indexOf("_ParticleSystem")&&f.hasComponent("ParticleComponent")&&f.removeFromWorld()}},c}),define("goo/statemachine/actions/DollyZoomAction",["goo/statemachine/actions/Action","goo/math/Vector3"],function(a,b){"use strict";function c(){a.apply(this,arguments)}return c.prototype=Object.create(a.prototype),c.prototype.constructor=c,c.external={name:"Dolly Zoom",description:"Performs dolly zoom",parameters:[{name:"Forward",key:"forward",type:"number",description:"Number of units to move towards the focus point; Enter negative values to move away","default":100},{name:"Focus point",key:"lookAt",type:"position",description:"Point to focus on while transitioning","default":[0,0,0]},{name:"Time",key:"time",type:"number",description:"Time","default":1e4},{name:"Easing type",key:"easing1",type:"dropdown",description:"Easing","default":"Linear",options:["Linear","Quadratic","Exponential","Circular","Elastic","Back","Bounce"]},{name:"Direction",key:"easing2",type:"dropdown",description:"Easing direction","default":"In",options:["In","Out","InOut"]}],transitions:[{key:"complete",name:"On Completion",description:"Event fired when the movement completes"}]},c.prototype.configure=function(a){this.forward=a.forward,this.lookAt=a.lookAt,this.time=a.time,this.easing="Linear"===a.easing1?window.TWEEN.Easing.Linear.None:window.TWEEN.Easing[a.easing1][a.easing2],this.eventToEmit={channel:a.transitions.complete}},c.prototype._setup=function(a){this.tween=new window.TWEEN.Tween;var c=a.getOwnerEntity();if(c.cameraComponent&&c.cameraComponent.camera){var d=c.cameraComponent.camera;this.initialDistance=new b(this.lookAt).distance(d.translation),this.eyeTargetScale=Math.tan(d.fov*(Math.PI/180)/2)*this.initialDistance}else this.eyeTargetScale=null},c.prototype.cleanup=function(){this.tween&&this.tween.stop()},c.prototype._run=function(a){if(this.eyeTargetScale){var c=a.getOwnerEntity(),d=c.transformComponent,e=d.transform.translation,f=(new b).copy(e),g=c.cameraComponent.camera,h=new b(this.lookAt).sub(f).normalize().scale(this.forward).add(f),i={x:f.x,y:f.y,z:f.z,d:this.initialDistance},j={x:h.x,y:h.y,z:h.z,d:+this.initialDistance-+this.forward},k={x:i.x,y:i.y,z:i.z},l=this;this.tween.from(i).to(j,+this.time).easing(this.easing).onUpdate(function(){e.data[0]+=this.x-k.x,e.data[1]+=this.y-k.y,e.data[2]+=this.z-k.z,k.x=this.x,k.y=this.y,k.z=this.z,d.setUpdated();var a=2*(180/Math.PI)*Math.atan(l.eyeTargetScale/this.d);g.setFrustumPerspective(a)}).onComplete(function(){a.send(this.eventToEmit.channel)}.bind(this)).start(1e3*a.getTime())}},c}),define("goo/statemachine/actions/TweenTextureOffsetAction",["goo/statemachine/actions/Action"],function(a){"use strict";function b(){a.apply(this,arguments)}return b.prototype=Object.create(a.prototype),b.prototype.constructor=b,b.external={name:"Tween Texture Offset",description:"Smoothly changes the texture offset of the entity",canTransition:!0,parameters:[{name:"X Offset",key:"toX",type:"float",control:"slider",min:0,max:1,description:"X Offset","default":1},{name:"Y Offset",key:"toY",type:"float",control:"slider",min:0,max:1,description:"Y Offset","default":1},{name:"Time",key:"time",type:"number",description:"Time it takes for this transition to complete","default":1e3},{name:"Easing type",key:"easing1",type:"dropdown",description:"Easing type","default":"Linear",options:["Linear","Quadratic","Exponential","Circular","Elastic","Back","Bounce"]},{name:"Direction",key:"easing2",type:"dropdown",description:"Easing direction","default":"In",options:["In","Out","InOut"]}],transitions:[{key:"complete",name:"On Completion",description:"State to transition to when the transition completes"}]},b.prototype.configure=function(a){this.toX=+a.toX,this.toY=+a.toY,this.time=+a.time,this.easing="Linear"===a.easing1?window.TWEEN.Easing.Linear.None:window.TWEEN.Easing[a.easing1][a.easing2],this.eventToEmit={channel:a.transitions.complete}},b.prototype._setup=function(){this.tween=new window.TWEEN.Tween},b.prototype.cleanup=function(){this.tween&&this.tween.stop()},b.prototype._run=function(a){var b=a.getOwnerEntity();if(b.meshRendererComponent&&b.meshRendererComponent.materials.length>0){var c=b.meshRendererComponent,d=c.materials[0],e=d.getTexture("DIFFUSE_MAP"),f=e.offset,g={x:f.x,y:f.y},h={x:this.toX,y:this.toY};this.tween.from(g).to(h,this.time).easing(this.easing).onUpdate(function(){e.offset.setd(this.x,this.y)}).onComplete(function(){a.send(this.eventToEmit.channel)}.bind(this)).start(1e3*a.getTime())}},b}),define("goo/statemachine/actions/PickAction",["goo/statemachine/actions/Action"],function(a){"use strict";function b(){a.apply(this,arguments),this.everyFrame=!0,this.updated=!1,this.eventListener=function(a){a.entity===this.ownerEntity&&(this.updated=!0)}.bind(this)}return b.prototype=Object.create(a.prototype),b.prototype.constructor=b,b.external={name:"Pick",description:"Listens for a picking event and performs a transition",canTransition:!0,parameters:[],transitions:[{key:"pick",name:"Pick",description:"State to transition to when entity is picked"}]},b.prototype._setup=function(a){this.ownerEntity=a.getOwnerEntity(),this.goo=this.ownerEntity._world.gooRunner,this.goo.addEventListener("click",this.eventListener)
},b.prototype._run=function(a){this.updated&&(this.updated=!1,a.send(this.transitions.pick))},b.prototype.exit=function(){this.goo&&this.goo.removeEventListener("click",this.eventListener)},b}),define("goo/statemachine/actions/SoundFadeInAction",["goo/statemachine/actions/Action"],function(a){"use strict";function b(){a.apply(this,arguments)}return b.prototype=Object.create(a.prototype),b.prototype.constructor=b,b.external={name:"Sound Fade In",descriptions:"Starts playing a sound",canTransition:!0,parameters:[{name:"Sound",key:"sound",type:"sound",description:"Sound","default":0},{name:"Time",key:"time",type:"number",description:"Time it takes for the fading to complete","default":1e3}],transitions:[{key:"complete",name:"On Completion",description:"State to transition to when the movement completes"}]},b.prototype._run=function(a){var b=a.getOwnerEntity();if(b.hasComponent("HowlerComponent")){var c=b.howlerComponent.sounds[this.sound];c&&c.fadeIn(c.volume(),this.time,function(){a.send(this.transitions.complete)}.bind(this))}},b}),define("goo/statemachine/actions/SoundFadeOutAction",["goo/statemachine/actions/Action"],function(a){"use strict";function b(){a.apply(this,arguments)}return b.prototype=Object.create(a.prototype),b.prototype.constructor=b,b.external={name:"Sound Fade Out",descriptions:"Fades out a sound and stops it",canTransition:!0,parameters:[{name:"Sound",key:"sound",type:"sound",description:"Sound","default":0},{name:"Time",key:"time",type:"number",description:"Time it takes for the fading to complete","default":1e3}],transitions:[{key:"complete",name:"On Completion",description:"State to transition to when the movement completes"}]},b.prototype._run=function(a){var b=a.getOwnerEntity();if(b.hasComponent("HowlerComponent")){var c=b.howlerComponent.sounds[this.sound];c&&c.fadeOut(0,this.time,function(){a.send(this.transitions.complete)}.bind(this))}},b}),define("goo/statemachine/actions/TransitionOnMessageAction",["goo/statemachine/actions/Action","goo/entities/SystemBus"],function(a,b){"use strict";function c(){a.apply(this,arguments),this.everyFrame=!0,this.updated=!1,this.eventListener=function(){this.updated=!0}.bind(this)}return c.prototype=Object.create(a.prototype),c.prototype.constructor=c,c.external={name:"Transition on Message",description:"Performs a transition on receiving a message",canTransition:!0,parameters:[{name:"Message channel",key:"channel",type:"string",description:"Channel to listen to","default":""}],transitions:[{key:"transition",name:"To",description:"State to transition to"}]},c.prototype._setup=function(){b.addListener(this.channel,this.eventListener)},c.prototype._run=function(a){this.updated&&(this.updated=!1,a.send(this.transitions.transition))},c.prototype.exit=function(){b.removeListener(this.channel,this.eventListener)},c}),define("goo/statemachine/actions/TweenLightColorAction",["goo/statemachine/actions/Action"],function(a){"use strict";function b(){a.apply(this,arguments)}return b.prototype=Object.create(a.prototype),b.prototype.constructor=b,b.external={name:"Tween Light Color",description:"Tweens the color of the light",parameters:[{name:"Color",key:"to",type:"color",description:"Color of the light","default":[1,1,1]},{name:"Time",key:"time",type:"number",description:"Time it takes for the transition to complete","default":1e3},{name:"Easing type",key:"easing1",type:"dropdown",description:"Easing type","default":"Linear",options:["Linear","Quadratic","Exponential","Circular","Elastic","Back","Bounce"]},{name:"Direction",key:"easing2",type:"dropdown",description:"Easing direction","default":"In",options:["In","Out","InOut"]}],transitions:[{key:"complete",name:"On Completion",description:"State to transition to when the transition completes"}]},b.prototype.configure=function(a){this.to=a.to,this.time=a.time,this.easing="Linear"===a.easing1?window.TWEEN.Easing.Linear.None:window.TWEEN.Easing[a.easing1][a.easing2],this.eventToEmit={channel:a.transitions.complete}},b.prototype._setup=function(){this.tween=new window.TWEEN.Tween},b.prototype.cleanup=function(){this.tween&&this.tween.stop()},b.prototype._run=function(a){var b=a.getOwnerEntity();if(b.lightComponent){var c=b.lightComponent,d=c.light.color,e={x:d.x,y:d.y,z:d.z},f={x:this.to[0],y:this.to[1],z:this.to[2]},g={x:e.x,y:e.y,z:e.z};this.tween.from(e).to(f,+this.time).easing(this.easing).onUpdate(function(){d.data[0]+=this.x-g.x,d.data[1]+=this.y-g.y,d.data[2]+=this.z-g.z,g.x=this.x,g.y=this.y,g.z=this.z}).onComplete(function(){a.send(this.eventToEmit.channel)}.bind(this)).start(1e3*a.getTime())}},b}),define("goo/statemachine/actions/Actions",["goo/statemachine/actions/MoveAction","goo/statemachine/actions/RotateAction","goo/statemachine/actions/ScaleAction","goo/statemachine/actions/LookAtAction","goo/statemachine/actions/TweenMoveAction","goo/statemachine/actions/TweenRotationAction","goo/statemachine/actions/TweenScaleAction","goo/statemachine/actions/TweenLookAtAction","goo/statemachine/actions/HideAction","goo/statemachine/actions/ShowAction","goo/statemachine/actions/RemoveAction","goo/statemachine/actions/AddLightAction","goo/statemachine/actions/RemoveLightAction","goo/statemachine/actions/InBoxAction","goo/statemachine/actions/CompareDistanceAction","goo/statemachine/actions/SetClearColorAction","goo/statemachine/actions/InFrustumAction","goo/statemachine/actions/TransitionAction","goo/statemachine/actions/EmitAction","goo/statemachine/actions/EvalAction","goo/statemachine/actions/SwitchCameraAction","goo/statemachine/actions/LogMessageAction","goo/statemachine/actions/PauseAnimationAction","goo/statemachine/actions/ResumeAnimationAction","goo/statemachine/actions/SetAnimationAction","goo/statemachine/actions/MouseUpAction","goo/statemachine/actions/MouseDownAction","goo/statemachine/actions/MouseMoveAction","goo/statemachine/actions/KeyUpAction","goo/statemachine/actions/KeyDownAction","goo/statemachine/actions/WASDAction","goo/statemachine/actions/ArrowsAction","goo/statemachine/actions/SetRenderTargetAction","goo/statemachine/actions/WaitAction","goo/statemachine/actions/RandomTransitionAction","goo/statemachine/actions/ShakeAction","goo/statemachine/actions/SmokeAction","goo/statemachine/actions/FireAction","goo/statemachine/actions/RemoveParticlesAction","goo/statemachine/actions/DollyZoomAction","goo/statemachine/actions/TweenTextureOffsetAction","goo/statemachine/actions/PickAction","goo/statemachine/actions/SoundFadeInAction","goo/statemachine/actions/SoundFadeOutAction","goo/statemachine/actions/TransitionOnMessageAction","goo/statemachine/actions/TweenLightColorAction"],function(){"use strict";function a(a){for(var b=0,d=b;d<a.length;d++){var e=a[d];c.register(e.external.name,e)}}var b={},c={};return c.register=function(a,c){b[a]=c},c.actionForType=function(a){return b[a]},c.allActions=function(){for(var a={},c=Object.keys(b),d=0;d<c.length;d++){var e=c[d];a[e]=b[e]}return a},a(arguments),c}),define("goo/loaders/handlers/MachineHandler",["goo/loaders/handlers/ConfigHandler","goo/renderer/MeshData","goo/animation/SkeletonPose","goo/loaders/JsonUtils","goo/util/PromiseUtil","goo/statemachine/State","goo/statemachine/Machine","goo/statemachine/actions/Actions","goo/util/rsvp"],function(a,b,c,d,e,f,g,h,i){"use strict";function j(){a.apply(this,arguments),this._objects={}}return j.prototype=Object.create(a.prototype),a._registerClass("machine",j),j.prototype.remove=function(a){var b=this._objects[a];b&&b.removeFromParent(),delete this._objects[a]},j.prototype._updateActions=function(a,b){for(var c=0;c<a._actions.length;c++){var d=a._actions[c],e=b.actions.some(function(a){return a.id===d.id});e||(a._actions.splice(c,1),c--)}for(var f=0;f<b.actions.length;f++){var g=b.actions[f],d=a.getAction(g.id);if(void 0===d){var i=h.actionForType(g.type);i instanceof Function&&(d=new i(g.id,g.options),a.addAction(d))}else d.configure(g.options)}},j.prototype._updateTransitions=function(a,b){for(var c=b.transitions,d=0;d<c.length;d++){var e=c[d];a.setTransition(e.id,e.targetState)}},j.prototype._updateState=function(a,b){function c(a){return g.getConfig(a).then(function(b){return g.updateObject(a,b)})}var d=a._states?a._states[b.id]:void 0;void 0===d&&(d=new f(b.id),a.addState(d)),d.name=b.name,this._updateActions(d,b),this._updateTransitions(d,b);for(var g=this,h=[],j=0;j<b.machineRefs.length;j++){var k=b.machineRefs[j];h.push(c(k))}return h.length>0?i.all(h).then(function(a){a.forEach(function(a){d.addMachine(a)})}):e.createDummyPromise(d)},j.prototype.update=function(a,b){var c=this._objects[a];if(c||(c=this._objects[a]=new g(b.name)),c.setInitialState(b.initialState),c._states)for(var d=Object.keys(c._states),e=0;e<d.length;e++){var f=c._states[d[e]],h=b.states.some(function(a){return a.id===f.uuid});h||c.removeState(f.uuid)}for(var j=[],e=0;e<b.states.length;e++)j.push(this._updateState(c,b.states[e]));return i.all(j).then(function(){return c})},j}),define("goo/loaders/handlers/SoundComponentHandler",["goo/loaders/handlers/ComponentHandler","goo/addons/howler/components/HowlerComponent","goo/util/rsvp","goo/util/PromiseUtil"],function(a,b,c,d){"use strict";function e(){a.apply(this,arguments)}return e.prototype=Object.create(a.prototype),a._registerClass("sound",e),e._type="howler",e.prototype.constructor=e,e.prototype._create=function(a){var c=new b;return a.setComponent(c),c},e.prototype.update=function(b,e){if(!window.Howl)throw new Error("Howler is missing");for(var f=a.prototype.update.call(this,b,e),g=0;g<f.sounds.length;g++)f.sounds[g].stop();f.sounds=[];var h=e.soundRefs;if(h){for(var i=[],g=0;g<h.length;g++)i.push(this._getSound(h[g]));return c.all(i).then(function(a){return f.sounds=a,f})}return d.createDummyPromise(f)},e.prototype._getSound=function(a){var b=this;return this.getConfig(a).then(function(c){return b.updateObject(a,c,b.options)})},e}),define("goo/loaders/handlers/SoundHandler",["goo/loaders/handlers/ConfigHandler","goo/util/rsvp","goo/util/PromiseUtil","goo/util/ObjectUtil"],function(a,b,c,d){"use strict";function e(){a.apply(this,arguments),this._objects={}}function f(a,b){var c=a.length;if(c!==b.length)return!1;for(;c--;)if(a[c]!==b[c])return!1;return!0}return e.prototype=Object.create(a.prototype),a._registerClass("sound",e),e.prototype.constructor=e,e.prototype._prepare=function(a){d.defaults(a,{loop:!1,urls:[],volume:1,name:"A Sound"})},e.prototype._create=function(a){var b=new window.Howl({});return b._loaded=!0,this._objects[a]=b},e.prototype.update=function(a,c){if(!window.Howl)throw new Error("Howler is missing");this._prepare(c);var d=this._objects[a]||this._create(a,c),e=[];for(var g in c)"urls"!==g&&d[g]instanceof Function&&d[g](c[g]);for(var h=0;h<c.urls.length;h++)e.push(this.getConfig(c.urls[h]));return b.all(e).then(function(a){return f(a,d._urls)||d.urls(a),d})},e.prototype.remove=function(a){this._objects[a].stop(),delete this._objects[a]},e}),define("goo/renderer/pass/BloomPass",["goo/renderer/Material","goo/renderer/pass/FullscreenUtil","goo/renderer/pass/RenderTarget","goo/renderer/Util","goo/renderer/shaders/ShaderLib"],function(a,b,c,d,e){"use strict";function f(g){g=g||{},this.target=void 0!==g.target?g.target:null;var h=void 0!==g.strength?g.strength:0,i=void 0!==g.sigma?g.sigma:4,j=2*Math.ceil(3*i)+1,k=void 0!==g.sizeX?g.sizeX:256,l=void 0!==g.sizeY?g.sizeY:256;this.renderTargetX=new c(k,l),this.renderTargetY=new c(k,l),this.renderable={meshData:b.quad,materials:[]},this.copyMaterial=a.createMaterial(e.copyPure),this.copyMaterial.uniforms.opacity=h,this.copyMaterial.blendState.blending="AdditiveBlending",this.convolutionShader=d.clone(e.convolution),this.convolutionShader.defines={KERNEL_SIZE_FLOAT:j.toFixed(1),KERNEL_SIZE_INT:j.toFixed(0)},this.convolutionMaterial=a.createMaterial(this.convolutionShader),this.convolutionMaterial.uniforms.uImageIncrement=f.blurX,this.convolutionMaterial.uniforms.cKernel=this.convolutionShader.buildKernel(i),this.bcMaterial=a.createMaterial(e.brightnesscontrast),this.bcMaterial.uniforms.brightness=0,this.bcMaterial.uniforms.contrast=0,this.enabled=!0,this.clear=!1,this.needsSwap=!1}return f.prototype.render=function(a,c,d){this.renderable.materials[0]=this.bcMaterial,this.bcMaterial.setTexture("DIFFUSE_MAP",d),a.render(this.renderable,b.camera,[],this.renderTargetY,!0),this.renderable.materials[0]=this.convolutionMaterial,this.convolutionMaterial.setTexture("DIFFUSE_MAP",this.renderTargetY),this.convolutionMaterial.uniforms.uImageIncrement=f.blurY,a.render(this.renderable,b.camera,[],this.renderTargetX,!0),this.convolutionMaterial.setTexture("DIFFUSE_MAP",this.renderTargetX),this.convolutionMaterial.uniforms.uImageIncrement=f.blurX,a.render(this.renderable,b.camera,[],this.renderTargetY,!0),this.renderable.materials[0]=this.copyMaterial,this.copyMaterial.setTexture("DIFFUSE_MAP",this.renderTargetY),null!==this.target?a.render(this.renderable,b.camera,[],this.target,this.clear):a.render(this.renderable,b.camera,[],d,this.clear)},f.blurX=[.001953125,0],f.blurY=[0,.001953125],f}),define("goo/renderer/pass/BlurPass",["goo/renderer/Material","goo/renderer/pass/FullscreenUtil","goo/renderer/pass/RenderTarget","goo/renderer/Util","goo/renderer/shaders/ShaderLib"],function(a,b,c,d,e){"use strict";function f(g){g=g||{},this.target=void 0!==g.target?g.target:null;var h=void 0!==g.strength?g.strength:1,i=void 0!==g.sigma?g.sigma:4,j=2*Math.ceil(3*i)+1,k=void 0!==g.sizeX?g.sizeX:256,l=void 0!==g.sizeY?g.sizeY:256;this.renderTargetX=new c(k,l),this.renderTargetY=new c(k,l),this.renderable={meshData:b.quad,materials:[]},this.copyShader=d.clone(e.copyPure),this.copyShader.uniforms.opacity=h,this.copyMaterial=a.createMaterial(this.copyShader),this.convolutionShader=d.clone(e.convolution),this.convolutionShader.defines={KERNEL_SIZE_FLOAT:j.toFixed(1),KERNEL_SIZE_INT:j.toFixed(0)},this.convolutionShader.uniforms.uImageIncrement=f.blurX,this.convolutionShader.uniforms.cKernel=this.convolutionShader.buildKernel(i),this.convolutionMaterial=a.createMaterial(this.convolutionShader),this.enabled=!0,this.clear=!1,this.needsSwap=!1}return f.prototype.render=function(a,c,d){this.renderable.materials[0]=this.convolutionMaterial,this.convolutionMaterial.setTexture("DIFFUSE_MAP",d),this.convolutionMaterial.uniforms.uImageIncrement=f.blurY,a.render(this.renderable,b.camera,[],this.renderTargetX,!0),this.convolutionMaterial.setTexture("DIFFUSE_MAP",this.renderTargetX),this.convolutionMaterial.uniforms.uImageIncrement=f.blurX,a.render(this.renderable,b.camera,[],this.renderTargetY,!0),this.renderable.materials[0]=this.copyMaterial,this.copyMaterial.setTexture("DIFFUSE_MAP",this.renderTargetY),null!==this.target?a.render(this.renderable,b.camera,[],this.target,this.clear):a.render(this.renderable,b.camera,[],d,this.clear)},f.blurX=[.001953125,0],f.blurY=[0,.001953125],f}),define("goo/renderer/pass/SSAOPass",["goo/renderer/Material","goo/renderer/pass/RenderTarget","goo/renderer/Util","goo/renderer/MeshData","goo/renderer/Shader","goo/renderer/shaders/ShaderFragment","goo/renderer/pass/RenderPass","goo/renderer/pass/FullscreenPass","goo/renderer/pass/BlurPass","goo/renderer/shaders/ShaderLib"],function(a,b,c,d,e,f,g,h,i,j){"use strict";function k(d){this.depthPass=new g(d),this.depthPass.clearColor.set(1,1,1,1);var e=a.createMaterial(l);this.depthPass.overrideMaterial=e;var f=window.innerWidth/4,k=window.innerHeight/4;f=Math.floor(f),k=Math.floor(k);var m=c.clone(j.ssao);m.uniforms.size=[f,k],this.outPass=new h(m),this.outPass.useReadBuffer=!1,this.blurPass=new i({sizeX:f,sizeY:k}),this.depthTarget=new b(f,k,{magFilter:"NearestNeighbor",minFilter:"NearestNeighborNoMipMaps"}),this.enabled=!0,this.clear=!1,this.needsSwap=!0}k.prototype.render=function(a,b,c,d){this.depthPass.render(a,null,this.depthTarget,d),this.outPass.material.setTexture(e.DIFFUSE_MAP,c),this.outPass.material.setTexture(e.DEPTH_MAP,this.depthTarget),this.outPass.render(a,b,c,d)};var l={attributes:{vertexPosition:d.POSITION},uniforms:{viewMatrix:e.VIEW_MATRIX,projectionMatrix:e.PROJECTION_MATRIX,worldMatrix:e.WORLD_MATRIX},vshader:["attribute vec3 vertexPosition;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 worldMatrix;","void main(void) {","	gl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4(vertexPosition, 1.0);","}"].join("\n"),fshader:["precision mediump float;",f.methods.packDepth,"void main(void) {","	gl_FragColor = packDepth(gl_FragCoord.z);","}"].join("\n")};return k}),define("goo/renderer/pass/PassLib",["goo/renderer/shaders/ShaderLib","goo/renderer/pass/FullscreenPass","goo/renderer/pass/BloomPass","goo/renderer/pass/BlurPass","goo/renderer/pass/SSAOPass","goo/renderer/Util"],function(a,b,c,d,e,f){"use strict";var g={};return g.Sepia=function(){var c;return{create:function(){return c=new b(f.clone(a.sepia))},update:function(a){var b=a.options;void 0!==b.amount&&(c.material.uniforms.amount=b.amount/100),void 0!==a.enabled&&(c.enabled=a.enabled)},get:function(){return c},options:[{key:"amount",name:"Amount",type:"int",control:"slider",min:0,max:100,"default":100}]}}(),g.Bloom=function(){var a;return{create:function(){return a=new c},update:function(b){var c=b.options||{};void 0!==c.opacity&&(a.copyMaterial.uniforms.opacity=c.opacity/100),void 0!==c.size&&(a.convolutionMaterial.uniforms.size=c.size),void 0!==c.brightness&&(a.bcMaterial.uniforms.brightness=c.brightness/100),void 0!==c.contrast&&(a.bcMaterial.uniforms.contrast=c.contrast/100),void 0!==b.enabled&&(a.enabled=b.enabled)},get:function(){return a},options:[{key:"opacity",name:"Opacity",type:"int",control:"slider",min:0,max:100,"default":100},{key:"size",name:"Size",type:"float",control:"slider",min:0,max:10,decimals:1,"default":2},{key:"brightness",name:"Gain",type:"int",control:"slider",min:-100,max:100,"default":0},{key:"contrast",name:"Intensity",type:"int",control:"slider",min:-100,max:100,"default":0}]}}(),g.Grain=function(){var c,d;return{create:function(){return c=f.clone(a.film),d=new b(c)},update:function(a){var b=a.options;void 0!==b.nIntensity&&(c.uniforms.nIntensity=b.nIntensity/100),void 0!==b.sIntensity&&(c.uniforms.sIntensity=b.sIntensity/100),void 0!==b.sCount&&(c.uniforms.sCount=b.sCount),void 0!==a.enabled&&(d.enabled=a.enabled)},get:function(){return d},options:[{key:"nIntensity",type:"int",control:"slider",name:"Noise",min:0,max:100,"default":50},{key:"sIntensity",type:"int",control:"slider",name:"Intensity",min:0,max:100,"default":50},{key:"sCount",type:"int",control:"slider",name:"Count",min:1,max:4096,"default":1024}]}}(),g.Contrast=function(){var c,d;return{create:function(){return c=f.clone(a.brightnesscontrast),d=new b(c)},update:function(a){var b=a.options;void 0!==b.brightness&&(c.uniforms.brightness=b.brightness),void 0!==b.contrast&&(c.uniforms.contrast=b.contrast),void 0!==a.enabled&&(d.enabled=a.enabled)},get:function(){return d},options:[{key:"brightness",type:"float",control:"slider",name:"Brightness",min:-1,max:1,decimals:2,"default":0},{key:"contrast",type:"float",control:"slider",name:"Contrast",min:0,max:1,"default":0}]}}(),g.RgbShift=function(){var c,d;return{create:function(){return c=f.clone(a.rgbshift),d=new b(c)},update:function(a){var b=a.options;void 0!==b.amount&&(c.uniforms.amount=b.amount),void 0!==b.angle&&(c.uniforms.angle=b.angle),void 0!==a.enabled&&(d.enabled=a.enabled)},get:function(){return d},options:[{key:"amount",type:"float",control:"slider",name:"Amount",min:0,max:.05,decimals:3,"default":.005},{key:"angle",type:"float",control:"slider",name:"Angle",min:0,max:6.28,decimals:1,"default":0}]}}(),g.Vignette=function(){var c,d;return{create:function(){return c=f.clone(a.vignette),d=new b(c)},update:function(a){var b=a.options;void 0!==b.offset&&(c.uniforms.offset=b.offset),void 0!==b.darkness&&(c.uniforms.darkness=b.darkness),void 0!==a.enabled&&(d.enabled=a.enabled)},get:function(){return d},options:[{key:"offset",type:"float",control:"slider",name:"Offset",min:0,max:10,decimals:1,"default":1},{key:"darkness",type:"float",control:"slider",name:"Darkness",min:0,max:2,decimals:2,"default":1.5}]}}(),g.Bleach=function(){var c,d;return{create:function(){return c=f.clone(a.bleachbypass),d=new b(c)},update:function(a){var b=a.options;void 0!==b.opacity&&(c.uniforms.opacity=b.opacity),void 0!==a.enabled&&(d.enabled=a.enabled)},get:function(){return d},options:[{key:"opacity",type:"float",control:"slider",name:"Opacity",min:0,max:1,decimals:2,"default":1}]}}(),g}),define("goo/loaders/handlers/PosteffectHandler",["goo/loaders/handlers/ConfigHandler","goo/util/rsvp","goo/util/PromiseUtil","goo/renderer/Util","goo/renderer/pass/PassLib","goo/renderer/shaders/ShaderLib","goo/renderer/pass/FullscreenPass","goo/renderer/pass/BloomPass","goo/util/ObjectUtil"],function(a,b,c,d,e,f,g,h,i){"use strict";function j(){a.apply(this,arguments),this._objects={}}return j.prototype=Object.create(a.prototype),j.prototype.constructor=j,a._registerClass("posteffect",j),j.prototype._prepare=function(a){if(!a.name||!e[a.name])return console.error("Unknown posteffect name: "+a.name),void 0;var b=e[a.name];i.defaults(a,{enabled:!0,options:{}});for(var c=b.options,d=0;d<c.length;d++){var f=c[d];void 0===a.options[f.key]&&(a.options[f.key]=f["default"])}},j.prototype._create=function(a,b){return b.name&&e[b.name]?(this._objects[a]=e[b.name],this._objects[a].create(),this._objects[a]):(console.error("Unknown posteffect name: "+b.name),void 0)},j.prototype.update=function(a,b){if(!b.name||!e[b.name])return console.error("Unknown posteffect name: "+b.name),c.createDummyPromise();var d=this._objects[a]||this._create(a,b);return this._prepare(b),d.update(b),c.createDummyPromise(d)},j}),define("goo/loaders/DynamicLoader",["goo/loaders/handlers/ConfigHandler","goo/loaders/handlers/ComponentHandler","goo/util/Ajax","goo/renderer/TextureCreator","goo/util/rsvp","goo/util/StringUtil","goo/util/PromiseUtil","goo/util/ObjectUtil","goo/loaders/handlers/CameraComponentHandler","goo/loaders/handlers/EntityHandler","goo/loaders/handlers/LightComponentHandler","goo/loaders/handlers/MaterialHandler","goo/loaders/handlers/MeshDataComponentHandler","goo/loaders/handlers/MeshDataHandler","goo/loaders/handlers/MeshRendererComponentHandler","goo/loaders/handlers/SceneHandler","goo/loaders/handlers/ShaderHandler","goo/loaders/handlers/SkeletonHandler","goo/loaders/handlers/TextureHandler","goo/loaders/handlers/TransformComponentHandler","goo/loaders/handlers/AnimationComponentHandler","goo/loaders/handlers/AnimationStateHandler","goo/loaders/handlers/AnimationLayersHandler","goo/loaders/handlers/AnimationClipHandler","goo/loaders/handlers/ProjectHandler","goo/loaders/handlers/ScriptComponentHandler","goo/loaders/handlers/ScriptHandler","goo/loaders/handlers/FSMComponentHandler","goo/loaders/handlers/MachineHandler","goo/loaders/handlers/SoundComponentHandler","goo/loaders/handlers/SoundHandler","goo/loaders/handlers/PosteffectHandler"],function(a,b,c,d,e,f,g,h){"use strict";function i(a){if(this.options=a,this._objects={},h.defaults(this.options,{ajax:!0}),!this.options.world)throw new Error("World argument cannot be null");if(this._world=this.options.world,!this.options.rootPath)throw new Error("parameters.rootPath must be defined");this.setRootPath(this.options.rootPath),this._configs={},this.options.ajax&&(this._ajax=new c)}var j=["shader","script","entity","material","scene","mesh","texture","skeleton","animation","clip","bundle","project","machine","posteffect","animstate","sound"],k=h.keys(a.getHandler("texture").loaders),l=["jpg","jpeg","png","gif"],m=["dat","bin"],n=["mp3","wav"],o=a.getHandler("material").ENGINE_SHADER_PREFIX;return i.prototype.preloadCache=function(a,b){return null==b&&(b=!1),b?this._configs=a:h.extend(this._configs,a)},i.prototype.loadFromConfig=function(a,b,c){if(null==c&&(c={}),h.defaults(c,this.options),null!=b&&(c.noCache?this._configs=b:h.extend(this._configs,b)),this._configs[a])throw new Error(""+a+" not found in the supplied configs Available keys: \n"+h.keys(this._configs).join("\n"));return this.load(a,c)},i.prototype.loadFromBundle=function(a,b,c){var d=this;return null==c&&(c={}),h.defaults(c,this.options),this._loadRef(b).then(function(e){if(c.noCache?d._configs=e:h.extend(d._configs,e),null==d._configs[a])throw new Error(""+a+" not found in bundle "+b+". Available keys: \n"+h.keys(d._configs).join("\n"));return d.load(a,c)})},i.prototype.load=function(a,b){return null==b&&(b={}),this.update(a,null,b)},i.prototype.update=function(b,c,d){var f=this;return null==d&&(d={}),h.defaults(d,this.options,{recursive:!0}),c&&(this._configs[b]=c),delete this._objects[b],this._loadRef(b).then(function(c){var g=0,h=[];if(d.recursive&&a.getHandler(i.getTypeForRef(b)))for(var j=f._getRefsFromConfig(c),k=function(a){return h.push(f._loadRef(a).then(function(b){return g++,d.progressCallback&&d.progressCallback.call&&d.progressCallback.call(null,g,h.length),f._handle(a,b,d)}))},l=0;l<j.length;l++)k(j[l]);return h.push(f._handle(b,c,d)),e.all(h)}).then(function(){return f._configs}).then(null,function(a){return console.error("Error updating "+b+" "+a)})},i.prototype.remove=function(a){return delete this._objects[a],this._handle(a,null)},i.prototype._handle=function(b,c,d){var e,f,j,k=this;return null==d&&(d={}),this._objects[b]?this._objects[b].then?this._objects[b]:d.noCache?void 0:g.createDummyPromise(this._objects[b]):(j=i.getTypeForRef(b),f=a.getHandler(j),f?(null==this._handlers&&(this._handlers={}),e=this._handlers[j],e?h.extend(e,{world:this._world,getConfig:this._loadRef.bind(this),updateObject:this._handle.bind(this),options:h.clone(d)}):e=this._handlers[j]=new f(this._world,this._loadRef.bind(this),this._handle.bind(this),d),null!=c?this._objects[b]=e.update(b,c,d).then(function(a){return k._objects[b]=a}):(e.remove(b),g.createDummyPromise(null))):(console.warn("No handler for type "+j),g.createDummyPromise(null)))},i.prototype._loadRef=function(a,b){var d,e,f=this;if(0===a.indexOf(o)&&(d=g.createDummyPromise(null),this._configs[a]=d),null==b&&(b=!1),this._configs[a]){if(this._configs[a].then)return this._configs[a];if(!b)return g.createDummyPromise(this._configs[a])}return this._ajax?(e=this._rootPath+window.escape(a),d=i.isImageRef(a)?this._ajax.loadImage(e):i.isBinaryRef(a)?this._ajax.load(e,c.ARRAY_BUFFER):i.isUrlRef(a)?g.createDummyPromise(e):this._ajax.load(e),d=d.then(function(b){return f._configs[a]=i.isJSONRef(a)?JSON.parse(b):b}).then(null,function(b){return delete f._configs[a],b}),this._configs[a]=d,d):g.createDummyPromise(null)},i.prototype._getRefsFromConfig=function(a){var b=[],c=function(a,d){var e;if(f.endsWith(a,"Refs"))b=b.concat(d);else if(f.endsWith(a,"Ref"))b.push(d);else if(d instanceof Object)for(e in d)d.hasOwnProperty(e)&&c(e,d[e])};return c("",a),b},i.getTypeForRef=function(a){return a.split(".").pop().toLowerCase()},i.isJSONRef=function(a){var b=i.getTypeForRef(a);return h.indexOf(j,b)>=0},i.isImageRef=function(a){var b=i.getTypeForRef(a);return h.indexOf(l,b)>=0},i.isBinaryRef=function(a){var b=i.getTypeForRef(a);return h.indexOf(k,b)>=0||h.indexOf(m,b)>=0},i.isUrlRef=function(a){var b=i.getTypeForRef(a);return h.indexOf(n,b)>=0},i.prototype.getCachedObjectForRef=function(a){return this._objects?this._objects[a]:void 0},i.prototype.setRootPath=function(a){this._rootPath=a,a.length>1&&"/"!==a.charAt(a.length-1)&&(this._rootPath+="/")},i}),define("goo/math/Matrix2x2",["goo/math/MathUtils","goo/math/Matrix"],function(a,b){"use strict";function c(){b.call(this,2,2),0===arguments.length?this.setIdentity():this.set(arguments)}return c.prototype=Object.create(b.prototype),c.prototype.setupAliases([["e00"],["e10"],["e01"],["e11"]]),c.IDENTITY=new c(1,0,0,1),c.add=function(a,b,d){return d||(d=new c),b instanceof c?(d.e00=a.e00+b.e00,d.e10=a.e10+b.e10,d.e01=a.e01+b.e01,d.e11=a.e11+b.e11):(d.e00=a.e00+b,d.e10=a.e10+b,d.e01=a.e01+b,d.e11=a.e11+b),d},c.prototype.add=function(a){return c.add(this,a,this)},c.sub=function(a,b,d){return d||(d=new c),b instanceof c?(d.e00=a.e00-b.e00,d.e10=a.e10-b.e10,d.e01=a.e01-b.e01,d.e11=a.e11-b.e11):(d.e00=a.e00-b,d.e10=a.e10-b,d.e01=a.e01-b,d.e11=a.e11-b),d},c.prototype.sub=function(a){return c.sub(this,a,this)},c.mul=function(a,b,d){return d||(d=new c),b instanceof c?(d.e00=a.e00*b.e00,d.e10=a.e10*b.e10,d.e01=a.e01*b.e01,d.e11=a.e11*b.e11):(d.e00=a.e00*b,d.e10=a.e10*b,d.e01=a.e01*b,d.e11=a.e11*b),d},c.prototype.mul=function(a){return c.mul(this,a,this)},c.div=function(a,b,d){return d||(d=new c),b instanceof c?(d.e00=a.e00/b.e00,d.e10=a.e10/b.e10,d.e01=a.e01/b.e01,d.e11=a.e11/b.e11):(b=1/b,d.e00=a.e00*b,d.e10=a.e10*b,d.e01=a.e01*b,d.e11=a.e11*b),d},c.prototype.div=function(a){return c.div(this,a,this)},c.combine=function(a,d,e){return e||(e=new c),e===a||e===d?b.copy(c.combine(a,d),e):(e.e00=a.e00*d.e00+a.e01*d.e10,e.e10=a.e10*d.e00+a.e11*d.e10,e.e01=a.e00*d.e01+a.e01*d.e11,e.e11=a.e10*d.e01+a.e11*d.e11,e)},c.prototype.combine=function(a){return c.combine(this,a,this)},c.transpose=function(a,d){return d||(d=new c),d===a?b.copy(c.transpose(a),d):(d.e00=a.e00,d.e10=a.e01,d.e01=a.e10,d.e11=a.e11,d)},c.prototype.transpose=function(){return c.transpose(this,this)},c.invert=function(d,e){if(e||(e=new c),e===d)return b.copy(c.invert(d),e);var f=d.determinant();if(Math.abs(f)<a.EPSILON)throw{name:"Singular Matrix",message:"The matrix is singular and cannot be inverted."};return f=1/f,e.e00=d.e11*f,e.e10=0-d.e10*f,e.e01=0-d.e01*f,e.e11=d.e00*f,e},c.prototype.invert=function(){return c.invert(this,this)},c.prototype.isOrthogonal=function(){var b;return b=this.e00*this.e01+this.e10*this.e11,Math.abs(b)>a.EPSILON?!1:!0},c.prototype.isNormal=function(){var b;return b=this.e00*this.e00+this.e10*this.e10,Math.abs(b-1)>a.EPSILON?!1:(b=this.e01*this.e01+this.e11*this.e11,Math.abs(b-1)>a.EPSILON?!1:!0)},c.prototype.isOrthonormal=function(){return this.isOrthogonal()&&this.isNormal()},c.prototype.determinant=function(){return this.e00*this.e11-this.e01*this.e10},c.prototype.setIdentity=function(){return this.set(c.IDENTITY),this},c}),define("goo/noise/Noise",["goo/math/MathUtils"],function(a){"use strict";function b(){}return b.shifter=[37,91,12,128,216,96,51,153,39,231,223,180,160,157,135,179,74,50,205,151,4,213,196,58,212,120,53,45,10,195,137,159,103,144,109,170,202,48,121,13,245,68,232,28,210,174,197,80,107,206,156,116,155,240,162,79,41,59,147,117,0,242,118,164,129,101,98,126,214,105,89,26,130,254,85,199,8,165,76,75,187,166,64,143,217,149,78,7,172,230,87,119,42,247,84,139,16,141,134,86,154,71,253,60,99,235,168,30,34,55,113,140,191,69,31,106,40,82,73,33,81,14,234,131,255,88,169,136,248,148,220,138,219,102,44,127,36,200,95,208,54,152,47,20,23,15,52,123,177,224,122,171,215,173,211,188,190,133,244,167,236,35,63,145,221,104,65,24,70,100,56,150,49,77,110,228,112,209,198,1,237,185,250,225,93,201,124,108,218,72,243,21,22,6,114,38,125,29,66,249,222,111,241,11,186,61,176,183,17,163,229,161,57,238,227,132,67,83,207,226,46,189,115,193,194,233,182,192,18,27,25,2,3,252,97,62,184,239,175,92,246,142,251,204,203,32,146,90,19,9,178,158,181,94,43,5],b.split=function(b){var c=Math.floor(b),d=a.scurve5(b-c);return{i0:c+0,i1:c+1,f0:1-d,f1:0+d}},b.fractal1d=function(a,b,c,d,e,f){for(var g=0,h=1,i=0,j=0;c>j;j++)g+=h*f.evaluate1d(a,b),i+=h,h*=d,a*=e;return g/i},b.fractal2d=function(a,b,c,d,e,f,g){for(var h=0,i=1,j=0,k=0;d>k;k++)h+=i*g.evaluate2d(a,b,c),j+=i,i*=e,a*=f,b*=f;return h/j},b.fractal3d=function(a,b,c,d,e,f,g,h){for(var i=0,j=1,k=0,l=0;e>l;l++)i+=j*h.evaluate3d(a,b,c,d),k+=j,j*=f,a*=g,b*=g,c*=g;return i/k},b.fractal4d=function(a,b,c,d,e,f,g,h,i){for(var j=0,k=1,l=0,m=0;f>m;m++)j+=k*i.evaluate4d(a,b,c,d,e),l+=k,k*=g,a*=h,b*=h,c*=h,d*=h;return j/l},b}),define("goo/noise/ValueNoise",["goo/noise/Noise"],function(a){"use strict";function b(){a.call(this)}return b.prototype=Object.create(a.prototype),b.sources=[0,1/15,2/15,.2,4/15,5/15,.4,7/15,8/15,.6,10/15,11/15,.8,13/15,14/15,1],b.evaluate1d=function(c,d){var e=a.split(c/d),f=15&a.shifter[255&e.i0],g=15&a.shifter[255&e.i1],h=0;return h+=e.f0*b.sources[f],h+=e.f1*b.sources[g]
},b.evaluate2d=function(c,d,e){var f=a.split(c/e),g=a.split(d/e),h=15&a.shifter[255&a.shifter[255&g.i0]+f.i0],i=15&a.shifter[255&a.shifter[255&g.i0]+f.i1],j=15&a.shifter[255&a.shifter[255&g.i1]+f.i0],k=15&a.shifter[255&a.shifter[255&g.i1]+f.i1],l=0;return l+=g.f0*f.f0*b.sources[h],l+=g.f0*f.f1*b.sources[i],l+=g.f1*f.f0*b.sources[j],l+=g.f1*f.f1*b.sources[k]},b.evaluate3d=function(c,d,e,f){var g=a.split(c/f),h=a.split(d/f),i=a.split(e/f),j=15&a.shifter[255&a.shifter[255&a.shifter[255&i.i0]+h.i0]+g.i0],k=15&a.shifter[255&a.shifter[255&a.shifter[255&i.i0]+h.i0]+g.i1],l=15&a.shifter[255&a.shifter[255&a.shifter[255&i.i0]+h.i1]+g.i0],m=15&a.shifter[255&a.shifter[255&a.shifter[255&i.i0]+h.i1]+g.i1],n=15&a.shifter[255&a.shifter[255&a.shifter[255&i.i1]+h.i0]+g.i0],o=15&a.shifter[255&a.shifter[255&a.shifter[255&i.i1]+h.i0]+g.i1],p=15&a.shifter[255&a.shifter[255&a.shifter[255&i.i1]+h.i1]+g.i0],q=15&a.shifter[255&a.shifter[255&a.shifter[255&i.i1]+h.i1]+g.i1],r=0;return r+=i.f0*h.f0*g.f0*b.sources[j],r+=i.f0*h.f0*g.f1*b.sources[k],r+=i.f0*h.f1*g.f0*b.sources[l],r+=i.f0*h.f1*g.f1*b.sources[m],r+=i.f1*h.f0*g.f0*b.sources[n],r+=i.f1*h.f0*g.f1*b.sources[o],r+=i.f1*h.f1*g.f0*b.sources[p],r+=i.f1*h.f1*g.f1*b.sources[q]},b.evaluate4d=function(c,d,e,f,g){var h=a.split(c/g),i=a.split(d/g),j=a.split(e/g),k=a.split(f/g),l=15&a.shifter[255&a.shifter[255&a.shifter[255&a.shifter[255&k.i0]+j.i0]+i.i0]+h.i0],m=15&a.shifter[255&a.shifter[255&a.shifter[255&a.shifter[255&k.i0]+j.i0]+i.i0]+h.i1],n=15&a.shifter[255&a.shifter[255&a.shifter[255&a.shifter[255&k.i0]+j.i0]+i.i1]+h.i0],o=15&a.shifter[255&a.shifter[255&a.shifter[255&a.shifter[255&k.i0]+j.i0]+i.i1]+h.i1],p=15&a.shifter[255&a.shifter[255&a.shifter[255&a.shifter[255&k.i0]+j.i1]+i.i0]+h.i0],q=15&a.shifter[255&a.shifter[255&a.shifter[255&a.shifter[255&k.i0]+j.i1]+i.i0]+h.i1],r=15&a.shifter[255&a.shifter[255&a.shifter[255&a.shifter[255&k.i0]+j.i1]+i.i1]+h.i0],s=15&a.shifter[255&a.shifter[255&a.shifter[255&a.shifter[255&k.i0]+j.i1]+i.i1]+h.i1],t=15&a.shifter[255&a.shifter[255&a.shifter[255&a.shifter[255&k.i1]+j.i0]+i.i0]+h.i0],u=15&a.shifter[255&a.shifter[255&a.shifter[255&a.shifter[255&k.i1]+j.i0]+i.i0]+h.i1],v=15&a.shifter[255&a.shifter[255&a.shifter[255&a.shifter[255&k.i1]+j.i0]+i.i1]+h.i0],w=15&a.shifter[255&a.shifter[255&a.shifter[255&a.shifter[255&k.i1]+j.i0]+i.i1]+h.i1],x=15&a.shifter[255&a.shifter[255&a.shifter[255&a.shifter[255&k.i1]+j.i1]+i.i0]+h.i0],y=15&a.shifter[255&a.shifter[255&a.shifter[255&a.shifter[255&k.i1]+j.i1]+i.i0]+h.i1],z=15&a.shifter[255&a.shifter[255&a.shifter[255&a.shifter[255&k.i1]+j.i1]+i.i1]+h.i0],A=15&a.shifter[255&a.shifter[255&a.shifter[255&a.shifter[255&k.i1]+j.i1]+i.i1]+h.i1],B=0;return B+=k.f0*j.f0*i.f0*h.f0*b.sources[l],B+=k.f0*j.f0*i.f0*h.f1*b.sources[m],B+=k.f0*j.f0*i.f1*h.f0*b.sources[n],B+=k.f0*j.f0*i.f1*h.f1*b.sources[o],B+=k.f0*j.f1*i.f0*h.f0*b.sources[p],B+=k.f0*j.f1*i.f0*h.f1*b.sources[q],B+=k.f0*j.f1*i.f1*h.f0*b.sources[r],B+=k.f0*j.f1*i.f1*h.f1*b.sources[s],B+=k.f1*j.f0*i.f0*h.f0*b.sources[t],B+=k.f1*j.f0*i.f0*h.f1*b.sources[u],B+=k.f1*j.f0*i.f1*h.f0*b.sources[v],B+=k.f1*j.f0*i.f1*h.f1*b.sources[w],B+=k.f1*j.f1*i.f0*h.f0*b.sources[x],B+=k.f1*j.f1*i.f0*h.f1*b.sources[y],B+=k.f1*j.f1*i.f1*h.f0*b.sources[z],B+=k.f1*j.f1*i.f1*h.f1*b.sources[A]},b}),define("goo/particles/ParticleInfluence",[],function(){"use strict";function a(a){a=a||{},this.prepare=a.prepare?a.prepare:function(){},this.apply=a.apply?a.apply:function(){},this.enabled=void 0!==a.enabled?a.enabled===!0:!0}return a}),define("goo/picking/BoundingTree",["goo/renderer/bounds/BoundingBox","goo/renderer/bounds/BoundingSphere","goo/math/Vector3"],function(a,b,c){"use strict";function d(a){this.leftTree=null,this.rightTree=null,this.localBound=null,this.worldBound=null,this.boundType=a?a:d.BOUNDTYPE_BOX}return d.BOUNDTYPE_SPHERE="sphere",d.BOUNDTYPE_BOX="box",d.MAX_PRIMITIVES_PER_LEAF=16,d.prototype.construct=function(a){if(!a.meshRendererComponent||!a.meshDataComponent||!a.transformComponent)return console.warn("Entity missing required components for boundingtree construction: ",a),void 0;var b=a.meshDataComponent.meshData;if(b.updatePrimitiveCounts(),1===b.getSectionCount()){this.primitiveIndices=[];for(var c=0,d=b.getPrimitiveCount(0);d>c;c++)this.primitiveIndices.push(c);this.createTree(a,0,0,this.primitiveIndices.length)}else this.split(a,0,b.getSectionCount())},d.prototype.createTree=function(a,b,c,e){var f=a.meshDataComponent.meshData;this.section=b,this.start=c,this.end=e,this.primitiveIndices&&(this.createBounds(),this.localBound.computeFromPrimitives(f,b,this.primitiveIndices,c,e),e-c+1<=d.MAX_PRIMITIVES_PER_LEAF||(this.leftTree||(this.leftTree=new d(this.boundType)),this.leftTree.primitiveIndices=this.primitiveIndices,this.leftTree.createTree(a,b,c,Math.floor((c+e)/2)),this.rightTree||(this.rightTree=new d(this.boundType)),this.rightTree.primitiveIndices=this.primitiveIndices,this.rightTree.createTree(a,b,Math.floor((c+e)/2),e)))},d.prototype.split=function(a,b,c){var e=c-b,f=Math.floor(e/2);if(1===f){var g=b;this.leftTree=new d(this.boundType),this.leftTree.primitiveIndices=[];for(var h=0;h<this.leftTree.primitiveIndices.length;h++)this.leftTree.primitiveIndices.push(h);this.leftTree.createTree(a,g,0,this.leftTree.primitiveIndices.length)}else this.leftTree=new d(this.boundType),this.leftTree.split(a,b,b+f);if(1===e-f){var g=b+1;this.rightTree=new d(this.boundType),this.rightTree._primitiveIndices=[];for(var h=0;h<this.rightTree.primitiveIndices.length;h++)this.rightTree.primitiveIndices.push(h);this.rightTree.createTree(a,g,0,this.rightTree.primitiveIndices.length)}else this.rightTree=new d(this.boundType),this.rightTree.split(a,b+f,c);this.localBound=this.leftTree.localBound.clone(this.localBound),this.localBound.merge(this.rightTree.localBound),this.worldBound=this.localBound.clone(this.worldBound)},d.prototype.createBounds=function(){switch(this.boundType){case d.BOUNDTYPE_BOX:this.localBound=new a,this.worldBound=new a;break;case d.BOUNDTYPE_SPHERE:this.localBound=new b,this.worldBound=new b}},d.prototype.findPick=function(a,b,d){var e=d;e||(e={});var f=b.transformComponent.worldTransform;if(this.localBound.transform(f,this.worldBound),!this.worldBound.intersectsRay(a))return e;if(this.leftTree&&this.leftTree.findPick(a,b,e),this.rightTree)this.rightTree.findPick(a,b,e);else if(!this.leftTree)for(var g=b.meshDataComponent.meshData,h=null,i=this.start;i<this.end;i++){h=g.getPrimitiveVertices(this.primitiveIndices[i],this.section,h);for(var j=0;j<h.length;j++)f.matrix.applyPostPoint(h[j]);var k=new c;a.intersects(h,!1,k)&&(e.distances=e.distances||[],e.distances.push(a.origin.distance(k)),e.points=e.points||[],e.points.push(k))}return e},d}),define("goo/picking/PrimitivePickLogic",["goo/picking/BoundingTree"],function(a){"use strict";function b(){}return b.prototype.getPickResult=function(a,b){var c=b.meshDataComponent.meshData.__boundingTree;return c?c.findPick(a,b,{}):null},b.prototype.added=function(a){this.isConstructed(a)||this.rebuild(a)},b.prototype.removed=function(a){a.meshDataComponent.meshData.__boundingTree=null},b.prototype.isConstructed=function(a){return!!a.meshDataComponent.meshData.__boundingTree},b.prototype.rebuild=function(b){b.meshDataComponent.meshData.__boundingTree=new a,b.meshDataComponent.meshData.__boundingTree.construct(b)},b}),define("goo/renderer/OcclusionPartitioner",["goo/renderer/SimplePartitioner","goo/renderer/scanline/SoftwareRenderer"],function(a,b){"use strict";function c(c){this._viewFrustumCuller=new a,this.occluderList=[],this.renderer=new b(c),this.debugContext=c.debugContext,this.imagedata=this.debugContext.createImageData(c.width,c.height)}return c.prototype.added=function(a){this._viewFrustumCuller.added(a)},c.prototype.removed=function(a){this._viewFrustumCuller.added(a)},c.prototype.process=function(a,b,c){this._viewFrustumCuller.process(a,b,c),this._addVisibleOccluders(c),this.renderer.render(this.occluderList);var d=this.renderer.performOcclusionCulling(c);c.length=0;for(var e=0;e<d.length;e++)c[e]=d[e]},c.prototype._writeDebugData=function(){this.imagedata.data.set(this.renderer.getColorData()),this.debugContext.putImageData(this.imagedata,0,0)},c.prototype._addVisibleOccluders=function(a){this.occluderList.length=0;for(var b=0;b<a.length;b++){var c=a[b];c.occluderComponent&&this.occluderList.push(c)}},c}),define("goo/renderer/pass/DOFPass",["goo/renderer/Material","goo/renderer/pass/RenderTarget","goo/renderer/MeshData","goo/renderer/Shader","goo/renderer/shaders/ShaderFragment","goo/renderer/pass/RenderPass","goo/renderer/pass/FullscreenPass","goo/renderer/pass/BlurPass","goo/renderer/Util","goo/util/Skybox"],function(a,b,c,d,e,f,g,h,i,j){"use strict";function k(c,d){this.depthPass=new f(c,function(a){return!(a instanceof j)}),this.regularPass=new f(c);var e=a.createMaterial(l);this.depthPass.overrideMaterial=e;var h=d||m;this.outPass=new g(h),this.outPass.useReadBuffer=!1,this.outPass.renderToScreen=!0;var k=window.innerWidth||1,n=window.innerHeight||1,o=i.nearestPowerOfTwo(Math.max(k,n));this.depthTarget=new b(k,n),this.regularTarget=new b(o/2,o/2),this.regularTarget2=new b(k,n),this.regularTarget.generateMipmaps=!0,this.regularTarget.minFilter="Trilinear",this.enabled=!0,this.clear=!1,this.needsSwap=!0}k.prototype.render=function(a,b,c,e){this.depthPass.render(a,null,this.depthTarget,e),this.regularPass.render(a,null,this.regularTarget,e),this.regularPass.render(a,null,this.regularTarget2,e),this.outPass.material.setTexture(d.DEPTH_MAP,this.depthTarget),this.outPass.material.setTexture(d.DIFFUSE_MAP,this.regularTarget),this.outPass.material.setTexture("DIFFUSE_MIP",this.regularTarget2),this.outPass.render(a,b,c,e)};var l={attributes:{vertexPosition:c.POSITION},uniforms:{viewMatrix:d.VIEW_MATRIX,projectionMatrix:d.PROJECTION_MATRIX,worldMatrix:d.WORLD_MATRIX,farPlane:d.FAR_PLANE},vshader:["attribute vec3 vertexPosition;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 worldMatrix;","varying vec4 vPosition;","void main(void) {","	vPosition = viewMatrix * worldMatrix * vec4(vertexPosition, 1.0);","	gl_Position = projectionMatrix * vPosition;","}"].join("\n"),fshader:["precision mediump float;","uniform float farPlane;",e.methods.packDepth,"varying vec4 vPosition;","void main(void)","{","	float linearDepth = min(-vPosition.z, farPlane) / farPlane;","	gl_FragColor = packDepth(linearDepth);","}"].join("\n")},m={attributes:{vertexPosition:c.POSITION,vertexUV0:c.TEXCOORD0},uniforms:{worldMatrix:d.WORLD_MATRIX,viewProjectionMatrix:d.VIEW_PROJECTION_MATRIX,depthMap:d.DEPTH_MAP,diffuseMap:d.DIFFUSE_MAP,diffuseMip:"DIFFUSE_MIP",zfar:d.FAR_PLANE,focalDepth:100,fStop:2,CoC:.003,focalLength:75,maxBlur:16},vshader:["attribute vec3 vertexPosition;","attribute vec2 vertexUV0;","uniform mat4 viewProjectionMatrix;","uniform mat4 worldMatrix;","varying vec2 texCoord0;","void main(void) {","	texCoord0 = vertexUV0;","	gl_Position = viewProjectionMatrix * worldMatrix * vec4(vertexPosition, 1.0);","}"].join("\n"),fshader:"uniform sampler2D diffuseMap;\nuniform sampler2D diffuseMip;\nuniform sampler2D depthMap;\nuniform float zfar; //camera clipping end\nuniform float focalDepth;\nuniform float focalLength;\nuniform float fStop;\nuniform float CoC;\nuniform float maxBlur;\nvarying vec2 texCoord0;\n"+e.methods.unpackDepth+"void main() \n{\n	float depth = unpackDepth(texture2D(depthMap,texCoord0)) * zfar;\n	float f = focalLength; //focal length in mm\n	float d = focalDepth*1000.0; //focal plane in mm\n	float o = depth*1000.0; //depth in mm\n	float a = (o*f)/(o-f); \n	float b = (d*f)/(d-f); \n	float c = (d-f)/(d*fStop*CoC); \n	float blur = clamp(abs(a-b)*c, 0.0, maxBlur);\n if (blur < 0.3) {\n   gl_FragColor = texture2D(diffuseMip, texCoord0);\n } else { \n   gl_FragColor = texture2D(diffuseMap, texCoord0, log2(blur));\n }\n gl_FragColor.a = 1.0;}"};return k}),define("goo/renderer/pass/DepthPass",["goo/renderer/Material","goo/renderer/pass/RenderTarget","goo/renderer/MeshData","goo/renderer/Shader","goo/renderer/shaders/ShaderFragment","goo/renderer/pass/RenderPass","goo/renderer/pass/FullscreenPass","goo/renderer/pass/BlurPass"],function(a,b,c,d,e,f,g,h){"use strict";function i(c,d){this.depthPass=new f(c);var e=a.createMaterial(j);this.depthPass.overrideMaterial=e,this.blurTarget=new b(256,256),this.blurPass=new h({target:this.blurTarget});var i=d||k;this.outPass=new g(i),this.outPass.useReadBuffer=!1;var l=window.innerWidth||1,m=window.innerHeight||1;this.depthTarget=new b(l,m),this.enabled=!0,this.clear=!1,this.needsSwap=!0}i.prototype.render=function(a,b,c,e){this.depthPass.render(a,null,this.depthTarget,e),this.blurPass.render(a,b,c,e),this.outPass.material.setTexture(d.DEPTH_MAP,this.depthTarget),this.outPass.material.setTexture(d.DIFFUSE_MAP,c),this.outPass.material.setTexture("BLUR_MAP",this.blurTarget),this.outPass.render(a,b,c,e)};var j={attributes:{vertexPosition:c.POSITION},uniforms:{viewMatrix:d.VIEW_MATRIX,projectionMatrix:d.PROJECTION_MATRIX,worldMatrix:d.WORLD_MATRIX,farPlane:d.FAR_PLANE},vshader:["attribute vec3 vertexPosition;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 worldMatrix;","varying vec4 vPosition;","void main(void) {","	vPosition = viewMatrix * worldMatrix * vec4(vertexPosition, 1.0);","	gl_Position = projectionMatrix * vPosition;","}"].join("\n"),fshader:["precision mediump float;","uniform float farPlane;",e.methods.packDepth,"varying vec4 vPosition;","void main(void)","{","	float linearDepth = min(length(vPosition), farPlane) / farPlane;","	gl_FragColor = packDepth(linearDepth);","}"].join("\n")},k={attributes:{vertexPosition:c.POSITION,vertexUV0:c.TEXCOORD0},uniforms:{viewMatrix:d.VIEW_MATRIX,projectionMatrix:d.PROJECTION_MATRIX,worldMatrix:d.WORLD_MATRIX,depthMap:d.DEPTH_MAP,diffuseMap:d.DIFFUSE_MAP},vshader:["attribute vec3 vertexPosition;","attribute vec2 vertexUV0;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 worldMatrix;","varying vec2 texCoord0;","void main(void) {","	texCoord0 = vertexUV0;","	gl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4(vertexPosition, 1.0);","}"].join("\n"),fshader:["precision mediump float;","uniform sampler2D depthMap;","uniform sampler2D diffuseMap;","varying vec2 texCoord0;",e.methods.unpackDepth,"void main(void)","{","	vec4 depthCol = texture2D(depthMap, texCoord0);","	vec4 diffuseCol = texture2D(diffuseMap, texCoord0);","	float depth = unpackDepth(depthCol);","	gl_FragColor = diffuseCol * vec4(depth);","}"].join("\n")};return i}),define("goo/renderer/pass/DoGPass",["goo/renderer/Material","goo/renderer/pass/FullscreenUtil","goo/renderer/pass/RenderTarget","goo/renderer/Util","goo/renderer/shaders/ShaderLib"],function(a,b,c,d,e){"use strict";function f(f){f=f||{},this.target=void 0!==f.target?f.target:null;var g=void 0!==f.width?f.width:512,h=void 0!==f.height?f.height:512,i=void 0!==f.sigma?f.sigma:.6,j=void 0!==f.threshold?f.threshold:.005;i>2.5&&(i=2.5),this.renderTargetX=new c(g,h),this.gaussian1=new c(g,h),this.gaussian2=new c(g,h),this.renderable={meshData:b.quad,materials:[]},this.convolutionShader1=d.clone(e.convolution),this.convolutionShader2=d.clone(e.convolution),this.differenceShader=d.clone(e.differenceOfGaussians),this.differenceShader.uniforms.threshold=j,this.differenceMaterial=a.createMaterial(this.differenceShader);var k=this.convolutionShader1.buildKernel(i),l=this.convolutionShader2.buildKernel(1.6*i),m=k.length;this.convolutionShader1.defines={KERNEL_SIZE_FLOAT:m.toFixed(1),KERNEL_SIZE_INT:m.toFixed(0)},m=l.length,this.convolutionShader2.defines={KERNEL_SIZE_FLOAT:m.toFixed(1),KERNEL_SIZE_INT:m.toFixed(0)},this.convolutionShader1.uniforms.cKernel=k,this.convolutionShader2.uniforms.cKernel=l,this.blurX=[.5/g,0],this.blurY=[0,.5/h],this.convolutionMaterial1=a.createMaterial(this.convolutionShader1),this.convolutionMaterial2=a.createMaterial(this.convolutionShader2),this.enabled=!0,this.clear=!1,this.needsSwap=!1}return f.prototype.render=function(a,c,d){this.renderable.materials[0]=this.convolutionMaterial1,this.convolutionMaterial1.setTexture("DIFFUSE_MAP",d),this.convolutionShader1.uniforms.uImageIncrement=this.blurX,a.render(this.renderable,b.camera,[],this.renderTargetX,!0),this.convolutionMaterial1.setTexture("DIFFUSE_MAP",this.renderTargetX),this.convolutionShader1.uniforms.uImageIncrement=this.blurY,a.render(this.renderable,b.camera,[],this.gaussian1,!0),this.renderable.materials[0]=this.convolutionMaterial2,this.convolutionMaterial2.setTexture("DIFFUSE_MAP",d),this.convolutionShader2.uniforms.uImageIncrement=this.blurX,a.render(this.renderable,b.camera,[],this.renderTargetX,!0),this.convolutionMaterial2.setTexture("DIFFUSE_MAP",this.renderTargetX),this.convolutionShader2.uniforms.uImageIncrement=this.blurY,a.render(this.renderable,b.camera,[],this.gaussian2,!0),this.renderable.materials[0]=this.differenceMaterial,this.differenceMaterial.setTexture("BLUR1",this.gaussian1),this.differenceMaterial.setTexture("BLUR2",this.gaussian2),this.differenceMaterial.setTexture("ORIGINAL",d),null!==this.target?a.render(this.renderable,b.camera,[],this.target,this.clear):a.render(this.renderable,b.camera,[],d,this.clear)},f}),define("goo/renderer/pass/NesPass",["goo/renderer/TextureCreator","goo/renderer/Material","goo/renderer/pass/FullscreenUtil","goo/renderer/shaders/ShaderLib"],function(a,b,c,d){"use strict";function e(d){this.material=b.createMaterial(f),this.renderToScreen=!1,this.renderable={meshData:c.quad,materials:[this.material]},this.mapping=(new a).loadTexture2D(d),this.mapping.minFilter="NearestNeighborNoMipMaps",this.mapping.magFilter="NearestNeighbor",this.mapping.generateMipmaps=!1,this.enabled=!0,this.clear=!1,this.needsSwap=!0}e.prototype.render=function(a,b,d){this.material.setTexture("DIFFUSE_MAP",d),this.material.setTexture("COLOR_MAPPING",this.mapping),this.renderToScreen?a.render(this.renderable,c.camera,[],null,this.clear):a.render(this.renderable,c.camera,[],b,this.clear)};var f={attributes:d.copy.attributes,uniforms:{diffuse:"DIFFUSE_MAP",mapping:"COLOR_MAPPING",$link:d.copy.uniforms},vshader:d.copy.vshader,fshader:["precision mediump float;","uniform sampler2D diffuse;","uniform sampler2D mapping;","varying vec2 texCoord0;","void main() {","	vec4 texCol = texture2D( diffuse, texCoord0 );","	float r = floor(texCol.r * 31.0);","	float g = floor(texCol.g * 31.0);","	float b = floor(texCol.b * 31.0);","	vec4 texPalette = texture2D( mapping, vec2((r * 32.0 + g)/1024.0, b / 32.0) );","	gl_FragColor = vec4( texPalette.rgb, 1.0 );","}"].join("\n")};return e}),define("goo/scripts/FlyControlScript",["goo/math/Vector3","goo/math/Matrix3x3","goo/math/MathUtils"],function(a,b,c){"use strict";function d(d){d=d||{},this.name="FlyControlScript",this.domElement=d.domElement||null,this.turnSpeedHorizontal=isNaN(d.turnSpeedHorizontal)?.005:d.turnSpeed,this.turnSpeedVertical=isNaN(d.turnSpeedVertical)?.005:d.turnSpeed,this.dragOnly=void 0!==d.dragOnly?d.dragOnly===!0:!0,this.dragButton=isNaN(d.dragButton)?2:d.dragButton,this.worldUpVector=new a(d.worldUpVector)||new a(0,1,0),this.localLeftVector=new a(d.localLeftVector)||new a(-1,0,0),this.onRun=d.onRun,this.maxAscent=void 0!==d.maxAscent?d.maxAscent:89.95*c.DEG_TO_RAD,this.minAscent=void 0!==d.minAscent?d.minAscent:-89.95*c.DEG_TO_RAD,this.calcVector=new a,this.calcMat1=new b,this.calcMat2=new b,this.rotX=0,this.rotY=0,this.walkSpeed=isNaN(d.walkSpeed)?400:d.walkSpeed,this.crawlSpeed=isNaN(d.crawlSpeed)?40:d.crawlSpeed,this.fwdVector=d.fwdVector||new a(0,0,-1),this.leftVector=d.leftVector||new a(-1,0,0),this.crawlKey=isNaN(d.crawlKey)?16:d.crawlKey,this.forwardKey=isNaN(d.forwardKey)?87:d.forwardKey,this.backKey=isNaN(d.backKey)?83:d.backKey,this.strafeLeftKey=isNaN(d.strafeLeftKey)?65:d.strafeLeftKey,this.strafeRightKey=isNaN(d.strafeRightKey)?68:d.strafeRightKey,this.XZ=d.XZ||!1,this.maxSpeed=d.maxSpeed||30,this.onRun=d.onRun,this.moveState={strafeLeft:0,strafeRight:0,forward:0,back:0,crawling:!1},this.moveVector=new a(0,0,0),this.calcVector=new a,this.baseMultiplier=1,this.movementMultiplier=this.baseMultiplier,this.domElement&&this.setupKeyControls(),this.resetMouseState(),this.domElement&&this.setupMouseControls()}d.prototype.updateMovementVector=function(){this.moveVector.x=this.moveState.strafeLeft-this.moveState.strafeRight,this.moveVector.z=this.moveState.forward-this.moveState.back},d.prototype.updateKeys=function(a,b){if(!a.altKey){if(this.dragOnly&&!this.mouseState.buttonDown)return this.movementMultiplier=this.baseMultiplier,this.moveState.forward=0,this.moveState.back=0,this.moveState.strafeLeft=0,this.moveState.strafeRight=0,this.updateMovementVector(),void 0;var c=!1;switch(a.keyCode){case this.crawlKey:this.moveState.crawling=b;break;case this.forwardKey:this.moveState.forward=b?1:0,c=!0;break;case this.backKey:this.moveState.back=b?1:0,c=!0;break;case this.strafeLeftKey:this.moveState.strafeLeft=b?1:0,c=!0;break;case this.strafeRightKey:this.moveState.strafeRight=b?1:0,c=!0}c&&this.updateMovementVector()}},d.prototype.setupKeyControls=function(){var a=this;this.domElement.setAttribute("tabindex",-1),this.domElement.addEventListener("keydown",function(b){a.updateKeys(b,!0)},!1),this.domElement.addEventListener("keyup",function(b){a.updateKeys(b,!1)},!1)},d.prototype.resetMouseState=function(){this.mouseState={buttonDown:!1,lastX:0/0,lastY:0/0,dX:0,dY:0}},d.prototype.updateButtonState=function(a,b){this.domElement!==document&&this.domElement.focus(),!this.dragOnly||-1!==this.dragButton&&this.dragButton!==a.button||(this.mouseState.buttonDown=b,a.preventDefault())},d.prototype.updateDeltas=function(a){isNaN(this.mouseState.lastX)||isNaN(this.mouseState.lastY)?(this.mouseState.dX=0,this.mouseState.dY=0,this.mouseState.lastX=a.clientX,this.mouseState.lastY=a.clientY):(this.mouseState.dX=a.clientX-this.mouseState.lastX,this.mouseState.dY=a.clientY-this.mouseState.lastY,this.mouseState.lastX=a.clientX,this.mouseState.lastY=a.clientY)};var e=function(a){this.resetMouseState(),this.updateButtonState(a,!0)},f=function(a){this.updateDeltas(a)},g=function(a){this.updateButtonState(a,!1)};return d.prototype.setupMouseControls=function(){var a=e.bind(this),b=f.bind(this),c=g.bind(this);this.domElement.addEventListener("mousedown",a,!1),document.addEventListener("mousemove",b,!1),document.addEventListener("mouseup",c,!1),this.domElement.addEventListener("dragstart",function(a){a.preventDefault()},!1),this.domElement.oncontextmenu=function(){return!1}},d.prototype.run=function(a,b,c){c&&!this.domElement&&c.domElement&&(this.domElement=c.domElement,this.setupMouseControls(),this.setupKeyControls());var d=a.transformComponent;if(d){var e=d.transform,f=e.rotation;if(f.toAngles(this.calcVector),this.rotY=this.calcVector.x,this.rotX=this.calcVector.y,this.dragOnly&&!this.mouseState.buttonDown)return this.mouseState.dX=0,this.mouseState.dY=0,this.movementMultiplier=this.baseMultiplier,this.moveState.forward=0,this.moveState.back=0,this.moveState.strafeLeft=0,this.moveState.strafeRight=0,this.updateMovementVector(),void 0;0!==this.moveVector.x||0!==this.moveVector.z?(this.movementMultiplier+=1*b*this.movementMultiplier,this.movementMultiplier=Math.min(this.movementMultiplier,this.maxSpeed)):this.movementMultiplier=this.baseMultiplier;var g=this.turnSpeedHorizontal,h=this.turnSpeedVertical;0!==this.mouseState.dX&&(this.rotX-=g*this.mouseState.dX),0!==this.mouseState.dY&&(this.rotY-=h*this.mouseState.dY,this.rotY>this.maxAscent?this.rotY=this.maxAscent:this.rotY<this.minAscent&&(this.rotY=this.minAscent)),e.rotation.fromAngles(this.rotY,this.rotX,0),this.calcVector.set(this.fwdVector.x*this.moveVector.z+this.leftVector.x*this.moveVector.x,this.fwdVector.y*this.moveVector.z+this.leftVector.y*this.moveVector.x,this.fwdVector.z*this.moveVector.z+this.leftVector.z*this.moveVector.x),this.calcVector.normalize();var i=(this.moveState.crawling?this.crawlSpeed:this.walkSpeed)*this.movementMultiplier,j=a._world.tpf*i;this.calcVector.mul(j);var f=e.rotation;f.applyPost(this.calcVector),this.XZ&&(this.calcVector.data[1]=0),e.translation.add(this.calcVector),d.setUpdated(),this.mouseState.dX=0,this.mouseState.dY=0}},d}),define("goo/scripts/HeightMapBoundingScript",[],function(){"use strict";function a(a,b){var c=new Image;c.src=a,this.canvas=document.createElement("canvas"),this.con2d=this.canvas.getContext("2d"),this.loaded=!1;var d=this;c.onload=function(){d.canvas.width=c.width,d.canvas.height=c.height,d.con2d.drawImage(c,0,0),d.loaded=!0,b(this)}}return a.prototype.getMatrix=function(){for(var a=[],b=0;b<this.canvas.width;b++){a.push([]);for(var c=0;c<this.canvas.height;c++)a[b].push(this.getAt(b,c))}return a},a.prototype.getAt=function(a,b){return 0>a||a>this.canvas.width||0>b||b>this.canvas.height?0:8*(this.con2d.getImageData(a,b,1,1).data[0]/255)},a.prototype.getInterpolated=function(a,b){var c=this.getAt(Math.ceil(a),Math.ceil(b)),d=this.getAt(Math.ceil(a),Math.floor(b)),e=this.getAt(Math.floor(a),Math.ceil(b)),f=this.getAt(Math.floor(a),Math.floor(b)),g=a-Math.floor(a),h=b-Math.floor(b),i=c*g+e*(1-g),j=d*g+f*(1-g),k=i*h+j*(1-h);return k},a.prototype.run=function(a){var b=a.transformComponent.transform.translation;b.data[1]=this.getInterpolated(b.data[0],b.data[2])},a}),define("goo/scripts/MouseLookControlScript",["goo/math/Vector3","goo/math/Matrix3x3","goo/math/MathUtils"],function(a,b,c){"use strict";function d(d){d=d||{},this.name="MouseLookControlScript",this.domElement=d.domElement||null,this.turnSpeedHorizontal=isNaN(d.turnSpeedHorizontal)?.01:d.turnSpeed,this.turnSpeedVertical=isNaN(d.turnSpeedVertical)?.01:d.turnSpeed,this.dragOnly=void 0!==d.dragOnly?d.dragOnly===!0:!0,this.dragButton=isNaN(d.dragButton)?-1:d.dragButton,this.worldUpVector=new a(d.worldUpVector)||new a(0,1,0),this.localLeftVector=new a(d.localLeftVector)||new a(-1,0,0),this.onRun=d.onRun,this.maxAscent=void 0!==d.maxAscent?d.maxAscent:89.95*c.DEG_TO_RAD,this.minAscent=void 0!==d.minAscent?d.minAscent:-89.95*c.DEG_TO_RAD,this.calcVector=new a,this.calcMat1=new b,this.calcMat2=new b,this.rotX=0,this.rotY=0,this.resetMouseState(),this.domElement&&this.setupMouseControls()}d.prototype.resetMouseState=function(){this.mouseState={buttonDown:!1,lastX:0/0,lastY:0/0,dX:0,dY:0}},d.prototype.updateButtonState=function(a,b){this.domElement!==document&&this.domElement.focus(),!this.dragOnly||-1!==this.dragButton&&this.dragButton!==a.button||(this.mouseState.buttonDown=b,a.preventDefault())},d.prototype.updateDeltas=function(a){isNaN(this.mouseState.lastX)||isNaN(this.mouseState.lastY)?(this.mouseState.dX=0,this.mouseState.dY=0,this.mouseState.lastX=a.clientX,this.mouseState.lastY=a.clientY):(this.mouseState.dX=a.clientX-this.mouseState.lastX,this.mouseState.dY=a.clientY-this.mouseState.lastY,this.mouseState.lastX=a.clientX,this.mouseState.lastY=a.clientY)};var e,f,g,h=function(a){this.resetMouseState(),this.updateButtonState(a,!0),f=i.bind(this),g=j.bind(this),document.addEventListener("mousemove",f,!1),document.addEventListener("mouseup",g,!1),document.addEventListener("mouseout",g,!1)},i=function(a){this.updateDeltas(a)},j=function(a){this.updateButtonState(a,!1),document.removeEventListener("mousemove",f),document.removeEventListener("mouseup",g),document.removeEventListener("mouseout",g)};return d.prototype.setupMouseControls=function(){e=h.bind(this),this.domElement.addEventListener("mousedown",e,!1)},d.prototype.run=function(a,b,c){c&&!this.domElement&&c.domElement&&(this.domElement=c.domElement,this.setupMouseControls());var d=a.transformComponent;if(d){var e=d.transform,f=e.rotation;if(f.toAngles(this.calcVector),this.rotY=this.calcVector.x,this.rotX=this.calcVector.y,this.dragOnly&&!this.mouseState.buttonDown||0===this.mouseState.dX&&0===this.mouseState.dY)return this.mouseState.dX=0,this.mouseState.dY=0,void 0;var g=this.turnSpeedHorizontal,h=this.turnSpeedVertical;0!==this.mouseState.dX&&(this.rotX-=g*this.mouseState.dX),0!==this.mouseState.dY&&(this.rotY-=h*this.mouseState.dY,this.rotY>this.maxAscent?this.rotY=this.maxAscent:this.rotY<this.minAscent&&(this.rotY=this.minAscent)),e.rotation.fromAngles(this.rotY,this.rotX,0),d.setUpdated(),this.mouseState.dX=0,this.mouseState.dY=0}},d}),define("goo/scripts/RotationControlScript",["goo/math/Matrix3x3"],function(a){"use strict";function b(a){a=a||{},this.bindings={attach:c.bind(this),update:null,remove:null},this.element=a.domElement||null,this.name="RotationControlScript",this.states={dirty:!1,x:null,y:null,dx:null,dy:null},this.element&&this.setupMouseControls()}var c=function(a){a=a.touches&&1===a.touches.length?a.touches[0]:a,this.states.dx=0,this.states.dy=0,this.states.x=a.pageX,this.states.y=a.pageY,this.bindings.update=d.bind(this),this.bindings.remove=e.bind(this),document.addEventListener("mousemove",this.bindings.update,!1),document.addEventListener("touchmove",this.bindings.update,!1),document.addEventListener("mouseup",this.bindings.remove,!1),document.addEventListener("touchend",this.bindings.remove,!1)},d=function(a){a=a.touches&&1===a.touches.length?a.touches[0]:a,this.states.dirty=!0,this.states.dx+=a.pageX-this.states.x,this.states.dy+=a.pageY-this.states.y,this.states.x=a.pageX,this.states.y=a.pageY},e=function(){document.removeEventListener("mousemove",this.bindings.update),document.removeEventListener("touchmove",this.bindings.update),document.removeEventListener("mouseup",this.bindings.remove),document.removeEventListener("touchend",this.bindings.remove)};return b.prototype.setupMouseControls=function(){this.element.addEventListener("mousedown",this.bindings.attach,!1),this.element.addEventListener("touchstart",this.bindings.attach,!1)},b.prototype.run=function(b,c,d){if(d&&!this.element&&d.domElement&&(this.element=d.domElement,this.setupMouseControls()),this.states.dirty){var e=Math.PI*this.states.dy/this.element.clientHeight,f=Math.PI*this.states.dx/this.element.clientWidth,g=Math.cos(e),h=Math.sin(e),i=Math.cos(f),j=Math.sin(f),k=new a(i,h*j,0-g*j,0,g,h,j,0-h*i,g*i);a.combine(k,b.transformComponent.transform.rotation,b.transformComponent.transform.rotation),b.transformComponent.setUpdated(),this.states.dirty=!1,this.states.dx=0,this.states.dy=0}},b}),define("goo/scripts/SparseHeightMapBoundingScript",[],function(){"use strict";function a(a){this.elevationData=a}return a.prototype.getClosest=function(a,b){for(var c=Number.MAX_VALUE,d=-1,e=0;e<this.elevationData.length;e+=3){var f=Math.pow(this.elevationData[e+0]-a,2)+Math.pow(this.elevationData[e+2]-b,2);c>f&&(c=f,d=e)}return this.elevationData[d+1]},a.prototype.run=function(a){var b=a.transformComponent.transform.translation,c=this.getClosest(b.data[0],b.data[2]),d=b.data[1]-c;b.data[1]-=.1*d},a}),define("goo/scripts/SplineInterpolator",["goo/math/Matrix4x4","goo/math/Vector4"],function(a,b){"use strict";function c(a){a=a||{},this.controlPoint=0,this.controlPoints=a.controlPoints||[],this.elapsedTime=0,this.enabled=a.enabled||!0,this.firstIteration=!0,this.tolerance=a.tolerance||.01,this.beforeFunction=a.beforeFunction||function(a){return a.transformComponent.transform.translation.clone().data},this.updateFunction=a.updateFunction||function(a,b){a.transformComponent.transform.translation.set(b),a.transformComponent.setUpdated()},this.afterFunction=a.afterFunction||function(){}}var d=function(a,b,c){return Math.min(Math.max(a,b),c)};return c.CATMULL_ROM=new a(-.5,1,-.5,0,1.5,-2.5,0,1,-1.5,2,.5,0,.5,-.5,0,0),c.UNIFORM_CUBIC=new a(-.16667,.5,-.5,.16667,.5,-1,0,.66667,-.5,.5,.5,.16667,.16667,0,0,0),c.prototype.run=function(a,e){if(this.firstIteration){this.firstIteration=!1;try{this.controlPoints.unshift({time:0,value:this.beforeFunction(a)})}catch(f){return this.enabled=!1,void 0}}for(var g=d(this.controlPoint-1,0,this.controlPoints.length-1),h=d(this.controlPoint+0,0,this.controlPoints.length-1),i=d(this.controlPoint+1,0,this.controlPoints.length-1),j=d(this.controlPoint+2,0,this.controlPoints.length-1),k=this.controlPoints[i].time>this.controlPoints[h].time?(this.elapsedTime-this.controlPoints[h].time)/(this.controlPoints[i].time-this.controlPoints[h].time):0,l=c.CATMULL_ROM.applyPre(new b(k*k*k,k*k,k,1)),m=new Array(this.controlPoints[0].value.length),n=0,o=0;o<m.length;o++)m[o]=0,m[o]+=this.controlPoints[g].value[o]*l[0],m[o]+=this.controlPoints[h].value[o]*l[1],m[o]+=this.controlPoints[i].value[o]*l[2],m[o]+=this.controlPoints[j].value[o]*l[3],n+=Math.abs(this.controlPoints[this.controlPoints.length-1].value[o]-m[o]);
try{this.updateFunction(a,m)}catch(f){return this.enabled=!1,void 0}if(this.elapsedTime+=e,this.elapsedTime>=this.controlPoints[i].time&&this.controlPoint++,this.controlPoint>=this.controlPoints.length||n<this.tolerance){try{this.afterFunction(a)}catch(f){}return this.enabled=!1,void 0}},c}),define("goo/shapes/FilledPolygon",["goo/renderer/MeshData","goo/math/MathUtils"],function(a,b){"use strict";function c(b,c){this.verts=b,this.indices=c?c:d(b);var e=a.defaultMap([a.POSITION,a.NORMAL,a.TEXCOORD0]);a.call(this,e,this.verts.length/3,this.indices.length),this.rebuild()}function d(a){var b=a.length/3;if(3>b)return[];for(var c=[],d=[],g=0;b>g;g++)d.push(g);for(var g=0,h=b;h>3;){var i=d[(g+0)%h],j=d[(g+1)%h],k=d[(g+2)%h],l=a[3*i],m=a[3*i+1],n=a[3*j],o=a[3*j+1],p=a[3*k],q=a[3*k+1],r=!1;if(f(l,m,n,o,p,q)){r=!0;for(var s=0;h>s;s++){var t=d[s];if(t!==i&&t!==j&&t!==k&&e(a[3*t],a[3*t+1],l,m,n,o,p,q)){r=!1;break}}}if(r)c.push(i,j,k),d.splice((g+1)%h,1),h--,g=0;else if(g++>3*h)break}return c.push(d[0],d[1],d[2]),c}function e(a,b,c,d,e,f,g,h){var i=g-c,j=h-d,k=e-c,l=f-d,m=a-c,n=b-d,o=i*i+j*j,p=i*k+j*l,q=i*m+j*n,r=k*k+l*l,s=k*m+l*n,t=1/(o*r-p*p),u=(r*q-p*s)*t,v=(o*s-p*q)*t;return u>=0&&v>=0&&1>u+v}function f(a,b,c,d,e,f){return(b-d)*(e-c)+(c-a)*(f-d)>=0}function g(a){for(var b=a[0],c=a[0],d=a[1],e=a[1],f=3;f<a.length;f+=3)b=b<a[f+0]?b:a[f+0],c=c>a[f+0]?c:a[f+0],d=d<a[f+1]?d:a[f+1],e=e>a[f+1]?e:a[f+1];return{minX:b,maxX:c,minY:d,maxY:e}}return c.prototype=Object.create(a.prototype),c.prototype.rebuild=function(){this.getAttributeBuffer(a.POSITION).set(this.verts);for(var c=[],d=0;d<this.indices.length;d+=3){var e=b.getTriangleNormal(this.verts[3*this.indices[d+0]+0],this.verts[3*this.indices[d+0]+1],this.verts[3*this.indices[d+0]+2],this.verts[3*this.indices[d+1]+0],this.verts[3*this.indices[d+1]+1],this.verts[3*this.indices[d+1]+2],this.verts[3*this.indices[d+2]+0],this.verts[3*this.indices[d+2]+1],this.verts[3*this.indices[d+2]+2]);c[3*this.indices[d+0]+0]=e[0],c[3*this.indices[d+0]+1]=e[1],c[3*this.indices[d+0]+2]=e[2],c[3*this.indices[d+1]+0]=e[0],c[3*this.indices[d+1]+1]=e[1],c[3*this.indices[d+1]+2]=e[2],c[3*this.indices[d+2]+0]=e[0],c[3*this.indices[d+2]+1]=e[1],c[3*this.indices[d+2]+2]=e[2]}this.getAttributeBuffer(a.NORMAL).set(c),this.getIndexBuffer().set(this.indices);for(var f=[],h=g(this.verts),i=h.maxX-h.minX,j=h.maxY-h.minY,d=0;d<this.verts.length;d+=3){var k=(this.verts[d+0]-h.minX)/i,l=(this.verts[d+1]-h.minY)/j;f.push(k,l)}return this.getAttributeBuffer(a.TEXCOORD0).set(f),this},c}),define("goo/shapes/Surface",["goo/renderer/MeshData","goo/math/MathUtils"],function(a,b){"use strict";function c(b,c,d){this.verts=b,this.vertsPerLine=c||2,this.verticallyClosed=!!d;var e=a.defaultMap([a.POSITION,a.NORMAL,a.TEXCOORD0]),f=this.verts.length/3,g=f/this.vertsPerLine;a.call(this,e,f,6*(g-1)*(this.vertsPerLine-1)),this.rebuild()}function d(a){for(var b=a[0],c=a[0],d=a[1],e=a[1],f=3;f<a.length;f+=3)b=b<a[f+0]?b:a[f+0],c=c>a[f+0]?c:a[f+0],d=d<a[f+1]?d:a[f+1],e=e>a[f+1]?e:a[f+1];return{minX:b,maxX:c,minY:d,maxY:e}}return c.prototype=Object.create(a.prototype),c.prototype.rebuild=function(){this.getAttributeBuffer(a.POSITION).set(this.verts);for(var c=[],e=[],f=[],g=this.verts.length/3,h=g/this.vertsPerLine,i=0;h-1>i;i++){for(var j=0;j<this.vertsPerLine-1;j++){var k=(i+0)*this.vertsPerLine+(j+0),l=(i+1)*this.vertsPerLine+(j+0),m=(i+1)*this.vertsPerLine+(j+1),n=(i+0)*this.vertsPerLine+(j+1);c.push(k,l,n,n,l,m),f=b.getTriangleNormal(this.verts[3*k+0],this.verts[3*k+1],this.verts[3*k+2],this.verts[3*l+0],this.verts[3*l+1],this.verts[3*l+2],this.verts[3*n+0],this.verts[3*n+1],this.verts[3*n+2]),e.push(f[0],f[1],f[2])}if(this.verticallyClosed){var k=(i+0)*this.vertsPerLine+0,l=(i+1)*this.vertsPerLine+0,n=(i+0)*this.vertsPerLine+1;f=b.getTriangleNormal(this.verts[3*k+0],this.verts[3*k+1],this.verts[3*k+2],this.verts[3*l+0],this.verts[3*l+1],this.verts[3*l+2],this.verts[3*n+0],this.verts[3*n+1],this.verts[3*n+2]),e.push(f[0],f[1],f[2])}else e.push(f[0],f[1],f[2])}i--;for(var j=0;j<this.vertsPerLine-1;j++){var k=(i+0)*this.vertsPerLine+(j+0),l=(i+1)*this.vertsPerLine+(j+0),n=(i+0)*this.vertsPerLine+(j+1);f=b.getTriangleNormal(this.verts[3*k+0],this.verts[3*k+1],this.verts[3*k+2],this.verts[3*l+0],this.verts[3*l+1],this.verts[3*l+2],this.verts[3*n+0],this.verts[3*n+1],this.verts[3*n+2]),e.push(f[0],f[1],f[2])}e.push(f[0],f[1],f[2]),this.getAttributeBuffer(a.NORMAL).set(e),this.getIndexBuffer().set(c);for(var o=[],p=d(this.verts),q=p.maxX-p.minX,r=p.maxY-p.minY,i=0;i<this.verts.length;i+=3){var s=(this.verts[i+0]-p.minX)/q,t=(this.verts[i+1]-p.minY)/r;o.push(s,t)}return this.getAttributeBuffer(a.TEXCOORD0).set(o),this},c.createFromHeightMap=function(a,b,d){b=b||1,d=d||1;for(var e=[],f=0;f<a.length;f++)for(var g=0;g<a[f].length;g++)e.push(f*b,g*d,a[f][g]);return new c(e,a[0].length)},c}),define("goo/shapes/PolyLine",["goo/renderer/MeshData","goo/shapes/Surface"],function(a,b){"use strict";function c(b,c){this.verts=b,this.closed=!!c;var d=a.defaultMap([a.POSITION]);a.call(this,d,this.verts.length/3,this.verts.length/3),this.indexModes=this.closed?["LineLoop"]:["LineStrip"],this.rebuild()}function d(a,b,c,d){var e=Math.sqrt(a*a+b*b),f=a/e,g=b/e,h=Math.sqrt(c*c+d*d),i=c/h,j=d/h;return Math.atan2(g+j,f+i)-Math.PI/2}function e(a,b){var c,e,f,g,h,i,j=a.length/3;return 0===b?(f=a[0],g=a[2],h=a[3],i=a[5],Math.atan2(i-g,h-f)-Math.PI/2):b===j-1?(c=a[3*(j-2)+0],e=a[3*(j-2)+2],f=a[3*(j-1)+0],g=a[3*(j-1)+2],Math.atan2(g-e,f-c)-Math.PI/2):(c=a[3*(b-1)+0],e=a[3*(b-1)+2],f=a[3*b+0],g=a[3*b+2],h=a[3*(b+1)+0],i=a[3*(b+1)+2],d(f-c,g-e,h-f,i-g))}return c.prototype=Object.create(a.prototype),c.prototype.rebuild=function(){this.getAttributeBuffer(a.POSITION).set(this.verts);for(var b=[],c=this.verts.length/3,d=0;c>d;d++)b.push(d);return this.getIndexBuffer().set(b),this},c.prototype.mul=function(a){if(a instanceof c){for(var d=a.verts.length/3,e=[],f=0;f<this.verts.length;f+=3)for(var g=0;g<a.verts.length;g+=3)e.push(this.verts[f+0]+a.verts[g+0],this.verts[f+1]+a.verts[g+1],this.verts[f+2]+a.verts[g+2]);return new b(e,d)}},c.prototype.pipe=function(a){if(!(a instanceof c))return console.error("pipe operation can only be applied to PolyLines"),void 0;for(var d=a.verts.length/3,f=[],g=0;g<this.verts.length;g+=3)for(var h=e(this.verts,g/3),i=0;i<a.verts.length;i+=3)f.push(this.verts[g+0]+a.verts[i+2]*Math.cos(h),this.verts[g+1]+a.verts[i+1],this.verts[g+2]+a.verts[i+2]*Math.sin(h));return new b(f,d)},c.prototype.lathe=function(a){a=a||8;for(var c=2*Math.PI/a,d=[],e=0;e<this.verts.length;e+=3)for(var f=0,g=0;a>=f;f++,g+=c)d.push(Math.cos(g)*this.verts[e+0],this.verts[e+1],Math.sin(g)*this.verts[e+0]);return new b(d,a+1,!0)},c.prototype.concat=function(a,b){return a instanceof c?new c(this.verts.concat(a.verts),b):(console.error("concat operation can only be applied to PolyLines"),void 0)},c.fromCubicBezier=function(a,b,d){if(12!==a.length)return console.error("PolyLine.fromCubicBezier takes an array of exactly 12 coordinates"),void 0;b=b||16,d=d||0;for(var e=[],f=[],g=[],h=[],i=[],j=[],k=[],l=d;b>=l;l++){var m=l/b;f[0]=a[0]+(a[3]-a[0])*m,f[1]=a[1]+(a[4]-a[1])*m,f[2]=a[2]+(a[5]-a[2])*m,g[0]=a[3]+(a[6]-a[3])*m,g[1]=a[4]+(a[7]-a[4])*m,g[2]=a[5]+(a[8]-a[5])*m,h[0]=a[6]+(a[9]-a[6])*m,h[1]=a[7]+(a[10]-a[7])*m,h[2]=a[8]+(a[11]-a[8])*m,i[0]=f[0]+(g[0]-f[0])*m,i[1]=f[1]+(g[1]-f[1])*m,i[2]=f[2]+(g[2]-f[2])*m,j[0]=g[0]+(h[0]-g[0])*m,j[1]=g[1]+(h[1]-g[1])*m,j[2]=g[2]+(h[2]-g[2])*m,k[0]=i[0]+(j[0]-i[0])*m,k[1]=i[1]+(j[1]-i[1])*m,k[2]=i[2]+(j[2]-i[2])*m,e.push(k[0],k[1],k[2])}return new c(e)},c.fromCubicSpline=function(a,b,d){if(d){if(0!==a.length%3&&0!==a.length/3%3)return console.error("Wrong number of coordinates supplied in first argument to PolyLine.fromCubicSpline"),void 0;for(var e=a.length/3,f=e/3,g=c.fromCubicBezier(a.slice(0,12),b,1),h=1;f-1>h;h++){var i=c.fromCubicBezier(a.slice(9*h,9*h+12),b,1);g=g.concat(i)}var i=c.fromCubicBezier(a.slice(9*h,9*h+9).concat(a.slice(0,3)),b,1);return g=g.concat(i)}if(0!==a.length%3&&1!==a.length/3%3)return console.error("Wrong number of coordinates supplied in first argument to PolyLine.fromCubicSpline"),void 0;for(var e=a.length/3,f=(e-1)/3,g=c.fromCubicBezier(a.slice(0,12),b,1),h=1;f>h;h++){var i=c.fromCubicBezier(a.slice(9*h,9*h+12),b,1);g=g.concat(i)}return g},c}),define("goo/shapes/ProjectedGrid",["goo/renderer/MeshData","goo/math/Vector2","goo/math/Vector3","goo/math/Vector4","goo/math/Matrix4x4","goo/renderer/Camera","goo/math/MathUtils"],function(a,b,c,d,e,f,g){"use strict";function h(g,h){this.densityX=void 0!==g?g:20,this.densityY=void 0!==h?h:20,this.projectorCamera=new f(45,1,.1,2e3),this.mainCamera=new f(45,1,.1,2e3),this.freezeProjector=!1,this.upperBound=20,this.origin=new d,this.direction=new d,this.source=new b,this.rangeMatrix=new e,this.intersectBottomLeft=new d,this.intersectTopLeft=new d,this.intersectTopRight=new d,this.intersectBottomRight=new d,this.planeIntersection=new c,this.freezeProjector=!1,this.projectorMinHeight=50,this.intersections=[];for(var i=0;24>i;i++)this.intersections.push(new c);this.connections=[0,3,1,2,0,4,1,5,2,6,3,7,4,7,5,6];var j=this.densityX*this.densityY,k=6*(this.densityX-1)*(this.densityY-1),l=a.defaultMap([a.POSITION,a.TEXCOORD0]);a.call(this,l,j,k),this.rebuild()}return h.prototype=Object.create(a.prototype),h.prototype.update=function(a){var b=this.upperBound,f=this.mainCamera;this.freezeProjector||f.copy(a);var h=f.translation;h.y>0&&h.y<b+f.near?f.translation.setd(h.x,b+f.near,h.z):h.y<0&&h.y>-b-f.near&&f.translation.setd(h.x,-b-f.near,h.z);for(var i=f.calculateFrustumCorners(),j=0,k=new c,l=0;8>l;l++){var m=this.connections[2*l],n=this.connections[2*l+1];(i[m].y>b&&i[n].y<b||i[m].y<b&&i[n].y>b)&&this.getWorldIntersectionSimple(b,i[m],i[n],this.intersections[j++],k),(i[m].y>-b&&i[n].y<-b||i[m].y<-b&&i[n].y>-b)&&this.getWorldIntersectionSimple(-b,i[m],i[n],this.intersections[j++],k)}for(var l=0;8>l;l++)i[l].y<b&&i[l].y>-b&&this.intersections[j++].set(i[l]);if(0===j)return!1;var o=this.projectorCamera;if(o.copy(f),o.translation.y>0&&o._direction.y>0||o.translation.y<0&&o._direction.y<0){o._direction.y=-o._direction.y;var p=new c;p.setv(o._direction).cross(o._left).normalize(),o._up.setv(p)}var m=this.source,q=this.planeIntersection;m.set(.5,.5),this.getWorldIntersection(0,m,o.getViewProjectionInverseMatrix(),q);var r=o.translation;if(r.y>0&&r.y<2*this.projectorMinHeight){var s=(2*this.projectorMinHeight-r.y)/(2*this.projectorMinHeight);o.translation.setd(r.x,2*this.projectorMinHeight-this.projectorMinHeight*s,r.z)}else if(r.y<0&&r.y>2*-this.projectorMinHeight){var s=(2*-this.projectorMinHeight-r.y)/(2*-this.projectorMinHeight);o.translation.setd(r.x,2*-this.projectorMinHeight+this.projectorMinHeight*s,r.z)}q.subv(o.translation),q.y=0;var t=q.length();t>Math.abs(o.translation.y)?(q.normalize(),q.mul(Math.abs(o.translation.y))):t<g.EPSILON&&(q.addv(o._up),q.y=0,q.normalize(),q.mul(.1)),q.addv(o.translation),q.y=0,o.lookAt(q,c.UNIT_Y);for(var u=o.getViewProjectionMatrix(),v=new d,w=this.intersections,l=0;j>l;l++)v.set(w[l].x,0,this.intersections[l].z,1),u.applyPost(v),w[l].set(v.x,v.y,0),w[l].div(v.w);for(var x=Number.MAX_VALUE,y=-Number.MAX_VALUE,z=Number.MAX_VALUE,A=-Number.MAX_VALUE,l=0;j>l;l++)w[l].x<x&&(x=w[l].x),w[l].x>y&&(y=w[l].x),w[l].y<z&&(z=w[l].y),w[l].y>A&&(A=w[l].y);var B=this.rangeMatrix;B.setIdentity(),B.e00=y-x,B.e11=A-z,B.e03=x,B.e13=z;var C=o.getViewProjectionInverseMatrix();return e.combine(C,B,B),m.set(.5,.5),this.getWorldIntersectionHomogenous(0,m,B,this.intersectBottomLeft),m.set(.5,1),this.getWorldIntersectionHomogenous(0,m,B,this.intersectTopLeft),m.set(1,1),this.getWorldIntersectionHomogenous(0,m,B,this.intersectTopRight),m.set(1,.5),this.getWorldIntersectionHomogenous(0,m,B,this.intersectBottomRight),!0},h.prototype.getWorldIntersectionHomogenous=function(a,b,c,d){this.calculateIntersection(a,b,c),d.setv(this.origin)},h.prototype.getWorldIntersection=function(a,b,c,d){this.calculateIntersection(a,b,c),d.setd(this.origin.x,this.origin.y,this.origin.z).div(this.origin.w)},h.prototype.getWorldIntersectionSimple=function(a,b,c,d,e){var f=d.setv(b),g=e.setv(c).sub(f),h=(a-f.y)/g.y;return g.mul(h),f.addv(g),h>=0&&1>=h},h.prototype.calculateIntersection=function(a,b,c){if(this.origin.setd(2*b.x-1,2*b.y-1,-1,1),this.direction.setd(2*b.x-1,2*b.y-1,1,1),c.applyPost(this.origin),c.applyPost(this.direction),this.direction.sub(this.origin),Math.abs(this.direction.y)>g.EPSILON){var d=(a-this.origin.y)/this.direction.y;this.direction.mul(d)}else this.direction.normalize(),this.direction.mul(this.mainCamera._frustumFar);this.origin.add(this.direction)},h.prototype.rebuild=function(){for(var b=this.getAttributeBuffer(a.POSITION),c=this.getAttributeBuffer(a.TEXCOORD0),d=this.getIndexBuffer(),e=this.densityX,f=this.densityY,g=0;e>g;g++)for(var h=0;f>h;h++)b[3*(g+h*e)+0]=g,b[3*(g+h*e)+1]=0,b[3*(g+h*e)+2]=h,c[2*(g+h*e)+0]=g/(e-1),c[2*(g+h*e)+1]=h/(f-1);for(var i=0,j=0;e*(f-1)>j;j++)(0!==j%(e*(Math.floor(j/e)+1)-1)||0===j)&&(d[i++]=j,d[i++]=1+e+j,d[i++]=1+j,d[i++]=j,d[i++]=e+j,d[i++]=1+e+j);return this},h}),define("goo/shapes/RegularPolygon",["goo/renderer/MeshData","goo/shapes/PolyLine"],function(a,b){"use strict";function c(a,c){this.nSegments=a||5,this.radius=c||1;for(var d=[],e=2*Math.PI/a,f=0,g=0;f<this.nSegments;f++,g+=e)d.push(Math.cos(g)*this.radius,Math.sin(g)*this.radius,0);b.call(this,d,!0),this.rebuild()}return c.prototype=Object.create(b.prototype),c}),define("goo/shapes/SimpleBox",["goo/renderer/MeshData"],function(a){"use strict";function b(b,c,d){this.xExtent=void 0!==b?.5*b:.5,this.yExtent=void 0!==c?.5*c:.5,this.zExtent=void 0!==d?.5*d:.5;var e=a.defaultMap([a.POSITION]);a.call(this,e,8,36),this.rebuild()}return b.prototype=Object.create(a.prototype),b.prototype.rebuild=function(){var b=this.xExtent,c=this.yExtent,d=this.zExtent;return this.getAttributeBuffer(a.POSITION).set([-b,-c,-d,b,-c,-d,b,c,-d,-b,c,-d,-b,-c,d,b,-c,d,b,c,d,-b,c,d]),this.getIndexBuffer().set([0,1,2,2,3,0,7,6,5,5,4,7,0,3,7,7,4,0,1,2,6,6,5,1,3,2,6,6,7,3,0,1,5,5,4,0]),this},b}),define("goo/shapes/Triangle",["goo/renderer/MeshData","goo/math/MathUtils"],function(a,b){"use strict";function c(b){this.verts=b;var c=a.defaultMap([a.POSITION,a.NORMAL]);a.call(this,c,3,3),this.rebuild()}return c.prototype=Object.create(a.prototype),c.prototype.rebuild=function(){this.getAttributeBuffer(a.POSITION).set(this.verts);var c=b.getTriangleNormal(this.verts[0],this.verts[1],this.verts[2],this.verts[3],this.verts[4],this.verts[5],this.verts[6],this.verts[7],this.verts[8]);return this.getAttributeBuffer(a.NORMAL).set([c[0],c[1],c[2],c[0],c[1],c[2],c[0],c[1],c[2]]),this.getIndexBuffer().set([0,1,2]),this},c}),define("goo/statemachine/FSMSystem",["goo/entities/systems/System","goo/statemachine/actions/Actions"],function(a){"use strict";function b(b){a.call(this,"FSMSystem",["FSMComponent"]),this.engine=b,this.resetRequest=!1,this.passive=!1,this.entered=!0,this.paused=!1,this.time=0}return b.prototype=Object.create(a.prototype),b.prototype.process=function(a,b){var c;if(this.resetRequest){this.resetRequest=!1;for(var d=0;d<a.length;d++)c=a[d].fSMComponent,c.kill(),c.cleanup();return this.time=0,window.TWEEN&&window.TWEEN.removeAll(),this.passive=!0,void 0}if(this.time+=b,this.entered){this.entered=!1;for(var d=0;d<a.length;d++)c=a[d].fSMComponent,c.init(),c.doEnter()}window.TWEEN&&window.TWEEN.update(1e3*this.time);for(var d=0;d<a.length;d++)c=a[d].fSMComponent,c.update(b)},b.prototype.inserted=function(a){var b=a.fSMComponent;b.entity=a,b.system=this,b.init()},b.prototype.pause=function(){this.passive=!0,this.paused=!0},b.prototype.play=function(){this.passive=!1,this.paused||(this.entered=!0),this.paused=!1},b.prototype.reset=function(){this.passive=!1,this.resetRequest=!0,this.paused=!1},b}),define("goo/statemachine/actions/AddPositionAction",["goo/statemachine/actions/Action","goo/statemachine/FSMUtil"],function(a,b){"use strict";function c(){a.apply(this,arguments)}return c.prototype=Object.create(a.prototype),c.prototype.configure=function(a){this.everyFrame=a.everyFrame!==!1,this.entity=a.entity||null,this.amountX=a.amountX||0,this.amountY=a.amountY||0,this.amountZ=a.amountZ||0,this.speed=a.speed||1},c.external={parameters:[{name:"Entity",key:"entity",type:"entity",description:"Entity to move"},{name:"Amount X",key:"amountX",type:"float",description:"Amount to move on the X axis","default":0},{name:"Amount Y",key:"amountY",type:"float",description:"Amount to move on the Y axis","default":0},{name:"Amount Z",key:"amountZ",type:"float",description:"Amount to move on the Z axis","default":0},{name:"Speed",key:"speed",type:"float",description:"Speed to multiply","default":1},{name:"On every frame",key:"everyFrame",type:"boolean",description:"Repeat this action every frame","default":!0}],transitions:[]},c.prototype._run=function(a){if(null!==this.entity){var c=a.getTpf(),d=b.getValue(this.amountX,a),e=b.getValue(this.amountY,a),f=b.getValue(this.amountZ,a);this.entity.transformComponent.transform.translation.add_d(d*this.speed*c,e*this.speed*c,f*this.speed*c),this.entity.transformComponent.setUpdated()}},c}),define("goo/statemachine/actions/AddVariableAction",["goo/statemachine/actions/Action","goo/statemachine/FSMUtil"],function(a,b){"use strict";function c(){a.apply(this,arguments)}return c.prototype=Object.create(a.prototype),c.prototype.configure=function(a){this.everyFrame=!!a.everyFrame,this.variable=a.variable||null,this.amount=a.amount||1},c.external={parameters:[{name:"Variable",key:"variable",type:"identifier"},{name:"Amount",key:"amount",type:"float"},{name:"On every frame",key:"everyFrame",type:"boolean",description:"Repeat this action every frame","default":!1}],transitions:[]},c.prototype._run=function(a){a.applyOnVariable(this.variable,function(c){return c+b.getValue(this.amount,a)}.bind(this))},c}),define("goo/statemachine/actions/GetPositionAction",["goo/statemachine/actions/Action"],function(a){"use strict";function b(){a.apply(this,arguments)}return b.prototype=Object.create(a.prototype),b.prototype.configure=function(a){this.everyFrame=a.everyFrame!==!1,this.entity=a.entity||null,this.variableX=a.variableX||null,this.variableY=a.variableY||null,this.variableZ=a.variableZ||null},b.external={parameters:[{name:"VariableX",key:"variableX",type:"identifier"},{name:"VariableY",key:"variableY",type:"identifier"},{name:"VariableZ",key:"variableZ",type:"identifier"},{name:"On every frame",key:"everyFrame",type:"boolean",description:"Repeat this action every frame","default":!0}],transitions:[]},b.prototype._run=function(a){var b=this.entity.transformComponent.transform.translation;null!==this.entity&&(this.variableX&&a.applyOnVariable(this.variableX,function(){return b.data[0]}),this.variableY&&a.applyOnVariable(this.variableY,function(){return b.data[1]}),this.variableZ&&a.applyOnVariable(this.variableZ,function(){return b.data[2]}))},b}),define("goo/statemachine/actions/GuiButtonAction",["goo/statemachine/actions/Action"],function(a){"use strict";function b(a){a=a||{},this.everyFrame=a.everyFrame||!0,this.name=a.name||"Button",this.event=a.event||"dummy"}return b.prototype=Object.create(a.prototype),b.external=[{name:"Name",key:"name",type:"string"},{name:"Send Event",key:"event",type:"event"}],b.prototype._setup=function(a){this.button=$("<button/>",{text:this.name,css:{position:"relative","z-index":1e4},click:function(){a.send(this.event)}.bind(this)}).appendTo($("body"))},b.prototype.exit=function(){this.button&&this.button.remove()},b}),define("goo/statemachine/actions/MultiplyVariableAction",["goo/statemachine/actions/Action","goo/statemachine/FSMUtil"],function(a,b){"use strict";function c(){a.apply(this,arguments)}return c.prototype=Object.create(a.prototype),c.prototype.configure=function(a){this.everyFrame=!!a.everyFrame,this.variable=a.variable||null,this.amount=a.amount||1},c.external={parameters:[{name:"Variable",key:"variable",type:"identifier"},{name:"Amount",key:"amount",type:"float"},{name:"On every frame",key:"everyFrame",type:"boolean",description:"Repeat this action every frame","default":!1}],transitions:[]},c.prototype._run=function(a){a.applyOnVariable(this.variable,function(c){return c*b.getValue(this.amount,a)}.bind(this))},c}),define("goo/statemachine/actions/NumberCompareAction",["goo/statemachine/actions/Action","goo/statemachine/FSMUtil"],function(a,b){"use strict";function c(){a.apply(this,arguments)}return c.prototype=Object.create(a.prototype),c.prototype.configure=function(a){this.everyFrame=a.everyFrame!==!1,this.leftHand=a.leftHand||0,this.rightHand=a.rightHand||0,this.tolerance=a.tolerance||1e-4,this.lessThanEvent={channel:a.transitions.less},this.equalEvent={channel:a.transitions.equal},this.greaterThanEvent={channel:a.transitions.greater}},c.external={parameters:[{name:"Left hand value",key:"leftHand",type:"float"},{name:"Right hand value",key:"rightHand",type:"float"},{name:"Tolerance",key:"tolerance",type:"float","default":.001},{name:"On every frame",key:"everyFrame",type:"boolean",description:"Repeat this action every frame","default":!0}],transitions:[{name:"less",description:"Event fired if left hand argument is smaller than right hand argument"},{name:"equal",description:"Event fired if both sides are approximately equal"},{name:"greater",description:"Event fired if left hand argument is greater than right hand argument"}]},c.prototype._run=function(a){var c=b.getValue(this.leftHand,a),d=b.getValue(this.rightHand,a),e=d-c;Math.abs(e)<=this.tolerance?this.equalEvent.channel&&a.send(this.equalEvent.channel):e>0?this.lessThanEvent.channel&&a.send(this.lessThanEvent.channel):this.greaterThanEvent.channel&&a.send(this.greaterThanEvent.channel)},c}),define("goo/statemachine/actions/ResumeFSMAction",["goo/statemachine/actions/Action"],function(a){"use strict";function b(){a.apply(this,arguments)}return b.prototype=Object.create(a.prototype),b.prototype.constructor=b,b.external={name:"Resume FSM",description:"Continue running a suspended state machine",parameters:[{name:"Entity",key:"entity",type:"entity",description:"Entity to resume its FSM","default":null}],transitions:[]},b.prototype._run=function(){this.entity&&this.entity.fSMComponent&&this.entity.fSMComponent.resume()},b}),define("goo/statemachine/actions/SetCssPropertyAction",["goo/statemachine/actions/Action"],function(a){"use strict";function b(a){a=a||{},this.everyFrame=a.everyFrame||!1,this.selector=a.selector||"body",this.property=a.property||"background-color",this.value=a.value||"black"}return b.prototype=Object.create(a.prototype),b.external=[{selector:["string","Selector"],property:["string","Property"],value:["string","Value"]}],b.prototype.onCreate=function(){$(this.selector).css(this.property,this.value)},b}),define("goo/statemachine/actions/SetLightRangeAction",["goo/statemachine/actions/Action"],function(a){"use strict";function b(){a.apply(this,arguments)}return b.prototype=Object.create(a.prototype),b.prototype.configure=function(a){this.everyFrame=!!a.everyFrame,this.entity=a.entity||null,this.range=a.range||100},b.external={name:"Set Light Range",description:"Sets the range of a light",parameters:[{name:"Entity",key:"entity",type:"entity",description:"Light entity"},{name:"Range",key:"range",type:"real",description:"Light range","default":100,min:0},{name:"On every frame",key:"everyFrame",type:"boolean",description:"Repeat this action every frame","default":!0}],transitions:[]},b.prototype._run=function(){this.entity&&this.entity.lightComponent&&this.entity.lightComponent.light&&(this.entity.lightComponent.light.range=this.range)},b}),define("goo/statemachine/actions/SetPositionAction",["goo/statemachine/actions/Action","goo/statemachine/FSMUtil"],function(a,b){"use strict";function c(){a.apply(this,arguments)}return c.prototype=Object.create(a.prototype),c.prototype.configure=function(a){this.everyFrame=!!a.everyFrame,this.entity=a.entity||null,this.amountX=a.amountX||0,this.amountY=a.amountY||0,this.amountZ=a.amountZ||0},c.external={parameters:[{name:"Entity",key:"entity",type:"entity",description:"Entity to move"},{name:"Amount X",key:"amountX",type:"float",description:"Position on the X axis","default":0},{name:"Amount Y",key:"amountY",type:"float",description:"Position on the Y axis","default":0},{name:"Amount Z",key:"amountZ",type:"float",description:"Position on the Z axis","default":0},{name:"On every frame",key:"everyFrame",type:"boolean",description:"Repeat this action every frame","default":!0}],transitions:[]},c.prototype._run=function(a){null!==this.entity&&(this.entity.transformComponent.transform.translation.setd(b.getValue(this.amountX,a),b.getValue(this.amountY,a),b.getValue(this.amountZ,a)),this.entity.transformComponent.setUpdated())},c}),define("goo/statemachine/actions/SetRotationAction",["goo/statemachine/actions/Action","goo/statemachine/FSMUtil"],function(a,b){"use strict";function c(){a.apply(this,arguments)}return c.prototype=Object.create(a.prototype),c.prototype.configure=function(a){this.everyFrame=!!a.everyFrame,this.entity=a.entity||null,this.amountX=a.amountX||0,this.amountY=a.amountY||0,this.amountZ=a.amountZ||0},c.external={parameters:[{name:"Entity",key:"entity",type:"entity",description:"Entity to move"},{name:"Amount X",key:"amountX",type:"float",description:"Amount to rotate on the X axis","default":0},{name:"Amount Y",key:"amountY",type:"float",description:"Amount to rotate on the Y axis","default":0},{name:"Amount Z",key:"amountZ",type:"float",description:"Amount to rotate on the Z axis","default":0},{name:"On every frame",key:"everyFrame",type:"boolean",description:"Repeat this action every frame","default":!0}],transitions:[]},c.prototype._run=function(a){null!==this.entity&&(this.entity.transformComponent.transform.setRotationXYZ(b.getValue(this.amountX,a),b.getValue(this.amountY,a),b.getValue(this.amountZ,a)),this.entity.transformComponent.setUpdated())},c}),define("goo/statemachine/actions/SetVariableAction",["goo/statemachine/actions/Action","goo/statemachine/FSMUtil"],function(a,b){"use strict";function c(){a.apply(this,arguments)}return c.prototype=Object.create(a.prototype),c.prototype.configure=function(a){this.everyFrame=a.everyFrame!==!1,this.variable=a.variable||null,this.amount=a.amount||0},c.external={parameters:[{name:"Variable",key:"variable",type:"identifier"},{name:"Amount",key:"amount",type:"float"},{name:"On every frame",key:"everyFrame",type:"boolean",description:"Repeat this action every frame","default":!1}],transitions:[]},c.prototype._run=function(a){this.variable&&a.applyOnVariable(this.variable,function(){return b.getValue(this.amount,a)}.bind(this))},c}),define("goo/statemachine/actions/SnowAction",["goo/statemachine/actions/Action","goo/renderer/Material","goo/renderer/shaders/ShaderLib","goo/renderer/TextureCreator","goo/particles/ParticleLib","goo/util/ParticleSystemUtils","goo/entities/EntityUtils"],function(a,b,c,d,e,f){"use strict";function g(){a.apply(this,arguments)}return g.material=null,g.prototype=Object.create(a.prototype),g.prototype.constructor=g,g.external={name:"Snow",description:"Makes the entity emit snow",parameters:[],transitions:[]},g.prototype._run=function(a){var d=a.getOwnerEntity(),h=d._world.gooRunner;if(!SmokeAction.material){g.material=b.createMaterial(c.particles);var i=f.createFlareTexture();i.generateMipmaps=!0,g.material.setTexture("DIFFUSE_MAP",i),g.material.blendState.blending="AlphaBlending",g.material.cullState.enabled=!1,g.material.depthState.write=!1,g.material.renderQueue=2001}var j=f.createParticleSystemEntity(h,e.getSmoke(),SmokeAction.material);j.name="_ParticleSystemSmoke",d.transformComponent.attachChild(j.transformComponent),j.addToWorld()},g}),define("goo/statemachine/actions/SuspendFSMAction",["goo/statemachine/actions/Action"],function(a){"use strict";function b(){a.apply(this,arguments)}return b.prototype=Object.create(a.prototype),b.prototype.constructor=b,b.external={name:"Suspend FSM",description:"Suspends the state machine of another entity",parameters:[{name:"Entity",key:"entity",type:"entity",description:"Entity to suspend its FSM","default":null}],transitions:[]},b.prototype._run=function(){this.entity&&this.entity.fSMComponent&&this.entity.fSMComponent.pause()},b}),define("goo/statemachine/actions/TestAngleAction",["goo/statemachine/actions/Action"],function(a){"use strict";function b(a){a=a||{},this.everyFrame=a.everyFrame||!0,this.entity=a.entity||null,this.rangeMin=a.rangeMin||0,this.rangeMax=a.rangeMax||Math.PI,this.eventInRange=a.eventInRange||"inRange",this.eventOutRange=a.eventOutRange||"outRange"}return b.prototype=Object.create(a.prototype),b.external=[{name:"Entity",key:"entity",type:"entity"},{name:"RangeMin",key:"rangeMin",type:"spinner"},{name:"RangeMax",key:"rangeMax",type:"spinner"},{name:"Event In Range",key:"eventInRange",type:"event"},{name:"Event Out Of Range",key:"eventOutRange",type:"event"}],b.prototype.onUpdate=function(a){if(null!==this.entity&&this.entity.body){var b=this.entity.body.GetAngle()%(2*Math.PI);0>b&&(b=2*Math.PI+b),b>=this.rangeMin&&b<=this.rangeMax?a.handle(this.eventInRange):a.handle(this.eventOutRange)}},b}),define("goo/statemachine/actions/TestCollisionAction",["goo/statemachine/actions/Action"],function(a){"use strict";function b(a){a=a||{},this.everyFrame=a.everyFrame||!0,this.entity1=a.entity1||null,this.entity2=a.entity2||null,this.noCollisionEvent=a.noCollisionEvent||"noCollision",this.collisionEvent=a.collisionEvent||"collision"}return b.prototype=Object.create(a.prototype),b.external=[{entity1:["entity","Entity 1"],entity2:["entity","Entity 2"],noCollisionEvent:["string","No collision event"],collisionEvent:["string","Collision event"]}],b.prototype.onUpdate=function(a){null!==this.entity1&&null!==this.entity2&&(this.entity1.meshRendererComponent.worldBound.intersects(this.entity2.meshRendererComponent.worldBound)?a.handle(this.collisionEvent):a.handle(this.noCollisionEvent))},b}),define("goo/statemachine/actions/TestSpeedAction",["goo/statemachine/actions/Action"],function(a){"use strict";function b(a){this.type="TestSpeedAction",this.everyFrame=a.everyFrame||!0,a=a||{},this.entity=a.entity||null,this.rangeMin=a.rangeMin||0,this.rangeMax=a.rangeMax||Math.PI,this.eventInRange=a.eventInRange||"inRange",this.eventOutRange=a.eventOutRange||"outRange"}return b.prototype=Object.create(a.prototype),b.external=[{name:"Entity",key:"entity",type:"entity"},{name:"RangeMin",key:"rangeMin",type:"spinner"},{name:"RangeMax",key:"rangeMax",type:"spinner"},{name:"Event In Range",key:"eventInRange",type:"event"},{name:"Event Out Of Range",key:"eventOutRange",type:"event"}],b.prototype.onUpdate=function(a){if(null!==this.entity&&this.entity.body){var b=this.entity.body.GetLinearVelocity().Length();b>=this.rangeMin&&b<=this.rangeMax?a.handle(this.eventInRange):a.handle(this.eventOutRange)}},b}),define("goo/statemachine/actions/TweenAction",["goo/statemachine/actions/Action","goo/statemachine/FSMUtil"],function(Action,FSMUtil){"use strict";function TweenAction(){Action.apply(this,arguments)}return TweenAction.prototype=Object.create(Action.prototype),TweenAction.prototype.constructor=TweenAction,TweenAction.external={name:"Tween",description:"Tween anything",canTransition:!0,parameters:[{name:"To",key:"to",type:"number",description:"Value to tween to","default":0},{name:"Object",key:"objectName",type:"string",description:"Object","default":""},{name:"Property",key:"propertyName",type:"string",description:"Property","default":""},{name:"Time",key:"time",type:"number",description:"Time it takes for this tween to complete","default":1e3},{name:"Easing type",key:"easing1",type:"dropdown",description:"Easing type","default":"Linear",options:["Linear","Quadratic","Exponential","Circular","Elastic","Back","Bounce"]},{name:"Direction",key:"easing2",type:"dropdown",description:"Easing direction","default":"In",options:["In","Out","InOut"]}],transitions:[{key:"complete",name:"On Completion",description:"State to transition to when the tween completes"}]},TweenAction.prototype.configure=function(a){this.to=a.to,this.objectName=a.objectName,this.propertyName=a.propertyName,this.time=a.time,this.easing="Linear"===a.easing1?window.TWEEN.Easing.Linear.None:window.TWEEN.Easing[a.easing1][a.easing2],this.eventToEmit={channel:a.transitions.complete}
},TweenAction.prototype._run=function(fsm){var entity=fsm.getOwnerEntity(),object=eval("entity."+this.objectName),from=object[this.propertyName];FSMUtil.createComposableTween(entity,this.propertyName,from,this.to,this.time)},TweenAction}),define("goo/util/ColorUtil",["goo/math/Vector4"],function(a){"use strict";function b(){}b.arrayToVector4=function(b,c){return c=c||new a,c.seta(b),c},b.hexToArray=function(a,b){return b=b||[],a=Math.floor(a),b[0]=(255&a>>16)/255,b[1]=(255&a>>8)/255,b[2]=(255&a)/255,b},b.arrayToHex=function(a){return 255*a[0]<<16^255*a[1]<<8^255*a[2]<<0},b.arrayToHexString=function(a){return("000000"+b.arrayToHex(a).toString(16)).slice(-6)};var c=/^rgb\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)$/i,d=/^rgb\(\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*\)$/i,e=/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i,f=/^\#([0-9a-f]{6})$/i,g=/^(\w+)$/i;return b.cssToArray=function(a,h){if(h=h||[],c.test(a)){var i=c.exec(a);return h[0]=Math.min(255,parseInt(i[1],10))/255,h[1]=Math.min(255,parseInt(i[2],10))/255,h[2]=Math.min(255,parseInt(i[3],10))/255,h}if(d.test(a)){var i=d.exec(a);return h[0]=Math.min(100,parseInt(i[1],10))/100,h[1]=Math.min(100,parseInt(i[2],10))/100,h[2]=Math.min(100,parseInt(i[3],10))/100,h}if(f.test(a)){var i=f.exec(a);return this.hexToArray(parseInt(i[1],16),h)}if(e.test(a)){var i=e.exec(a);return this.hexToArray(parseInt(i[1]+i[1]+i[2]+i[2]+i[3]+i[3],16),h)}return g.test(a)?this.hexToArray(b.color[a],h):(console.warn("No matching style found"),h[0]=h[1]=h[2]=0,h)},b.HSLToArray=function(a,b,c,d){if(d=d||[],0===b)d[0]=d[1]=d[2]=c;else{var e=function(a,b,c){return 0>c&&(c+=1),c>1&&(c-=1),1/6>c?a+6*(b-a)*c:.5>c?b:2/3>c?a+6*(b-a)*(2/3-c):a},f=.5>=c?c*(1+b):c+b-c*b,g=2*c-f;d[0]=e(g,f,a+1/3),d[1]=e(g,f,a),d[2]=e(g,f,a-1/3)}return d},b.arrayToHSL=function(a,b){b=b||[];var c,d,e=a[0],f=a[1],g=a[2],h=Math.max(e,f,g),i=Math.min(e,f,g),j=(i+h)/2;if(i===h)c=0,d=0;else{var k=h-i;switch(d=.5>=j?k/(h+i):k/(2-h-i),h){case e:c=(f-g)/k+(g>f?6:0);break;case f:c=(g-e)/k+2;break;case g:c=(e-f)/k+4}c/=6}return b[0]=c,b[1]=d,b[2]=j,b},b.HSBToArray=function(a,b,c,d){d=d||[];var e=0,f=0,g=0;if(0===b)e=f=g=c;else{var h=6*(a-Math.floor(a)),i=h-Math.floor(h),j=c*(1-b),k=c*(1-b*i),l=c*(1-b*(1-i));switch(h){case 0:e=c,f=l,g=j;break;case 1:e=k,f=c,g=j;break;case 2:e=j,f=c,g=l;break;case 3:e=j,f=k,g=c;break;case 4:e=l,f=j,g=c;break;case 5:e=c,f=j,g=k}}return d[0]=e,d[1]=f,d[2]=g,d},b.arrayToHSB=function(a,b){b=b||[];var c,d,e,f=a[0],g=a[1],h=a[2],i=f>g?f:g;h>i&&(i=h);var j=g>f?f:g;if(j>h&&(j=h),e=i/255,d=0!==i?(i-j)/i:0,0===d)c=0;else{var k=(i-f)/(i-j),l=(i-g)/(i-j),m=(i-h)/(i-j);c=f===i?m-l:g===i?2+k-m:4+l-k,c/=6,0>c&&(c+=1)}return b[0]=c,b[1]=d,b[2]=e,b},b.arrayToCSS=function(a){return"rgb("+(0|255*a[0])+","+(0|255*a[1])+","+(0|255*a[2])+")"},b.color={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},b}),define("goo/util/Grid",["goo/entities/EntityUtils","goo/entities/components/MeshDataComponent","goo/entities/components/MeshRendererComponent","goo/renderer/MeshData","goo/renderer/Material","goo/renderer/Shader","goo/shapes/ShapeCreator","goo/renderer/shaders/ShaderLib","goo/renderer/Util"],function(a,b,c,d,e,f,g,h,i){"use strict";function j(d,f){if(f=f||{},this.topEntity=d.createEntity(this.name),f.floor&&this.topEntity.transformComponent.transform.rotation.rotateX(-Math.PI/2),f.surface){var j=g.createQuad(f.width,f.height),l=a.createTypicalEntity(d,j),m=e.createMaterial(h.simpleLit);m.uniforms.materialDiffuse=f.surfaceColor||[1,1,1,1],m.depthState={writable:!1,enabled:!1},m.renderQueue=9,l.meshRendererComponent.materials.push(m),this.topEntity.transformComponent.attachChild(l.transformComponent)}this.gridShader=this._buildGridShader(f),f.grids||(f.grids=[]),0===f.grids.length&&f.grids.push(i.clone(k)),this.grids=f.grids;for(var n,o,p,q=0;q<f.grids.length;q++)o=f.grids[q],this._fillDefaults(o,k),o._width=f.width||1,o._height=f.height||1,n=d.createEntity("grid_"+q),n.setComponent(new b(this._buildGrid(o))),p=new c,p.materials.push(this._buildGridMaterial(o,q)),n.setComponent(p),this.topEntity.transformComponent.attachChild(n.transformComponent)}var k={stepX:1,stepY:1,color:[0,0,0,1],width:1};return j.prototype.addToWorld=function(){a.traverse(this.topEntity,function(a){a.addToWorld()})},j.prototype._collides=function(a,b,c){for(var d="step"+c,e=0;e<this.grids.length;e++){if(a===this.grids[e])return!1;if(0===b%this.grids[e][d])return!0}return!1},j.prototype._buildGrid=function(a){var b=Math.ceil(a._width/a.stepX),c=Math.ceil(a._height/a.stepY),e=a._width/2,f=a._height/2,g=[],h=[];a===this.grids[0]&&(g.push(-e,-f,0,-e,f,0,e,f,0,e,-f,0),h.push(0,1,1,2,2,3,3,0));for(var i,j=1;b>j;j++)i=a.stepX*j,this._collides(a,i,"X")||(i-=e,g.push(i,-f,0,i,f,0));for(var k,j=1;c>j;j++)k=a.stepY*j,this._collides(a,k,"Y")||(k-=f,g.push(-e,k,0,e,k,0));for(var j=h.length/2;j<g.length/3;j+=2)h.push(j,j+1);var l=new d(d.defaultMap([d.POSITION]),g.length,h.length);return l.getAttributeBuffer(d.POSITION).set(g),l.getIndexBuffer().set(h),l.indexModes[0]="Lines",l},j.prototype._buildGridMaterial=function(a,b){var c=new e("GridMaterial_"+b);return this.gridShader&&(c.shader=this.gridShader),c.uniforms.color=a.color,c.lineWidth=a.width,c.depthState={enabled:!1,write:!1},c.renderQueue=10+b,c},j.prototype._fillDefaults=function(a,b){for(var c in b)void 0===a[c]&&(a[c]="array"==typeof b[c]||b[c]instanceof Object?i.clone(b[c]):b[c])},j.prototype._buildGridShader=function(a){var b={attributes:{vertexPosition:d.POSITION},uniforms:{viewMatrix:f.VIEW_MATRIX,projectionMatrix:f.PROJECTION_MATRIX,worldMatrix:f.WORLD_MATRIX,color:[0,0,0,1],fogOn:a.fogOn||!1,fogColor:a.fogColor||[0,0,0,1],fogNear:f.MAIN_NEAR_PLANE,fogFar:a.fogFar||f.MAIN_FAR_PLANE},vshader:["attribute vec3 vertexPosition;","uniform mat4 worldMatrix;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","varying float depth;","void main(void)","{","vec4 viewPosition = viewMatrix * worldMatrix * vec4(vertexPosition, 1.0);","depth = viewPosition.z;","gl_Position = projectionMatrix * viewPosition;","}"].join("\n"),fshader:["precision mediump float;","uniform vec4 fogColor;","uniform vec4 color;","uniform float fogNear;","uniform float fogFar;","uniform bool fogOn;","varying float depth;","void main(void)","{","if (fogOn) {","float lerpVal = clamp(depth / (-fogFar - fogNear), 0.0, 1.0);","lerpVal = pow(lerpVal, 0.4);","gl_FragColor = mix(color, fogColor, lerpVal);","} else {","gl_FragColor = color;","}","}"].join("\n")};return e.createShader(b,"Grid Shader")},j}),define("goo/util/NoWebGL",["goo/util/Logo"],function(a){"use strict";function b(a){this.template=b.templates[a]?b.templates[a]:b.templates.standard}return b.prototype.upgradeLocation="http://goodemos.com/recommended.html",b.prototype.gooLocation="http://gooengine.com",b.templates={},b.templates.standard={},b.templates.standard.css="#unsupportedBrowser {z-index: 10000;position: absolute;top: 0;left: 0;width: 100%;background: #1c1c1c;border-top: 1px solid #2a3276;font-family: Helvetica Neue, Helvetica, sans-serif;font-size: 90%;line-height: 145%;}#unsupportedBrowser a.button {-webkit-border-radius: 18px;-moz-border-radius: 18px;-o-border-radius: 18px;border-radius: 18px;margin: 5px 20px 0 0;text-align: left;padding: 10px 25px;color: #1d1d1d;font-weight: 600;font-style: italic;display: inline-block;text-shadow: 0px 1px 1px #8372da;filter: dropshadow(color=#02c2df, offx=0, offy=1);-moz-box-shadow: inset 1px 1px 2px 0 #a9b1fd;-o-box-shadow: inset 1px 1px 2px 0 #a9b1fd;-webkit-box-shadow: inset 1px 1px 2px 0 #a9b1fd;box-shadow: inset 1px 1px 2px 0 #a9b1fd;background: #2a3276;background-image: -ms-linear-gradient(top, #2a3276 0%, #6b7aff 100%);background-image: -moz-linear-gradient(top, #2a3276 0%, #6b7aff 100%);background-image: -o-linear-gradient(top, #2a3276 0%, #6b7aff 100%);background-image: -webkit-gradient(linear, left top, left bottom, color-stop(0, #2a3276), color-stop(1, #6b7aff));background-image: -webkit-linear-gradient(top, #2a3276 0%, #6b7aff 100%);background-image: linear-gradient(top, #2a3276 0%, #6b7aff 100%);filter: progid:DXImageTransform.Microsoft.gradient(startColorstr=\"#2a3276\", endColorstr=\"#6b7aff\");}#unsupportedBrowser a.button:hover {-moz-box-shadow: inset 3px 3px 5px 0 #a9b1fd;-o-box-shadow: inset 3px 3px 5px 0 #a9b1fd;-webkit-box-shadow: inset 3px 3px 5px 0 #a9b1fd;box-shadow: inset 3px 3px 5px 0 #a9b1fd;background: #6b7aff;background-image: -ms-linear-gradient(top, #6b7aff 0%, #2a3276 100%);background-image: -moz-linear-gradient(top, #6b7aff 0%, #2a3276 100%);background-image: -o-linear-gradient(top, #6b7aff 0%, #2a3276 100%);background-image: -webkit-gradient(linear, left top, left bottom, color-stop(0, #6b7aff), color-stop(1, #2a3276));background-image: -webkit-linear-gradient(top, #6b7aff 0%, #2a3276 100%);background-image: linear-gradient(top, #6b7aff 0%, #2a3276 100%);filter: progid:DXImageTransform.Microsoft.gradient(startColorstr='#6b7aff', endColorstr='#2a3276'); }#unsupportedBrowser > svg {margin-top: 5px;}#unsupportedBrowser > .logo {background-image: -moz-radial-gradient(50% 250px, circle farthest-corner, #6b7aff, #2a3276 100%);background-image: -webkit-radial-gradient(50% 250px, circle farthest-corner, #6b7aff, #2a3276 100%);background-image: -o-radial-gradient(50% 250px, circle farthest-corner, #6b7aff, #2a3276 100%);background-image: -ms-radial-gradient(50% 250px, circle farthest-corner, #6b7aff, #2a3276 100%);background-image: radial-gradient(50% 250px, circle farthest-corner, #6b7aff, #2a3276 100%);}#unsupportedBrowser > .content {color: #9f9f9f;max-width: 700px;margin-left: 120px;margin-right: 20px;padding-top: 1em;}#unsupportedBrowser p {margin: 0 0 25px 0;}#unsupportedBrowser h1 {display: inline-block;max-width: 600px;margin: 13px 0 25px 20px;color: #f1eee5;vertical-align: top;font-weight: normal}",b.templates.standard.html='<div class="logo"><a href="http://gooengine.com">'+a.getLogo({color:a.white,shadow:!0,width:"100px",height:"70px"})+'</a><h1>Whoopsie daisy!</h1></div><div class="content"><p>Your browser doesn\'t seem to support HTML5 and WebGL. The best thing to do is upgrade to a modern browser that supports all the awesome things the web has to offer.</p><p><a data-upgrade class="button" href="">Upgrade my browser!</a><a data-close class="button" href="">Not now</a></p></div>',b.prototype.show=function(){var a=document.createElement("div");a.innerHTML=this.template.html,a.setAttribute("id","unsupportedBrowser");var b=document.createElement("style");b.type="text/css",b.setAttribute("id","unsupportedBrowserStyles"),b.stylesheet?b.stylesheet.cssText=this.template.css:b.appendChild(document.createTextNode(this.template.css)),document.head.appendChild(b),document.body.appendChild(a);var c=a.querySelector("[data-close]"),d=function(a){a.preventDefault(),a.stopPropagation(),document.location.href=this.gooLocation,document.body.removeChild(document.querySelector("div#unsupportedBrowser")),document.head.removeChild(document.querySelector("#unsupportedBrowserStyles"))}.bind(this);c.addEventListener("click",d);var e=a.querySelector("[data-upgrade]"),f=function(a){a.preventDefault(),a.stopPropagation(),document.location.href=this.upgradeLocation}.bind(this);e.addEventListener("click",f)},b.prototype.addTemplate=function(a,c){b.templates[a]?console.error("Template "+a+" already exists"):b.templates[a]=c},b}),define("goo/util/Rc4Random",[],function(){"use strict";function a(a){function b(a){for(var b=0;256>b;b++)d[b]=b;for(var c=0,b=0;256>b;b++){c=(c+d[b]+a.charCodeAt(b%a.length))%256;var e=d[b];d[b]=d[c],d[c]=e}}function c(){e=(e+1)%256,f=(f+d[e])%256;var a=d[e];return d[e]=d[f],d[f]=a,d[(d[e]+d[f])%256]}var d=[],e=0,f=0;b(a),this.getRandomNumber=function(){for(var a=0,b=1,d=0;8>d;d++)a+=c()*b,b*=256;return a/0x10000000000000000}}return a}),define("goo",["goo/addons/box2d/components/Box2DComponent","goo/addons/box2d/systems/Box2DSystem","goo/addons/cannon/components/CannonjsComponent","goo/addons/cannon/systems/CannonjsSystem","goo/addons/howler/components/HowlerComponent","goo/addons/howler/systems/HowlerSystem","goo/addons/scripts/PolyBoundingScript","goo/addons/soundmanager2/components/SoundManager2Component","goo/addons/soundmanager2/systems/SoundManager2System","goo/addons/terrain/Terrain","goo/addons/water/FlatWaterRenderer","goo/addons/water/ProjectedGridWaterRenderer","goo/animation/Joint","goo/animation/Skeleton","goo/animation/SkeletonPose","goo/animation/blendtree/BinaryLERPSource","goo/animation/blendtree/ClipSource","goo/animation/blendtree/ExclusiveClipSource","goo/animation/blendtree/FrozenClipSource","goo/animation/blendtree/InclusiveClipSource","goo/animation/blendtree/ManagedTransformSource","goo/animation/clip/AbstractAnimationChannel","goo/animation/clip/AnimationClip","goo/animation/clip/AnimationClipInstance","goo/animation/clip/InterpolatedFloatChannel","goo/animation/clip/JointChannel","goo/animation/clip/JointData","goo/animation/clip/TransformChannel","goo/animation/clip/TransformData","goo/animation/clip/TriggerChannel","goo/animation/clip/TriggerData","goo/animation/layer/AnimationLayer","goo/animation/layer/LayerLERPBlender","goo/animation/state/AbstractState","goo/animation/state/AbstractTransitionState","goo/animation/state/FadeTransitionState","goo/animation/state/FrozenTransitionState","goo/animation/state/SteadyState","goo/animation/state/SyncFadeTransitionState","goo/debug/BoundingVolumeMeshBuilder","goo/debug/DebugDrawHelper","goo/debug/Debugger","goo/debug/EntityCounter","goo/debug/FrustumViewer","goo/debug/LightPointer","goo/debug/components/MarkerComponent","goo/debug/systems/MarkerSystem","goo/entities/Bus","goo/entities/Entity","goo/entities/EntityUtils","goo/entities/GooRunner","goo/entities/SystemBus","goo/entities/World","goo/entities/components/AnimationComponent","goo/entities/components/CSSTransformComponent","goo/entities/components/CameraComponent","goo/entities/components/CameraDebugComponent","goo/entities/components/Component","goo/entities/components/LightComponent","goo/entities/components/LightDebugComponent","goo/entities/components/MeshDataComponent","goo/entities/components/MeshRendererComponent","goo/entities/components/OccludeeComponent","goo/entities/components/OccluderComponent","goo/entities/components/ParticleComponent","goo/entities/components/PortalComponent","goo/entities/components/ScriptComponent","goo/entities/components/TextComponent","goo/entities/components/TransformComponent","goo/entities/managers/EntityManager","goo/entities/systems/AnimationSystem","goo/entities/systems/BoundingUpdateSystem","goo/entities/systems/CSSTransformSystem","goo/entities/systems/CameraDebugSystem","goo/entities/systems/CameraSystem","goo/entities/systems/DebugRenderSystem","goo/entities/systems/GizmoRenderSystem","goo/entities/systems/GridRenderSystem","goo/entities/systems/LightDebugSystem","goo/entities/systems/LightingSystem","goo/entities/systems/OcclusionCullingSystem","goo/entities/systems/ParticlesSystem","goo/entities/systems/PickingSystem","goo/entities/systems/PortalSystem","goo/entities/systems/RenderSystem","goo/entities/systems/ScriptSystem","goo/entities/systems/System","goo/entities/systems/TextSystem","goo/entities/systems/TransformSystem","goo/loaders/DynamicLoader","goo/loaders/JsonUtils","goo/loaders/Loader","goo/loaders/crunch/CrunchLoader","goo/loaders/dds/DdsLoader","goo/loaders/dds/DdsUtils","goo/loaders/handlers/AnimationClipHandler","goo/loaders/handlers/AnimationComponentHandler","goo/loaders/handlers/AnimationLayersHandler","goo/loaders/handlers/AnimationStateHandler","goo/loaders/handlers/CameraComponentHandler","goo/loaders/handlers/ComponentHandler","goo/loaders/handlers/ConfigHandler","goo/loaders/handlers/EntityHandler","goo/loaders/handlers/FSMComponentHandler","goo/loaders/handlers/LightComponentHandler","goo/loaders/handlers/MachineHandler","goo/loaders/handlers/MaterialHandler","goo/loaders/handlers/MeshDataComponentHandler","goo/loaders/handlers/MeshDataHandler","goo/loaders/handlers/MeshRendererComponentHandler","goo/loaders/handlers/PosteffectHandler","goo/loaders/handlers/ProjectHandler","goo/loaders/handlers/SceneHandler","goo/loaders/handlers/ScriptComponentHandler","goo/loaders/handlers/ScriptHandler","goo/loaders/handlers/ShaderHandler","goo/loaders/handlers/SkeletonHandler","goo/loaders/handlers/SoundComponentHandler","goo/loaders/handlers/SoundHandler","goo/loaders/handlers/TextureHandler","goo/loaders/handlers/TransformComponentHandler","goo/loaders/tga/TgaLoader","goo/math/MathUtils","goo/math/Matrix","goo/math/Matrix2x2","goo/math/Matrix3x3","goo/math/Matrix4x4","goo/math/Plane","goo/math/Quaternion","goo/math/Ray","goo/math/Transform","goo/math/Vector","goo/math/Vector2","goo/math/Vector3","goo/math/Vector4","goo/noise/Noise","goo/noise/ValueNoise","goo/particles/Particle","goo/particles/ParticleEmitter","goo/particles/ParticleInfluence","goo/particles/ParticleLib","goo/particles/ParticleUtils","goo/picking/BoundingTree","goo/picking/PrimitivePickLogic","goo/renderer/BufferData","goo/renderer/BufferUtils","goo/renderer/Camera","goo/renderer/Material","goo/renderer/MeshData","goo/renderer/OcclusionPartitioner","goo/renderer/RenderQueue","goo/renderer/Renderer","goo/renderer/RendererRecord","goo/renderer/Shader","goo/renderer/ShaderCall","goo/renderer/SimplePartitioner","goo/renderer/Texture","goo/renderer/TextureCreator","goo/renderer/Util","goo/renderer/bounds/BoundingBox","goo/renderer/bounds/BoundingSphere","goo/renderer/bounds/BoundingVolume","goo/renderer/light/DirectionalLight","goo/renderer/light/Light","goo/renderer/light/PointLight","goo/renderer/light/SpotLight","goo/renderer/pass/BloomPass","goo/renderer/pass/BlurPass","goo/renderer/pass/Composer","goo/renderer/pass/DOFPass","goo/renderer/pass/DepthPass","goo/renderer/pass/DoGPass","goo/renderer/pass/FullscreenPass","goo/renderer/pass/FullscreenUtil","goo/renderer/pass/NesPass","goo/renderer/pass/PassLib","goo/renderer/pass/RenderPass","goo/renderer/pass/RenderTarget","goo/renderer/pass/SSAOPass","goo/renderer/scanline/BoundingBoxOcclusionChecker","goo/renderer/scanline/BoundingSphereOcclusionChecker","goo/renderer/scanline/Edge","goo/renderer/scanline/EdgeData","goo/renderer/scanline/EdgeMap","goo/renderer/scanline/OccludeeTriangleData","goo/renderer/scanline/OccluderTriangleData","goo/renderer/scanline/SoftwareRenderer","goo/renderer/shaders/ShaderBuilder","goo/renderer/shaders/ShaderFragment","goo/renderer/shaders/ShaderLib","goo/renderer/shadow/ShadowHandler","goo/scripts/BasicControlScript","goo/scripts/FlyControlScript","goo/scripts/HeightMapBoundingScript","goo/scripts/MouseLookControlScript","goo/scripts/OrbitCamControlScript","goo/scripts/OrbitNPanControlScript","goo/scripts/RotationControlScript","goo/scripts/SparseHeightMapBoundingScript","goo/scripts/SplineInterpolator","goo/scripts/WASDControlScript","goo/shapes/Box","goo/shapes/Cylinder","goo/shapes/Disk","goo/shapes/FilledPolygon","goo/shapes/Grid","goo/shapes/PolyLine","goo/shapes/ProjectedGrid","goo/shapes/Quad","goo/shapes/RegularPolygon","goo/shapes/ShapeCreator","goo/shapes/SimpleBox","goo/shapes/Sphere","goo/shapes/Surface","goo/shapes/TextureGrid","goo/shapes/Torus","goo/shapes/Triangle","goo/shapes/debug/CameraDebug","goo/shapes/debug/LightDebug","goo/shapes/debug/MeshRendererDebug","goo/statemachine/FSMComponent","goo/statemachine/FSMSystem","goo/statemachine/FSMUtil","goo/statemachine/Machine","goo/statemachine/State","goo/statemachine/actions/Action","goo/statemachine/actions/Actions","goo/statemachine/actions/AddLightAction","goo/statemachine/actions/AddPositionAction","goo/statemachine/actions/AddVariableAction","goo/statemachine/actions/ArrowsAction","goo/statemachine/actions/CompareDistanceAction","goo/statemachine/actions/DollyZoomAction","goo/statemachine/actions/EmitAction","goo/statemachine/actions/EvalAction","goo/statemachine/actions/FireAction","goo/statemachine/actions/GetPositionAction","goo/statemachine/actions/GuiButtonAction","goo/statemachine/actions/HideAction","goo/statemachine/actions/InBoxAction","goo/statemachine/actions/InFrustumAction","goo/statemachine/actions/KeyDownAction","goo/statemachine/actions/KeyUpAction","goo/statemachine/actions/LogMessageAction","goo/statemachine/actions/LookAtAction","goo/statemachine/actions/MouseDownAction","goo/statemachine/actions/MouseMoveAction","goo/statemachine/actions/MouseUpAction","goo/statemachine/actions/MoveAction","goo/statemachine/actions/MultiplyVariableAction","goo/statemachine/actions/NumberCompareAction","goo/statemachine/actions/PauseAnimationAction","goo/statemachine/actions/PickAction","goo/statemachine/actions/RandomTransitionAction","goo/statemachine/actions/RemoveAction","goo/statemachine/actions/RemoveLightAction","goo/statemachine/actions/RemoveParticlesAction","goo/statemachine/actions/ResumeAnimationAction","goo/statemachine/actions/ResumeFSMAction","goo/statemachine/actions/RotateAction","goo/statemachine/actions/ScaleAction","goo/statemachine/actions/SetAnimationAction","goo/statemachine/actions/SetClearColorAction","goo/statemachine/actions/SetCssPropertyAction","goo/statemachine/actions/SetLightRangeAction","goo/statemachine/actions/SetPositionAction","goo/statemachine/actions/SetRenderTargetAction","goo/statemachine/actions/SetRotationAction","goo/statemachine/actions/SetVariableAction","goo/statemachine/actions/ShakeAction","goo/statemachine/actions/ShowAction","goo/statemachine/actions/SmokeAction","goo/statemachine/actions/SnowAction","goo/statemachine/actions/SoundFadeInAction","goo/statemachine/actions/SoundFadeOutAction","goo/statemachine/actions/SuspendFSMAction","goo/statemachine/actions/SwitchCameraAction","goo/statemachine/actions/TestAngleAction","goo/statemachine/actions/TestCollisionAction","goo/statemachine/actions/TestSpeedAction","goo/statemachine/actions/TransitionAction","goo/statemachine/actions/TransitionOnMessageAction","goo/statemachine/actions/TweenAction","goo/statemachine/actions/TweenLightColorAction","goo/statemachine/actions/TweenLookAtAction","goo/statemachine/actions/TweenMoveAction","goo/statemachine/actions/TweenRotationAction","goo/statemachine/actions/TweenScaleAction","goo/statemachine/actions/TweenTextureOffsetAction","goo/statemachine/actions/WASDAction","goo/statemachine/actions/WaitAction","goo/util/Ajax","goo/util/ArrayUtil","goo/util/ColorUtil","goo/util/Enum","goo/util/GameUtils","goo/util/Grid","goo/util/Handy","goo/util/Latch","goo/util/Logo","goo/util/MeshBuilder","goo/util/NoWebGL","goo/util/ObjectUtil","goo/util/ParticleSystemUtils","goo/util/PromiseUtil","goo/util/Rc4Random","goo/util/ShapeCreatorMemoized","goo/util/Skybox","goo/util/Stats","goo/util/StringUtil","goo/util/TangentGenerator","goo/util/gizmos/Gizmo","goo/util/gizmos/RotationGizmo","goo/util/gizmos/ScaleGizmo","goo/util/gizmos/TranslationGizmo","goo/util/rsvp"],function(){}),window.requirejs=requirejs,window.require=require,window.define=define}(window,void 0),define("component/BulletComponent",["goo/entities/components/Component","goo/shapes/ShapeCreator","goo/entities/EntityUtils","material/ColoredMaterial","script/RunEntityScript","helper/InputHelper","manager/PlayerManager"],function(a,b,c,d,e,f,g){"use strict";function h(a,f,h,i,j,k,l){this.type="BulletComponent",this.life=g.get("bulletLife"),this.power=g.get("bulletPower"),this.shape=b.createCylinder(15,.01),this.material=new d.buildBullet,this.entity=c.createTypicalEntity(a,this.shape,this.material,new e(i,1,100)),this.entity.transformComponent.setTranslation(f.x,f.y-.5,f.z),this.entity.transformComponent.setRotation(.01,i,0),this.entity.beeDataComponent=this,this.entity.addToWorld(),l&&this.showHelper()}return h.prototype=Object.create(a.prototype),h.prototype.showHelper=function(){var a=f.entity("Bullet",this.entity);f.coloredMaterial("color",this.material,a)},h.prototype.collide=function(){this.life=this.life-1,this.life<=0&&this.entity.removeFromWorld()},h.prototype.isDead=function(){return this.life<=0},h}),define("component/CameraComponent",["goo/entities/components/Component","goo/renderer/Camera","goo/scripts/OrbitCamControlScript","goo/shapes/ShapeCreator","goo/entities/EntityUtils","script/MobileXYZControlScript","script/KeyboardXYZControlScript","helper/MobileHelper","helper/EntityHelper","helper/InputHelper","manager/PlayerManager","manager/EntityManager"],function(a,b,c,d,e,f,g,h,i,j,k,l){"use strict";function m(a,c,d){this.type="CameraComponent",this.amountFuel=100,this.camera=new b(35,1,.1,1e3);var j=function(a){l.checkCollision(this.entity),i.getDistance(this.entity,c.entity)<0?this.amountFuel<100&&(this.amountFuel=this.amountFuel+1,c.update(this.amountFuel)):a&&(this.amountFuel=this.amountFuel-k.get("fuelLoss"),this.amountFuel<0&&(k.looseLife(),this.amountFuel=100),c.update(this.amountFuel))};this.script=h.isMobile()?new f:new g,this.script.onRun(j,this),this.entity=e.createTypicalEntity(a,this.camera,this.script),this.entity.addToWorld(),this.entity.beeDataComponent=this,d&&this.showHelper()}return m.prototype=Object.create(a.prototype),m.prototype.showHelper=function(){j.entity("camera",this.entity)},m.prototype.getBulletPosition=function(){var a=i.getPosition(this.entity);if(a.z=a.z-10,0!==this.script.yRotationAcc){var b=this.script.yRotationAcc,c=a.x*Math.cos(b)-a.z*Math.sin(b),d=a.x*Math.sin(b)+a.z*Math.cos(b);a.x=c,a.z=d}return a},m.prototype.updateFuelAmount=function(a){this.amountFuel=a},m.prototype.collide=function(){k.looseLife()},m.prototype.isDead=function(){return k.get("nbLife")},m}),define("component/FinalZoneComponent",["goo/entities/components/Component","goo/math/Vector3","goo/shapes/ShapeCreator","goo/entities/EntityUtils","goo/shapes/Disk","material/ColoredMaterial","helper/InputHelper","goo/particles/ParticleUtils","goo/entities/components/ParticleComponent","goo/renderer/TextureCreator","goo/renderer/Material","goo/renderer/shaders/ShaderLib"],function(a,b,c,d,e,f,g,h,i,j,k,l){"use strict";function m(a,c){this.type="FinalZoneComponent",this.shape=new e(8,2,0),this.material=new f.buildStar,this.entity=d.createTypicalEntity(a,this.shape,this.material),this.entity.transformComponent.setTranslation(0,0,0),this.entity.transformComponent.setRotation(Math.PI/2,0,Math.PI),this.entity.beeDataComponent=this,this.entity.addToWorld(),this.config={timeline:[{timeOffset:0,color:[0,0,1,1],size:5,spin:0,mass:0},{timeOffset:.5,color:[1,1,0,1],size:4},{timeOffset:1,color:[0,1,0,.5],size:2.5},{timeOffset:2,color:[1,0,0,0],size:.1}],emitters:[{totalParticlesToSpawn:-1,releaseRatePerSecond:500,minLifetime:1,maxLifetime:2,getEmissionVelocity:function(a){var b=a.velocity;return h.getRandomVelocityOffY(b,0,15*Math.PI/180,5)}}]};var g=new i(this.config);g.emitters[0].influences.push(h.createConstantForce(new b(0,5,0)));var m=(new j).loadTexture2D("assets/img/flare.png");m.generateMipmaps=!0;var n=this.material=k.createMaterial(l.particles);n.setTexture("DIFFUSE_MAP",m),n.blendState.blending="AlphaBlending",n.cullState.enabled=!1,n.depthState.write=!1,n.renderQueue=2001;var o=d.createTypicalEntity(a,n,g.meshData,[0,0,0]);o.meshRendererComponent.isPickable=!1,o.setComponent(g),o.addToWorld(),c&&this.showHelper()}return m.prototype=Object.create(a.prototype),m.prototype.showHelper=function(){var a=g.entity("FinalZone",this.entity);g.coloredMaterial("color",this.material,a)},m}),define("component/FinishZoneComponent",["goo/entities/components/Component","goo/shapes/ShapeCreator","goo/entities/EntityUtils","material/ColoredMaterial","helper/InputHelper","helper/DomHelper","util/OptionsUtil"],function(a,b,c,d,e,f,g){"use strict";function h(a,e){this.type="FinishZoneComponent";var f=g.get("meshDetails");this.shape=b.createSphere(5*f,5*f,.8),this.material=new d.buildFinishZone,this.material.wireframe=!0,this.entity=c.createTypicalEntity(a,this.shape,this.material),this.entity.beeDataComponent=this,this.entity.addToWorld(),e&&this.showHelper()}return h.prototype=Object.create(a.prototype),h.prototype.showHelper=function(){var a=e.entity("FinishZone",this.entity);e.coloredMaterial("color",this.material,a)},h}),define("component/FuelZoneComponent",["goo/entities/components/Component","goo/shapes/ShapeCreator","goo/entities/EntityUtils","material/ColoredMaterial","helper/InputHelper","helper/DomHelper","util/OptionsUtil"],function(a,b,c,d,e,f,g){"use strict";function h(a,e){this.type="FuelZoneComponent";var h=g.get("meshDetails");this.shape=b.createSphere(5*h,5*h,.8),this.material=new d.buildFuelZone,this.material.wireframe=!0,this.entity=c.createTypicalEntity(a,this.shape,this.material),this.entity.beeDataComponent=this,this.entity.addToWorld(),i=f.addFuelAmount(),i.update(100),e&&this.showHelper()}var i;return h.prototype=Object.create(a.prototype),h.prototype.showHelper=function(){var a=e.entity("FuelZone",this.entity);e.coloredMaterial("color",this.material,a)},h.prototype.update=function(a){i.update(a)},h}),define("component/StarComponent",["goo/entities/components/Component","goo/shapes/ShapeCreator","goo/entities/EntityUtils","material/ColoredMaterial","helper/InputHelper","util/OptionsUtil","manager/PlayerManager"],function(a,b,c,d,e,f,g){"use strict";function h(a,e,h){this.type="StarComponent",this.life=g.get("starLife");var i=f.get("meshDetails");this.shape=b.createSphere(5*i,5*i,1),this.material=new d.buildStar,this.entity=c.createTypicalEntity(a,this.shape,this.material),this.entity.transformComponent.setTranslation(e.x,e.y,e.z),this.entity.beeDataComponent=this,this.entity.addToWorld(),h&&this.showHelper()
}return h.prototype=Object.create(a.prototype),h.prototype.showHelper=function(){var a=e.entity("Star",this.entity);e.coloredMaterial("color",this.material,a)},h.prototype.collide=function(a){var b=a.power||1;this.life=this.life-b,this.life<=0&&this.entity.removeFromWorld()},h.prototype.isDead=function(){return this.life<=0},h}),define("component/StarshipComponent",["goo/entities/components/Component","goo/shapes/Box","goo/entities/EntityUtils","material/ColoredMaterial","script/RunEntityScript","helper/InputHelper"],function(a,b,c,d,e,f){"use strict";function g(a,f){this.type="StarshipComponent",this.onDeadCallbacks=[],this.life=1,this.power=1e3,this.shape=new b(5,5,15,0,0),this.material=new d.buildBullet,this.script=new e(0,.1,-1),this.entity=c.createTypicalEntity(a,this.shape,this.material,this.script),this.entity.beeDataComponent=this,this.entity.addToWorld(),f&&this.showHelper()}return g.prototype=Object.create(a.prototype),g.prototype.showHelper=function(){var a=f.entity("Starship",this.entity);f.coloredMaterial("color",this.material,a)},g.prototype.collide=function(){if(this.life=this.life-1,this.life<=0){this.entity.removeFromWorld();for(var a=0,b=this.onDeadCallbacks.length;b>a;a++)this.onDeadCallbacks[a]()}},g.prototype.isDead=function(){return this.life<=0},g.prototype.onDead=function(a){this.onDeadCallbacks.push(a)},g}),define("component/SunComponent",["goo/entities/components/Component","goo/renderer/light/PointLight","goo/entities/EntityUtils","helper/InputHelper"],function(a,b,c,d){"use strict";function e(a,d){this.type="SunComponent",this.entity=c.createTypicalEntity(a,new b),this.entity.transformComponent.setTranslation(0,10,0),this.entity.beeDataComponent=this,this.entity.addToWorld(),d&&this.showHelper()}return e.prototype=Object.create(a.prototype),e.prototype.showHelper=function(){d.entity("Sun",this.entity)},e}),define("helper/DebuggerHelper",["helper/UrlHelper"],function(a){function b(){for(var a="",b=0,d=arguments.length;d>b;b+=2)a=a+arguments[b]+" : "+arguments[b+1]+"<br />";c.innerHTML=a}var c=document.createElement("div");return c.style.position="absolute",c.style.top="80px",c.style.right=0,c.color="white",a.isDev()&&document.getElementsByTagName("body")[0].appendChild(c),b("Go","oo"),{updateDebug:function(){b.apply(null,arguments)}}}),define("helper/DomHelper",["helper/TouchButton"],function(a){var b=function(a){var b=document.createElement("div");return a&&b.classList.add(a),b},c=b("pageContainer");return c.style.display="none",document.body.appendChild(c),{showPage:function(){c.style.display="block"},hidePage:function(){c.style.display="none"},addContainer:function(a){var d=b(a);return c.appendChild(d),d},buildDiv:function(a){return b(a)},buildButton:function(b,c,d){var e=a.build("button",c,null,d);return e.innerHTML=b,e},buildTitle:function(a,b){var c=document.createElement("h1");return c.innerHTML=a,b&&c.classList.add(b),c},clearPageContent:function(){c.innerHTML=""},addPageTitle:function(a){var d=b("title");return d.innerHTML=a,c.appendChild(d),d},addPageButton:function(b,d,e){var f=a.build("button",d,null,e);return f.innerHTML=b,c.appendChild(f),f},addPageBackButton:function(b,d,e){var f=a.build("button",d,null,e);f.classList.add("back"),f.innerHTML=b,c.appendChild(f)},addPageSmallButton:function(b,d,e){var f=a.build("button",d,null,e);f.classList.add("small"),f.innerHTML=b,c.appendChild(f)},addPageImg:function(a,b){var d=document.createElement("img");return d.src=a,d.title=b,c.appendChild(d),d},addPageSentence:function(a){var d=b("sentence");return d.innerHTML=a,c.appendChild(d),d},addCrosschair:function(){var a=b("crosschair");return a.innerHTML="",document.body.appendChild(a),a},addRadar:function(){var a=b("radar");return document.body.appendChild(a),a},addFuelAmount:function(){var a=b("gauge");a.classList.add("fuel");var c=b();return a.appendChild(c),document.body.appendChild(a),{update:function(a){c.style.height=a+"%",a>60?(c.classList.add("relax"),c.classList.remove("nervous"),c.classList.remove("dead")):a>30?(c.classList.add("nervous"),c.classList.remove("relax"),c.classList.remove("dead")):(c.classList.add("dead"),c.classList.remove("nervous"),c.classList.remove("relax"))}}},addBulletAmount:function(){var a=b("gauge");a.classList.add("bullet");var c=b();return a.appendChild(c),document.body.appendChild(a),{update:function(a){c.style.width=a+"%"}}},addTouch:function(a){var c=b("touch");return c.classList.add(a),document.body.appendChild(c),c},addLifeContainer:function(){var a=b("lifeContainer");return document.body.appendChild(a),a},buildLife:function(a){var b=document.createElement("span");return b.classList.add("life"),a||b.classList.add("inactive"),document.body.appendChild(b),b}}}),define("helper/EntityHelper",function(){var a=function(a){return{x:a.transformComponent.transform.translation.x,y:a.transformComponent.transform.translation.y,z:a.transformComponent.transform.translation.z}},b=function(a){return a&&a.meshDataComponent&&a.meshDataComponent.meshData&&a.meshDataComponent.meshData.radius?a.meshDataComponent.meshData.radius:0};return{getPosition:function(b){return a(b)},getDistance:function(c,d){var e=a(c),f=a(d),g=Math.sqrt(Math.pow(e.x-f.x,2)+Math.pow(e.y-f.y,2)+Math.pow(e.z-f.z,2));return g=Math.abs(g),g=g-b(c)-b(d)}}}),define("helper/InputHelper",["helper/UrlHelper","material/ColoredMaterial"],function(a,b){function c(a,b,c,d,e,f,g){var h=document.createElement("div"),i=document.createElement("input");i.type="range",i.min=c,i.max=d,i.value=f||0,i.step=e,i.readOnly=!1,h.appendChild(i);var j=document.createElement("div");j.style.width="200px",j.style.textAlign="center";var k=document.createElement("span");k.innerHTML=c,k.style.cssFloat="left",j.appendChild(k);var l=document.createElement("span");l.innerHTML=b+" = "+f;var m=function(a){l.innerHTML=b+" = "+Math.round(100*a)/100};j.appendChild(l);var n=document.createElement("span");n.innerHTML=d,n.style.cssFloat="right",j.appendChild(n),h.appendChild(j),i.oninput=function(){m(this.value),g(this.value)},i.onchange=function(){m(this.value),g(this.value)},a.appendChild(h)}function d(a){for(var b=1,c=a.children.length;c>b;b++)a.children[b].style.display="none"===a.children[b].style.display?"block":"none"}function e(a){for(var b=1,c=a.children.length;c>b;b++)a.children[b].style.display="none"}function f(a,b,e,f){var g=h(b),i={x:0,y:0,z:0},j=function(){f.call(e,i.x,i.y,i.z)};c(g,"x",-100,100,.01,0,function(a){i.x=a,j()}),c(g,"y",-100,100,.01,0,function(a){i.y=a,j()}),c(g,"z",-100,100,.01,0,function(a){i.z=a,j()}),d(g),a.appendChild(g)}function g(a,e,f,g){var i=h(e),j={r:0,g:0,b:0,a:0},k=function(){b.updateProp(f,g,[j.r,j.g,j.b,j.a])};c(i,"r",0,1,.01,0,function(a){j.r=a,k()}),c(i,"g",0,1,.01,0,function(a){j.g=a,k()}),c(i,"b",0,1,.01,0,function(a){j.b=a,k()}),c(i,"a",0,1,.01,0,function(a){j.a=a,k()}),d(i),a.appendChild(i)}function h(a){var b=document.createElement("div");b.style.display="inline-block",b.style.verticalAlign="top",b.style.padding="10px",b.style.width="300px";var c=document.createElement("div");return c.innerHTML=a+" : ",c.style.cursor="pointer",b.appendChild(c),c.onclick=function(){d(b)},b}function i(a,b,c){var e=h(a);return f(e,"Translation",b.transformComponent,b.transformComponent.setTranslation),f(e,"Rotation",b.transformComponent,b.transformComponent.setRotation),f(e,"Scale",b.transformComponent,b.transformComponent.setScale),d(e),c.appendChild(e),e}function j(a,d,f){var i=h(a);return g(i,"ambient",d,"materialAmbient"),g(i,"diffuse",d,"materialDiffuse"),g(i,"emissive",d,"materialEmissive"),g(i,"specular",d,"materialSpecular"),c(i,"specularPower",0,100,1,0,function(a){b.updateProp(d,"materialSpecularPower",a)}),c(i,"opacity",0,1,.01,0,function(a){b.updateProp(d,"opacity",a)}),f.appendChild(i),e(i),i}function k(a,d,f){var i=h(a);return g(i,"HighlightColour",d,"HighlightColour"),g(i,"MidColour",d,"MidColour"),g(i,"ShadowColour",d,"ShadowColour"),c(i,"HighlightSize",0,1,.01,1,function(a){b.updateProp(d,"HighlightSize",a)}),c(i,"OutlineWidth",0,1,.01,.15,function(a){b.updateProp(d,"OutlineWidth",a)}),c(i,"ShadowSize",0,1,.01,.15,function(a){b.updateProp(d,"ShadowSize",a)}),f.appendChild(i),e(i),i}var l=document.createElement("div");return l.classList.add("inputHelperMainContainer"),a.isDev()&&document.getElementsByTagName("body")[0].appendChild(l),{entity:function(a,b,c){c=c||l;var d=i(a,b,c);return c!==l&&e(c),d},coloredMaterial:function(a,b,c){c=c||l;var d=j(a,b,c);return e(c),d},toonColoredMaterial:function(a,b,c){c=c||l;var d=k(a,b,c);return e(c),d}}}),define("helper/KeyboardHelper",function(){var a={};return document.onkeydown=function(b){a[b.keyCode]&&a[b.keyCode].start.call(a[b.keyCode].ctx)},document.onkeyup=function(b){a[b.keyCode]&&a[b.keyCode].stop.call(a[b.keyCode].ctx)},{listen:function(b,c,d,e){a[b]={start:c,stop:d,ctx:e}}}}),define("helper/LangHelper",function(){var a,b;try{a=navigator.language.substring(0,2),b=window.location.hash.substring(1)}catch(c){a="en",b="en"}"en"===b?a="en":"fr"===b&&(a="fr"),(void 0===a||null===a)&&(a="en"),"en"!==a&&"fr"!==a&&(a="en");var d={en:{},fr:{}};return d.en.title="Sturvive",d.fr.title="Sturvive",d.en.back="Back",d.fr.back="Précédent",d.en.prev="Previous",d.fr.prev="Précédent",d.en.next="Next",d.fr.next="Suivant",d.en.homeStart="Start",d.fr.homeStart="Démarrer",d.en.homeHelp="Help",d.fr.homeHelp="Aide",d.en.homeOptions="Options",d.fr.homeOptions="Options",d.en.homeCompatibility="Compatibility",d.fr.homeCompatibility="Compatibilité",d.en.helpTitle="Help",d.fr.helpTitle="Aide",d.en.optionsTitle="Options",d.fr.optionsTitle="Options",d.en.compatibilityTitle="Compatibility",d.fr.compatibilityTitle="Compatibilité",d.en.compatibilityPageNoCompatible="We are sorry, but your browser doesn't allow you to play ! Please upgrade it or change it !",d.fr.compatibilityPageNoCompatible="Nous sommes désolés mais ton navigateur ne te permet pas de jouer ! S'il te plaît mets le à jour ou changes en !",d.en.compatibilityPageNoFullCompatible="Your browser is not fully compatible with the game, but you can still play !",d.fr.compatibilityPageNoFullCompatible="Ton navigateur n'est pas complètement compatible, mais tu peux jouer quand même !",d.en.compatibilityPageTryBack="Try anyway",d.fr.compatibilityPageTryBack="Essayer quand même",d.en.compatibilityWebGLDescription="All the game is based on this system !",d.fr.compatibilityWebGLDescription="Le jeu est en 3d grâce à ce système !",d.en.compatibilityCssTransitionDescription="TODO",d.fr.compatibilityCssTransitionDescription="TODO",d.en.compatibilityClassListDescription="TODO",d.fr.compatibilityClassListDescription="TODO",d.en.compatibilityLocalStorageDescription="TODO",d.fr.compatibilityLocalStorageDescription="TODO",d.en.compatibilityMp3Description="You can't play mp3 songs !",d.fr.compatibilityMp3Description="Tu ne peux pas écouter le son au format mp3 !",d.en.compatibilityWavDescription="You can't play wav songs !",d.fr.compatibilityWavDescription="Tu ne peux pas écouter le son au format wav !",d.en.compatibilityOggDescription="You can't play ogg songs !",d.fr.compatibilityOggDescription="Tu ne peux pas écouter le son au format ogg !",d.en.compatibilityNavigatorLanguageDescription="Game can't select your language !",d.fr.compatibilityNavigatorLanguageDescription="Le jeu ne peut pas sélectionner ta langue !",d.en.pauseTitle="Pause",d.fr.pauseTitle="Pause",d.en.pauseHelp="Help",d.fr.pauseHelp="Aide",d.en.pauseOptions="Options",d.fr.pauseOptions="Options",d.en.pauseRestart="Restart",d.fr.pauseRestart="Redémarrer",d.en.forwardKeyboardDescription="To go forward use up key !",d.fr.forwardKeyboardDescription="Pour aller en avant utilise la flêche du haut !",d.en.backwardKeyboardDescription="To go backward use down key !",d.fr.backwardKeyboardDescription="Pour aller en arrière utilise la flêche du bas !",d.en.leftKeyboardDescription="To go left use left key !",d.fr.leftKeyboardDescription="Pour aller à gauche utilise la flêche gauche !",d.en.rightKeyboardDescription="To go right use right key !",d.fr.rightKeyboardDescription="Pour aller à droite utilise la flêche droite !",d.en.tournLeftKeyboardDescription="To tourn righ use c key !",d.fr.tournLeftKeyboardDescription="Pour tourner à gauche utilise la touche c !",d.en.tournRightKeyboardDescription="To tourn left use v key !",d.fr.tournRightKeyboardDescription="Pour tourner à droite utilise la touche v !",d.en.shootKeyboardDescription="To shoot use space key !",d.fr.shootKeyboardDescription="Pour tirer utilise la touche espace !",d.en.bonusTitle="Bonus",d.fr.bonusTitle="Bonus",d.en.bonusExplanation="Well done ! Choose a bonus for your job !",d.fr.bonusExplanation="Bien joué ! Choisis un bonus pour ce boulot !",d.en.speedBonus="Speed",d.fr.speedBonus="Vitesse",d.en.nbLifeBonus="Life's number",d.fr.nbLifeBonus="Nombre de vies",d.en.nbBulletAtStartBonus="Bullets' reserve",d.fr.nbBulletAtStartBonus="Taille du chargeur",d.en.bulletPowerBonus="Bullets' power",d.fr.bulletPowerBonus="Destruction des balles",d.en.bulletLifeBonus="Bullets' life",d.fr.bulletLifeBonus="Vie des balles",d.en.fuelLossBonus="Fuel loss",d.fr.fuelLossBonus="Perte du carburant",d.en.backBonus="No, I save !",d.fr.backBonus="Non, j'économise !",d.en.chooseNextMapTitle="Choose a map",d.fr.chooseNextMapTitle="Choisis une carte",d.en.backChooseNextMap="Random",d.fr.backChooseNextMap="Aléatoire",d.en.chooseNextMaptutos="Learn",d.fr.chooseNextMaptutos="Enseignement",d.en.chooseNextMapcleanZone="Clean Zone",d.fr.chooseNextMapcleanZone="Nettoyer Zone",d.en.chooseNextMapprotect="Protect",d.fr.chooseNextMapprotect="Protéger",d.en.chooseNextMaprace="Race",d.fr.chooseNextMaprace="Course",{get:function(b){return d[a][b]},getCurrentLang:function(){return a}}}),define("helper/MathHelper",["goo/math/Matrix3x3"],function(a){var b=new a;return{rotateVectorByYRad:function(c,d){var e=new a;return b.rotateY(d,e),e.applyPre(c)}}}),define("helper/MobileHelper",function(){var a={Android:function(){return navigator.userAgent.match(/Android/i)},BlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},iOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return navigator.userAgent.match(/Opera Mini/i)},Windows:function(){return navigator.userAgent.match(/IEMobile/i)},any:function(){return a.Android()||a.BlackBerry()||a.iOS()||a.Opera()||a.Windows()}};return{isMobile:function(){return a.any()}}}),define("helper/ShootHelper",["component/BulletComponent","manager/PlayerManager","helper/MobileHelper","helper/KeyboardHelper","helper/TouchButton","helper/EntityHelper","helper/DomHelper"],function(a,b,c,d,e,f,g){var h,i=function(){h=g.addBulletAmount(),h.update(b.getBulletPercent())};return{start:function(g,j){i(),c.isMobile()?document.getElementsByTagName("body")[0].appendChild(e.build("shootButton",function(){b.get("nbBullet")>0&&(new a(g,f.getPosition(j.entity),j.getBulletPosition(),j.script.yRotationAcc,!1),b.minusBullet(),h.update(b.getBulletPercent()))})):d.listen(32,function(){b.get("nbBullet")>0&&(new a(g,f.getPosition(j.entity),j.getBulletPosition(),j.script.yRotationAcc,!1),b.minusBullet(),h.update(b.getBulletPercent()))},function(){},null)},refresh:function(){h.update(b.getBulletPercent())}}}),define("helper/TouchButton",function(){var a=function(a){a.preventDefault();var b;if(a.changedTouches)for(var c=0,d=a.changedTouches.length;d>c&&void 0===b;c++)a.changedTouches[c].target===a.target&&(b=a.changedTouches[c]);var e=b?b.clientX:a.clientX,f=b?b.clientY:a.clientY,g=a.target.offsetLeft,h=a.target.offsetTop;return{originalEvent:a,x:e,y:f,height:a.target.offsetHeight,width:a.target.offsetWidth,top:h,left:g,insideX:e-g,insideY:f-h}};return{build:function(b,c,d,e){var f=document.createElement("div");if(f.classList.add(b),c){var g=function(b){b.target===f&&(e?c.call(e,a(b)):c(a(b)))};f.addEventListener("touchstart",g,!1),f.addEventListener("touchmove",g,!1),f.addEventListener("mousedown",g,!1)}if(d){var h=function(b){b.target===f&&(e?d.call(e,a(b)):d(a(b)))};f.addEventListener("touchend",h,!1),f.addEventListener("touchcancel",h,!1),f.addEventListener("touchleave",h,!1),f.addEventListener("mouseup",h,!1)}return f}}}),define("helper/UrlHelper",function(){var a=-1!==document.URL.indexOf("localhost")||-1!==document.URL.indexOf("debug");return{isDev:function(){return a}}}),require(["helper/DomHelper","page/HomePage","page/CompatibilityPage","util/CompatibilityUtil"],function(a,b,c,d){"use strict";d.isCompatible()===!0?b.show():c.show(b.show),a.showPage()}),define("manager/EntityManager",["component/StarComponent","helper/EntityHelper"],function(a,b){var c,d=[],e=[];return{addToWorld:function(b,e){for(var f=0,g=d.length;g>f;f++)d[f].entity.removeFromWorld();d=[];for(var h=0,i=e.length;i>h;h++)d.push(new a(b,e[h].position,0===h));c&&c(d)},checkCollision:function(a){for(var c=0,f=d.length;f>c;c++)if(b.getDistance(a,d[c].entity)<0){if(a.beeDataComponent.collide(d[c]),d[c].collide(a.beeDataComponent),d[c].isDead()){var g=d[c].entity;d.splice(c,1);for(var h=0,i=e.length;i>h;h++)e[h](g,f-1);f=d.length}if(a.beeDataComponent.isDead())return}},redrawAllEntities:function(c){var e,f,g=[];for(e=d.length-1;e>-1;e--)d[e].entity.removeFromWorld(),g.push({position:b.getPosition(d[e].entity)});for(d=[],e=0,f=g.length;f>e;e++)d.push(new a(c,g[e].position,0===e))},onNewEntities:function(a){c=a},onRemoveEntity:function(a){e.push(a)}}}),define("manager/LifeManager",["manager/PlayerManager","helper/DomHelper"],function(a,b){var c,d=function(){c=b.addLifeContainer(),e()},e=function(){c.innerHTML="";for(var d=0;d<a.getMax("nbLife");d++)c.appendChild(b.buildLife(d<a.get("nbLife")))};return a.onLooseLife(e),a.onWinLife(e),{start:function(){d()}}}),define("manager/PlayerManager",function(){var a=10,b=[],c=[],d={nbLife:3,nbBulletAtStart:150,nbBulletPerShoot:3,bulletPower:5,bulletLife:10,fuelLoss:.1,speed:2},e={nbLife:d.nbLife,nbBullet:a,nbBulletAtStart:a,nbBulletPerShoot:1,bulletPower:1,bulletLife:1,fuelLoss:.5,speed:1,starLife:1,score:0},f=e;if(localStorage.optionsPlayer)try{f=JSON.parse(localStorage.optionsPlayer)}catch(g){}return f.nbLife=d.nbLife,f.nbBullet=f.nbBulletAtStart,{get:function(a){return f[a]},getMax:function(a){return d[a]},update:function(a,b){var c=void 0!==b?b:f[a];"nbLife"===a?c+=1:"nbBulletAtStart"===a?c+=10:"bulletPower"===a?c+=1:"bulletLife"===a?c+=1:"speed"===a?c=(10*c+1)/10:"fuelLoss"===a&&(c=(10*c-1)/10),f[a]=c,localStorage.optionsPlayer=JSON.stringify(f)},minusBullet:function(){f.nbBullet=f.nbBullet-f.nbBulletPerShoot},reinitNbBullet:function(){f.nbBullet=f.nbBulletAtStart},looseLife:function(){f.nbLife=f.nbLife-1;for(var a=0,c=b.length;c>a;a++)b[a]()},onLooseLife:function(a){b.push(a)},winLife:function(){f.nbLife=f.nbLife+1;for(var a=0,b=c.length;b>a;a++)c[a]()},onWinLife:function(a){c.push(a)},getBulletPercent:function(){return Math.round(f.nbBullet/f.nbBulletAtStart*100)}}}),define("material/ColoredMaterial",["goo/renderer/Material","goo/renderer/shaders/ShaderLib"],function(a,b){var c=function(a,b,c,d,e){return a.uniforms={materialAmbient:[b,c,d,e],materialDiffuse:[b-.1,c-.1,d-.1,e],materialEmissive:[0,0,0,e],materialSpecular:[0,0,0,e],materialSpecularPower:2,opacity:e},a};return{build:function(d,e,f,g){var h=a.createMaterial(b.simpleLit,"BoxMaterial");return c(h,d,e,f,g),h},update:function(a,b,d,e,f){return c(a,b,d,e,f)},updateProp:function(a,b,c){return a.uniforms[b]=c,a},buildToon:function(){var c=a.createMaterial(b.toon,"ToonMaterial");return c.uniforms={HighlightColour:[0,.2,0,0],MidColour:[0,.1,0,0],ShadowColour:[0,.1,0,0],HighlightSize:1,OutlineWidth:1,ShadowSize:.12},c},buildStar:function(){var c=(Math.random(),a.createMaterial(b.simpleLit,"StarMaterial"));return c.uniforms={materialAmbient:[.3,0,0,0],materialDiffuse:[.3,.7,0,0],materialEmissive:[.4,0,0,0],materialSpecular:[0,0,0,0],materialSpecularPower:0,opacity:1},c},buildBullet:function(){var c=a.createMaterial(b.simpleLit,"BulletMaterial");return c.uniforms={materialAmbient:[.3,.1,.3,0],materialDiffuse:[1,0,1,0],materialEmissive:[.2,.2,.9,0],materialSpecular:[.2,0,.8,0],materialSpecularPower:0,opacity:1},c},buildFuelZone:function(){var c=a.createMaterial(b.simpleLit,"FuelZoneMaterial");return c.uniforms={materialAmbient:[0,.3,0,0],materialDiffuse:[0,.3,0,0],materialEmissive:[0,.3,0,0],materialSpecular:[.2,0,.8,0],materialSpecularPower:0,opacity:1},c},buildFinishZone:function(){var c=a.createMaterial(b.simpleLit,"FInishZoneMaterial");return c.uniforms={materialAmbient:[0,0,.3,0],materialDiffuse:[0,0,.3,0],materialEmissive:[0,0,.3,0],materialSpecular:[.2,.8,0,0],materialSpecularPower:0,opacity:1},c}}}),define("page/BonusPage",["helper/DomHelper","helper/LangHelper","manager/PlayerManager"],function(a,b,c){function d(){a.clearPageContent(),f=a.addPageTitle(b.get("bonusTitle")),h();var c=a.addContainer("bonus");c.appendChild(g()),c.appendChild(k("nbLife")),c.appendChild(k("nbBulletAtStart")),c.appendChild(k("bulletPower")),c.appendChild(k("bulletLife")),c.appendChild(k("speed")),c.appendChild(k("fuelLoss")),a.addPageBackButton(b.get("backBonus"),e)}var e,f,g=function(){var c=a.addContainer("bonusExplanation");return c.innerHTML=b.get("bonusExplanation"),c},h=function(){f.innerHTML=b.get("bonusTitle")+" : "+c.get("score")+" ";var a=document.createElement("span");a.classList.add("bonusSymbol"),a.innerHTML="",f.appendChild(a)},i=function(a){var d=c.get(a),e=c.getMax(a);return b.get(a+"Bonus")+" "+d+"/"+e},j=function(a){var b="fuelLoss"===a;return c.get(a)<c.getMax(a)||b&&c.get(a)>c.getMax(a)},k=function(b){var d=a.buildButton(i(b),function(){j(b)&&(c.update(b),c.update("score",c.get("score")-1),h(),d.innerHTML=i(b),c.get("score")<=0?e():j(b)||(d.classList.add("disabled"),d.disabled=!0))});return j(b)||(d.classList.add("disabled"),d.disabled=!0),d};return{show:function(a){e=a,d()}}}),define("page/ChooseNextMapPage",["helper/DomHelper","helper/LangHelper","util/MapUtil"],function(a,b,c){function d(){a.clearPageContent(),scoreDiv=a.addPageTitle(b.get("chooseNextMapTitle"));var d=a.addContainer("chooseNextMap"),e=c.getAll(),g=c.getLevels();d.appendChild(f("tutos",e.tutos,g.tutos)),d.appendChild(f("cleanZone",e.cleanZone,g.cleanZone,-1===g.tutos)),d.appendChild(f("protect",e.protect,g.protect,-1===g.cleanZone)),d.appendChild(f("race",e.race,g.race,-1===g.protect))}var e,f=function(c,d,f,g){function h(a,b){return function(){a||e(b)}}var i=a.buildDiv("columnContainer"),j=a.buildTitle(b.get("chooseNextMap"+c));i.appendChild(j);for(var k in d){var l=d[k],m=g||k>f+1,n=a.buildButton(l.name,h(m,l)),o=a.buildDiv("mapScoreToWin");o.innerHTML=l.scoreToWin+"",n.appendChild(o),m&&n.classList.add("disabled"),i.appendChild(n)}return i};return{show:function(a){e=a,d()}}}),define("page/CompatibilityPage",["helper/DomHelper","helper/LangHelper","util/CompatibilityUtil"],function(a,b,c){function d(){a.clearPageContent(),a.addPageTitle(b.get("compatibilityTitle"));var d="";c.isCompatible()===!1?d=b.get("compatibilityPageNoCompatible"):c.isCompatible()===!0&&c.isFullCompatible()===!1&&(d=b.get("compatibilityPageNoFullCompatible"));var g=a.addPageSentence("");g.innerHTML=['<div class="content">',d,"</div><ul>",f("Web GL",c.hasWebGlContext(),b.get("compatibilityWebGLDescription")),f("Css transition",c.hasCssTransition(),b.get("compatibilityCssTransitionDescription")),f("Css class list",c.hasClassList(),b.get("compatibilityClassListDescription")),f("Local storage",c.hasLocalStorage(),b.get("compatibilityLocalStorageDescription")),f("Audio mp3",c.hasAudioMp3(),b.get("compatibilityMp3Description")),f("Audio wav",c.hasAudioWav(),b.get("compatibilityWavDescription")),f("Audio ogg",c.hasAudioOgg(),b.get("compatibilityOggDescription")),f("Navigator language",c.hasNavigatorLanguage(),b.get("compatibilityNavigatorLanguageDescription")),"</ul>"].join("");var h=b.get("back");c.isCompatible()===!1&&(h=b.get("compatibilityPageTryBack")),a.addPageBackButton(h,e)}var e,f=function(a,b,c){return['<li class="compatibility ',b,'">',a,'<span class="description">',c,"</span>","</li>"].join("")};return{show:function(a){e=a,d()}}}),define("page/GamePage",["goo/entities/GooRunner","component/CameraComponent","component/SunComponent","component/FinalZoneComponent","component/FuelZoneComponent","component/StarshipComponent","component/FinishZoneComponent","helper/DomHelper","helper/ShootHelper","helper/EntityHelper","page/PausePage","manager/EntityManager","manager/PlayerManager","manager/LifeManager","util/MapUtil","util/RadarUtil","util/OptionsUtil","util/ScreenUtil","util/TimeUtil","page/BonusPage","page/ChooseNextMapPage"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){"use strict";function v(){h.clearPageContent(),h.hidePage(),z=h.addCrosschair();var a=K();F=!0,y=h.buildButton("",function(){F?(G(a),k.show(function(){H(a)})):(a.startGameLoop(),F=!0)}),m.onLooseLife(function(){m.get("nbLife")<0&&M(a)}),y.classList.add("pause"),document.body.appendChild(y),n.start(),r.onResize(function(){J(a),A.refreshHeight()}),N(a)}var w,x,y,z,A,B,C,D,E,F=!1,G=function(a){a.stopGameLoop(),F=!1,I(!1),h.showPage(),s.pause()},H=function(a){h.clearPageContent(),h.hidePage(),a.startGameLoop(),F=!0,I(!0),J(a),l.redrawAllEntities(a.world),s.resume()},I=function(a){for(var b=0,c=document.body.children.length;c>b;b++)document.body.children[b].style.display=a===!1?"none":"block"},J=function(a){var b=r.getWidth()*q.get("screenSize"),c=r.getHeight()*q.get("screenSize");a.renderer.setSize(b,c)},K=function(){var d=new a;x=d.renderer.domElement,x.classList.add("canvas"),x.addEventListener("touchstart",function(a){a.preventDefault()},!1),x.addEventListener("touchmove",function(a){a.preventDefault()},!1),J(d),d.renderer.setClearColor(0,0,0,1),document.body.appendChild(x);new c(d.world,!0);return A=new e(d.world,!0),D=new f(d.world,!0),C=new g(d.world,!0),B=new b(d.world,A,!0),l.onRemoveEntity(function(a,b){0===b&&L(d)}),D.script.onRun(function(){E.starship&&j.getDistance(D.entity,C.entity)<0&&(D.entity.removeFromWorld(),L(d))}),D.onDead(function(){M(d)}),i.start(d.world,B),p.draw(B,A,D,C),d},L=function(a){G(a),E.scoreToWin>0?(m.update("score",m.get("score")+E.scoreToWin),t.show(function(){N(a)})):N(a)},M=function(a){G(a),E=void 0,N(a)},N=function(a){G(a),void 0!==E&&o.increment(E),u.show(function(b){E=b,H(a),m.reinitNbBullet(),i.refresh(),E.fuelZone?A.entity.transformComponent.setTranslation(E.fuelZone.position.x,E.fuelZone.position.y,E.fuelZone.position.z):A.entity.transformComponent.setTranslation(0,-100,0),B.updateFuelAmount(100),A.update(100),B.entity.transformComponent.setTranslation(E.camera.position.x,E.camera.position.y,E.camera.position.z),B.script.yRotationAcc=0,E.starship?(D.entity.transformComponent.setTranslation(E.starship.position.x,E.starship.position.y,E.starship.position.z),D.entity.addToWorld()):(D.entity.transformComponent.setTranslation(0,-100,0),D.entity.removeFromWorld()),E.finishZone?(C.entity.transformComponent.setTranslation(E.finishZone.position.x,E.finishZone.position.y,E.finishZone.position.z),C.entity.addToWorld()):(C.entity.transformComponent.setTranslation(0,-100,0),C.entity.removeFromWorld()),l.addToWorld(a.world,E.getEntities()),E.maxTime?s.start(E.maxTime,function(){M(a)}):s.hide()})};return{show:function(a){w=a,v()}}}),define("page/HelpPage",["helper/DomHelper","helper/LangHelper","helper/MobileHelper"],function(a,b,c){function d(){a.clearPageContent(),f=a.addPageTitle(k()),g=a.addPageImg(l(),i[j]),h=a.addPageSentence(i[j]),a.addPageSmallButton(b.get("prev"),function(){j>0&&(j-=1,m())}),a.addPageSmallButton(b.get("next"),function(){j<i.length-1&&(j+=1,m())}),a.addPageBackButton(b.get("back"),e)}var e,f,g,h,i=["blabla","blibli"],j=0,k=function(){return b.get("helpTitle")+" "+(j+1)+"/"+i.length},l=function(){var a="assets/img/help/";return a+=c.isMobile()?"mobile/":"pc/",a=a+j+".png"},m=function(){f.innerHTML=k(),g.src=l(),g.title=i[j],h.innerHTML=i[j]};return{show:function(a){e=a,d()}}}),define("page/HomePage",["helper/DomHelper","helper/LangHelper","page/GamePage","page/HelpPage","page/OptionsPage","page/CompatibilityPage","util/CompatibilityUtil","util/ScreenUtil"],function(a,b,c,d,e,f,g,h){h.onResize(function(){});var i=function j(){a.clearPageContent();var h=a.addContainer("langs"),i=a.buildButton("",function(){location.hash="#en",location.reload()});i.classList.remove("button"),i.classList.add("lang"),i.classList.add("en"),"en"===b.getCurrentLang()&&i.classList.add("active"),h.appendChild(i);var k=a.buildButton("",function(){location.hash="#fr",location.reload()});k.classList.remove("button"),k.classList.add("lang"),k.classList.add("fr"),"fr"===b.getCurrentLang()&&k.classList.add("active"),h.appendChild(k),a.addPageTitle(b.get("title")),a.addPageButton(b.get("homeStart"),function(){c.show(j)}),a.addPageButton(b.get("homeHelp"),function(){d.show(j)}),a.addPageButton(b.get("homeOptions"),function(){e.show(j)}),a.addPageButton(b.get("homeCompatibility")+" "+g.nbItemCompatible()+"/"+g.nbItem(),function(){f.show(j)})};return{show:function(){i()}}}),define("page/OptionsPage",["helper/DomHelper","helper/LangHelper","util/OptionsUtil"],function(a,b,c){function d(){a.clearPageContent(),a.addPageTitle(b.get("optionsTitle")),a.addPageBackButton(b.get("back"),e);var c=a.addContainer("options");c.appendChild(f()),c.appendChild(g())}var e,f=function(){var b=a.buildDiv("sizeScreenContainer"),d=a.buildDiv("sizeScreenViewContainer"),e=a.buildDiv("sizeScreenView"),f=a.buildDiv("buttonContainer");return d.appendChild(e),f.appendChild(a.buildButton("30%",function(){e.style.width="30%",e.style.height="30%",e.innerHTML="30%",c.update("screenSize",.3)})),f.appendChild(a.buildButton("50%",function(){e.style.width="50%",e.style.height="50%",e.innerHTML="50%",c.update("screenSize",.5)})),f.appendChild(a.buildButton("100%",function(){e.style.width="99%",e.style.height="99%",e.innerHTML="100%",c.update("screenSize",1)})),.3===c.get("screenSize")?(e.style.width="30%",e.style.height="30%",e.innerHTML="30%"):.5===c.get("screenSize")?(e.style.width="50%",e.style.height="50%",e.innerHTML="50%"):(e.style.width="99%",e.style.height="99%",e.innerHTML="100%"),b.appendChild(a.buildTitle("ScreenSize")),b.appendChild(f),b.appendChild(d),b},g=function(){var b=a.buildDiv("meshDetailsContainer"),d=a.buildDiv("buttonContainer");d.appendChild(a.buildButton("30%",function(){c.update("meshDetails",1),e.innerHTML="30%",e.style.color="rgba(0,0,0,0.3)"})),d.appendChild(a.buildButton("50%",function(){c.update("meshDetails",3),e.innerHTML="50%",e.style.color="rgba(0,0,0,0.65)"})),d.appendChild(a.buildButton("100%",function(){c.update("meshDetails",10),e.innerHTML="100%",e.style.color="rgba(0,0,0,1)"}));var e=a.buildDiv("meshDetailsView");return 1===c.get("meshDetails")?(e.innerHTML="30%",e.style.color="rgba(0,0,0,0.3)"):3===c.get("meshDetails")?(e.innerHTML="50%",e.style.color="rgba(0,0,0,0.65)"):(e.innerHTML="100%",e.style.color="rgba(0,0,0,1)"),b.appendChild(a.buildTitle("MeshDetails")),b.appendChild(d),b.appendChild(e),b};return{show:function(a){e=a,d()}}}),define("page/PausePage",["helper/DomHelper","helper/LangHelper","page/GamePage","page/HelpPage","page/OptionsPage","page/CompatibilityPage","util/CompatibilityUtil"],function(a,b,c,d,e){var f,g=function h(){a.clearPageContent(),a.addPageTitle(b.get("pauseTitle")),a.addPageButton(b.get("pauseHelp"),function(){d.show(h)}),a.addPageButton(b.get("pauseOptions"),function(){e.show(h)}),a.addPageButton(b.get("pauseRestart"),f)};return{show:function(a){f=a,g()}}}),define("script/AbstractXYZControlScript",["goo/math/Vector3","helper/MathHelper","manager/PlayerManager"],function(a,b,c){function d(){this.x=0,this.yRotation=0,this.yRotationAcc=0,this.z=0,this.afterRunCallback=[]}return d.prototype.onRun=function(a,b){this.afterRunCallback.push({f:a,ctx:b})},d.prototype.run=function(d){this.yRotationAcc=this.yRotationAcc+this.yRotation;var e=this.z*c.get("speed"),f=b.rotateVectorByYRad(new a(this.x,0,e),this.yRotationAcc);d.transformComponent.addTranslation(f.x,0,-f.z),d.transformComponent.setRotation(0,this.yRotationAcc,0);for(var g=0!==this.yRotation||0!==this.x||0!==this.z,h=0,i=this.afterRunCallback.length;i>h;h++){var j=this.afterRunCallback[h];
j.ctx?j.f.call(j.ctx,g):j.f(g)}},d}),define("script/KeyboardXYZControlScript",["helper/KeyboardHelper","helper/DebuggerHelper","script/AbstractXYZControlScript","helper/DomHelper","helper/LangHelper"],function(a,b,c,d,e){function f(){c.prototype.constructor.apply(this),a.listen(38,function(){this.z=g},function(){this.z=0},this),a.listen(40,function(){this.z=-g},function(){this.z=0},this),a.listen(39,function(){this.x=g},function(){this.x=0},this),a.listen(37,function(){this.x=-g},function(){this.x=0},this),a.listen(67,function(){this.yRotation=h},function(){this.yRotation=0},this),a.listen(86,function(){this.yRotation=-h},function(){this.yRotation=0},this);var b;b=d.addTouch("up"),b.title=e.get("forwardKeyboardDescription"),b=d.addTouch("down"),b.title=e.get("backwardKeyboardDescription"),b=d.addTouch("right"),b.title=e.get("rightKeyboardDescription"),b=d.addTouch("left"),b.title=e.get("leftKeyboardDescription"),b=d.addTouch("tournRight"),b.title=e.get("tournRightKeyboardDescription"),b=d.addTouch("tournLeft"),b.title=e.get("tournLeftKeyboardDescription"),b=d.addTouch("shoot"),b.title=e.get("shootKeyboardDescription")}var g=.5,h=.05;return f.prototype=Object.create(c.prototype),f}),define("script/MobileXYZControlScript",["helper/TouchButton","helper/DebuggerHelper","script/AbstractXYZControlScript"],function(a,b,c){function d(){c.prototype.constructor.apply(this);var b=a.build("xzButton",this.handleXZStart,this.handleXZStop,this);document.getElementsByTagName("body")[0].appendChild(b);var d=a.build("yButton",this.handleYStart,this.handleYStop,this);document.getElementsByTagName("body")[0].appendChild(d)}var e=.2,f=.01;return d.prototype=Object.create(c.prototype),d.prototype.handleXZStart=function(a){var c=a.width/2,d=a.height/2;this.x=a.insideX>c?e:-e,this.z=a.insideY>d?-e:e,this.x=a.insideX>a.width/3&&a.insideX<2*(a.width/3)?0:this.x,this.z=a.insideY>a.height/3&&a.insideY<2*(a.height/3)?0:this.z,b.updateDebug("x",this.x,"z",this.z,"yRotation",this.yRotation)},d.prototype.handleXZStop=function(){this.x=0,this.z=0},d.prototype.handleYStart=function(a){var c=a.width/2;this.yRotation=a.insideX>c?-f:f,b.updateDebug("x",this.x,"z",this.z,"yRotation",this.yRotation)},d.prototype.handleYStop=function(){this.yRotation=0},d}),define("script/RunEntityScript",["goo/math/Vector3","manager/EntityManager","helper/MathHelper"],function(a,b,c){"use strict";function d(b,d,e){this.lifeTime=0,this.maxLifeTime=e;var f=c.rotateVectorByYRad(new a(0,0,d),b);this.xBy=f.x,this.zBy=f.z}var e=[];return d.prototype.onRun=function(a){e.push(a)},d.prototype.run=function(a){if(this.lifeTime=this.lifeTime+1,this.maxLifeTime>-1&&this.lifeTime>this.maxLifeTime)return a.removeFromWorld(),void 0;a.transformComponent.addTranslation(this.xBy,0,-this.zBy),b.checkCollision(a);for(var c=0,d=e.length;d>c;c++)e[c]()},d}),define("util/CompatibilityUtil",function(){"use strict";function a(){try{var a=document.createElement("canvas");return!(!a.getContext("webgl")&&!a.getContext("experimental-webgl"))}catch(b){return!1}}function b(){try{var a=document.body||document.documentElement,b=a.style,c="transition";if("string"==typeof b[c])return!0;var d=["Moz","Webkit","Khtml","O","ms"];c=c.charAt(0).toUpperCase()+c.substr(1);for(var e=0;e<d.length;e++)if("string"==typeof b[d[e]+c])return!0}catch(f){return!1}return!1}function c(){try{return"localStorage"in window&&null!==window.localStorage}catch(a){return!1}}function d(){try{var a=document.createElement("audio");return!!a.canPlayType&&!!a.canPlayType("audio/mpeg;").replace(/no/,"")}catch(b){return!1}}function e(){try{var a=document.createElement("audio");return!!a.canPlayType&&!!a.canPlayType('audio/wav; codecs="1"').replace(/no/,"")}catch(b){return!1}}function f(){try{var a=document.createElement("audio");return!!a.canPlayType&&!!a.canPlayType('audio/ogg; codecs="vorbis"').replace(/no/,"")}catch(b){return!1}}function g(){try{return navigator.language.substring(0,2),!0}catch(a){return!1}}function h(){try{var a=document.createElement("span");return"classList"in a&&"add"in a.classList}catch(b){return!1}}var i=a(),j=b(),k=c(),l=d(),m=e(),n=f(),o=g(),p=h();return{isCompatible:function(){return i&&p&&(l||m||n)},isFullCompatible:function(){return i&&j&&p&&k&&o&&l&&m&&n},nbItemCompatible:function(){var a=0;return a+=i===!0?1:0,a+=j===!0?1:0,a+=k===!0?1:0,a+=l===!0?1:0,a+=m===!0?1:0,a+=n===!0?1:0,a+=p===!0?1:0,a+=o===!0?1:0},nbItem:function(){return 8},hasWebGlContext:function(){return i},hasCssTransition:function(){return j},hasLocalStorage:function(){return k},hasAudioMp3:function(){return l},hasAudioWav:function(){return m},hasAudioOgg:function(){return n},hasClassList:function(){return p},hasNavigatorLanguage:function(){return o}}}),define("util/MapUtil",function(){"use strict";var a={tutos:-1,cleanZone:-1,protect:-1,race:-1},b={0:{name:"Shoot",category:"tutos",level:0,camera:{position:{x:0,y:0,z:7}},getEntities:function(){return[{position:{x:0,y:0,z:-7}}]},scoreToWin:0},1:{name:"Move",category:"tutos",level:1,camera:{position:{x:0,y:0,z:7}},getEntities:function(){return[{position:{x:5,y:0,z:-7}},{position:{x:15,y:0,z:7}}]},scoreToWin:0},2:{name:"Fuel",category:"tutos",level:2,camera:{position:{x:0,y:0,z:0}},fuelZone:{position:{x:0,y:0,z:-50}},getEntities:function(){return[{position:{x:0,y:0,z:-100}}]},scoreToWin:0}},c={0:{name:"10 in 2'",category:"cleanZone",level:0,maxTime:120,camera:{position:{x:0,y:0,z:0}},getEntities:function(){for(var a=[],b=0;10>b;b++){var c=100*Math.random()+1-10,d=100*Math.random()+1-10;a.push({position:{x:c,y:0,z:d}})}return a},scoreToWin:1},1:{name:"20 in 2'",category:"cleanZone",level:1,maxTime:120,camera:{position:{x:0,y:0,z:0}},getEntities:function(){for(var a=[],b=0;20>b;b++){var c=100*Math.random()+1-50,d=100*Math.random()+1-50;a.push({position:{x:c,y:0,z:d}})}return a},scoreToWin:1},2:{name:"30 in 2'",category:"cleanZone",level:2,maxTime:120,camera:{position:{x:0,y:0,z:0}},fuelZone:{position:{x:10,y:0,z:10}},getEntities:function(){for(var a=[],b=0;30>b;b++){var c=100*Math.random()+1-100,d=100*Math.random()+1-100;a.push({position:{x:c,y:0,z:d}})}return a},scoreToWin:2},3:{name:"40 in 2'",category:"cleanZone",level:3,maxTime:120,camera:{position:{x:0,y:0,z:0}},fuelZone:{position:{x:10,y:0,z:10}},getEntities:function(){for(var a=[],b=0;40>b;b++){var c=100*Math.random()+1-100,d=100*Math.random()+1-100;a.push({position:{x:c,y:0,z:d}})}return a},scoreToWin:3},4:{name:"50 in 2'",category:"cleanZone",level:4,maxTime:120,camera:{position:{x:0,y:0,z:0}},fuelZone:{position:{x:10,y:0,z:10}},getEntities:function(){for(var a=[],b=0;50>b;b++){var c=100*Math.random()+1-100,d=100*Math.random()+1-100;a.push({position:{x:c,y:0,z:d}})}return a},scoreToWin:5}},d={0:{name:"10 in 100m",category:"protect",level:0,camera:{position:{x:10,y:0,z:60}},starship:{position:{x:0,y:0,z:50}},getEntities:function(){for(var a=[],b=0;10>b;b++){var c=10*Math.random()+1-10,d=40*Math.random()+1-40;a.push({position:{x:c,y:0,z:d}})}return a},finishZone:{position:{x:0,y:0,z:-50}},scoreToWin:1},1:{name:"20 in 200m",category:"protect",level:1,camera:{position:{x:10,y:0,z:110}},starship:{position:{x:0,y:0,z:100}},getEntities:function(){for(var a=[],b=0;20>b;b++){var c=20*Math.random()+1-20,d=90*Math.random()+1-90;a.push({position:{x:c,y:0,z:d}})}return a},finishZone:{position:{x:0,y:0,z:-100}},scoreToWin:2},2:{name:"50 in 500m",category:"protect",level:2,camera:{position:{x:10,y:0,z:260}},starship:{position:{x:0,y:0,z:250}},getEntities:function(){for(var a=[],b=0;50>b;b++){var c=40*Math.random()+1-40,d=230*Math.random()+1-230;a.push({position:{x:c,y:0,z:d}})}return a},finishZone:{position:{x:0,y:0,z:-250}},scoreToWin:3},3:{name:"70 in 500m",category:"protect",level:3,camera:{position:{x:10,y:0,z:260}},starship:{position:{x:0,y:0,z:250}},getEntities:function(){for(var a=[],b=0;70>b;b++){var c=40*Math.random()+1-40,d=230*Math.random()+1-230;a.push({position:{x:c,y:0,z:d}})}return a},finishZone:{position:{x:0,y:0,z:-250}},scoreToWin:3},4:{name:"100 in 1000m",category:"protect",level:4,camera:{position:{x:10,y:0,z:510}},starship:{position:{x:0,y:0,z:500}},getEntities:function(){for(var a=[],b=0;100>b;b++){var c=40*Math.random()+1-40,d=490*Math.random()+1-490;a.push({position:{x:c,y:0,z:d}})}return a},finishZone:{position:{x:0,y:0,z:-500}},scoreToWin:5}},e={0:{name:"1",category:"race",level:0,camera:{position:{x:0,y:0,z:0}},starship:{position:{x:0,y:0,z:7}},getEntities:function(){for(var a=[],b=0;10>b;b++){var c=100*Math.random()+1-50,d=100*Math.random()+1-50;a.push({position:{x:c,y:0,z:d}})}return a},scoreToWin:1}},f={tutos:b,cleanZone:c,protect:d,race:e};return{getAll:function(){return f},getLevels:function(){return a},increment:function(b){var c=b.category;b.level>a[c]&&(a[c]=a[c]+1)}}}),define("util/OptionsUtil",["helper/MobileHelper"],function(a){"use strict";var b={screenSize:.3,meshDetails:1};a.isMobile()&&(b.screenSize=1);var c=b;if(localStorage.options)try{c=JSON.parse(localStorage.options)}catch(d){}return{get:function(a){return c[a]},update:function(a,b){c[a]=b,localStorage.options=JSON.stringify(c)}}}),define("util/RadarUtil",["helper/DomHelper","helper/EntityHelper","manager/EntityManager"],function(a,b,c){"use strict";var d,e,f,g,h,i,j,k,l=50,m=50,n={},o=function(b,c,l,m){f=b,g=c,h=l,i=m,d||(d=a.addRadar(),j=a.buildDiv("radarCamera"),d.appendChild(j),f.script.onRun(p),k=a.buildDiv("radarStarship"),d.appendChild(k),h.script.onRun(q),h.onDead(q)),e&&r(e)},p=function(){var a=b.getPosition(f.entity);j.style.top=a.z*l+50+"px",j.style.left=a.x*m+50+"px"},q=function(){var a=b.getPosition(h.entity);0!==a.y||h.isDead()?k.style.display="none":(k.style.top=a.z*l+50+"px",k.style.left=a.x*m+50+"px",k.style.display="block")},r=function(c){if(e=c,d){d.setAttribute("nbentities",c.length),d.innerHTML="",n={};var f,h,o=100,r=o,s=o,t=0,u=c.length;for(t=0;u>t;t++)f=b.getPosition(c[t].entity),Math.abs(f.x)>r&&(r=f.x),Math.abs(f.z)>s&&(s=f.z);for(l=o/(2*s),m=o/(2*r),t=0;u>t;t++)h=a.buildDiv("radarEntity"),f=b.getPosition(c[t].entity),h.style.top=f.z*l+50+"px",h.style.left=f.x*m+50+"px",d.appendChild(h),n[c[t].entity.name]=h;h=a.buildDiv("radarFuelZone"),f=b.getPosition(g.entity),0===f.y&&(h.style.top=f.z*l+50+"px",h.style.left=f.x*m+50+"px",d.appendChild(h)),h=a.buildDiv("radarFinishZone"),f=b.getPosition(i.entity),0===f.y&&(h.style.top=f.z*l+50+"px",h.style.left=f.x*m+50+"px",d.appendChild(h)),d.appendChild(j),p(),d.appendChild(k),q()}},s=function(a){d&&a&&n[a.name]&&(d.removeChild(n[a.name]),delete n[a.name],d.setAttribute("nbentities",Object.keys(n).length))};return c.onNewEntities(r),c.onRemoveEntity(s),{draw:function(a,b,c,d){o(a,b,c,d)}}}),define("util/ScreenUtil",function(){var a=[],b=window.innerWidth||document.documentElement.clientWidth||document.getElementsByTagName("body")[0].clientWidth,c=window.innerHeight||document.documentElement.clientHeight||document.getElementsByTagName("body")[0].clientHeight,d=function(){b=window.innerWidth||document.documentElement.clientWidth||document.getElementsByTagName("body")[0].clientWidth,c=window.innerHeight||document.documentElement.clientHeight||document.getElementsByTagName("body")[0].clientHeight;for(var d=0,e=a.length;e>d;d++)a[d](b,c)};return window.addEventListener("resize",d,!1),{getWidth:function(){return b},getHeight:function(){return c},onResize:function(b){a.push(b)}}}),define("util/TimeUtil",["helper/DomHelper","helper/EntityHelper","manager/EntityManager"],function(a){"use strict";var b,c,d,e=a.buildDiv("time"),f=!1,g=function(){c=setInterval(function(){b-=1,e.innerHTML=b,0>b&&(clearInterval(c),d())},1e3)};return{start:function(a,c){document.body.appendChild(e),d=c,b=a,f=!0,g()},hide:function(){f&&(f=!1,document.body.removeChild(e),clearInterval(c))},pause:function(){clearInterval(c)},resume:function(){f&&void 0!==b&&g()}}});